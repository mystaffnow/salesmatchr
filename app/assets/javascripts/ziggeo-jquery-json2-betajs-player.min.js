!function(a,b){function c(a){var b=a.length,c=ib.type(a);return ib.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||"function"!==c&&(0===b||"number"==typeof b&&b>0&&b-1 in a)}function d(a){var b=xb[a]={};return ib.each(a.match(kb)||[],function(a,c){b[c]=!0}),b}function e(a,c,d,e){if(ib.acceptData(a)){var f,g,h=ib.expando,i="string"==typeof c,j=a.nodeType,k=j?ib.cache:a,l=j?a[h]:a[h]&&h;if(l&&k[l]&&(e||k[l].data)||!i||d!==b)return l||(j?a[h]=l=_.pop()||ib.guid++:l=h),k[l]||(k[l]={},j||(k[l].toJSON=ib.noop)),("object"==typeof c||"function"==typeof c)&&(e?k[l]=ib.extend(k[l],c):k[l].data=ib.extend(k[l].data,c)),f=k[l],e||(f.data||(f.data={}),f=f.data),d!==b&&(f[ib.camelCase(c)]=d),i?(g=f[c],null==g&&(g=f[ib.camelCase(c)])):g=f,g}}function f(a,b,c){if(ib.acceptData(a)){var d,e,f,g=a.nodeType,i=g?ib.cache:a,j=g?a[ib.expando]:ib.expando;if(i[j]){if(b&&(f=c?i[j]:i[j].data)){ib.isArray(b)?b=b.concat(ib.map(b,ib.camelCase)):b in f?b=[b]:(b=ib.camelCase(b),b=b in f?[b]:b.split(" "));for(d=0,e=b.length;e>d;d++)delete f[b[d]];if(!(c?h:ib.isEmptyObject)(f))return}(c||(delete i[j].data,h(i[j])))&&(g?ib.cleanData([a],!0):ib.support.deleteExpando||i!=i.window?delete i[j]:i[j]=null)}}}function g(a,c,d){if(d===b&&1===a.nodeType){var e="data-"+c.replace(zb,"-$1").toLowerCase();if(d=a.getAttribute(e),"string"==typeof d){try{d="true"===d?!0:"false"===d?!1:"null"===d?null:+d+""===d?+d:yb.test(d)?ib.parseJSON(d):d}catch(f){}ib.data(a,c,d)}else d=b}return d}function h(a){var b;for(b in a)if(("data"!==b||!ib.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function i(){return!0}function j(){return!1}function k(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}function l(a,b,c){if(b=b||0,ib.isFunction(b))return ib.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return ib.grep(a,function(a){return a===b===c});if("string"==typeof b){var d=ib.grep(a,function(a){return 1===a.nodeType});if(Rb.test(b))return ib.filter(b,d,!c);b=ib.filter(b,d)}return ib.grep(a,function(a){return ib.inArray(a,b)>=0===c})}function m(a){var b=Ub.split("|"),c=a.createDocumentFragment();if(c.createElement)for(;b.length;)c.createElement(b.pop());return c}function n(a,b){return a.getElementsByTagName(b)[0]||a.appendChild(a.ownerDocument.createElement(b))}function o(a){var b=a.getAttributeNode("type");return a.type=(b&&b.specified)+"/"+a.type,a}function p(a){var b=ec.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function q(a,b){for(var c,d=0;null!=(c=a[d]);d++)ib._data(c,"globalEval",!b||ib._data(b[d],"globalEval"))}function r(a,b){if(1===b.nodeType&&ib.hasData(a)){var c,d,e,f=ib._data(a),g=ib._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;e>d;d++)ib.event.add(b,c,h[c][d])}g.data&&(g.data=ib.extend({},g.data))}}function s(a,b){var c,d,e;if(1===b.nodeType){if(c=b.nodeName.toLowerCase(),!ib.support.noCloneEvent&&b[ib.expando]){e=ib._data(b);for(d in e.events)ib.removeEvent(b,d,e.handle);b.removeAttribute(ib.expando)}"script"===c&&b.text!==a.text?(o(b).text=a.text,p(b)):"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),ib.support.html5Clone&&a.innerHTML&&!ib.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&bc.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.defaultSelected=b.selected=a.defaultSelected:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}}function t(a,c){var d,e,f=0,g=typeof a.getElementsByTagName!==V?a.getElementsByTagName(c||"*"):typeof a.querySelectorAll!==V?a.querySelectorAll(c||"*"):b;if(!g)for(g=[],d=a.childNodes||a;null!=(e=d[f]);f++)!c||ib.nodeName(e,c)?g.push(e):ib.merge(g,t(e,c));return c===b||c&&ib.nodeName(a,c)?ib.merge([a],g):g}function u(a){bc.test(a.type)&&(a.defaultChecked=a.checked)}function v(a,b){if(b in a)return b;for(var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=yc.length;e--;)if(b=yc[e]+c,b in a)return b;return d}function w(a,b){return a=b||a,"none"===ib.css(a,"display")||!ib.contains(a.ownerDocument,a)}function x(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=ib._data(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&w(d)&&(f[g]=ib._data(d,"olddisplay",B(d.nodeName)))):f[g]||(e=w(d),(c&&"none"!==c||!e)&&ib._data(d,"olddisplay",e?c:ib.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function y(a,b,c){var d=rc.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function z(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=ib.css(a,c+xc[f],!0,e)),d?("content"===c&&(g-=ib.css(a,"padding"+xc[f],!0,e)),"margin"!==c&&(g-=ib.css(a,"border"+xc[f]+"Width",!0,e))):(g+=ib.css(a,"padding"+xc[f],!0,e),"padding"!==c&&(g+=ib.css(a,"border"+xc[f]+"Width",!0,e)));return g}function A(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=kc(a),g=ib.support.boxSizing&&"border-box"===ib.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=lc(a,b,f),(0>e||null==e)&&(e=a.style[b]),sc.test(e))return e;d=g&&(ib.support.boxSizingReliable||e===a.style[b]),e=parseFloat(e)||0}return e+z(a,b,c||(g?"border":"content"),d,f)+"px"}function B(a){var b=W,c=uc[a];return c||(c=C(a,b),"none"!==c&&c||(jc=(jc||ib("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(b.documentElement),b=(jc[0].contentWindow||jc[0].contentDocument).document,b.write("<!doctype html><html><body>"),b.close(),c=C(a,b),jc.detach()),uc[a]=c),c}function C(a,b){var c=ib(b.createElement(a)).appendTo(b.body),d=ib.css(c[0],"display");return c.remove(),d}function D(a,b,c,d){var e;if(ib.isArray(b))ib.each(b,function(b,e){c||Ac.test(a)?d(a,e):D(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==ib.type(b))d(a,b);else for(e in b)D(a+"["+e+"]",b[e],c,d)}function E(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(kb)||[];if(ib.isFunction(c))for(;d=f[e++];)"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function F(a,b,c,d){function e(h){var i;return f[h]=!0,ib.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||g||f[j]?g?!(i=j):void 0:(b.dataTypes.unshift(j),e(j),!1)}),i}var f={},g=a===Rc;return e(b.dataTypes[0])||!f["*"]&&e("*")}function G(a,c){var d,e,f=ib.ajaxSettings.flatOptions||{};for(e in c)c[e]!==b&&((f[e]?a:d||(d={}))[e]=c[e]);return d&&ib.extend(!0,a,d),a}function H(a,c,d){var e,f,g,h,i=a.contents,j=a.dataTypes,k=a.responseFields;for(h in k)h in d&&(c[k[h]]=d[h]);for(;"*"===j[0];)j.shift(),f===b&&(f=a.mimeType||c.getResponseHeader("Content-Type"));if(f)for(h in i)if(i[h]&&i[h].test(f)){j.unshift(h);break}if(j[0]in d)g=j[0];else{for(h in d){if(!j[0]||a.converters[h+" "+j[0]]){g=h;break}e||(e=h)}g=g||e}return g?(g!==j[0]&&j.unshift(g),d[g]):void 0}function I(a,b){var c,d,e,f,g={},h=0,i=a.dataTypes.slice(),j=i[0];if(a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i[1])for(e in a.converters)g[e.toLowerCase()]=a.converters[e];for(;d=i[++h];)if("*"!==d){if("*"!==j&&j!==d){if(e=g[j+" "+d]||g["* "+d],!e)for(c in g)if(f=c.split(" "),f[1]===d&&(e=g[j+" "+f[0]]||g["* "+f[0]])){e===!0?e=g[c]:g[c]!==!0&&(d=f[0],i.splice(h--,0,d));break}if(e!==!0)if(e&&a["throws"])b=e(b);else try{b=e(b)}catch(k){return{state:"parsererror",error:e?k:"No conversion from "+j+" to "+d}}}j=d}return{state:"success",data:b}}function J(){try{return new a.XMLHttpRequest}catch(b){}}function K(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function L(){return setTimeout(function(){$c=b}),$c=ib.now()}function M(a,b){ib.each(b,function(b,c){for(var d=(ed[b]||[]).concat(ed["*"]),e=0,f=d.length;f>e;e++)if(d[e].call(a,b,c))return})}function N(a,b,c){var d,e,f=0,g=dd.length,h=ib.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=$c||L(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:ib.extend({},b),opts:ib.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:$c||L(),duration:c.duration,tweens:[],createTween:function(b,c){var d=ib.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(O(k,j.opts.specialEasing);g>f;f++)if(d=dd[f].call(j,a,k,j.opts))return d;return M(j,k),ib.isFunction(j.opts.start)&&j.opts.start.call(a,j),ib.fx.timer(ib.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function O(a,b){var c,d,e,f,g;for(e in a)if(d=ib.camelCase(e),f=b[d],c=a[e],ib.isArray(c)&&(f=c[1],c=a[e]=c[0]),e!==d&&(a[d]=c,delete a[e]),g=ib.cssHooks[d],g&&"expand"in g){c=g.expand(c),delete a[d];for(e in c)e in a||(a[e]=c[e],b[e]=f)}else b[d]=f}function P(a,b,c){var d,e,f,g,h,i,j,k,l,m=this,n=a.style,o={},p=[],q=a.nodeType&&w(a);c.queue||(k=ib._queueHooks(a,"fx"),null==k.unqueued&&(k.unqueued=0,l=k.empty.fire,k.empty.fire=function(){k.unqueued||l()}),k.unqueued++,m.always(function(){m.always(function(){k.unqueued--,ib.queue(a,"fx").length||k.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[n.overflow,n.overflowX,n.overflowY],"inline"===ib.css(a,"display")&&"none"===ib.css(a,"float")&&(ib.support.inlineBlockNeedsLayout&&"inline"!==B(a.nodeName)?n.zoom=1:n.display="inline-block")),c.overflow&&(n.overflow="hidden",ib.support.shrinkWrapBlocks||m.always(function(){n.overflow=c.overflow[0],n.overflowX=c.overflow[1],n.overflowY=c.overflow[2]}));for(e in b)if(g=b[e],ad.exec(g)){if(delete b[e],i=i||"toggle"===g,g===(q?"hide":"show"))continue;p.push(e)}if(f=p.length){h=ib._data(a,"fxshow")||ib._data(a,"fxshow",{}),"hidden"in h&&(q=h.hidden),i&&(h.hidden=!q),q?ib(a).show():m.done(function(){ib(a).hide()}),m.done(function(){var b;ib._removeData(a,"fxshow");for(b in o)ib.style(a,b,o[b])});for(e=0;f>e;e++)d=p[e],j=m.createTween(d,q?h[d]:0),o[d]=h[d]||ib.style(a,d),d in h||(h[d]=j.start,q&&(j.end=j.start,j.start="width"===d||"height"===d?1:0))}}function Q(a,b,c,d,e){return new Q.prototype.init(a,b,c,d,e)}function R(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=xc[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function S(a){return ib.isWindow(a)?a:9===a.nodeType?a.defaultView||a.parentWindow:!1}var T,U,V=typeof b,W=a.document,X=a.location,Y=a.jQuery,Z=a.$,$={},_=[],ab="1.9.1",bb=_.concat,cb=_.push,db=_.slice,eb=_.indexOf,fb=$.toString,gb=$.hasOwnProperty,hb=ab.trim,ib=function(a,b){return new ib.fn.init(a,b,U)},jb=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,kb=/\S+/g,lb=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,mb=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,nb=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,ob=/^[\],:{}\s]*$/,pb=/(?:^|:|,)(?:\s*\[)+/g,qb=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,rb=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,sb=/^-ms-/,tb=/-([\da-z])/gi,ub=function(a,b){return b.toUpperCase()},vb=function(a){(W.addEventListener||"load"===a.type||"complete"===W.readyState)&&(wb(),ib.ready())},wb=function(){W.addEventListener?(W.removeEventListener("DOMContentLoaded",vb,!1),a.removeEventListener("load",vb,!1)):(W.detachEvent("onreadystatechange",vb),a.detachEvent("onload",vb))};ib.fn=ib.prototype={jquery:ab,constructor:ib,init:function(a,c,d){var e,f;if(!a)return this;if("string"==typeof a){if(e="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:mb.exec(a),!e||!e[1]&&c)return!c||c.jquery?(c||d).find(a):this.constructor(c).find(a);if(e[1]){if(c=c instanceof ib?c[0]:c,ib.merge(this,ib.parseHTML(e[1],c&&c.nodeType?c.ownerDocument||c:W,!0)),nb.test(e[1])&&ib.isPlainObject(c))for(e in c)ib.isFunction(this[e])?this[e](c[e]):this.attr(e,c[e]);return this}if(f=W.getElementById(e[2]),f&&f.parentNode){if(f.id!==e[2])return d.find(a);this.length=1,this[0]=f}return this.context=W,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):ib.isFunction(a)?d.ready(a):(a.selector!==b&&(this.selector=a.selector,this.context=a.context),ib.makeArray(a,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return db.call(this)},get:function(a){return null==a?this.toArray():0>a?this[this.length+a]:this[a]},pushStack:function(a){var b=ib.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return ib.each(this,a,b)},ready:function(a){return ib.ready.promise().done(a),this},slice:function(){return this.pushStack(db.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},map:function(a){return this.pushStack(ib.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:cb,sort:[].sort,splice:[].splice},ib.fn.init.prototype=ib.fn,ib.extend=ib.fn.extend=function(){var a,c,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;for("boolean"==typeof h&&(k=h,h=arguments[1]||{},i=2),"object"==typeof h||ib.isFunction(h)||(h={}),j===i&&(h=this,--i);j>i;i++)if(null!=(f=arguments[i]))for(e in f)a=h[e],d=f[e],h!==d&&(k&&d&&(ib.isPlainObject(d)||(c=ib.isArray(d)))?(c?(c=!1,g=a&&ib.isArray(a)?a:[]):g=a&&ib.isPlainObject(a)?a:{},h[e]=ib.extend(k,g,d)):d!==b&&(h[e]=d));return h},ib.extend({noConflict:function(b){return a.$===ib&&(a.$=Z),b&&a.jQuery===ib&&(a.jQuery=Y),ib},isReady:!1,readyWait:1,holdReady:function(a){a?ib.readyWait++:ib.ready(!0)},ready:function(a){if(a===!0?!--ib.readyWait:!ib.isReady){if(!W.body)return setTimeout(ib.ready);ib.isReady=!0,a!==!0&&--ib.readyWait>0||(T.resolveWith(W,[ib]),ib.fn.trigger&&ib(W).trigger("ready").off("ready"))}},isFunction:function(a){return"function"===ib.type(a)},isArray:Array.isArray||function(a){return"array"===ib.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return null==a?String(a):"object"==typeof a||"function"==typeof a?$[fb.call(a)]||"object":typeof a},isPlainObject:function(a){if(!a||"object"!==ib.type(a)||a.nodeType||ib.isWindow(a))return!1;try{if(a.constructor&&!gb.call(a,"constructor")&&!gb.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}var d;for(d in a);return d===b||gb.call(a,d)},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},error:function(a){throw new Error(a)},parseHTML:function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||W;var d=nb.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=ib.buildFragment([a],b,e),e&&ib(e).remove(),ib.merge([],d.childNodes))},parseJSON:function(b){return a.JSON&&a.JSON.parse?a.JSON.parse(b):null===b?b:"string"==typeof b&&(b=ib.trim(b),b&&ob.test(b.replace(qb,"@").replace(rb,"]").replace(pb,"")))?new Function("return "+b)():(ib.error("Invalid JSON: "+b),void 0)},parseXML:function(c){var d,e;if(!c||"string"!=typeof c)return null;try{a.DOMParser?(e=new DOMParser,d=e.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(f){d=b}return d&&d.documentElement&&!d.getElementsByTagName("parsererror").length||ib.error("Invalid XML: "+c),d},noop:function(){},globalEval:function(b){b&&ib.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(sb,"ms-").replace(tb,ub)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,d){var e,f=0,g=a.length,h=c(a);if(d){if(h)for(;g>f&&(e=b.apply(a[f],d),e!==!1);f++);else for(f in a)if(e=b.apply(a[f],d),e===!1)break}else if(h)for(;g>f&&(e=b.call(a[f],f,a[f]),e!==!1);f++);else for(f in a)if(e=b.call(a[f],f,a[f]),e===!1)break;return a},trim:hb&&!hb.call("ï»¿Â ")?function(a){return null==a?"":hb.call(a)}:function(a){return null==a?"":(a+"").replace(lb,"")},makeArray:function(a,b){var d=b||[];return null!=a&&(c(Object(a))?ib.merge(d,"string"==typeof a?[a]:a):cb.call(d,a)),d},inArray:function(a,b,c){var d;if(b){if(eb)return eb.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=c.length,e=a.length,f=0;if("number"==typeof d)for(;d>f;f++)a[e++]=c[f];else for(;c[f]!==b;)a[e++]=c[f++];return a.length=e,a},grep:function(a,b,c){var d,e=[],f=0,g=a.length;for(c=!!c;g>f;f++)d=!!b(a[f],f),c!==d&&e.push(a[f]);return e},map:function(a,b,d){var e,f=0,g=a.length,h=c(a),i=[];if(h)for(;g>f;f++)e=b(a[f],f,d),null!=e&&(i[i.length]=e);else for(f in a)e=b(a[f],f,d),null!=e&&(i[i.length]=e);return bb.apply([],i)},guid:1,proxy:function(a,c){var d,e,f;return"string"==typeof c&&(f=a[c],c=a,a=f),ib.isFunction(a)?(d=db.call(arguments,2),e=function(){return a.apply(c||this,d.concat(db.call(arguments)))},e.guid=a.guid=a.guid||ib.guid++,e):b},access:function(a,c,d,e,f,g,h){var i=0,j=a.length,k=null==d;if("object"===ib.type(d)){f=!0;for(i in d)ib.access(a,c,i,d[i],!0,g,h)}else if(e!==b&&(f=!0,ib.isFunction(e)||(h=!0),k&&(h?(c.call(a,e),c=null):(k=c,c=function(a,b,c){return k.call(ib(a),c)})),c))for(;j>i;i++)c(a[i],d,h?e:e.call(a[i],i,c(a[i],d)));return f?a:k?c.call(a):j?c(a[0],d):g},now:function(){return(new Date).getTime()}}),ib.ready.promise=function(b){if(!T)if(T=ib.Deferred(),"complete"===W.readyState)setTimeout(ib.ready);else if(W.addEventListener)W.addEventListener("DOMContentLoaded",vb,!1),a.addEventListener("load",vb,!1);else{W.attachEvent("onreadystatechange",vb),a.attachEvent("onload",vb);var c=!1;try{c=null==a.frameElement&&W.documentElement}catch(d){}c&&c.doScroll&&!function e(){if(!ib.isReady){try{c.doScroll("left")}catch(a){return setTimeout(e,50)}wb(),ib.ready()}}()}return T.promise(b)},ib.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){$["[object "+b+"]"]=b.toLowerCase()}),U=ib(W);var xb={};ib.Callbacks=function(a){a="string"==typeof a?xb[a]||d(a):ib.extend({},a);var c,e,f,g,h,i,j=[],k=!a.once&&[],l=function(b){for(e=a.memory&&b,f=!0,h=i||0,i=0,g=j.length,c=!0;j&&g>h;h++)if(j[h].apply(b[0],b[1])===!1&&a.stopOnFalse){e=!1;break}c=!1,j&&(k?k.length&&l(k.shift()):e?j=[]:m.disable())},m={add:function(){if(j){var b=j.length;!function d(b){ib.each(b,function(b,c){var e=ib.type(c);"function"===e?a.unique&&m.has(c)||j.push(c):c&&c.length&&"string"!==e&&d(c)})}(arguments),c?g=j.length:e&&(i=b,l(e))}return this},remove:function(){return j&&ib.each(arguments,function(a,b){for(var d;(d=ib.inArray(b,j,d))>-1;)j.splice(d,1),c&&(g>=d&&g--,h>=d&&h--)}),this},has:function(a){return a?ib.inArray(a,j)>-1:!(!j||!j.length)},empty:function(){return j=[],this},disable:function(){return j=k=e=b,this},disabled:function(){return!j},lock:function(){return k=b,e||m.disable(),this},locked:function(){return!k},fireWith:function(a,b){return b=b||[],b=[a,b.slice?b.slice():b],!j||f&&!k||(c?k.push(b):l(b)),this},fire:function(){return m.fireWith(this,arguments),this},fired:function(){return!!f}};return m},ib.extend({Deferred:function(a){var b=[["resolve","done",ib.Callbacks("once memory"),"resolved"],["reject","fail",ib.Callbacks("once memory"),"rejected"],["notify","progress",ib.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return ib.Deferred(function(c){ib.each(b,function(b,f){var g=f[0],h=ib.isFunction(a[b])&&a[b];e[f[1]](function(){var a=h&&h.apply(this,arguments);a&&ib.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[g+"With"](this===d?c.promise():this,h?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?ib.extend(a,d):d}},e={};return d.pipe=d.then,ib.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b,c,d,e=0,f=db.call(arguments),g=f.length,h=1!==g||a&&ib.isFunction(a.promise)?g:0,i=1===h?a:ib.Deferred(),j=function(a,c,d){return function(e){c[a]=this,d[a]=arguments.length>1?db.call(arguments):e,d===b?i.notifyWith(c,d):--h||i.resolveWith(c,d)}};if(g>1)for(b=new Array(g),c=new Array(g),d=new Array(g);g>e;e++)f[e]&&ib.isFunction(f[e].promise)?f[e].promise().done(j(e,d,f)).fail(i.reject).progress(j(e,c,b)):--h;return h||i.resolveWith(d,f),i.promise()}}),ib.support=function(){var b,c,d,e,f,g,h,i,j,k,l=W.createElement("div");if(l.setAttribute("className","t"),l.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",c=l.getElementsByTagName("*"),d=l.getElementsByTagName("a")[0],!c||!d||!c.length)return{};f=W.createElement("select"),h=f.appendChild(W.createElement("option")),e=l.getElementsByTagName("input")[0],d.style.cssText="top:1px;float:left;opacity:.5",b={getSetAttribute:"t"!==l.className,leadingWhitespace:3===l.firstChild.nodeType,tbody:!l.getElementsByTagName("tbody").length,htmlSerialize:!!l.getElementsByTagName("link").length,style:/top/.test(d.getAttribute("style")),hrefNormalized:"/a"===d.getAttribute("href"),opacity:/^0.5/.test(d.style.opacity),cssFloat:!!d.style.cssFloat,checkOn:!!e.value,optSelected:h.selected,enctype:!!W.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==W.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===W.compatMode,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},e.checked=!0,b.noCloneChecked=e.cloneNode(!0).checked,f.disabled=!0,b.optDisabled=!h.disabled;try{delete l.test}catch(m){b.deleteExpando=!1}e=W.createElement("input"),e.setAttribute("value",""),b.input=""===e.getAttribute("value"),e.value="t",e.setAttribute("type","radio"),b.radioValue="t"===e.value,e.setAttribute("checked","t"),e.setAttribute("name","t"),g=W.createDocumentFragment(),g.appendChild(e),b.appendChecked=e.checked,b.checkClone=g.cloneNode(!0).cloneNode(!0).lastChild.checked,l.attachEvent&&(l.attachEvent("onclick",function(){b.noCloneEvent=!1}),l.cloneNode(!0).click());for(k in{submit:!0,change:!0,focusin:!0})l.setAttribute(i="on"+k,"t"),b[k+"Bubbles"]=i in a||l.attributes[i].expando===!1;return l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",b.clearCloneStyle="content-box"===l.style.backgroundClip,ib(function(){var c,d,e,f="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",g=W.getElementsByTagName("body")[0];g&&(c=W.createElement("div"),c.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",g.appendChild(c).appendChild(l),l.innerHTML="<table><tr><td></td><td>t</td></tr></table>",e=l.getElementsByTagName("td"),e[0].style.cssText="padding:0;margin:0;border:0;display:none",j=0===e[0].offsetHeight,e[0].style.display="",e[1].style.display="none",b.reliableHiddenOffsets=j&&0===e[0].offsetHeight,l.innerHTML="",l.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",b.boxSizing=4===l.offsetWidth,b.doesNotIncludeMarginInBodyOffset=1!==g.offsetTop,a.getComputedStyle&&(b.pixelPosition="1%"!==(a.getComputedStyle(l,null)||{}).top,b.boxSizingReliable="4px"===(a.getComputedStyle(l,null)||{width:"4px"}).width,d=l.appendChild(W.createElement("div")),d.style.cssText=l.style.cssText=f,d.style.marginRight=d.style.width="0",l.style.width="1px",b.reliableMarginRight=!parseFloat((a.getComputedStyle(d,null)||{}).marginRight)),typeof l.style.zoom!==V&&(l.innerHTML="",l.style.cssText=f+"width:1px;padding:1px;display:inline;zoom:1",b.inlineBlockNeedsLayout=3===l.offsetWidth,l.style.display="block",l.innerHTML="<div></div>",l.firstChild.style.width="5px",b.shrinkWrapBlocks=3!==l.offsetWidth,b.inlineBlockNeedsLayout&&(g.style.zoom=1)),g.removeChild(c),c=l=e=d=null)}),c=f=g=h=d=e=null,b}();var yb=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,zb=/([A-Z])/g;ib.extend({cache:{},expando:"jQuery"+(ab+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){return a=a.nodeType?ib.cache[a[ib.expando]]:a[ib.expando],!!a&&!h(a)},data:function(a,b,c){return e(a,b,c)},removeData:function(a,b){return f(a,b)},_data:function(a,b,c){return e(a,b,c,!0)},_removeData:function(a,b){return f(a,b,!0)},acceptData:function(a){if(a.nodeType&&1!==a.nodeType&&9!==a.nodeType)return!1;var b=a.nodeName&&ib.noData[a.nodeName.toLowerCase()];return!b||b!==!0&&a.getAttribute("classid")===b}}),ib.fn.extend({data:function(a,c){var d,e,f=this[0],h=0,i=null;if(a===b){if(this.length&&(i=ib.data(f),1===f.nodeType&&!ib._data(f,"parsedAttrs"))){for(d=f.attributes;h<d.length;h++)e=d[h].name,e.indexOf("data-")||(e=ib.camelCase(e.slice(5)),g(f,e,i[e]));ib._data(f,"parsedAttrs",!0)}return i}return"object"==typeof a?this.each(function(){ib.data(this,a)}):ib.access(this,function(c){return c===b?f?g(f,a,ib.data(f,a)):null:(this.each(function(){ib.data(this,a,c)}),void 0)},null,c,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){ib.removeData(this,a)})}}),ib.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=ib._data(a,b),c&&(!d||ib.isArray(c)?d=ib._data(a,b,ib.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=ib.queue(a,b),d=c.length,e=c.shift(),f=ib._queueHooks(a,b),g=function(){ib.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),f.cur=e,e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return ib._data(a,c)||ib._data(a,c,{empty:ib.Callbacks("once memory").add(function(){ib._removeData(a,b+"queue"),ib._removeData(a,c)})})}}),ib.fn.extend({queue:function(a,c){var d=2;return"string"!=typeof a&&(c=a,a="fx",d--),arguments.length<d?ib.queue(this[0],a):c===b?this:this.each(function(){var b=ib.queue(this,a,c);ib._queueHooks(this,a),"fx"===a&&"inprogress"!==b[0]&&ib.dequeue(this,a)})},dequeue:function(a){return this.each(function(){ib.dequeue(this,a)})},delay:function(a,b){return a=ib.fx?ib.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){var d,e=1,f=ib.Deferred(),g=this,h=this.length,i=function(){--e||f.resolveWith(g,[g])};for("string"!=typeof a&&(c=a,a=b),a=a||"fx";h--;)d=ib._data(g[h],a+"queueHooks"),d&&d.empty&&(e++,d.empty.add(i));return i(),f.promise(c)}});var Ab,Bb,Cb=/[\t\r\n]/g,Db=/\r/g,Eb=/^(?:input|select|textarea|button|object)$/i,Fb=/^(?:a|area)$/i,Gb=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,Hb=/^(?:checked|selected)$/i,Ib=ib.support.getSetAttribute,Jb=ib.support.input;ib.fn.extend({attr:function(a,b){return ib.access(this,ib.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){ib.removeAttr(this,a)})},prop:function(a,b){return ib.access(this,ib.prop,a,b,arguments.length>1)},removeProp:function(a){return a=ib.propFix[a]||a,this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,f,g=0,h=this.length,i="string"==typeof a&&a;if(ib.isFunction(a))return this.each(function(b){ib(this).addClass(a.call(this,b,this.className))});if(i)for(b=(a||"").match(kb)||[];h>g;g++)if(c=this[g],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(Cb," "):" ")){for(f=0;e=b[f++];)d.indexOf(" "+e+" ")<0&&(d+=e+" ");c.className=ib.trim(d)}return this},removeClass:function(a){var b,c,d,e,f,g=0,h=this.length,i=0===arguments.length||"string"==typeof a&&a;if(ib.isFunction(a))return this.each(function(b){ib(this).removeClass(a.call(this,b,this.className))});if(i)for(b=(a||"").match(kb)||[];h>g;g++)if(c=this[g],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(Cb," "):"")){for(f=0;e=b[f++];)for(;d.indexOf(" "+e+" ")>=0;)d=d.replace(" "+e+" "," ");c.className=a?ib.trim(d):""}return this},toggleClass:function(a,b){var c=typeof a,d="boolean"==typeof b;return ib.isFunction(a)?this.each(function(c){ib(this).toggleClass(a.call(this,c,this.className,b),b)}):this.each(function(){if("string"===c)for(var e,f=0,g=ib(this),h=b,i=a.match(kb)||[];e=i[f++];)h=d?h:!g.hasClass(e),g[h?"addClass":"removeClass"](e);else(c===V||"boolean"===c)&&(this.className&&ib._data(this,"__className__",this.className),this.className=this.className||a===!1?"":ib._data(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(Cb," ").indexOf(b)>=0)return!0;return!1},val:function(a){var c,d,e,f=this[0];{if(arguments.length)return e=ib.isFunction(a),this.each(function(c){var f,g=ib(this);1===this.nodeType&&(f=e?a.call(this,c,g.val()):a,null==f?f="":"number"==typeof f?f+="":ib.isArray(f)&&(f=ib.map(f,function(a){return null==a?"":a+""})),d=ib.valHooks[this.type]||ib.valHooks[this.nodeName.toLowerCase()],d&&"set"in d&&d.set(this,f,"value")!==b||(this.value=f))});if(f)return d=ib.valHooks[f.type]||ib.valHooks[f.nodeName.toLowerCase()],d&&"get"in d&&(c=d.get(f,"value"))!==b?c:(c=f.value,"string"==typeof c?c.replace(Db,""):null==c?"":c)}}}),ib.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(ib.support.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&ib.nodeName(c.parentNode,"optgroup"))){if(b=ib(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c=ib.makeArray(b);return ib(a).find("option").each(function(){this.selected=ib.inArray(ib(this).val(),c)>=0}),c.length||(a.selectedIndex=-1),c}}},attr:function(a,c,d){var e,f,g,h=a.nodeType;if(a&&3!==h&&8!==h&&2!==h)return typeof a.getAttribute===V?ib.prop(a,c,d):(f=1!==h||!ib.isXMLDoc(a),f&&(c=c.toLowerCase(),e=ib.attrHooks[c]||(Gb.test(c)?Bb:Ab)),d===b?e&&f&&"get"in e&&null!==(g=e.get(a,c))?g:(typeof a.getAttribute!==V&&(g=a.getAttribute(c)),null==g?b:g):null!==d?e&&f&&"set"in e&&(g=e.set(a,d,c))!==b?g:(a.setAttribute(c,d+""),d):(ib.removeAttr(a,c),void 0))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(kb);if(f&&1===a.nodeType)for(;c=f[e++];)d=ib.propFix[c]||c,Gb.test(c)?!Ib&&Hb.test(c)?a[ib.camelCase("default-"+c)]=a[d]=!1:a[d]=!1:ib.attr(a,c,""),a.removeAttribute(Ib?c:d)},attrHooks:{type:{set:function(a,b){if(!ib.support.radioValue&&"radio"===b&&ib.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,f,g,h=a.nodeType;if(a&&3!==h&&8!==h&&2!==h)return g=1!==h||!ib.isXMLDoc(a),g&&(c=ib.propFix[c]||c,f=ib.propHooks[c]),d!==b?f&&"set"in f&&(e=f.set(a,d,c))!==b?e:a[c]=d:f&&"get"in f&&null!==(e=f.get(a,c))?e:a[c]},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):Eb.test(a.nodeName)||Fb.test(a.nodeName)&&a.href?0:b}}}}),Bb={get:function(a,c){var d=ib.prop(a,c),e="boolean"==typeof d&&a.getAttribute(c),f="boolean"==typeof d?Jb&&Ib?null!=e:Hb.test(c)?a[ib.camelCase("default-"+c)]:!!e:a.getAttributeNode(c);
  return f&&f.value!==!1?c.toLowerCase():b},set:function(a,b,c){return b===!1?ib.removeAttr(a,c):Jb&&Ib||!Hb.test(c)?a.setAttribute(!Ib&&ib.propFix[c]||c,c):a[ib.camelCase("default-"+c)]=a[c]=!0,c}},Jb&&Ib||(ib.attrHooks.value={get:function(a,c){var d=a.getAttributeNode(c);return ib.nodeName(a,"input")?a.defaultValue:d&&d.specified?d.value:b},set:function(a,b,c){return ib.nodeName(a,"input")?(a.defaultValue=b,void 0):Ab&&Ab.set(a,b,c)}}),Ib||(Ab=ib.valHooks.button={get:function(a,c){var d=a.getAttributeNode(c);return d&&("id"===c||"name"===c||"coords"===c?""!==d.value:d.specified)?d.value:b},set:function(a,c,d){var e=a.getAttributeNode(d);return e||a.setAttributeNode(e=a.ownerDocument.createAttribute(d)),e.value=c+="","value"===d||c===a.getAttribute(d)?c:b}},ib.attrHooks.contenteditable={get:Ab.get,set:function(a,b,c){Ab.set(a,""===b?!1:b,c)}},ib.each(["width","height"],function(a,b){ib.attrHooks[b]=ib.extend(ib.attrHooks[b],{set:function(a,c){return""===c?(a.setAttribute(b,"auto"),c):void 0}})})),ib.support.hrefNormalized||(ib.each(["href","src","width","height"],function(a,c){ib.attrHooks[c]=ib.extend(ib.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return null==d?b:d}})}),ib.each(["href","src"],function(a,b){ib.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}})),ib.support.style||(ib.attrHooks.style={get:function(a){return a.style.cssText||b},set:function(a,b){return a.style.cssText=b+""}}),ib.support.optSelected||(ib.propHooks.selected=ib.extend(ib.propHooks.selected,{get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}})),ib.support.enctype||(ib.propFix.enctype="encoding"),ib.support.checkOn||ib.each(["radio","checkbox"],function(){ib.valHooks[this]={get:function(a){return null===a.getAttribute("value")?"on":a.value}}}),ib.each(["radio","checkbox"],function(){ib.valHooks[this]=ib.extend(ib.valHooks[this],{set:function(a,b){return ib.isArray(b)?a.checked=ib.inArray(ib(a).val(),b)>=0:void 0}})});var Kb=/^(?:input|select|textarea)$/i,Lb=/^key/,Mb=/^(?:mouse|contextmenu)|click/,Nb=/^(?:focusinfocus|focusoutblur)$/,Ob=/^([^.]*)(?:\.(.+)|)$/;ib.event={global:{},add:function(a,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r=ib._data(a);if(r){for(d.handler&&(j=d,d=j.handler,f=j.selector),d.guid||(d.guid=ib.guid++),(h=r.events)||(h=r.events={}),(l=r.handle)||(l=r.handle=function(a){return typeof ib===V||a&&ib.event.triggered===a.type?b:ib.event.dispatch.apply(l.elem,arguments)},l.elem=a),c=(c||"").match(kb)||[""],i=c.length;i--;)g=Ob.exec(c[i])||[],o=q=g[1],p=(g[2]||"").split(".").sort(),k=ib.event.special[o]||{},o=(f?k.delegateType:k.bindType)||o,k=ib.event.special[o]||{},m=ib.extend({type:o,origType:q,data:e,handler:d,guid:d.guid,selector:f,needsContext:f&&ib.expr.match.needsContext.test(f),namespace:p.join(".")},j),(n=h[o])||(n=h[o]=[],n.delegateCount=0,k.setup&&k.setup.call(a,e,p,l)!==!1||(a.addEventListener?a.addEventListener(o,l,!1):a.attachEvent&&a.attachEvent("on"+o,l))),k.add&&(k.add.call(a,m),m.handler.guid||(m.handler.guid=d.guid)),f?n.splice(n.delegateCount++,0,m):n.push(m),ib.event.global[o]=!0;a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=ib.hasData(a)&&ib._data(a);if(q&&(k=q.events)){for(b=(b||"").match(kb)||[""],j=b.length;j--;)if(h=Ob.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){for(l=ib.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=k[n]||[],h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=f=m.length;f--;)g=m[f],!e&&p!==g.origType||c&&c.guid!==g.guid||h&&!h.test(g.namespace)||d&&d!==g.selector&&("**"!==d||!g.selector)||(m.splice(f,1),g.selector&&m.delegateCount--,l.remove&&l.remove.call(a,g));i&&!m.length&&(l.teardown&&l.teardown.call(a,o,q.handle)!==!1||ib.removeEvent(a,n,q.handle),delete k[n])}else for(n in k)ib.event.remove(a,n+b[j],c,d,!0);ib.isEmptyObject(k)&&(delete q.handle,ib._removeData(a,"events"))}},trigger:function(c,d,e,f){var g,h,i,j,k,l,m,n=[e||W],o=gb.call(c,"type")?c.type:c,p=gb.call(c,"namespace")?c.namespace.split("."):[];if(i=l=e=e||W,3!==e.nodeType&&8!==e.nodeType&&!Nb.test(o+ib.event.triggered)&&(o.indexOf(".")>=0&&(p=o.split("."),o=p.shift(),p.sort()),h=o.indexOf(":")<0&&"on"+o,c=c[ib.expando]?c:new ib.Event(o,"object"==typeof c&&c),c.isTrigger=!0,c.namespace=p.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,c.result=b,c.target||(c.target=e),d=null==d?[c]:ib.makeArray(d,[c]),k=ib.event.special[o]||{},f||!k.trigger||k.trigger.apply(e,d)!==!1)){if(!f&&!k.noBubble&&!ib.isWindow(e)){for(j=k.delegateType||o,Nb.test(j+o)||(i=i.parentNode);i;i=i.parentNode)n.push(i),l=i;l===(e.ownerDocument||W)&&n.push(l.defaultView||l.parentWindow||a)}for(m=0;(i=n[m++])&&!c.isPropagationStopped();)c.type=m>1?j:k.bindType||o,g=(ib._data(i,"events")||{})[c.type]&&ib._data(i,"handle"),g&&g.apply(i,d),g=h&&i[h],g&&ib.acceptData(i)&&g.apply&&g.apply(i,d)===!1&&c.preventDefault();if(c.type=o,!(f||c.isDefaultPrevented()||k._default&&k._default.apply(e.ownerDocument,d)!==!1||"click"===o&&ib.nodeName(e,"a")||!ib.acceptData(e)||!h||!e[o]||ib.isWindow(e))){l=e[h],l&&(e[h]=null),ib.event.triggered=o;try{e[o]()}catch(q){}ib.event.triggered=b,l&&(e[h]=l)}return c.result}},dispatch:function(a){a=ib.event.fix(a);var c,d,e,f,g,h=[],i=db.call(arguments),j=(ib._data(this,"events")||{})[a.type]||[],k=ib.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){for(h=ib.event.handlers.call(this,a,j),c=0;(f=h[c++])&&!a.isPropagationStopped();)for(a.currentTarget=f.elem,g=0;(e=f.handlers[g++])&&!a.isImmediatePropagationStopped();)(!a.namespace_re||a.namespace_re.test(e.namespace))&&(a.handleObj=e,a.data=e.data,d=((ib.event.special[e.origType]||{}).handle||e.handler).apply(f.elem,i),d!==b&&(a.result=d)===!1&&(a.preventDefault(),a.stopPropagation()));return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,c){var d,e,f,g,h=[],i=c.delegateCount,j=a.target;if(i&&j.nodeType&&(!a.button||"click"!==a.type))for(;j!=this;j=j.parentNode||this)if(1===j.nodeType&&(j.disabled!==!0||"click"!==a.type)){for(f=[],g=0;i>g;g++)e=c[g],d=e.selector+" ",f[d]===b&&(f[d]=e.needsContext?ib(d,this).index(j)>=0:ib.find(d,this,null,[j]).length),f[d]&&f.push(e);f.length&&h.push({elem:j,handlers:f})}return i<c.length&&h.push({elem:this,handlers:c.slice(i)}),h},fix:function(a){if(a[ib.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];for(g||(this.fixHooks[e]=g=Mb.test(e)?this.mouseHooks:Lb.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new ib.Event(f),b=d.length;b--;)c=d[b],a[c]=f[c];return a.target||(a.target=f.srcElement||W),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,g.filter?g.filter(a,f):a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,c){var d,e,f,g=c.button,h=c.fromElement;return null==a.pageX&&null!=c.clientX&&(e=a.target.ownerDocument||W,f=e.documentElement,d=e.body,a.pageX=c.clientX+(f&&f.scrollLeft||d&&d.scrollLeft||0)-(f&&f.clientLeft||d&&d.clientLeft||0),a.pageY=c.clientY+(f&&f.scrollTop||d&&d.scrollTop||0)-(f&&f.clientTop||d&&d.clientTop||0)),!a.relatedTarget&&h&&(a.relatedTarget=h===a.target?c.toElement:h),a.which||g===b||(a.which=1&g?1:2&g?3:4&g?2:0),a}},special:{load:{noBubble:!0},click:{trigger:function(){return ib.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0}},focus:{trigger:function(){if(this!==W.activeElement&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){return this===W.activeElement&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},beforeunload:{postDispatch:function(a){a.result!==b&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=ib.extend(new ib.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?ib.event.trigger(e,null,b):ib.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},ib.removeEvent=W.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;a.detachEvent&&(typeof a[d]===V&&(a[d]=null),a.detachEvent(d,c))},ib.Event=function(a,b){return this instanceof ib.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?i:j):this.type=a,b&&ib.extend(this,b),this.timeStamp=a&&a.timeStamp||ib.now(),this[ib.expando]=!0,void 0):new ib.Event(a,b)},ib.Event.prototype={isDefaultPrevented:j,isPropagationStopped:j,isImmediatePropagationStopped:j,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=i,a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=i,a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=i,this.stopPropagation()}},ib.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){ib.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!ib.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),ib.support.submitBubbles||(ib.event.special.submit={setup:function(){return ib.nodeName(this,"form")?!1:(ib.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=ib.nodeName(c,"input")||ib.nodeName(c,"button")?c.form:b;d&&!ib._data(d,"submitBubbles")&&(ib.event.add(d,"submit._submit",function(a){a._submit_bubble=!0}),ib._data(d,"submitBubbles",!0))}),void 0)},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&ib.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){return ib.nodeName(this,"form")?!1:(ib.event.remove(this,"._submit"),void 0)}}),ib.support.changeBubbles||(ib.event.special.change={setup:function(){return Kb.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(ib.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._just_changed=!0)}),ib.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1),ib.event.simulate("change",this,a,!0)})),!1):(ib.event.add(this,"beforeactivate._change",function(a){var b=a.target;Kb.test(b.nodeName)&&!ib._data(b,"changeBubbles")&&(ib.event.add(b,"change._change",function(a){!this.parentNode||a.isSimulated||a.isTrigger||ib.event.simulate("change",this.parentNode,a,!0)}),ib._data(b,"changeBubbles",!0))}),void 0)},handle:function(a){var b=a.target;return this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type?a.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return ib.event.remove(this,"._change"),!Kb.test(this.nodeName)}}),ib.support.focusinBubbles||ib.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){ib.event.simulate(b,a.target,ib.event.fix(a),!0)};ib.event.special[b]={setup:function(){0===c++&&W.addEventListener(a,d,!0)},teardown:function(){0===--c&&W.removeEventListener(a,d,!0)}}}),ib.fn.extend({on:function(a,c,d,e,f){var g,h;if("object"==typeof a){"string"!=typeof c&&(d=d||c,c=b);for(g in a)this.on(g,c,d,a[g],f);return this}if(null==d&&null==e?(e=c,d=c=b):null==e&&("string"==typeof c?(e=d,d=b):(e=d,d=c,c=b)),e===!1)e=j;else if(!e)return this;return 1===f&&(h=e,e=function(a){return ib().off(a),h.apply(this,arguments)},e.guid=h.guid||(h.guid=ib.guid++)),this.each(function(){ib.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){var e,f;if(a&&a.preventDefault&&a.handleObj)return e=a.handleObj,ib(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this;if("object"==typeof a){for(f in a)this.off(f,c,a[f]);return this}return(c===!1||"function"==typeof c)&&(d=c,c=b),d===!1&&(d=j),this.each(function(){ib.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)},trigger:function(a,b){return this.each(function(){ib.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?ib.event.trigger(a,b,c,!0):void 0}}),function(a,b){function c(a){return ob.test(a+"")}function d(){var a,b=[];return a=function(c,d){return b.push(c+=" ")>y.cacheLength&&delete a[b.shift()],a[c]=d}}function e(a){return a[N]=!0,a}function f(a){var b=F.createElement("div");try{return a(b)}catch(c){return!1}finally{b=null}}function g(a,b,c,d){var e,f,g,h,i,j,k,n,o,p;if((b?b.ownerDocument||b:O)!==F&&E(b),b=b||F,c=c||[],!a||"string"!=typeof a)return c;if(1!==(h=b.nodeType)&&9!==h)return[];if(!H&&!d){if(e=pb.exec(a))if(g=e[1]){if(9===h){if(f=b.getElementById(g),!f||!f.parentNode)return c;if(f.id===g)return c.push(f),c}else if(b.ownerDocument&&(f=b.ownerDocument.getElementById(g))&&L(b,f)&&f.id===g)return c.push(f),c}else{if(e[2])return Z.apply(c,$.call(b.getElementsByTagName(a),0)),c;if((g=e[3])&&P.getByClassName&&b.getElementsByClassName)return Z.apply(c,$.call(b.getElementsByClassName(g),0)),c}if(P.qsa&&!I.test(a)){if(k=!0,n=N,o=b,p=9===h&&a,1===h&&"object"!==b.nodeName.toLowerCase()){for(j=l(a),(k=b.getAttribute("id"))?n=k.replace(sb,"\\$&"):b.setAttribute("id",n),n="[id='"+n+"'] ",i=j.length;i--;)j[i]=n+m(j[i]);o=nb.test(a)&&b.parentNode||b,p=j.join(",")}if(p)try{return Z.apply(c,$.call(o.querySelectorAll(p),0)),c}catch(q){}finally{k||b.removeAttribute("id")}}}return u(a.replace(gb,"$1"),b,c,d)}function h(a,b){var c=b&&a,d=c&&(~b.sourceIndex||W)-(~a.sourceIndex||W);if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function i(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function j(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function k(a){return e(function(b){return b=+b,e(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function l(a,b){var c,d,e,f,h,i,j,k=T[a+" "];if(k)return b?0:k.slice(0);for(h=a,i=[],j=y.preFilter;h;){(!c||(d=hb.exec(h)))&&(d&&(h=h.slice(d[0].length)||h),i.push(e=[])),c=!1,(d=jb.exec(h))&&(c=d.shift(),e.push({value:c,type:d[0].replace(gb," ")}),h=h.slice(c.length));for(f in y.filter)!(d=mb[f].exec(h))||j[f]&&!(d=j[f](d))||(c=d.shift(),e.push({value:c,type:f,matches:d}),h=h.slice(c.length));if(!c)break}return b?h.length:h?g.error(a):T(a,i).slice(0)}function m(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function n(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=R++;return b.first?function(b,c,f){for(;b=b[d];)if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j,k=Q+" "+f;if(g){for(;b=b[d];)if((1===b.nodeType||e)&&a(b,c,g))return!0}else for(;b=b[d];)if(1===b.nodeType||e)if(j=b[N]||(b[N]={}),(i=j[d])&&i[0]===k){if((h=i[1])===!0||h===x)return h===!0}else if(i=j[d]=[k],i[1]=a(b,c,g)||x,i[1]===!0)return!0}}function o(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function p(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function q(a,b,c,d,f,g){return d&&!d[N]&&(d=q(d)),f&&!f[N]&&(f=q(f,g)),e(function(e,g,h,i){var j,k,l,m=[],n=[],o=g.length,q=e||t(b||"*",h.nodeType?[h]:h,[]),r=!a||!e&&b?q:p(q,m,a,h,i),s=c?f||(e?a:o||d)?[]:g:r;if(c&&c(r,s,h,i),d)for(j=p(s,n),d(j,[],h,i),k=j.length;k--;)(l=j[k])&&(s[n[k]]=!(r[n[k]]=l));if(e){if(f||a){if(f){for(j=[],k=s.length;k--;)(l=s[k])&&j.push(r[k]=l);f(null,s=[],j,i)}for(k=s.length;k--;)(l=s[k])&&(j=f?_.call(e,l):m[k])>-1&&(e[j]=!(g[j]=l))}}else s=p(s===g?s.splice(o,s.length):s),f?f(null,g,s,i):Z.apply(g,s)})}function r(a){for(var b,c,d,e=a.length,f=y.relative[a[0].type],g=f||y.relative[" "],h=f?1:0,i=n(function(a){return a===b},g,!0),j=n(function(a){return _.call(b,a)>-1},g,!0),k=[function(a,c,d){return!f&&(d||c!==D)||((b=c).nodeType?i(a,c,d):j(a,c,d))}];e>h;h++)if(c=y.relative[a[h].type])k=[n(o(k),c)];else{if(c=y.filter[a[h].type].apply(null,a[h].matches),c[N]){for(d=++h;e>d&&!y.relative[a[d].type];d++);return q(h>1&&o(k),h>1&&m(a.slice(0,h-1)).replace(gb,"$1"),c,d>h&&r(a.slice(h,d)),e>d&&r(a=a.slice(d)),e>d&&m(a))}k.push(c)}return o(k)}function s(a,b){var c=0,d=b.length>0,f=a.length>0,h=function(e,h,i,j,k){var l,m,n,o=[],q=0,r="0",s=e&&[],t=null!=k,u=D,v=e||f&&y.find.TAG("*",k&&h.parentNode||h),w=Q+=null==u?1:Math.random()||.1;for(t&&(D=h!==F&&h,x=c);null!=(l=v[r]);r++){if(f&&l){for(m=0;n=a[m++];)if(n(l,h,i)){j.push(l);break}t&&(Q=w,x=++c)}d&&((l=!n&&l)&&q--,e&&s.push(l))}if(q+=r,d&&r!==q){for(m=0;n=b[m++];)n(s,o,h,i);if(e){if(q>0)for(;r--;)s[r]||o[r]||(o[r]=Y.call(j));o=p(o)}Z.apply(j,o),t&&!e&&o.length>0&&q+b.length>1&&g.uniqueSort(j)}return t&&(Q=w,D=u),s};return d?e(h):h}function t(a,b,c){for(var d=0,e=b.length;e>d;d++)g(a,b[d],c);return c}function u(a,b,c,d){var e,f,g,h,i,j=l(a);if(!d&&1===j.length){if(f=j[0]=j[0].slice(0),f.length>2&&"ID"===(g=f[0]).type&&9===b.nodeType&&!H&&y.relative[f[1].type]){if(b=y.find.ID(g.matches[0].replace(ub,vb),b)[0],!b)return c;a=a.slice(f.shift().value.length)}for(e=mb.needsContext.test(a)?0:f.length;e--&&(g=f[e],!y.relative[h=g.type]);)if((i=y.find[h])&&(d=i(g.matches[0].replace(ub,vb),nb.test(f[0].type)&&b.parentNode||b))){if(f.splice(e,1),a=d.length&&m(f),!a)return Z.apply(c,$.call(d,0)),c;break}}return B(a,j)(d,b,H,c,nb.test(a)),c}function v(){}var w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N="sizzle"+-new Date,O=a.document,P={},Q=0,R=0,S=d(),T=d(),U=d(),V=typeof b,W=1<<31,X=[],Y=X.pop,Z=X.push,$=X.slice,_=X.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},ab="[\\x20\\t\\r\\n\\f]",bb="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",cb=bb.replace("w","w#"),db="([*^$|!~]?=)",eb="\\["+ab+"*("+bb+")"+ab+"*(?:"+db+ab+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+cb+")|)|)"+ab+"*\\]",fb=":("+bb+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+eb.replace(3,8)+")*)|.*)\\)|)",gb=new RegExp("^"+ab+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ab+"+$","g"),hb=new RegExp("^"+ab+"*,"+ab+"*"),jb=new RegExp("^"+ab+"*([\\x20\\t\\r\\n\\f>+~])"+ab+"*"),kb=new RegExp(fb),lb=new RegExp("^"+cb+"$"),mb={ID:new RegExp("^#("+bb+")"),CLASS:new RegExp("^\\.("+bb+")"),NAME:new RegExp("^\\[name=['\"]?("+bb+")['\"]?\\]"),TAG:new RegExp("^("+bb.replace("w","w*")+")"),ATTR:new RegExp("^"+eb),PSEUDO:new RegExp("^"+fb),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ab+"*(even|odd|(([+-]|)(\\d*)n|)"+ab+"*(?:([+-]|)"+ab+"*(\\d+)|))"+ab+"*\\)|)","i"),needsContext:new RegExp("^"+ab+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ab+"*((?:-\\d)?\\d*)"+ab+"*\\)|)(?=[^-]|$)","i")},nb=/[\x20\t\r\n\f]*[+~]/,ob=/^[^{]+\{\s*\[native code/,pb=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,qb=/^(?:input|select|textarea|button)$/i,rb=/^h\d$/i,sb=/'|\\/g,tb=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,ub=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,vb=function(a,b){var c="0x"+b-65536;return c!==c?b:0>c?String.fromCharCode(c+65536):String.fromCharCode(c>>10|55296,1023&c|56320)};try{$.call(O.documentElement.childNodes,0)[0].nodeType}catch(wb){$=function(a){for(var b,c=[];b=this[a++];)c.push(b);return c}}A=g.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},E=g.setDocument=function(a){var d=a?a.ownerDocument||a:O;return d!==F&&9===d.nodeType&&d.documentElement?(F=d,G=d.documentElement,H=A(d),P.tagNameNoComments=f(function(a){return a.appendChild(d.createComment("")),!a.getElementsByTagName("*").length}),P.attributes=f(function(a){a.innerHTML="<select></select>";var b=typeof a.lastChild.getAttribute("multiple");return"boolean"!==b&&"string"!==b}),P.getByClassName=f(function(a){return a.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",a.getElementsByClassName&&a.getElementsByClassName("e").length?(a.lastChild.className="e",2===a.getElementsByClassName("e").length):!1}),P.getByName=f(function(a){a.id=N+0,a.innerHTML="<a name='"+N+"'></a><div name='"+N+"'></div>",G.insertBefore(a,G.firstChild);var b=d.getElementsByName&&d.getElementsByName(N).length===2+d.getElementsByName(N+0).length;return P.getIdNotName=!d.getElementById(N),G.removeChild(a),b}),y.attrHandle=f(function(a){return a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!==V&&"#"===a.firstChild.getAttribute("href")})?{}:{href:function(a){return a.getAttribute("href",2)},type:function(a){return a.getAttribute("type")}},P.getIdNotName?(y.find.ID=function(a,b){if(typeof b.getElementById!==V&&!H){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},y.filter.ID=function(a){var b=a.replace(ub,vb);return function(a){return a.getAttribute("id")===b}}):(y.find.ID=function(a,c){if(typeof c.getElementById!==V&&!H){var d=c.getElementById(a);return d?d.id===a||typeof d.getAttributeNode!==V&&d.getAttributeNode("id").value===a?[d]:b:[]}},y.filter.ID=function(a){var b=a.replace(ub,vb);return function(a){var c=typeof a.getAttributeNode!==V&&a.getAttributeNode("id");return c&&c.value===b}}),y.find.TAG=P.tagNameNoComments?function(a,b){return typeof b.getElementsByTagName!==V?b.getElementsByTagName(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},y.find.NAME=P.getByName&&function(a,b){return typeof b.getElementsByName!==V?b.getElementsByName(name):void 0},y.find.CLASS=P.getByClassName&&function(a,b){return typeof b.getElementsByClassName===V||H?void 0:b.getElementsByClassName(a)},J=[],I=[":focus"],(P.qsa=c(d.querySelectorAll))&&(f(function(a){a.innerHTML="<select><option selected=''></option></select>",a.querySelectorAll("[selected]").length||I.push("\\["+ab+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),a.querySelectorAll(":checked").length||I.push(":checked")}),f(function(a){a.innerHTML="<input type='hidden' i=''/>",a.querySelectorAll("[i^='']").length&&I.push("[*^$]="+ab+"*(?:\"\"|'')"),a.querySelectorAll(":enabled").length||I.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),I.push(",.*:")})),(P.matchesSelector=c(K=G.matchesSelector||G.mozMatchesSelector||G.webkitMatchesSelector||G.oMatchesSelector||G.msMatchesSelector))&&f(function(a){P.disconnectedMatch=K.call(a,"div"),K.call(a,"[s!='']:x"),J.push("!=",fb)}),I=new RegExp(I.join("|")),J=new RegExp(J.join("|")),L=c(G.contains)||G.compareDocumentPosition?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},M=G.compareDocumentPosition?function(a,b){var c;return a===b?(C=!0,0):(c=b.compareDocumentPosition&&a.compareDocumentPosition&&a.compareDocumentPosition(b))?1&c||a.parentNode&&11===a.parentNode.nodeType?a===d||L(O,a)?-1:b===d||L(O,b)?1:0:4&c?-1:1:a.compareDocumentPosition?-1:1}:function(a,b){var c,e=0,f=a.parentNode,g=b.parentNode,i=[a],j=[b];if(a===b)return C=!0,0;if(!f||!g)return a===d?-1:b===d?1:f?-1:g?1:0;if(f===g)return h(a,b);for(c=a;c=c.parentNode;)i.unshift(c);for(c=b;c=c.parentNode;)j.unshift(c);for(;i[e]===j[e];)e++;return e?h(i[e],j[e]):i[e]===O?-1:j[e]===O?1:0},C=!1,[0,0].sort(M),P.detectDuplicates=C,F):F},g.matches=function(a,b){return g(a,null,null,b)},g.matchesSelector=function(a,b){if((a.ownerDocument||a)!==F&&E(a),b=b.replace(tb,"='$1']"),!(!P.matchesSelector||H||J&&J.test(b)||I.test(b)))try{var c=K.call(a,b);if(c||P.disconnectedMatch||a.document&&11!==a.document.nodeType)return c}catch(d){}return g(b,F,null,[a]).length>0},g.contains=function(a,b){return(a.ownerDocument||a)!==F&&E(a),L(a,b)},g.attr=function(a,b){var c;return(a.ownerDocument||a)!==F&&E(a),H||(b=b.toLowerCase()),(c=y.attrHandle[b])?c(a):H||P.attributes?a.getAttribute(b):((c=a.getAttributeNode(b))||a.getAttribute(b))&&a[b]===!0?b:c&&c.specified?c.value:null},g.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},g.uniqueSort=function(a){var b,c=[],d=1,e=0;if(C=!P.detectDuplicates,a.sort(M),C){for(;b=a[d];d++)b===a[d-1]&&(e=c.push(d));for(;e--;)a.splice(c[e],1)}return a},z=g.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(1===e||9===e||11===e){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=z(a)}else if(3===e||4===e)return a.nodeValue}else for(;b=a[d];d++)c+=z(b);return c},y=g.selectors={cacheLength:50,createPseudo:e,match:mb,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ub,vb),a[3]=(a[4]||a[5]||"").replace(ub,vb),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||g.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&g.error(a[0]),a},PSEUDO:function(a){var b,c=!a[5]&&a[2];return mb.CHILD.test(a[0])?null:(a[4]?a[2]=a[4]:c&&kb.test(c)&&(b=l(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){return"*"===a?function(){return!0}:(a=a.replace(ub,vb).toLowerCase(),function(b){return b.nodeName&&b.nodeName.toLowerCase()===a})},CLASS:function(a){var b=S[a+" "];return b||(b=new RegExp("(^|"+ab+")"+a+"("+ab+"|$)"))&&S(a,function(a){return b.test(a.className||typeof a.getAttribute!==V&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=g.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){for(;p;){for(l=b;l=l[p];)if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(k=q[N]||(q[N]={}),j=k[a]||[],n=j[0]===Q&&j[1],m=j[0]===Q&&j[2],l=n&&q.childNodes[n];l=++n&&l&&l[p]||(m=n=0)||o.pop();)if(1===l.nodeType&&++m&&l===b){k[a]=[Q,n,m];break}}else if(s&&(j=(b[N]||(b[N]={}))[a])&&j[0]===Q)m=j[1];else for(;(l=++n&&l&&l[p]||(m=n=0)||o.pop())&&((h?l.nodeName.toLowerCase()!==r:1!==l.nodeType)||!++m||(s&&((l[N]||(l[N]={}))[a]=[Q,m]),l!==b)););return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var c,d=y.pseudos[a]||y.setFilters[a.toLowerCase()]||g.error("unsupported pseudo: "+a);return d[N]?d(b):d.length>1?(c=[a,a,"",b],y.setFilters.hasOwnProperty(a.toLowerCase())?e(function(a,c){for(var e,f=d(a,b),g=f.length;g--;)e=_.call(a,f[g]),a[e]=!(c[e]=f[g])}):function(a){return d(a,0,c)}):d}},pseudos:{not:e(function(a){var b=[],c=[],d=B(a.replace(gb,"$1"));return d[N]?e(function(a,b,c,e){for(var f,g=d(a,null,e,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:e(function(a){return function(b){return g(a,b).length>0}}),contains:e(function(a){return function(b){return(b.textContent||b.innerText||z(b)).indexOf(a)>-1}}),lang:e(function(a){return lb.test(a||"")||g.error("unsupported lang: "+a),a=a.replace(ub,vb).toLowerCase(),function(b){var c;do if(c=H?b.getAttribute("xml:lang")||b.getAttribute("lang"):b.lang)return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===G},focus:function(a){return a===F.activeElement&&(!F.hasFocus||F.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeName>"@"||3===a.nodeType||4===a.nodeType)return!1;return!0},parent:function(a){return!y.pseudos.empty(a)},header:function(a){return rb.test(a.nodeName)},input:function(a){return qb.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||b.toLowerCase()===a.type)},first:k(function(){return[0]}),last:k(function(a,b){return[b-1]}),eq:k(function(a,b,c){return[0>c?c+b:c]}),even:k(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:k(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:k(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:k(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}};for(w in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})y.pseudos[w]=i(w);for(w in{submit:!0,reset:!0})y.pseudos[w]=j(w);B=g.compile=function(a,b){var c,d=[],e=[],f=U[a+" "];if(!f){for(b||(b=l(a)),c=b.length;c--;)f=r(b[c]),f[N]?d.push(f):e.push(f);f=U(a,s(e,d))}return f},y.pseudos.nth=y.pseudos.eq,y.filters=v.prototype=y.pseudos,y.setFilters=new v,E(),g.attr=ib.attr,ib.find=g,ib.expr=g.selectors,ib.expr[":"]=ib.expr.pseudos,ib.unique=g.uniqueSort,ib.text=g.getText,ib.isXMLDoc=g.isXML,ib.contains=g.contains}(a);var Pb=/Until$/,Qb=/^(?:parents|prev(?:Until|All))/,Rb=/^.[^:#\[\.,]*$/,Sb=ib.expr.match.needsContext,Tb={children:!0,contents:!0,next:!0,prev:!0};ib.fn.extend({find:function(a){var b,c,d,e=this.length;if("string"!=typeof a)return d=this,this.pushStack(ib(a).filter(function(){for(b=0;e>b;b++)if(ib.contains(d[b],this))return!0}));for(c=[],b=0;e>b;b++)ib.find(a,this[b],c);return c=this.pushStack(e>1?ib.unique(c):c),c.selector=(this.selector?this.selector+" ":"")+a,c},has:function(a){var b,c=ib(a,this),d=c.length;return this.filter(function(){for(b=0;d>b;b++)if(ib.contains(this,c[b]))return!0})},not:function(a){return this.pushStack(l(this,a,!1))},filter:function(a){return this.pushStack(l(this,a,!0))},is:function(a){return!!a&&("string"==typeof a?Sb.test(a)?ib(a,this.context).index(this[0])>=0:ib.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=Sb.test(a)||"string"!=typeof a?ib(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c.ownerDocument&&c!==b&&11!==c.nodeType;){if(g?g.index(c)>-1:ib.find.matchesSelector(c,a)){f.push(c);break}c=c.parentNode}return this.pushStack(f.length>1?ib.unique(f):f)},index:function(a){return a?"string"==typeof a?ib.inArray(this[0],ib(a)):ib.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){var c="string"==typeof a?ib(a,b):ib.makeArray(a&&a.nodeType?[a]:a),d=ib.merge(this.get(),c);return this.pushStack(ib.unique(d))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),ib.fn.andSelf=ib.fn.addBack,ib.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return ib.dir(a,"parentNode")},parentsUntil:function(a,b,c){return ib.dir(a,"parentNode",c)
},next:function(a){return k(a,"nextSibling")},prev:function(a){return k(a,"previousSibling")},nextAll:function(a){return ib.dir(a,"nextSibling")},prevAll:function(a){return ib.dir(a,"previousSibling")},nextUntil:function(a,b,c){return ib.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return ib.dir(a,"previousSibling",c)},siblings:function(a){return ib.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return ib.sibling(a.firstChild)},contents:function(a){return ib.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:ib.merge([],a.childNodes)}},function(a,b){ib.fn[a]=function(c,d){var e=ib.map(this,b,c);return Pb.test(a)||(d=c),d&&"string"==typeof d&&(e=ib.filter(d,e)),e=this.length>1&&!Tb[a]?ib.unique(e):e,this.length>1&&Qb.test(a)&&(e=e.reverse()),this.pushStack(e)}}),ib.extend({filter:function(a,b,c){return c&&(a=":not("+a+")"),1===b.length?ib.find.matchesSelector(b[0],a)?[b[0]]:[]:ib.find.matches(a,b)},dir:function(a,c,d){for(var e=[],f=a[c];f&&9!==f.nodeType&&(d===b||1!==f.nodeType||!ib(f).is(d));)1===f.nodeType&&e.push(f),f=f[c];return e},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}});var Ub="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Vb=/ jQuery\d+="(?:null|\d+)"/g,Wb=new RegExp("<(?:"+Ub+")[\\s/>]","i"),Xb=/^\s+/,Yb=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Zb=/<([\w:]+)/,$b=/<tbody/i,_b=/<|&#?\w+;/,ac=/<(?:script|style|link)/i,bc=/^(?:checkbox|radio)$/i,cc=/checked\s*(?:[^=]|=\s*.checked.)/i,dc=/^$|\/(?:java|ecma)script/i,ec=/^true\/(.*)/,fc=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,gc={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:ib.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},hc=m(W),ic=hc.appendChild(W.createElement("div"));gc.optgroup=gc.option,gc.tbody=gc.tfoot=gc.colgroup=gc.caption=gc.thead,gc.th=gc.td,ib.fn.extend({text:function(a){return ib.access(this,function(a){return a===b?ib.text(this):this.empty().append((this[0]&&this[0].ownerDocument||W).createTextNode(a))},null,a,arguments.length)},wrapAll:function(a){if(ib.isFunction(a))return this.each(function(b){ib(this).wrapAll(a.call(this,b))});if(this[0]){var b=ib(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstChild&&1===a.firstChild.nodeType;)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return ib.isFunction(a)?this.each(function(b){ib(this).wrapInner(a.call(this,b))}):this.each(function(){var b=ib(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=ib.isFunction(a);return this.each(function(c){ib(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){ib.nodeName(this,"body")||ib(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.insertBefore(a,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,!1,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=0;null!=(c=this[d]);d++)(!a||ib.filter(a,[c]).length>0)&&(b||1!==c.nodeType||ib.cleanData(t(c)),c.parentNode&&(b&&ib.contains(c.ownerDocument,c)&&q(t(c,"script")),c.parentNode.removeChild(c)));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++){for(1===a.nodeType&&ib.cleanData(t(a,!1));a.firstChild;)a.removeChild(a.firstChild);a.options&&ib.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return ib.clone(this,a,b)})},html:function(a){return ib.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b)return 1===c.nodeType?c.innerHTML.replace(Vb,""):b;if(!("string"!=typeof a||ac.test(a)||!ib.support.htmlSerialize&&Wb.test(a)||!ib.support.leadingWhitespace&&Xb.test(a)||gc[(Zb.exec(a)||["",""])[1].toLowerCase()])){a=a.replace(Yb,"<$1></$2>");try{for(;e>d;d++)c=this[d]||{},1===c.nodeType&&(ib.cleanData(t(c,!1)),c.innerHTML=a);c=0}catch(f){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(a){var b=ib.isFunction(a);return b||"string"==typeof a||(a=ib(a).not(this).detach()),this.domManip([a],!0,function(a){var b=this.nextSibling,c=this.parentNode;c&&(ib(this).remove(),c.insertBefore(a,b))})},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){a=bb.apply([],a);var e,f,g,h,i,j,k=0,l=this.length,m=this,q=l-1,r=a[0],s=ib.isFunction(r);if(s||!(1>=l||"string"!=typeof r||ib.support.checkClone)&&cc.test(r))return this.each(function(e){var f=m.eq(e);s&&(a[0]=r.call(this,e,c?f.html():b)),f.domManip(a,c,d)});if(l&&(j=ib.buildFragment(a,this[0].ownerDocument,!1,this),e=j.firstChild,1===j.childNodes.length&&(j=e),e)){for(c=c&&ib.nodeName(e,"tr"),h=ib.map(t(j,"script"),o),g=h.length;l>k;k++)f=j,k!==q&&(f=ib.clone(f,!0,!0),g&&ib.merge(h,t(f,"script"))),d.call(c&&ib.nodeName(this[k],"table")?n(this[k],"tbody"):this[k],f,k);if(g)for(i=h[h.length-1].ownerDocument,ib.map(h,p),k=0;g>k;k++)f=h[k],dc.test(f.type||"")&&!ib._data(f,"globalEval")&&ib.contains(i,f)&&(f.src?ib.ajax({url:f.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):ib.globalEval((f.text||f.textContent||f.innerHTML||"").replace(fc,"")));j=e=null}return this}}),ib.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){ib.fn[a]=function(a){for(var c,d=0,e=[],f=ib(a),g=f.length-1;g>=d;d++)c=d===g?this:this.clone(!0),ib(f[d])[b](c),cb.apply(e,c.get());return this.pushStack(e)}}),ib.extend({clone:function(a,b,c){var d,e,f,g,h,i=ib.contains(a.ownerDocument,a);if(ib.support.html5Clone||ib.isXMLDoc(a)||!Wb.test("<"+a.nodeName+">")?f=a.cloneNode(!0):(ic.innerHTML=a.outerHTML,ic.removeChild(f=ic.firstChild)),!(ib.support.noCloneEvent&&ib.support.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||ib.isXMLDoc(a)))for(d=t(f),h=t(a),g=0;null!=(e=h[g]);++g)d[g]&&s(e,d[g]);if(b)if(c)for(h=h||t(a),d=d||t(f),g=0;null!=(e=h[g]);g++)r(e,d[g]);else r(a,f);return d=t(f,"script"),d.length>0&&q(d,!i&&t(a,"script")),d=h=e=null,f},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k,l=a.length,n=m(b),o=[],p=0;l>p;p++)if(f=a[p],f||0===f)if("object"===ib.type(f))ib.merge(o,f.nodeType?[f]:f);else if(_b.test(f)){for(h=h||n.appendChild(b.createElement("div")),i=(Zb.exec(f)||["",""])[1].toLowerCase(),k=gc[i]||gc._default,h.innerHTML=k[1]+f.replace(Yb,"<$1></$2>")+k[2],e=k[0];e--;)h=h.lastChild;if(!ib.support.leadingWhitespace&&Xb.test(f)&&o.push(b.createTextNode(Xb.exec(f)[0])),!ib.support.tbody)for(f="table"!==i||$b.test(f)?"<table>"!==k[1]||$b.test(f)?0:h:h.firstChild,e=f&&f.childNodes.length;e--;)ib.nodeName(j=f.childNodes[e],"tbody")&&!j.childNodes.length&&f.removeChild(j);for(ib.merge(o,h.childNodes),h.textContent="";h.firstChild;)h.removeChild(h.firstChild);h=n.lastChild}else o.push(b.createTextNode(f));for(h&&n.removeChild(h),ib.support.appendChecked||ib.grep(t(o,"input"),u),p=0;f=o[p++];)if((!d||-1===ib.inArray(f,d))&&(g=ib.contains(f.ownerDocument,f),h=t(n.appendChild(f),"script"),g&&q(h),c))for(e=0;f=h[e++];)dc.test(f.type||"")&&c.push(f);return h=null,n},cleanData:function(a,b){for(var c,d,e,f,g=0,h=ib.expando,i=ib.cache,j=ib.support.deleteExpando,k=ib.event.special;null!=(c=a[g]);g++)if((b||ib.acceptData(c))&&(e=c[h],f=e&&i[e])){if(f.events)for(d in f.events)k[d]?ib.event.remove(c,d):ib.removeEvent(c,d,f.handle);i[e]&&(delete i[e],j?delete c[h]:typeof c.removeAttribute!==V?c.removeAttribute(h):c[h]=null,_.push(e))}}});var jc,kc,lc,mc=/alpha\([^)]*\)/i,nc=/opacity\s*=\s*([^)]*)/,oc=/^(top|right|bottom|left)$/,pc=/^(none|table(?!-c[ea]).+)/,qc=/^margin/,rc=new RegExp("^("+jb+")(.*)$","i"),sc=new RegExp("^("+jb+")(?!px)[a-z%]+$","i"),tc=new RegExp("^([+-])=("+jb+")","i"),uc={BODY:"block"},vc={position:"absolute",visibility:"hidden",display:"block"},wc={letterSpacing:0,fontWeight:400},xc=["Top","Right","Bottom","Left"],yc=["Webkit","O","Moz","ms"];ib.fn.extend({css:function(a,c){return ib.access(this,function(a,c,d){var e,f,g={},h=0;if(ib.isArray(c)){for(f=kc(a),e=c.length;e>h;h++)g[c[h]]=ib.css(a,c[h],!1,f);return g}return d!==b?ib.style(a,c,d):ib.css(a,c)},a,c,arguments.length>1)},show:function(){return x(this,!0)},hide:function(){return x(this)},toggle:function(a){var b="boolean"==typeof a;return this.each(function(){(b?a:w(this))?ib(this).show():ib(this).hide()})}}),ib.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=lc(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":ib.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var f,g,h,i=ib.camelCase(c),j=a.style;if(c=ib.cssProps[i]||(ib.cssProps[i]=v(j,i)),h=ib.cssHooks[c]||ib.cssHooks[i],d===b)return h&&"get"in h&&(f=h.get(a,!1,e))!==b?f:j[c];if(g=typeof d,"string"===g&&(f=tc.exec(d))&&(d=(f[1]+1)*f[2]+parseFloat(ib.css(a,c)),g="number"),!(null==d||"number"===g&&isNaN(d)||("number"!==g||ib.cssNumber[i]||(d+="px"),ib.support.clearCloneStyle||""!==d||0!==c.indexOf("background")||(j[c]="inherit"),h&&"set"in h&&(d=h.set(a,d,e))===b)))try{j[c]=d}catch(k){}}},css:function(a,c,d,e){var f,g,h,i=ib.camelCase(c);return c=ib.cssProps[i]||(ib.cssProps[i]=v(a.style,i)),h=ib.cssHooks[c]||ib.cssHooks[i],h&&"get"in h&&(g=h.get(a,!0,d)),g===b&&(g=lc(a,c,e)),"normal"===g&&c in wc&&(g=wc[c]),""===d||d?(f=parseFloat(g),d===!0||ib.isNumeric(f)?f||0:g):g},swap:function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e}}),a.getComputedStyle?(kc=function(b){return a.getComputedStyle(b,null)},lc=function(a,c,d){var e,f,g,h=d||kc(a),i=h?h.getPropertyValue(c)||h[c]:b,j=a.style;return h&&(""!==i||ib.contains(a.ownerDocument,a)||(i=ib.style(a,c)),sc.test(i)&&qc.test(c)&&(e=j.width,f=j.minWidth,g=j.maxWidth,j.minWidth=j.maxWidth=j.width=i,i=h.width,j.width=e,j.minWidth=f,j.maxWidth=g)),i}):W.documentElement.currentStyle&&(kc=function(a){return a.currentStyle},lc=function(a,c,d){var e,f,g,h=d||kc(a),i=h?h[c]:b,j=a.style;return null==i&&j&&j[c]&&(i=j[c]),sc.test(i)&&!oc.test(c)&&(e=j.left,f=a.runtimeStyle,g=f&&f.left,g&&(f.left=a.currentStyle.left),j.left="fontSize"===c?"1em":i,i=j.pixelLeft+"px",j.left=e,g&&(f.left=g)),""===i?"auto":i}),ib.each(["height","width"],function(a,b){ib.cssHooks[b]={get:function(a,c,d){return c?0===a.offsetWidth&&pc.test(ib.css(a,"display"))?ib.swap(a,vc,function(){return A(a,b,d)}):A(a,b,d):void 0},set:function(a,c,d){var e=d&&kc(a);return y(a,c,d?z(a,b,d,ib.support.boxSizing&&"border-box"===ib.css(a,"boxSizing",!1,e),e):0)}}}),ib.support.opacity||(ib.cssHooks.opacity={get:function(a,b){return nc.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=ib.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,(b>=1||""===b)&&""===ib.trim(f.replace(mc,""))&&c.removeAttribute&&(c.removeAttribute("filter"),""===b||d&&!d.filter)||(c.filter=mc.test(f)?f.replace(mc,e):f+" "+e)}}),ib(function(){ib.support.reliableMarginRight||(ib.cssHooks.marginRight={get:function(a,b){return b?ib.swap(a,{display:"inline-block"},lc,[a,"marginRight"]):void 0}}),!ib.support.pixelPosition&&ib.fn.position&&ib.each(["top","left"],function(a,b){ib.cssHooks[b]={get:function(a,c){return c?(c=lc(a,b),sc.test(c)?ib(a).position()[b]+"px":c):void 0}}})}),ib.expr&&ib.expr.filters&&(ib.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0||!ib.support.reliableHiddenOffsets&&"none"===(a.style&&a.style.display||ib.css(a,"display"))},ib.expr.filters.visible=function(a){return!ib.expr.filters.hidden(a)}),ib.each({margin:"",padding:"",border:"Width"},function(a,b){ib.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+xc[d]+b]=f[d]||f[d-2]||f[0];return e}},qc.test(a)||(ib.cssHooks[a+b].set=y)});var zc=/%20/g,Ac=/\[\]$/,Bc=/\r?\n/g,Cc=/^(?:submit|button|image|reset|file)$/i,Dc=/^(?:input|select|textarea|keygen)/i;ib.fn.extend({serialize:function(){return ib.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=ib.prop(this,"elements");return a?ib.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!ib(this).is(":disabled")&&Dc.test(this.nodeName)&&!Cc.test(a)&&(this.checked||!bc.test(a))}).map(function(a,b){var c=ib(this).val();return null==c?null:ib.isArray(c)?ib.map(c,function(a){return{name:b.name,value:a.replace(Bc,"\r\n")}}):{name:b.name,value:c.replace(Bc,"\r\n")}}).get()}}),ib.param=function(a,c){var d,e=[],f=function(a,b){b=ib.isFunction(b)?b():null==b?"":b,e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(c===b&&(c=ib.ajaxSettings&&ib.ajaxSettings.traditional),ib.isArray(a)||a.jquery&&!ib.isPlainObject(a))ib.each(a,function(){f(this.name,this.value)});else for(d in a)D(d,a[d],c,f);return e.join("&").replace(zc,"+")},ib.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){ib.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),ib.fn.hover=function(a,b){return this.mouseenter(a).mouseleave(b||a)};var Ec,Fc,Gc=ib.now(),Hc=/\?/,Ic=/#.*$/,Jc=/([?&])_=[^&]*/,Kc=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Lc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Mc=/^(?:GET|HEAD)$/,Nc=/^\/\//,Oc=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Pc=ib.fn.load,Qc={},Rc={},Sc="*/".concat("*");try{Fc=X.href}catch(Tc){Fc=W.createElement("a"),Fc.href="",Fc=Fc.href}Ec=Oc.exec(Fc.toLowerCase())||[],ib.fn.load=function(a,c,d){if("string"!=typeof a&&Pc)return Pc.apply(this,arguments);var e,f,g,h=this,i=a.indexOf(" ");return i>=0&&(e=a.slice(i,a.length),a=a.slice(0,i)),ib.isFunction(c)?(d=c,c=b):c&&"object"==typeof c&&(g="POST"),h.length>0&&ib.ajax({url:a,type:g,dataType:"html",data:c}).done(function(a){f=arguments,h.html(e?ib("<div>").append(ib.parseHTML(a)).find(e):a)}).complete(d&&function(a,b){h.each(d,f||[a.responseText,b,a])}),this},ib.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){ib.fn[b]=function(a){return this.on(b,a)}}),ib.each(["get","post"],function(a,c){ib[c]=function(a,d,e,f){return ib.isFunction(d)&&(f=f||e,e=d,d=b),ib.ajax({url:a,type:c,dataType:f,data:d,success:e})}}),ib.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Fc,type:"GET",isLocal:Lc.test(Ec[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Sc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":ib.parseJSON,"text xml":ib.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?G(G(a,ib.ajaxSettings),b):G(ib.ajaxSettings,a)},ajaxPrefilter:E(Qc),ajaxTransport:E(Rc),ajax:function(a,c){function d(a,c,d,e){var f,l,s,t,v,x=c;2!==u&&(u=2,i&&clearTimeout(i),k=b,h=e||"",w.readyState=a>0?4:0,d&&(t=H(m,w,d)),a>=200&&300>a||304===a?(m.ifModified&&(v=w.getResponseHeader("Last-Modified"),v&&(ib.lastModified[g]=v),v=w.getResponseHeader("etag"),v&&(ib.etag[g]=v)),204===a?(f=!0,x="nocontent"):304===a?(f=!0,x="notmodified"):(f=I(m,t),x=f.state,l=f.data,s=f.error,f=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),w.status=a,w.statusText=(c||x)+"",f?p.resolveWith(n,[l,x,w]):p.rejectWith(n,[w,x,s]),w.statusCode(r),r=b,j&&o.trigger(f?"ajaxSuccess":"ajaxError",[w,m,f?l:s]),q.fireWith(n,[w,x]),j&&(o.trigger("ajaxComplete",[w,m]),--ib.active||ib.event.trigger("ajaxStop")))}"object"==typeof a&&(c=a,a=b),c=c||{};var e,f,g,h,i,j,k,l,m=ib.ajaxSetup({},c),n=m.context||m,o=m.context&&(n.nodeType||n.jquery)?ib(n):ib.event,p=ib.Deferred(),q=ib.Callbacks("once memory"),r=m.statusCode||{},s={},t={},u=0,v="canceled",w={readyState:0,getResponseHeader:function(a){var b;if(2===u){if(!l)for(l={};b=Kc.exec(h);)l[b[1].toLowerCase()]=b[2];b=l[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===u?h:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return u||(a=t[c]=t[c]||a,s[a]=b),this},overrideMimeType:function(a){return u||(m.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>u)for(b in a)r[b]=[r[b],a[b]];else w.always(a[w.status]);return this},abort:function(a){var b=a||v;return k&&k.abort(b),d(0,b),this}};if(p.promise(w).complete=q.add,w.success=w.done,w.error=w.fail,m.url=((a||m.url||Fc)+"").replace(Ic,"").replace(Nc,Ec[1]+"//"),m.type=c.method||c.type||m.method||m.type,m.dataTypes=ib.trim(m.dataType||"*").toLowerCase().match(kb)||[""],null==m.crossDomain&&(e=Oc.exec(m.url.toLowerCase()),m.crossDomain=!(!e||e[1]===Ec[1]&&e[2]===Ec[2]&&(e[3]||("http:"===e[1]?80:443))==(Ec[3]||("http:"===Ec[1]?80:443)))),m.data&&m.processData&&"string"!=typeof m.data&&(m.data=ib.param(m.data,m.traditional)),F(Qc,m,c,w),2===u)return w;j=m.global,j&&0===ib.active++&&ib.event.trigger("ajaxStart"),m.type=m.type.toUpperCase(),m.hasContent=!Mc.test(m.type),g=m.url,m.hasContent||(m.data&&(g=m.url+=(Hc.test(g)?"&":"?")+m.data,delete m.data),m.cache===!1&&(m.url=Jc.test(g)?g.replace(Jc,"$1_="+Gc++):g+(Hc.test(g)?"&":"?")+"_="+Gc++)),m.ifModified&&(ib.lastModified[g]&&w.setRequestHeader("If-Modified-Since",ib.lastModified[g]),ib.etag[g]&&w.setRequestHeader("If-None-Match",ib.etag[g])),(m.data&&m.hasContent&&m.contentType!==!1||c.contentType)&&w.setRequestHeader("Content-Type",m.contentType),w.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+("*"!==m.dataTypes[0]?", "+Sc+"; q=0.01":""):m.accepts["*"]);for(f in m.headers)w.setRequestHeader(f,m.headers[f]);if(m.beforeSend&&(m.beforeSend.call(n,w,m)===!1||2===u))return w.abort();v="abort";for(f in{success:1,error:1,complete:1})w[f](m[f]);if(k=F(Rc,m,c,w)){w.readyState=1,j&&o.trigger("ajaxSend",[w,m]),m.async&&m.timeout>0&&(i=setTimeout(function(){w.abort("timeout")},m.timeout));try{u=1,k.send(s,d)}catch(x){if(!(2>u))throw x;d(-1,x)}}else d(-1,"No Transport");return w},getScript:function(a,c){return ib.get(a,b,c,"script")},getJSON:function(a,b,c){return ib.get(a,b,c,"json")}}),ib.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return ib.globalEval(a),a}}}),ib.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),ib.ajaxTransport("script",function(a){if(a.crossDomain){var c,d=W.head||ib("head")[0]||W.documentElement;return{send:function(b,e){c=W.createElement("script"),c.async=!0,a.scriptCharset&&(c.charset=a.scriptCharset),c.src=a.url,c.onload=c.onreadystatechange=function(a,b){(b||!c.readyState||/loaded|complete/.test(c.readyState))&&(c.onload=c.onreadystatechange=null,c.parentNode&&c.parentNode.removeChild(c),c=null,b||e(200,"success"))},d.insertBefore(c,d.firstChild)},abort:function(){c&&c.onload(b,!0)}}}});var Uc=[],Vc=/(=)\?(?=&|$)|\?\?/;ib.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Uc.pop()||ib.expando+"_"+Gc++;return this[a]=!0,a}}),ib.ajaxPrefilter("json jsonp",function(c,d,e){var f,g,h,i=c.jsonp!==!1&&(Vc.test(c.url)?"url":"string"==typeof c.data&&!(c.contentType||"").indexOf("application/x-www-form-urlencoded")&&Vc.test(c.data)&&"data");return i||"jsonp"===c.dataTypes[0]?(f=c.jsonpCallback=ib.isFunction(c.jsonpCallback)?c.jsonpCallback():c.jsonpCallback,i?c[i]=c[i].replace(Vc,"$1"+f):c.jsonp!==!1&&(c.url+=(Hc.test(c.url)?"&":"?")+c.jsonp+"="+f),c.converters["script json"]=function(){return h||ib.error(f+" was not called"),h[0]},c.dataTypes[0]="json",g=a[f],a[f]=function(){h=arguments},e.always(function(){a[f]=g,c[f]&&(c.jsonpCallback=d.jsonpCallback,Uc.push(f)),h&&ib.isFunction(g)&&g(h[0]),h=g=b}),"script"):void 0});var Wc,Xc,Yc=0,Zc=a.ActiveXObject&&function(){var a;for(a in Wc)Wc[a](b,!0)};ib.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&J()||K()}:J,Xc=ib.ajaxSettings.xhr(),ib.support.cors=!!Xc&&"withCredentials"in Xc,Xc=ib.support.ajax=!!Xc,Xc&&ib.ajaxTransport(function(c){if(!c.crossDomain||ib.support.cors){var d;return{send:function(e,f){var g,h,i=c.xhr();if(c.username?i.open(c.type,c.url,c.async,c.username,c.password):i.open(c.type,c.url,c.async),c.xhrFields)for(h in c.xhrFields)i[h]=c.xhrFields[h];c.mimeType&&i.overrideMimeType&&i.overrideMimeType(c.mimeType),c.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest");try{for(h in e)i.setRequestHeader(h,e[h])}catch(j){}i.send(c.hasContent&&c.data||null),d=function(a,e){var h,j,k,l;try{if(d&&(e||4===i.readyState))if(d=b,g&&(i.onreadystatechange=ib.noop,Zc&&delete Wc[g]),e)4!==i.readyState&&i.abort();else{l={},h=i.status,j=i.getAllResponseHeaders(),"string"==typeof i.responseText&&(l.text=i.responseText);try{k=i.statusText}catch(m){k=""}h||!c.isLocal||c.crossDomain?1223===h&&(h=204):h=l.text?200:404}}catch(n){e||f(-1,n)}l&&f(h,k,l,j)},c.async?4===i.readyState?setTimeout(d):(g=++Yc,Zc&&(Wc||(Wc={},ib(a).unload(Zc)),Wc[g]=d),i.onreadystatechange=d):d()},abort:function(){d&&d(b,!0)}}}});var $c,_c,ad=/^(?:toggle|show|hide)$/,bd=new RegExp("^(?:([+-])=|)("+jb+")([a-z%]*)$","i"),cd=/queueHooks$/,dd=[P],ed={"*":[function(a,b){var c,d,e=this.createTween(a,b),f=bd.exec(b),g=e.cur(),h=+g||0,i=1,j=20;if(f){if(c=+f[2],d=f[3]||(ib.cssNumber[a]?"":"px"),"px"!==d&&h){h=ib.css(e.elem,a,!0)||c||1;do i=i||".5",h/=i,ib.style(e.elem,a,h+d);while(i!==(i=e.cur()/g)&&1!==i&&--j)}e.unit=d,e.start=h,e.end=f[1]?h+(f[1]+1)*c:c}return e}]};ib.Animation=ib.extend(N,{tweener:function(a,b){ib.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],ed[c]=ed[c]||[],ed[c].unshift(b)},prefilter:function(a,b){b?dd.unshift(a):dd.push(a)}}),ib.Tween=Q,Q.prototype={constructor:Q,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(ib.cssNumber[c]?"":"px")},cur:function(){var a=Q.propHooks[this.prop];return a&&a.get?a.get(this):Q.propHooks._default.get(this)},run:function(a){var b,c=Q.propHooks[this.prop];return this.pos=b=this.options.duration?ib.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Q.propHooks._default.set(this),this}},Q.prototype.init.prototype=Q.prototype,Q.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=ib.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){ib.fx.step[a.prop]?ib.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[ib.cssProps[a.prop]]||ib.cssHooks[a.prop])?ib.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},Q.propHooks.scrollTop=Q.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},ib.each(["toggle","show","hide"],function(a,b){var c=ib.fn[b];ib.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(R(b,!0),a,d,e)}}),ib.fn.extend({fadeTo:function(a,b,c,d){return this.filter(w).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=ib.isEmptyObject(a),f=ib.speed(b,c,d),g=function(){var b=N(this,ib.extend({},a),f);g.finish=function(){b.stop(!0)},(e||ib._data(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,c,d){var e=function(a){var b=a.stop;delete a.stop,b(d)};return"string"!=typeof a&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,c=null!=a&&a+"queueHooks",f=ib.timers,g=ib._data(this);if(c)g[c]&&g[c].stop&&e(g[c]);else for(c in g)g[c]&&g[c].stop&&cd.test(c)&&e(g[c]);for(c=f.length;c--;)f[c].elem!==this||null!=a&&f[c].queue!==a||(f[c].anim.stop(d),b=!1,f.splice(c,1));(b||!d)&&ib.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=ib._data(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=ib.timers,g=d?d.length:0;for(c.finish=!0,ib.queue(this,a,[]),e&&e.cur&&e.cur.finish&&e.cur.finish.call(this),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),ib.each({slideDown:R("show"),slideUp:R("hide"),slideToggle:R("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){ib.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),ib.speed=function(a,b,c){var d=a&&"object"==typeof a?ib.extend({},a):{complete:c||!c&&b||ib.isFunction(a)&&a,duration:a,easing:c&&b||b&&!ib.isFunction(b)&&b};return d.duration=ib.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in ib.fx.speeds?ib.fx.speeds[d.duration]:ib.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){ib.isFunction(d.old)&&d.old.call(this),d.queue&&ib.dequeue(this,d.queue)},d},ib.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},ib.timers=[],ib.fx=Q.prototype.init,ib.fx.tick=function(){var a,c=ib.timers,d=0;for($c=ib.now();d<c.length;d++)a=c[d],a()||c[d]!==a||c.splice(d--,1);c.length||ib.fx.stop(),$c=b},ib.fx.timer=function(a){a()&&ib.timers.push(a)&&ib.fx.start()},ib.fx.interval=13,ib.fx.start=function(){_c||(_c=setInterval(ib.fx.tick,ib.fx.interval))},ib.fx.stop=function(){clearInterval(_c),_c=null},ib.fx.speeds={slow:600,fast:200,_default:400},ib.fx.step={},ib.expr&&ib.expr.filters&&(ib.expr.filters.animated=function(a){return ib.grep(ib.timers,function(b){return a===b.elem}).length}),ib.fn.offset=function(a){if(arguments.length)return a===b?this:this.each(function(b){ib.offset.setOffset(this,a,b)});var c,d,e={top:0,left:0},f=this[0],g=f&&f.ownerDocument;if(g)return c=g.documentElement,ib.contains(c,f)?(typeof f.getBoundingClientRect!==V&&(e=f.getBoundingClientRect()),d=S(g),{top:e.top+(d.pageYOffset||c.scrollTop)-(c.clientTop||0),left:e.left+(d.pageXOffset||c.scrollLeft)-(c.clientLeft||0)}):e},ib.offset={setOffset:function(a,b,c){var d=ib.css(a,"position");"static"===d&&(a.style.position="relative");var e,f,g=ib(a),h=g.offset(),i=ib.css(a,"top"),j=ib.css(a,"left"),k=("absolute"===d||"fixed"===d)&&ib.inArray("auto",[i,j])>-1,l={},m={};k?(m=g.position(),e=m.top,f=m.left):(e=parseFloat(i)||0,f=parseFloat(j)||0),ib.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(l.top=b.top-h.top+e),null!=b.left&&(l.left=b.left-h.left+f),"using"in b?b.using.call(a,l):g.css(l)}},ib.fn.extend({position:function(){if(this[0]){var a,b,c={top:0,left:0},d=this[0];return"fixed"===ib.css(d,"position")?b=d.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),ib.nodeName(a[0],"html")||(c=a.offset()),c.top+=ib.css(a[0],"borderTopWidth",!0),c.left+=ib.css(a[0],"borderLeftWidth",!0)),{top:b.top-c.top-ib.css(d,"marginTop",!0),left:b.left-c.left-ib.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||W.documentElement;a&&!ib.nodeName(a,"html")&&"static"===ib.css(a,"position");)a=a.offsetParent;return a||W.documentElement})}}),ib.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,c){var d=/Y/.test(c);ib.fn[a]=function(e){return ib.access(this,function(a,e,f){var g=S(a);return f===b?g?c in g?g[c]:g.document.documentElement[e]:a[e]:(g?g.scrollTo(d?ib(g).scrollLeft():f,d?f:ib(g).scrollTop()):a[e]=f,void 0)},a,e,arguments.length,null)}}),ib.each({Height:"height",Width:"width"},function(a,c){ib.each({padding:"inner"+a,content:c,"":"outer"+a},function(d,e){ib.fn[e]=function(e,f){var g=arguments.length&&(d||"boolean"!=typeof e),h=d||(e===!0||f===!0?"margin":"border");return ib.access(this,function(c,d,e){var f;return ib.isWindow(c)?c.document.documentElement["client"+a]:9===c.nodeType?(f=c.documentElement,Math.max(c.body["scroll"+a],f["scroll"+a],c.body["offset"+a],f["offset"+a],f["client"+a])):e===b?ib.css(c,d,h):ib.style(c,d,e,h)},c,g?e:b,g,null)}})}),a.jQuery=a.$=ib,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return ib})}(window);var JSON;JSON||(JSON={}),function(){"use strict";function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;
  throw new SyntaxError("JSON.parse")})}();var BetaJS=BetaJS||{};"undefined"!=typeof module&&"exports"in module&&(module.exports=BetaJS),BetaJS.Types={is_object:function(a){return"object"==typeof a},is_array:function(a){return"[object Array]"===Object.prototype.toString.call(a)},is_undefined:function(a){return"undefined"==typeof a},is_null:function(a){return null===a},is_none:function(a){return this.is_undefined(a)||this.is_null(a)},is_defined:function(a){return"undefined"!=typeof a},is_empty:function(a){if(this.is_none(a))return!0;if(this.is_array(a))return 0===a.length;if(this.is_object(a)){for(var b in a)return!1;return!0}return!1},is_string:function(a){return"string"==typeof a},is_function:function(a){return"function"==typeof a},is_boolean:function(a){return"boolean"==typeof a},compare:function(a,b){if(BetaJS.Types.is_boolean(a)&&BetaJS.Types.is_boolean(b))return a==b?0:a?1:-1;if(BetaJS.Types.is_array(a)&&BetaJS.Types.is_array(b)){for(var c=a.length,d=b.length,e=Math.min(c,d),f=0;e>f;++f){var g=this.compare(a[f],b[f]);if(0!==g)return g}return c==d?0:c>d?1:-1}return a.localeCompare(b)},parseBool:function(a){return this.is_boolean(a)?a:"true"==a?!0:"false"==a?!1:null},type_of:function(a){return this.is_array(a)?"array":typeof a},parseType:function(a,b){return BetaJS.Types.is_string(a)?(b=b.toLowerCase(),"bool"==b||"boolean"==b?this.parseBool(a):"int"==b||"integer"==b?parseInt(a,10):"date"==b||"time"==b||"datetime"==b?parseInt(a,10):a):a}},BetaJS.Strings={nl2br:function(a){return(a+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")},htmlentities:function(a){return(a+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},JS_ESCAPES:{"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},JS_ESCAPER_REGEX:function(){return this.JS_ESCAPER_REGEX_CACHED||(this.JS_ESCAPER_REGEX_CACHED=new RegExp(BetaJS.Objs.keys(this.JS_ESCAPES).join("|"),"g")),this.JS_ESCAPER_REGEX_CACHED},js_escape:function(a){var b=this;return a.replace(this.JS_ESCAPER_REGEX(),function(a){return"\\"+b.JS_ESCAPES[a]})},starts_with:function(a,b){return a.substring(0,b.length)==b},ends_with:function(a,b){return-1!==a.indexOf(b,a.length-b.length)},strip_start:function(a,b){return this.starts_with(a,b)?a.substring(b.length):a},last_after:function(a,b){return a.substring(a.lastIndexOf(b)+b.length,a.length)},first_after:function(a,b){return a.substring(a.indexOf(b)+1,a.length)},EMAIL_ADDRESS_REGEX:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,is_email_address:function(a){return this.EMAIL_ADDRESS_REGEX.test(a)},STRIP_HTML_TAGS:["script","style","head"],STRIP_HTML_REGEX:/<\/?([a-z][a-z0-9]*)\b[^>]*>?/gi,STRIP_HTML_COMMENT_REGEX:/<![^>]*>/gi,strip_html:function(a){var b=a;for(i=0;i<this.STRIP_HTML_TAGS.length;++i)b=b.replace(new RegExp("<"+this.STRIP_HTML_TAGS[i]+".*</"+this.STRIP_HTML_TAGS[i]+">","i"),"");return b=b.replace(this.STRIP_HTML_REGEX,"").replace(this.STRIP_HTML_COMMENT_REGEX,"")},splitFirst:function(a,b){var c=a.indexOf(b);return{head:c>=0?a.substring(0,c):a,tail:c>=0?a.substring(c+b.length):""}},splitLast:function(a,b){var c=a.lastIndexOf(b);return{head:c>=0?a.substring(0,c):"",tail:c>=0?a.substring(c+b.length):a}},nltrim:function(a){var b=a.replace(/\t/g,"  ").split("\n"),c=null,d=0;for(d=0;d<b.length;++d){for(var e=0;e<b[d].length&&" "==b[d].charAt(e);)++e;e<b[d].length&&(c=null===c?e:Math.min(e,c))}for(d=0;d<b.length;++d)b[d]=b[d].substring(c);return b.join("\n").trim()},read_cookie_string:function(a,b){var c="; "+a,d=c.split("; "+b+"=");return 2==d.length?d.pop().split(";").shift():null},write_cookie_string:function(a,b,c){var d="; "+a,e=d.split("; "+b+"=");return 2==e.length&&(d=e[0]+e[1].substring(e[1].indexOf(";"))),b+"="+c+d},capitalize:function(a){return a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})},email_get_name:function(a){a=a||"";var b=a.split("<");return a=b[0].trim(),!a&&b.length>1&&(b=b[1].split(">"),a=b[0].trim()),a=a.replace(/['"]/g,"").replace(/[\\._@]/g," "),this.capitalize(a)},email_get_email:function(a){a=a||"";var b=a.split("<");return a=b[0].trim(),b.length>1&&(b=b[1].split(">"),a=b[0].trim()),a=a.replace(/'/g,"").replace(/"/g,"").trim()},email_get_salutatory_name:function(a){return a=a||"",this.email_get_name(a).split(" ")[0]}},BetaJS.Functions={as_method:function(a,b){return function(){return a.apply(b,arguments)}},once:function(a){var b=!1,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},getArguments:function(a,b){return Array.prototype.slice.call(a,b||0)},matchArgs:function(a,b,c){arguments.length<3&&(c=b,b=0);var d=b,e={};for(var f in c){var g=c[f];g===!0?g={required:!0}:"string"==typeof g&&(g={type:g}),g.required||g.type&&BetaJS.Types.type_of(a[d])==g.type?(e[f]=a[d],d++):g.def&&(e[f]=BetaJS.Types.is_function(g.def)?g.def(e):g.def)}return e},newClassFunc:function(a){return function(){function b(){return a.apply(this,c)}var c=arguments;return b.prototype=a.prototype,new b}},newClass:function(a){return this.newClassFunc(a).apply(this,BetaJS.Functions.getArguments(arguments,1))}},BetaJS.Async={eventually:function(a,b,c){var d=setTimeout(function(){clearTimeout(d),BetaJS.Types.is_array(b)||(c=b,b=[]),a.apply(c||this,b||[])},0)},eventuallyOnce:function(a,b,c){var d={func:a,params:b,context:c};for(var e in this.__eventuallyOnce)if(BetaJS.Comparators.listEqual(this.__eventuallyOnce[e],d))return;this.__eventuallyOnceIdx++;var f=this.__eventuallyOnceIdx;this.__eventuallyOnce[f]=d,this.eventually(function(){delete this.__eventuallyOnce[f],a.apply(c||this,b||[])},this)},__eventuallyOnce:{},__eventuallyOnceIdx:1},BetaJS.Scopes={base:function(a,b,c){if(!BetaJS.Types.is_string(a))return a;if(b)return b[a];try{if(window&&window[a])return window[a]}catch(d){}try{if(global&&global[a])return global[a]}catch(d){}try{if(module&&module.exports)return module.exports}catch(d){}if(!c)return null;try{if(window)return window[a]={},window[a]}catch(d){}try{if(global)return global[a]={},global[a]}catch(d){}try{if(module&&module.exports)return module.exports={},module.exports}catch(d){}return null},resolve:function(a,b){if(!BetaJS.Types.is_string(a))return a;for(var c=a.split("."),d=this.base(c[0],b),e=1;e<c.length;++e)d=d[c[e]];return d},touch:function(a,b){if(!BetaJS.Types.is_string(a))return a;for(var c=a.split("."),d=this.base(c[0],b,!0),e=1;e<c.length;++e)c[e]in d||(d[c[e]]={}),d=d[c[e]];return d},set:function(a,b,c){if(!BetaJS.Types.is_string(b))return b;for(var d=b.split("."),e=this.base(d[0],c,!0),f=1;f<d.length-1;++f)d[f]in e||(e[d[f]]={}),e=e[d[f]];return d.length>1&&(e[d[d.length-1]]=a),a}},BetaJS.Ids={__uniqueId:0,uniqueId:function(a){return(a||"")+this.__uniqueId++},objectId:function(a,b){return"undefined"!=typeof b?a.__cid=b:a.__cid||(a.__cid=this.uniqueId("cid_")),a.__cid}},BetaJS.Tokens={generate_token:function(a){a=a||16;for(var b="";b.length<a;)b+=Math.random().toString(36).substr(2);return b.substr(0,a)}},BetaJS.Objs={count:function(a){if(BetaJS.Types.is_array(a))return a.length;var b=0;for(var c in a)b++;return b},clone:function(a,b){return b&&0!==b?BetaJS.Types.is_array(a)?a.slice(0):BetaJS.Types.is_object(a)?this.extend({},a,b-1):a:a},acyclic_clone:function(a,b){if(null===a||!BetaJS.Types.is_object(a))return a;var c="__acyclic_cloned";if(a[c])return b||"CYCLE";a[c]=!0;var d={};for(var e in a)e!=c&&(d[e]=this.acyclic_clone(a[e],b));return delete a[c],d},extend:function(a,b,c){if(a=a||{},b)for(var d in b)a[d]=this.clone(b[d],c);return a},weak_extend:function(a,b,c){if(a=a||{},b)for(var d in b)d in a||(a[d]=this.clone(b[d],c));return a},tree_extend:function(a,b,c){if(a=a||{},b)for(var d in b)a[d]=d in a&&BetaJS.Types.is_object(a[d])&&BetaJS.Types.is_object(b[d])?this.tree_extend(a[d],b[d],c):this.clone(b[d],c);return a},merge:function(a,b,c){a=a||{},b=b||{};var d={},e=BetaJS.Objs.extend(BetaJS.Objs.keys(a,!0),BetaJS.Objs.keys(b,!0));for(var f in e){var g=f in c?c[f]:"primary";"primary"==g||"secondary"==g?(f in b||f in a)&&(d[f]="primary"==g?f in b?b[f]:a[f]:f in a?a[f]:b[f]):BetaJS.Types.is_function(g)?d[f]=g(a[f],b[f]):BetaJS.Types.is_object(g)&&(d[f]=BetaJS.Objs.merge(a[f],b[f],g))}return d},tree_merge:function(a,b){a=a||{},b=b||{};var c={},d=BetaJS.Objs.extend(BetaJS.Objs.keys(a,!0),BetaJS.Objs.keys(b,!0));for(var e in d)c[e]=BetaJS.Types.is_object(b[e])&&a[e]?BetaJS.Objs.tree_merge(a[e],b[e]):e in b?b[e]:a[e];return c},keys:function(a,b){var c=null,d=null;if(BetaJS.Types.is_undefined(b)){c=[];for(d in a)c.push(d);return c}c={};for(d in a)c[d]=b;return c},map:function(a,b,c){var d=null;if(BetaJS.Types.is_array(a)){d=[];for(var e=0;e<a.length;++e)d.push(c?b.apply(c,[a[e],e]):b(a[e],e));return d}d={};for(var f in a)d[f]=c?b.apply(c,[a[f],f]):b(a[f],f);return d},values:function(a){var b=[];for(var c in a)b.push(a[c]);return b},filter:function(a,b,c){var d=null;if(BetaJS.Types.is_array(a)){d=[];for(var e=0;e<a.length;++e)(c?b.apply(c,[a[e],e]):b(a[e],e))&&d.push(a[e]);return d}d={};for(var f in a)(c?b.apply(c,[a[f],f]):b(a[f],f))&&(d[f]=a[f]);return d},equals:function(a,b,c){var d=null;if(c&&c>0){for(d in a)if(!d in b||!this.equals(a[d],b[d],c-1))return!1;for(d in b)if(!d in a)return!1;return!0}return a==b},iter:function(a,b,c){var d=null;if(BetaJS.Types.is_array(a)){for(var e=0;e<a.length;++e)if(d=c?b.apply(c,[a[e],e]):b(a[e],e),BetaJS.Types.is_defined(d)&&!d)return!1}else for(var f in a)if(d=c?b.apply(c,[a[f],f]):b(a[f],f),BetaJS.Types.is_defined(d)&&!d)return!1;return!0},intersect:function(a,b){var c={};for(var d in a)d in b&&(c[d]=a[d]);return c},contains_key:function(a,b){return BetaJS.Types.is_array(a)?BetaJS.Types.is_defined(a[b]):b in a},contains_value:function(a,b){if(BetaJS.Types.is_array(a)){for(var c=0;c<a.length;++c)if(a[c]===b)return!0}else for(var d in a)if(a[d]===b)return!0;return!1},exists:function(a,b,c){var d=!1;return BetaJS.Objs.iter(a,function(){return d=d||b.apply(this,arguments),!d},c),d},all:function(a,b,c){var d=!0;return BetaJS.Objs.iter(a,function(){return d=d&&b.apply(this,arguments)},c),d},objectify:function(a,b,c){var d={},e=BetaJS.Types.is_function(b);BetaJS.Types.is_undefined(b)&&(b=!0);for(var f=0;f<a.length;++f)d[a[f]]=e?b.apply(c||this,[a[f],f]):b;return d},peek:function(a){if(BetaJS.Types.is_array(a))return a.length>0?a[0]:null;for(var b in a)return a[b];return null},poll:function(a){if(BetaJS.Types.is_array(a))return a.shift();for(var b in a){var c=a[b];return delete a[b],c}return null},objectBy:function(){for(var a={},b=arguments.length/2,c=0;b>c;++c)a[arguments[2*c]]=arguments[2*c+1];return a},valueByIndex:function(a,b){if(b=b||0,BetaJS.Types.is_array(a))return a[b];for(var c in a){if(0===b)return a[c];b--}return null},keyByIndex:function(a,b){if(b=b||0,BetaJS.Types.is_array(a))return b;for(var c in a){if(0===b)return c;b--}return null},pairArrayToObject:function(a){for(var b={},c=0;c<a.length/2;c+=2)b[a[c]]=a[c+1];return b},pairsToObject:function(){for(var a={},b=0;b<arguments.length;++b)a[arguments[b][0]]=arguments[b][1];return a}},BetaJS.Class=function(){},BetaJS.Class.classname="Class",BetaJS.Class.extend=function(a,b,c,d){b=b||[],BetaJS.Types.is_array(b)||(b=[b]),c=c||[],BetaJS.Types.is_array(c)||(c=[c]),d=d||[],BetaJS.Types.is_array(d)||(d=[d]);var e,f=this;BetaJS.Objs.iter(b,function(a){a.hasOwnProperty("constructor")&&(e=a.constructor)});var g=BetaJS.Types.is_defined(e);BetaJS.Types.is_defined(e)||(e=function(){f.apply(this,arguments)}),BetaJS.Objs.extend(e,f),BetaJS.Objs.iter(c,function(a){BetaJS.Objs.extend(e,a)});var h={};if(f.__class_statics_keys)for(var i in f.__class_statics_keys)e[i]=BetaJS.Objs.clone(f[i],1);BetaJS.Objs.iter(d,function(a){BetaJS.Objs.extend(e,a),BetaJS.Objs.extend(h,BetaJS.Objs.keys(a,!0))}),f.__class_statics_keys&&BetaJS.Objs.extend(h,f.__class_statics_keys),e.__class_statics_keys=h,e.parent=f,e.children=[],e.extend=this.extend,f.children||(f.children=[]),f.children.push(e);var j=function(){};return j.prototype=f.prototype,e.prototype=new j,e.prototype.cls=e,e.classname=a,a&&BetaJS.Scopes.set(e,a),e.__notifications={},f.__notifications&&BetaJS.Objs.extend(e.__notifications,f.__notifications,1),BetaJS.Objs.iter(b,function(a){if(BetaJS.Objs.extend(e.prototype,a),"constructor"in a&&(e.prototype.constructor=a.constructor),a._notifications)for(var b in a._notifications)e.__notifications[b]||(e.__notifications[b]=[]),e.__notifications[b].push(a._notifications[b])}),delete e.prototype._notifications,g||(e.prototype.constructor=f.prototype.constructor),e},BetaJS.Class.prototype.constructor=function(){this._notify("construct")},BetaJS.Class.prototype.as_method=function(a){return BetaJS.Functions.as_method(this[a],this)},BetaJS.Class.prototype._auto_destroy=function(a){this.__auto_destroy_list||(this.__auto_destroy_list=[]);var b=a;BetaJS.Types.is_array(b)||(b=[b]);for(var c=0;c<b.length;++c)this.__auto_destroy_list.push(b[c]);return a},BetaJS.Class.prototype._notify=function(a){if(this.cls.__notifications){var b=Array.prototype.slice.call(arguments,1);BetaJS.Objs.iter(this.cls.__notifications[a],function(c){var d=BetaJS.Types.is_function(c)?c:this[c];if(!d)throw this.cls.classname+": Could not find "+a+" notification handler "+c;d.apply(this,b)},this)}},BetaJS.Class.prototype.destroy=function(){if(this._notify("destroy"),this.__auto_destroy_list)for(var a=0;a<this.__auto_destroy_list.length;++a)"destroy"in this.__auto_destroy_list[a]&&this.__auto_destroy_list[a].destroy();for(var b in this)delete this[b]},BetaJS.Class.prototype._inherited=function(a,b){return a.parent.prototype[b].apply(this,Array.prototype.slice.apply(arguments,[2]))},BetaJS.Class._inherited=function(a,b){return a.parent[b].apply(this,Array.prototype.slice.apply(arguments,[2]))},BetaJS.Class.prototype.instance_of=function(a){return this.cls.ancestor_of(a)},BetaJS.Class.prototype.__clsguid="e6b0ed30-80ee-4b28-af02-7d52430ba45f",BetaJS.Class.ancestor_of=function(a){return this==a||this!=BetaJS.Class&&this.parent.ancestor_of(a)},BetaJS.Class.is_instance_of=function(a){return a&&a.__clsguid==BetaJS.Class.prototype.__clsguid&&a.instance_of(this)},BetaJS.Class.prototype.cid=function(){return BetaJS.Ids.objectId(this)},BetaJS.Class.prototype.cls=BetaJS.Class,BetaJS.Class.__notifications={},BetaJS.Class.is_class_instance=function(a){return a&&BetaJS.Types.is_object(a)&&"_inherited"in a&&"cls"in a},BetaJS.Exceptions={ensure:function(a){return a&&BetaJS.Types.is_object(a)&&"instance_of"in a&&a.instance_of(BetaJS.Exceptions.Exception)?a:new BetaJS.Exceptions.NativeException(a)}},BetaJS.Class.extend("BetaJS.Exceptions.Exception",{constructor:function(a){this._inherited(BetaJS.Exceptions.Exception,"constructor"),this.__message=a},assert:function(a){if(!this.instance_of(a))throw this;return this},callstack:function(){for(var a=[],b=arguments.callee.caller;b;)a.push(b.toString()),b=b.caller;return a},callstack_to_string:function(){return this.callstack().join("\n")},message:function(){return this.__message},toString:function(){return this.message()},format:function(){return this.cls.classname+": "+this.toString()+"\n\nCall Stack:\n"+this.callstack_to_string()},json:function(){return{classname:this.cls.classname,message:this.message()}}},{ensure:function(a){return a=BetaJS.Exceptions.ensure(a),a.assert(this),a}}),BetaJS.Exceptions.Exception.extend("BetaJS.Exceptions.NativeException",{constructor:function(a){this._inherited(BetaJS.Exceptions.NativeException,"constructor",a?"toString"in a?a.toString():a:"null"),this.__object=a},object:function(){return this.__object}}),BetaJS.Class.extend("BetaJS.Lists.AbstractList",{_add:function(){},_remove:function(){},_get:function(){},_iterate:function(){},get_ident:function(a){var b=null;return this._iterate(function(c,d){return c==a?(b=d,!1):!0}),b},exists:function(a){return a&&null!==this.get_ident(a)},_ident_changed:function(){},constructor:function(a){this._inherited(BetaJS.Lists.AbstractList,"constructor"),this.__count=0,a&&BetaJS.Objs.iter(a,function(a){this.add(a)},this)},add:function(a){var b=this._add(a);return BetaJS.Types.is_defined(b)&&this.__count++,b},count:function(){return this.__count},clear:function(){this._iterate(function(a,b){return this.remove_by_ident(b),!0},this)},remove_by_ident:function(a){var b=this._remove(a);return BetaJS.Types.is_defined(b)&&this.__count--,b},remove:function(a){return this.remove_by_ident(this.get_ident(a))},remove_by_filter:function(a){this._iterate(function(b,c){return a(b)&&this.remove_by_ident(c),!0},this)},get:function(a){return this._get(a)},iterate:function(a,b){this._iterate(function(b,c){var d=a.apply(this,[b,c]);return BetaJS.Types.is_defined(d)?d:!0},b)},iterator:function(){return BetaJS.Iterators.ArrayIterator.byIterate(this.iterate,this)}}),BetaJS.Lists.AbstractList.extend("BetaJS.Lists.LinkedList",{constructor:function(a){this.__first=null,this.__last=null,this._inherited(BetaJS.Lists.LinkedList,"constructor",a)},_add:function(a){return this.__last={obj:a,prev:this.__last,next:null},this.__first?this.__last.prev.next=this.__last:this.__first=this.__last,this.__last},_remove:function(a){return a.next?a.next.prev=a.prev:this.__last=a.prev,a.prev?a.prev.next=a.next:this.__first=a.next,a.obj},_get:function(a){return a.obj},_iterate:function(a,b){for(var c=this.__first;c;){var d=c;if(c=c.next,!a.apply(b||this,[d.obj,d]))return}}}),BetaJS.Lists.AbstractList.extend("BetaJS.Lists.ObjectIdList",{constructor:function(a,b){this.__map={},this.__id_generator=b,this._inherited(BetaJS.Lists.ObjectIdList,"constructor",a)},_add:function(a){for(;;){var b=a.__cid;if(b||(b=this.__id_generator?BetaJS.Ids.objectId(a,this.__id_generator()):BetaJS.Ids.objectId(a),!this.__map[b]||!this.__id_generator))return this.__map[b]=a,b}return null},_remove:function(a){var b=this.__map[a];return delete this.__map[a],b},_get:function(a){return this.__map[a]},_iterate:function(a,b){for(var c in this.__map)a.apply(b||this,[this.__map[c],c])},get_ident:function(a){var b=BetaJS.Ids.objectId(a);return this.__map[b]?b:null}}),BetaJS.Lists.AbstractList.extend("BetaJS.Lists.ArrayList",{constructor:function(a,b){this.__idToIndex={},this.__items=[],b=b||{},"compare"in b&&(this._compare=b.compare),"get_ident"in b&&(this._get_ident=b.get_ident),this._inherited(BetaJS.Lists.ArrayList,"constructor",a)},set_compare:function(a){this._compare=a,a&&this.sort()},get_compare:function(){return this._compare},sort:function(a){if(a=a||this._compare){this.__items.sort(a);for(var b=0;b<this.__items.length;++b)this.__ident_changed(this.__items[b],b);this._sorted()}},_sorted:function(){},re_index:function(a){if(!this._compare)return a;for(var b=this.__items.length-1,c=this.__items[a],d=a;b>d&&this._compare(this.__items[d],this.__items[d+1])>0;)this.__items[d]=this.__items[d+1],this.__ident_changed(this.__items[d],d),this.__items[d+1]=c,++d;if(d==a)for(;d>0&&this._compare(this.__items[d],this.__items[d-1])<0;)this.__items[d]=this.__items[d-1],this.__ident_changed(this.__items[d],d),this.__items[d-1]=c,--d;return d!=a&&(this.__ident_changed(c,d),this._re_indexed(c)),d},_re_indexed:function(){},__objectId:function(a){return this._get_ident?this._get_ident(a):BetaJS.Ids.objectId(a)},_add:function(a){var b=this.__items.length;this.__items.push(a);var c=this.re_index(b);return this.__idToIndex[this.__objectId(a)]=c,c},_remove:function(a){for(var b=this.__items[a],c=a+1;c<this.__items.length;++c)this.__items[c-1]=this.__items[c],this.__ident_changed(this.__items[c-1],c-1);return this.__items.pop(),delete this.__idToIndex[this.__objectId(b)],b},_get:function(a){return this.__items[a]},_iterate:function(a,b){for(var c=BetaJS.Objs.clone(this.__items,1),d=0;d<c.length;++d)a.apply(b||this,[c[d],this.get_ident(c[d])])},__ident_changed:function(a,b){this.__idToIndex[this.__objectId(a)]=b,this._ident_changed(a,b)},get_ident:function(a){var b=this.__objectId(a);return b in this.__idToIndex?this.__idToIndex[b]:null},ident_by_id:function(a){return this.__idToIndex[a]}}),BetaJS.Iterators={ensure:function(a){return null===a?new BetaJS.Iterators.ArrayIterator([]):a.instance_of(BetaJS.Iterators.Iterator)?a:BetaJS.Types.is_array(a)?new BetaJS.Iterators.ArrayIterator(a):new BetaJS.Iterators.ArrayIterator([a])}},BetaJS.Class.extend("BetaJS.Iterators.Iterator",{asArray:function(){for(var a=[];this.hasNext();)a.push(this.next());return a},asArrayDelegate:function(a){for(var b=[];this.hasNext();){var c=this.next();b.push(c[a].apply(c,BetaJS.Functions.getArguments(arguments,1)))}return b},iterate:function(a,b){for(;this.hasNext();)a.call(b||this,this.next())}}),BetaJS.Iterators.Iterator.extend("BetaJS.Iterators.ArrayIterator",{constructor:function(a){this._inherited(BetaJS.Iterators.ArrayIterator,"constructor"),this.__array=a,this.__i=0},hasNext:function(){return this.__i<this.__array.length},next:function(){var a=this.__array[this.__i];return this.__i++,a}},{byIterate:function(a,b){var c=[];return a.call(b||this,function(a){c.push(a)},this),new this(c)}}),BetaJS.Iterators.ArrayIterator.extend("BetaJS.Iterators.ObjectKeysIterator",{constructor:function(a){this._inherited(BetaJS.Iterators.ObjectKeysIterator,"constructor",BetaJS.Objs.keys(a))}}),BetaJS.Iterators.ArrayIterator.extend("BetaJS.Iterators.ObjectValuesIterator",{constructor:function(a){this._inherited(BetaJS.Iterators.ObjectValuesIterator,"constructor",BetaJS.Objs.values(a))}}),BetaJS.Iterators.Iterator.extend("BetaJS.Iterators.MappedIterator",{constructor:function(a,b,c){this._inherited(BetaJS.Iterators.MappedIterator,"constructor"),this.__iterator=a,this.__map=b,this.__context=c||this},hasNext:function(){return this.__iterator.hasNext()},next:function(){return this.hasNext()?this.__map.call(this.__context,this.__iterator.next()):null}}),BetaJS.Iterators.Iterator.extend("BetaJS.Iterators.FilteredIterator",{constructor:function(a,b,c){this._inherited(BetaJS.Iterators.FilteredIterator,"constructor"),this.__iterator=a,this.__filter=b,this.__context=c||this,this.__next=null},hasNext:function(){return this.__crawl(),null!==this.__next},next:function(){this.__crawl();var a=this.__next;return this.__next=null,a},__crawl:function(){for(;!this.__next&&this.__iterator.hasNext();){var a=this.__iterator.next();this.__filter_func(a)&&(this.__next=a)}},__filter_func:function(a){return this.__filter.apply(this.__context,[a])}}),BetaJS.Iterators.Iterator.extend("BetaJS.Iterators.SkipIterator",{constructor:function(a,b){for(this._inherited(BetaJS.Iterators.SkipIterator,"constructor"),this.__iterator=a;b>0;)a.next(),b--},hasNext:function(){return this.__iterator.hasNext()},next:function(){return this.__iterator.next()}}),BetaJS.Iterators.Iterator.extend("BetaJS.Iterators.LimitIterator",{constructor:function(a,b){this._inherited(BetaJS.Iterators.LimitIterator,"constructor"),this.__iterator=a,this.__limit=b},hasNext:function(){return this.__limit>0&&this.__iterator.hasNext()},next:function(){return this.__limit<=0?null:(this.__limit--,this.__iterator.next())}}),BetaJS.Iterators.Iterator.extend("BetaJS.Iterators.SortedIterator",{constructor:function(a,b){this._inherited(BetaJS.Iterators.SortedIterator,"constructor"),this.__array=a.asArray(),this.__array.sort(b),this.__i=0},hasNext:function(){return this.__i<this.__array.length},next:function(){var a=this.__array[this.__i];return this.__i++,a}}),BetaJS.Events={},BetaJS.Events.EVENT_SPLITTER=/\s+/,BetaJS.Events.EventsMixin={__create_event_object:function(a,b,c){c=c||{};var d={callback:a,context:b};return c.eventually&&(d.eventually=c.eventually),c.min_delay&&(d.min_delay=new BetaJS.Timers.Timer({delay:c.min_delay,once:!0,start:!1,context:this,fire:function(){d.max_delay&&d.max_delay.stop(),d.callback.apply(d.context||this,d.params)}})),c.max_delay&&(d.max_delay=new BetaJS.Timers.Timer({delay:c.max_delay,once:!0,start:!1,context:this,fire:function(){d.min_delay&&d.min_delay.stop(),d.callback.apply(d.context||this,d.params)}})),d},__destroy_event_object:function(a){a.min_delay&&a.min_delay.destroy(),a.max_delay&&a.max_delay.destroy()},__call_event_object:function(a,b){a.min_delay&&a.min_delay.restart(),a.max_delay&&a.max_delay.start(),a.min_delay||a.max_delay?a.params=b:a.eventually?BetaJS.Async.eventually(a.callback,b,a.context||this):a.callback.apply(a.context||this,b)},on:function(a,b,c,d){this.__events_mixin_events=this.__events_mixin_events||{},a=a.split(BetaJS.Events.EVENT_SPLITTER);for(var e;;){if(e=a.shift(),!e)break;this.__events_mixin_events[e]||this._notify("register_event",e),this.__events_mixin_events[e]=this.__events_mixin_events[e]||new BetaJS.Lists.LinkedList,this.__events_mixin_events[e].add(this.__create_event_object(b,c,d))}return this},off:function(a,b,c){if(this.__events_mixin_events=this.__events_mixin_events||{},a){a=a.split(BetaJS.Events.EVENT_SPLITTER);for(var d;;){if(d=a.shift(),!d)break;this.__events_mixin_events[d]&&(this.__events_mixin_events[d].remove_by_filter(function(a){var d=!(b&&a.callback!=b||c&&a.context!=c);return d&&this.__destroy_event_object&&this.__destroy_event_object(a),d}),0===this.__events_mixin_events[d].count()&&(this.__events_mixin_events[d].destroy(),delete this.__events_mixin_events[d],this._notify("unregister_event",d)))}}else for(d in this.__events_mixin_events)this.__events_mixin_events[d].remove_by_filter(function(a){var d=!(b&&a.callback!=b||c&&a.context!=c);return d&&this.__destroy_event_object&&this.__destroy_event_object(a),d}),0===this.__events_mixin_events[d].count()&&(this.__events_mixin_events[d].destroy(),delete this.__events_mixin_events[d],this._notify("unregister_event",d));return this},triggerAsync:function(){var a=this,b=BetaJS.Functions.getArguments(arguments),c=setTimeout(function(){clearTimeout(c),a.trigger.apply(a,b)},0)},trigger:function(a){var b=this;a=a.split(BetaJS.Events.EVENT_SPLITTER);var c,d=BetaJS.Functions.getArguments(arguments,1);if(!this.__events_mixin_events)return this;for(;;){if(c=a.shift(),!c)break;this.__events_mixin_events[c]&&this.__events_mixin_events[c].iterate(function(a){b.__call_event_object(a,d)}),this.__events_mixin_events&&"all"in this.__events_mixin_events&&this.__events_mixin_events.all.iterate(function(a){b.__call_event_object(a,[c].concat(d))})}return this},once:function(a,b,c,d){var e=this,f=BetaJS.Functions.once(function(){e.off(a,f),b.apply(this,arguments)});return f._callback=b,this.on(name,f,c,d)},delegateEvents:function(a,b,c,d){d=d||[],c=c?c+":":"",null===a?b.on("all",function(a){var b=BetaJS.Functions.getArguments(arguments,1);this.trigger.apply(this,[c+a].concat(d).concat(b))},this):(BetaJS.Types.is_array(a)||(a=[a]),BetaJS.Objs.iter(a,function(a){b.on(a,function(){var b=BetaJS.Functions.getArguments(arguments);this.trigger.apply(this,[c+a].concat(d).concat(b))},this)},this))}},BetaJS.Class.extend("BetaJS.Events.Events",BetaJS.Events.EventsMixin),BetaJS.Events.ListenMixin={_notifications:{destroy:"listenOff"},listenOn:function(a,b,c,d){this.__listen_mixin_listen||(this.__listen_mixin_listen={}),this.__listen_mixin_listen[BetaJS.Ids.objectId(a)]=a,a.on(b,c,this,d)},listenOnce:function(a,b,c,d){this.__listen_mixin_listen||(this.__listen_mixin_listen={}),this.__listen_mixin_listen[BetaJS.Ids.objectId(a)]=a,a.once(b,c,this,d)},listenOff:function(a,b,c){this.__listen_mixin_listen&&(a?(a.off(b,c,this),b||c||delete this.__listen_mixin_listen[BetaJS.Ids.objectId(a)]):BetaJS.Objs.iter(this.__listen_mixin_listen,function(a){a&&"off"in a&&a.off(b,c,this),b||c||delete this.__listen_mixin_listen[BetaJS.Ids.objectId(a)]},this))}},BetaJS.Class.extend("BetaJS.Events.Listen",BetaJS.Events.ListenMixin),BetaJS.Classes={},BetaJS.Classes.InvokerMixin={invoke_delegate:function(a,b){BetaJS.Types.is_array(b)||(b=[b]),a=this[a];for(var c=this,d=0;d<b.length;++d){var e=b[d];this[e]=function(b){return function(){var d=BetaJS.Functions.getArguments(arguments);return d.unshift(b),a.apply(c,d)}}.call(c,e)}}},BetaJS.Classes.AutoDestroyMixin={_notifications:{construct:"__initialize_auto_destroy",destroy:"__finalize_auto_destroy"},__initialize_auto_destroy:function(){this.__auto_destroy={}},__finalize_auto_destroy:function(){var a=this.__auto_destroy;this.__auto_destroy={},BetaJS.Objs.iter(a,function(a){a.unregister(this)},this)},register_auto_destroy:function(a){a.cid()in this.__auto_destroy||(this.__auto_destroy[a.cid()]=a,a.register(this),this._notify("register_auto_destroy",a))},unregister_auto_destroy:function(a){a.cid()in this.__auto_destroy&&(this._notify("unregister_auto_destroy",a),delete this.__auto_destroy[a.cid()],a.unregister(this),BetaJS.Types.is_empty(this.__auto_destroy)&&this.destroy())}},BetaJS.Class.extend("BetaJS.Classes.AutoDestroyObject",{constructor:function(){this._inherited(BetaJS.Classes.AutoDestroyObject,"constructor"),this.__objects={}},register:function(a){var b=BetaJS.Ids.objectId(a);b in this.__objects||(this.__objects[b]=a,a.register_auto_destroy(this))},unregister:function(a){var b=BetaJS.Ids.objectId(a);b in this.__objects&&(delete this.__objects[b],a.unregister_auto_destroy(this))},clear:function(){BetaJS.Objs.iter(this.__objects,function(a){this.unregister(a)},this)}}),BetaJS.Class.extend("BetaJS.Classes.ObjectCache",[BetaJS.Events.EventsMixin,{constructor:function(a){this._inherited(BetaJS.Classes.ObjectCache,"constructor"),this.__size="size"in a?a.size:null,this.__destroy_on_remove="destroy_on_remove"in a?a.destroy_on_remove:!0,this.__id_to_container={},this.__first=null,this.__last=null,this.__count=0},destroy:function(){this.clear(),this._inherited(BetaJS.Classes.ObjectCache,"destroy")},add:function(a){if(!this.get(a)){null!==this.__size&&this.__count>=this.__size&&this.__first&&this.remove(this.__first.object);var b={object:a,prev:this.__last,next:null};this.__id_to_container[BetaJS.Ids.objectId(a)]=b,this.__first?this.__last.next=b:this.__first=b,this.__last=b,this.__count++,this.trigger("cache",a)}},remove:function(a){BetaJS.Class.is_class_instance(a)&&(a=BetaJS.Ids.objectId(a));var b=this.__id_to_container[a];b&&(delete this.__id_to_container[a],b.next?b.next.prev=b.prev:this.__last=b.prev,b.prev?b.prev.next=b.next:this.__first=b.next,this.__count--,this.trigger("release",b.object),this.__destroy_on_remove&&b.object.destroy())},get:function(a){return BetaJS.Class.is_class_instance(a)&&(a=BetaJS.Ids.objectId(a)),this.__id_to_container[a]?this.__id_to_container[a].object:null},clear:function(){BetaJS.Objs.iter(this.__id_to_container,function(a){this.remove(a.object)},this)}}]),BetaJS.Classes.ModuleMixin={_notifications:{construct:function(){this.__modules={}},destroy:function(){BetaJS.Objs.iter(this.__modules,this.remove_module,this)}},add_module:function(a){a.cid()in this.__modules||(this.__modules[a.cid()]=a,a.register(this),this._notify("add_module",a))},remove_module:function(a){a.cid()in this.__modules&&(delete this.__modules[a.cid()],a.unregister(this),this._notify("remove_module",a))}},BetaJS.Class.extend("BetaJS.Classes.Module",{constructor:function(a){this._inherited(BetaJS.Classes.Module,"constructor"),this._objects={},this.__auto_destroy="auto_destroy"in a?a.auto_destroy:!0},destroy:function(){BetaJS.Objs.iter(this._objects,this.unregister,this),this._inherited(BetaJS.Classes.Module,"destroy")},register:function(a){var b=BetaJS.Ids.objectId(a);if(!(b in this._objects)){var c={};this._objects[b]={object:a,data:c},a.add_module(this),this._register(a,c)}},_register:function(){},unregister:function(a){var b=BetaJS.Ids.objectId(a);if(b in this._objects){var c=this._objects[b].data;this._unregister(a,c),delete this._objects[b],a.remove_module(this),"off"in a&&a.off(null,null,this),this.__auto_destroy&&BetaJS.Types.is_empty(this._objects)&&this.destroy()}},_unregister:function(){},_data:function(a){return this._objects[BetaJS.Ids.objectId(a)].data}},{__instance:null,singleton:function(){return this.__instance||(this.__instance=new this({auto_destroy:!1})),this.__instance}}),BetaJS.Classes.ObjectIdMixin={_notifications:{construct:"__register_object_id",destroy:"__unregister_object_id"},__object_id_scope:function(){return this.object_id_scope?this.object_id_scope:(BetaJS.Classes.ObjectIdScope||(BetaJS.Classes.ObjectIdScope=BetaJS.Objs.clone(BetaJS.Classes.ObjectIdScopeMixin,1)),BetaJS.Classes.ObjectIdScope)
},__register_object_id:function(){var a=this.__object_id_scope();a.__objects[BetaJS.Ids.objectId(this)]=this},__unregister_object_id:function(){var a=this.__object_id_scope();delete a.__objects[BetaJS.Ids.objectId(this)]}},BetaJS.Classes.ObjectIdScopeMixin={__objects:{},get:function(a){return this.__objects[a]}},BetaJS.Classes.HelperClassMixin={addHelper:function(a,b){var c=new a(this,b);return this.__helpers=this.__helpers||[],this.__helpers.push(this._auto_destroy(c)),c},_helper:function(a){this.__helpers=this.__helpers||[],BetaJS.Types.is_string(a)&&(a={method:a}),a=BetaJS.Objs.extend({fold_start:null,fold:function(a,b){return a||b}},a);for(var b=BetaJS.Functions.getArguments(arguments,1),c=a.async?BetaJS.Promise.create(a.fold_start):a.fold_start,d=0;d<this.__helpers.length;++d){var e=this.__helpers[d];a.method in e&&(c=a.async?BetaJS.Promise.func(a.fold,c,BetaJS.Promise.methodArgs(e,e[a.method],b)):a.fold(c,e[a.method].apply(e,b)))}return c}},BetaJS.Class.extend("BetaJS.Classes.IdGenerator",{generate:function(){}}),BetaJS.Classes.IdGenerator.extend("BetaJS.Classes.PrefixedIdGenerator",{constructor:function(a,b){this._inherited(BetaJS.Classes.PrefixedIdGenerator,"constructor"),this.__prefix=a,this.__generator=b},generate:function(){return this.__prefix+this.__generator.generate()}}),BetaJS.Classes.IdGenerator.extend("BetaJS.Classes.RandomIdGenerator",{constructor:function(a){this._inherited(BetaJS.Classes.PrefixedIdGenerator,"constructor"),this.__length=a||16},generate:function(){return BetaJS.Tokens.generate_token(this.__length)}}),BetaJS.Classes.IdGenerator.extend("BetaJS.Classes.ConsecutiveIdGenerator",{constructor:function(a){this._inherited(BetaJS.Classes.ConsecutiveIdGenerator,"constructor"),this.__current=a||0},generate:function(){return this.__current++,this.__current}}),BetaJS.Classes.IdGenerator.extend("BetaJS.Classes.TimedIdGenerator",{constructor:function(){this._inherited(BetaJS.Classes.TimedIdGenerator,"constructor"),this.__current=BetaJS.Time.now()-1},generate:function(){var a=BetaJS.Time.now();return this.__current=a>this.__current?a:this.__current+1,this.__current}}),BetaJS.Class.extend("BetaJS.Classes.PathResolver",{constructor:function(a){this._inherited(BetaJS.Classes.PathResolver,"constructor"),this._bindings=a||{}},extend:function(a,b){if(b)for(var c in a){for(var d=a[c],e=/\{([^}]+)\}/;;){var f=e.exec(d);if(!f)break;d=d.replace(e,b+"."+f[1])}this._bindings[b+"."+c]=d}else this._bindings=BetaJS.Objs.extend(this._bindings,a)},map:function(a){for(var b=[],c=0;c<a.length;++c)a[c]&&b.push(this.resolve(a[c]));return b},resolve:function(a){for(var b=/\{([^}]+)\}/;;){var c=b.exec(a);if(!c)return this.simplify(a);a=a.replace(b,this._bindings[c[1]])}return a},simplify:function(a){return a.replace(/[^\/]+\/\.\.\//,"").replace(/\/[^\/]+\/\.\./,"")}}),BetaJS.Class.extend("BetaJS.Classes.MultiDelegatable",{constructor:function(a,b){this._inherited(BetaJS.Classes.MultiDelegatable,"constructor"),BetaJS.Objs.iter(b,function(b){this[b]=function(){var c=arguments;return BetaJS.Objs.iter(a,function(a){a[b].apply(a,c)},this),this}},this)}}),BetaJS.Class.extend("BetaJS.Classes.ClassRegistry",{constructor:function(a){this._inherited(BetaJS.Classes.ClassRegistry,"constructor"),this._classes=a||{}},register:function(a,b){this._classes[a]=b},get:function(a){return BetaJS.Types.is_object(a)?a:this._classes[a]},create:function(a){var b=BetaJS.Functions.newClassFunc(this.get(a));return b.apply(this,BetaJS.Functions.getArguments(arguments,1))}}),BetaJS.Properties={},BetaJS.Properties.PropertiesMixin={_notifications:{construct:function(){this.__properties={data:{},watchers:{children:{},eventCount:0,parent:null,key:null},computed:{},bindings:{}}},destroy:function(){BetaJS.Objs.iter(this.__properties.bindings,function(a,b){this.unbind(b)},this),this.trigger("destroy")},register_event:function(a){BetaJS.Objs.iter(["change","unset","deepchange","deepunset","strongdeepchange","strongchange"],function(b){BetaJS.Strings.starts_with(a,b+":")&&this.__registerWatcher(BetaJS.Strings.strip_start(a,b+":"),b)},this)},unregister_event:function(a){BetaJS.Objs.iter(["change","unset","deepchange","deepunset","strongdeepchange","strongchange"],function(b){BetaJS.Strings.starts_with(a,b+":")&&this.__unregisterWatcher(BetaJS.Strings.strip_start(a,b+":"),b)},this)}},get:function(a){return BetaJS.Properties.Scopes.get(a,this.__properties.data)},_canSet:function(){return!0},_beforeSet:function(a,b){return b},_afterSet:function(){},has:function(a){return BetaJS.Properties.Scopes.has(a,this.__properties.data)},setAll:function(a){for(var b in a)this.set(b,a[b]);return this},keys:function(a){return BetaJS.Objs.keys(this.__properties.data,a)},data:function(){return this.__properties.data},getAll:function(){return BetaJS.Objs.clone(this.__properties.data,1)},__registerWatcher:function(a){for(var b=a?a.split("."):[],c=this.__properties.watchers,d=0;d<b.length;++d)b[d]in c.children||(c.children[b[d]]={parent:c,eventCount:0,children:{},key:b[d]}),c=c.children[b[d]];c.eventCount++},__unregisterWatcher:function(a){for(var b=a?a.split("."):[],c=this.__properties.watchers,d=0;d<b.length;++d)c&&(c=c.children[b[d]]);if(c)for(c.eventCount--;c.eventCount<=0&&BetaJS.Types.is_empty(c.children)&&c.parent;){var e=c.parent;delete e.children[c.key],c=e}},uncompute:function(a){return a in this.__properties.computed&&(BetaJS.Objs.iter(this.__properties.computed[a].dependencies,function(a){a.properties.off("change:"+a.key,null,a)},this),delete this.__properties.computed[a]),this},compute:function(a,b){function c(){if(!(f.ignore>0)){var c=BetaJS.Objs.map(e,function(a){return a.properties.get(a.key)});g.set(a,b.apply(d.context,c))}}var d=BetaJS.Functions.matchArgs(arguments,2,{setter:"function",context:{type:"object",def:this},dependencies:!0});this.uncompute(a);var e=[];BetaJS.Objs.iter(d.dependencies,function(a){BetaJS.Types.is_string(a)?e.push({properties:this,key:a}):e.push({properties:a[0],key:a[1]})},this);var f={ignore:0,func:b,context:d.context,setter:d.setter,dependencies:e};this.__properties.computed[a]=f;for(var g=this,h=0;h<e.length;++h)e[h].properties.on("change:"+e[h].key,function(){c()},e[h]);return c(),this},unbind:function(a,b){if(a in this.__properties.bindings){for(i=this.__properties.bindings[a].length-1;i>=0;--i){var c=this.__properties.bindings[a][i];b&&b!=c||(c.left&&c.properties.off(null,null,c),c.right&&this.off(null,null,c),this.__properties.bindings[a].splice(i,1),i--)}0===this.__properties.bindings[a].length&&delete this.__properties.bindings[a]}return this},bind:function(a,b,c){c=BetaJS.Objs.extend({secondKey:a,left:!0,right:!0,deep:!1},c);var d={key:c.secondKey,left:c.left,right:c.right,deep:c.deep,properties:b};if(this.__properties.bindings[a]=this.__properties.bindings[a]||[],this.__properties.bindings[a].push(d),d.left){var e=this;d.properties.on("strongchange:"+d.key,function(b){e.set(a,b)},d),d.properties.on("unset:"+d.key,function(){e.unset(a)},d),d.deep&&(d.properties.on("strongdeepchange:"+d.key,function(b,c,d){e.get(a?a+"."+d:d)===b?e.__setChanged(a?a+"."+d:d,b,c,!0):e.set(a?a+"."+d:d,b)},d),d.properties.on("deepunset:"+d.key,function(b,c){e.has(a?a+"."+c:c)?e.unset(a?a+"."+c:c):e.__unsetChanged(a?a+"."+c:c,b)},d)),d.right&&this.has(a)||this.set(a,d.properties.get(d.key))}return d.right&&(this.on("strongchange:"+a,function(a){d.properties.set(d.key,a)},d),this.on("unset:"+a,function(){d.properties.unset(d.key)},d),d.deep&&(this.on("strongdeepchange:"+a,function(a,b,c){d.properties.get(d.key?d.key+"."+c:c)===a?d.properties.__setChanged(d.key?d.key+"."+c:c,a,b,!0):d.properties.set(d.key?d.key+"."+c:c,a)},d),this.on("deepunset:"+a,function(a,b){d.properties.has(d.key?d.key+"."+b:b)?d.properties.unset(d.key?d.key+"."+b:b):d.properties.__unsetChanged(d.key?d.key+"."+b:b,a)},d)),(!d.left||this.has(a))&&d.properties.set(d.key,this.get(a))),d.properties.on("destroy",function(){this.unbind()},this),this},__unsetChanged:function(a,b){function c(a,b,d){BetaJS.Types.is_undefined(d)||(a.eventCount>0&&this.trigger("unset:"+b,d),BetaJS.Objs.iter(a.children,function(a,e){c.call(this,a,b?b+"."+e:e,d[e])},this))}this.trigger("unset",a,b);for(var d=a?a.split("."):[],e=this.__properties.watchers,f="",g=a,h=0;h<d.length;++h){if(e.eventCount>0&&this.trigger("deepunset:"+f,b,g),!(d[h]in e.children))return this;e=e.children[d[h]],f=f?f+"."+d[h]:d[h],g=BetaJS.Strings.first_after(g,".")}return c.call(this,e,a,b),this},__setChanged:function(a,b,c,d){function e(a,b,c,f){c!=f&&(a.eventCount>0&&(d||this.trigger("strongchange:"+b,c,f),this.trigger("change:"+b,c,f)),BetaJS.Objs.iter(a.children,function(a,d){e.call(this,a,b?b+"."+d:d,c[d],f[d])},this))}this.trigger("change",a,b,c),this._afterSet(a,b);for(var f=a?a.split("."):[],g=this.__properties.watchers,h="",i=a,j=0;j<f.length;++j){if(g.eventCount>0&&(d||this.trigger("strongdeepchange:"+h,b,c,i),this.trigger("deepchange:"+h,b,c,i)),!(f[j]in g.children))return;g=g.children[f[j]],h=h?h+"."+f[j]:f[j],i=BetaJS.Strings.first_after(i,".")}e.call(this,g,a,b,c)},unset:function(a){if(this.has(a)){var b=this.get(a);BetaJS.Properties.Scopes.unset(a,this.__properties.data),this.__unsetChanged(a,b)}return this},__properties_guid:"ec816b66-7284-43b1-a945-0600c6abfde3",set:function(a,b){if(BetaJS.Types.is_object(b)&&b&&b.guid==this.__properties_guid)return b.properties&&this.bind(a,b.properties,{secondKey:b.key}),b.func&&this.compute(a,b.func,b.dependencies),this;b=this._beforeSet(a,b);var c=this.get(a);return c!==b&&(BetaJS.Properties.Scopes.set(a,b,this.__properties.data),this.__setChanged(a,b,c)),this},binding:function(a){return{guid:this.__properties_guid,properties:this,key:a}},computed:function(a,b){return{guid:this.__properties_guid,func:a,dependencies:b}}},BetaJS.Class.extend("BetaJS.Properties.Properties",[BetaJS.Events.EventsMixin,BetaJS.Properties.PropertiesMixin,{constructor:function(a){this._inherited(BetaJS.Properties.Properties,"constructor"),a&&this.setAll(a)}}]),BetaJS.Properties.Scopes={has:function(a,b){for(var c=a?a.split("."):[],d=0;d<c.length;++d){if(!b||!BetaJS.Types.is_object(b))return!1;b=b[c[d]]}return BetaJS.Types.is_defined(b)},get:function(a,b){for(var c=a?a.split("."):[],d=0;d<c.length;++d){if(!b||!BetaJS.Types.is_object(b))return null;b=b[c[d]]}return b},set:function(a,b,c){if(a){for(var d=a.split("."),e=0;e<d.length-1;++e)d[e]in c&&BetaJS.Types.is_object(c[d[e]])||(c[d[e]]={}),c=c[d[e]];c[d[d.length-1]]=b}},unset:function(a,b){if(a){for(var c=a.split("."),d=0;d<c.length-1;++d){if(!b||!BetaJS.Types.is_object(b))return;b=b[c[d]]}delete b[c[c.length-1]]}},touch:function(a,b){if(!a)return b;for(var c=a.split("."),d=0;d<c.length;++d)c[d]in b&&BetaJS.Types.is_object(b)||(b[c[d]]={}),b=b[c[d]];return b[c[c.length-1]]}},BetaJS.Class.extend("BetaJS.Collections.Collection",[BetaJS.Events.EventsMixin,{constructor:function(a){this._inherited(BetaJS.Collections.Collection,"constructor"),a=a||{},this.__indices={},a.indices&&BetaJS.Objs.iter(a.indices,this.add_secondary_index,this);var b={};"compare"in a&&(b.compare=a.compare),b.get_ident=BetaJS.Functions.as_method(this.get_ident,this),this.__data=new BetaJS.Lists.ArrayList([],b);var c=this;this.__data._ident_changed=function(a,b){c._index_changed(a,b)},this.__data._re_indexed=function(a){c._re_indexed(a)},this.__data._sorted=function(){c._sorted()},"objects"in a&&this.add_objects(a.objects)},add_secondary_index:function(a){this.__indices[a]={},this.iterate(function(b){this.__indices[a][b.get(a)]=b},this)},get_by_secondary_index:function(a,b){return this.__indices[a][b]},get_ident:function(a){return BetaJS.Ids.objectId(a)},set_compare:function(a){this.__data.set_compare(a)},get_compare:function(){this.__data.get_compare()},destroy:function(){this.__data.iterate(function(a){"off"in a&&a.off(null,null,this)},this),this.__data.destroy(),this.trigger("destroy"),this._inherited(BetaJS.Collections.Collection,"destroy")},count:function(){return this.__data.count()},_index_changed:function(a,b){this.trigger("index",a,b)},_re_indexed:function(a){this.trigger("reindexed",a)},_sorted:function(){this.trigger("sorted")},_object_changed:function(a,b,c){this.trigger("update"),this.trigger("change",a,b,c),this.trigger("change:"+b,a,c),this.__data.re_index(this.getIndex(a))},add:function(a){if(BetaJS.Class.is_class_instance(a)||(a=new BetaJS.Properties.Properties(a)),this.exists(a))return null;var b=this.__data.add(a);return null!==b&&(BetaJS.Objs.iter(this.__indices,function(b,c){b[a.get(c)]=a},this),this.trigger("add",a),this.trigger("update"),"on"in a&&a.on("change",function(b,c,d){this._object_changed(a,b,c,d)},this)),b},add_objects:function(a){var b=0;return BetaJS.Objs.iter(a,function(a){this.add(a)&&b++},this),b},exists:function(a){return this.__data.exists(a)},remove:function(a){if(!this.exists(a))return null;BetaJS.Objs.iter(this.__indices,function(b,c){delete b[a.get(c)]},this),this.trigger("remove",a),this.trigger("update");var b=this.__data.remove(a);return"off"in a&&a.off(null,null,this),b},getByIndex:function(a){return this.__data.get(a)},getById:function(a){return this.__data.get(this.__data.ident_by_id(a))},getIndex:function(a){return this.__data.get_ident(a)},iterate:function(a,b){this.__data.iterate(a,b)},iterator:function(){return BetaJS.Iterators.ArrayIterator.byIterate(this.iterate,this)},clear:function(){this.iterate(function(a){this.remove(a)},this)}}]),BetaJS.Collections.Collection.extend("BetaJS.Collections.FilteredCollection",{constructor:function(a,b){this.__parent=a,b=b||{},delete b.objects,b.compare=b.compare||a.get_compare(),this._inherited(BetaJS.Collections.FilteredCollection,"constructor",b),"filter"in b&&(this.filter=b.filter),this.__parent.iterate(function(a){return this.add(a),!0},this),this.__parent.on("add",this.add,this),this.__parent.on("remove",this.remove,this)},filter:function(){return!0},_object_changed:function(a,b,c){this._inherited(BetaJS.Collections.FilteredCollection,"_object_changed",a,b,c),this.filter(a)||this.__selfRemove(a)},destroy:function(){this.__parent.off(null,null,this),this._inherited(BetaJS.Collections.FilteredCollection,"destroy")},__selfAdd:function(a){return this._inherited(BetaJS.Collections.FilteredCollection,"add",a)},add:function(a){if(this.exists(a)||!this.filter(a))return null;var b=this.__selfAdd(a);return this.__parent.add(a),b},__selfRemove:function(a){return this._inherited(BetaJS.Collections.FilteredCollection,"remove",a)},remove:function(a){if(!this.exists(a))return null;var b=this.__selfRemove(a);return b?this.__parent.remove(a):null}}),BetaJS.Comparators={byObject:function(a){return function(b,c){for(key in a){var d=0;if(d=BetaJS.Properties.Properties.is_class_instance(b)&&BetaJS.Properties.Properties.is_class_instance(c)?BetaJS.Comparators.byValue(b.get(key)||null,c.get(key)||null):BetaJS.Comparators.byValue(b[key]||null,c[key]||null),0!==d)return d*a[key]}return 0}},byValue:function(a,b){return BetaJS.Types.is_string(a)?a.localeCompare(b):b>a?-1:a>b?1:0},listEqual:function(a,b){if(BetaJS.Types.is_array(a)&&BetaJS.Types.is_array(b)){if(a.length!=b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0}if(BetaJS.Types.is_object(a)&&BetaJS.Types.is_object(b)){for(var d in a)if(b[d]!==a[d])return!1;for(d in b)if(!(d in a))return!1;return!0}return!1}},BetaJS.Sort={sort_object:function(a,b){var c=[];for(var d in a)c.push({key:d,value:a[d]});c.sort(function(a,c){return b(a.key,c.key,a.value,c.value)});for(var e={},f=0;f<c.length;++f)e[c[f].key]=c[f].value;return e},deep_sort:function(a,b){if(b=b||BetaJS.Comparators.byValue,BetaJS.Types.is_array(a)){for(var c=0;c<a.length;++c)a[c]=this.deep_sort(a[c],b);return a.sort(b)}if(BetaJS.Types.is_object(a)){for(var d in a)a[d]=this.deep_sort(a[d],b);return this.sort_object(a,b)}return a},dependency_sort:function(a,b,c,d){var e=BetaJS.Types.is_string(b)?function(a){return a[b]}:b,f=BetaJS.Types.is_string(c)?function(a){return a[c]}:c,g=BetaJS.Types.is_string(d)?function(a){return a[d]}:d,h=a.length,i=[],j={},k={},l=null;for(l=0;h>l;++l){k[l]=!0;var m=e(a[l],l);j[m]=l,i.push({before:{},after:{}})}for(l=0;h>l;++l)BetaJS.Objs.iter(f(a[l],l)||[],function(a){var b=j[a];BetaJS.Types.is_defined(b)&&(i[l].before[b]=!0,i[b].after[l]=!0)}),BetaJS.Objs.iter(g(a[l])||[],function(a){var b=j[a];BetaJS.Types.is_defined(b)&&(i[l].after[b]=!0,i[b].before[l]=!0)});for(var n=[];!BetaJS.Types.is_empty(k);)for(l in k)if(BetaJS.Types.is_empty(i[l].after)){delete k[l],n.push(a[l]);for(bef in i[l].before)delete i[bef].after[l]}return n}},BetaJS.Locales={__data:{},language:null,get:function(a){return this.language&&this.language+"."+a in this.__data?this.__data[this.language+"."+a]:a in this.__data?this.__data[a]:a},register:function(a,b){b=b?b+".":"";for(var c in a)this.__data[b+c]=a[c]},view:function(a){return{context:this,base:a,get:function(a){return this.context.get(this.base+"."+a)},base:function(a){return this.context.base(this.base+"."+a)}}}},BetaJS.Time={timezoneBias:function(a){return a===!0&&(a=(new Date).getTimezoneOffset()),("undefined"==typeof a||null===a||a===!1)&&(a=0),60*a*1e3},timeToDate:function(a,b){return new Date(a+this.timezoneBias(b))},dateToTime:function(a,b){return a.getTime()-this.timezoneBias(b)},timeToTimezoneBasedDate:function(a,b){return new Date(a-this.timezoneBias(b))},timezoneBasedDateToTime:function(a,b){return a.getTime()+this.timezoneBias(b)},__components:{year:{set:function(a,b){a.setUTCFullYear(b)},get:function(a){return a.getUTCFullYear()}},month:{set:function(a,b){a.setUTCMonth(b)},get:function(a){return a.getUTCMonth()}},day:{dependencies:{weekday:!0},set:function(a,b){a.setUTCDate(b+1)},get:function(a){return a.getUTCDate()-1},milliseconds:864e5},weekday:{dependencies:{day:!0,month:!0,year:!0},set:function(a,b){a.setUTCDate(a.getUTCDate()+b-a.getUTCDay())},get:function(a){return a.getUTCDay()}},hour:{set:function(a,b){a.setUTCHours(b)},get:function(a){return a.getUTCHours()},max:23,milliseconds:36e5},minute:{set:function(a,b){a.setUTCMinutes(b)},get:function(a){return a.getUTCMinutes()},max:59,milliseconds:6e4},second:{set:function(a,b){a.setUTCSeconds(b)},get:function(a){return a.getUTCSeconds()},max:59,milliseconds:1e3},millisecond:{set:function(a,b){a.setUTCMilliseconds(b)},get:function(a){return a.getUTCMilliseconds()},max:999,milliseconds:1}},decodeTime:function(a,b){var c=this.timeToTimezoneBasedDate(a,b),d={};for(var e in this.__components)d[e]=this.__components[e].get(c);return d},encodeTime:function(a,b){return this.updateTime(this.now(),a,b)},encodePeriod:function(a){return this.incrementTime(0,a)},updateTime:function(a,b,c){var d=this.timeToTimezoneBasedDate(a,c);for(var e in b)this.__components[e].set(d,b[e]);return this.timezoneBasedDateToTime(d,c)},now:function(a){return this.dateToTime(new Date,a)},incrementTime:function(a,b){var c=this.timeToDate(a);for(var d in b)this.__components[d].set(c,this.__components[d].get(c)+b[d]);return this.dateToTime(c)},floorTime:function(a,b,c){var d=this.timeToTimezoneBasedDate(a,c),e=!1;for(var f in this.__components){var g=this.__components[f];e=e||f==b,!e||g.dependencies&&g.dependencies[b]||g.set(d,0)}return this.timezoneBasedDateToTime(d,c)},ago:function(a,b){return this.now(b)-a},timeComponent:function(a,b,c){return Math[c||"floor"](a/this.__components[b].milliseconds)},timeModulo:function(a,b,c){return this.timeComponent(a,b,c)%(this.__components[b].max+1)},formatTimePeriod:function(a,b){b=b||{};for(var c=b.components||["day","hour","minute","second"],d="",e=0,f=0;f<c.length&&(d=c[f],!(e=this.timeComponent(a,d,b.round||"round")));++f);return e+" "+BetaJS.Locales.get(d+(1==e?"":"s"))},formatTime:function(a,b){var c=["hour","minute","second"];b=b||"hhh:mm:ss";for(var d={},e=0;e<c.length;++e){var f=c[e].charAt(0);d[f+f+f]=this.timeComponent(a,c[e],"floor");var g=this.timeModulo(a,c[e],"floor");d[f+f]=10>g?"0"+g:g,d[f]=g}for(var h in d)b=b.replace(h,d[h]);return b}},BetaJS.Class.extend("BetaJS.Timers.Timer",{constructor:function(a){this._inherited(BetaJS.Timers.Timer,"constructor"),a=BetaJS.Objs.extend({once:!1,start:!0,fire:null,context:this,destroy_on_fire:!1},a),this.__delay=a.delay,this.__destroy_on_fire=a.destroy_on_fire,this.__once=a.once,this.__fire=a.fire,this.__context=a.context,this.__started=!1,a.start&&this.start()},destroy:function(){this.stop(),this._inherited(BetaJS.Timers.Timer,"destroy")},fire:function(){this.__once&&(this.__started=!1),this.__fire&&this.__fire.apply(this.__context,[this]),this.__destroy_on_fire&&this.destroy()},stop:function(){this.__started&&(this.__once?clearTimeout(this.__timer):clearInterval(this.__timer),this.__started=!1)},start:function(){if(!this.__started){var a=this;this.__timer=this.__once?setTimeout(function(){a.fire()},this.__delay):setInterval(function(){a.fire()},this.__delay),this.__started=!0}},restart:function(){this.stop(),this.start()}}),BetaJS.Templates={tokenize:function(a){if(BetaJS.Types.is_array(a))return a;var b=[],c=0;return a.replace(BetaJS.Templates.SYNTAX_REGEX(),function(d,e,f,g,h){return h>c&&b.push({type:BetaJS.Templates.TOKEN_STRING,data:BetaJS.Strings.js_escape(a.slice(c,h))}),g&&b.push({type:BetaJS.Templates.TOKEN_CODE,data:g}),e&&b.push({type:BetaJS.Templates.TOKEN_EXPR,data:e}),f&&b.push({type:BetaJS.Templates.TOKEN_ESC,data:f}),c=h+d.length,d}),b},compile:function(a,b){BetaJS.Types.is_string(a)&&(a=this.tokenize(a)),b=b||{};for(var c=b.start_index||0,d=b.end_index||a.length,e="__p+='",f=c;d>f;++f)switch(a[f].type){case BetaJS.Templates.TOKEN_STRING:e+=a[f].data;break;case BetaJS.Templates.TOKEN_CODE:e+="';\n"+a[f].data+"\n__p+='";break;case BetaJS.Templates.TOKEN_EXPR:e+="'+\n((__t=("+a[f].data+"))==null?'':__t)+\n'";break;case BetaJS.Templates.TOKEN_ESC:e+="'+\n((__t=("+a[f].data+"))==null?'':BetaJS.Strings.htmlentities(__t))+\n'"}e+="';\n",e="with(obj||{}){\n"+e+"}\n",e="var __t,__p='',__j=Array.prototype.join,echo=function(){__p+=__j.call(arguments,'');};\n"+e+"return __p;\n";var g=new Function("obj",e),h=function(a){return g.call(this,a)};return h.source="function(obj){\n"+e+"}",h}},BetaJS.Templates.SYNTAX={OPEN:"{%",CLOSE:"%}",MODIFIER_CODE:"",MODIFIER_EXPR:"=",MODIFIER_ESC:"-"},BetaJS.Templates.SYNTAX_REGEX=function(){var a=BetaJS.Templates.SYNTAX;return BetaJS.Templates.SYNTAX_REGEX_CACHED||(BetaJS.Templates.SYNTAX_REGEX_CACHED=new RegExp(a.OPEN+a.MODIFIER_EXPR+"([\\s\\S]+?)"+a.CLOSE+"|"+a.OPEN+a.MODIFIER_ESC+"([\\s\\S]+?)"+a.CLOSE+"|"+a.OPEN+a.MODIFIER_CODE+"([\\s\\S]+?)"+a.CLOSE+"|$","g")),BetaJS.Templates.SYNTAX_REGEX_CACHED},BetaJS.Templates.TOKEN_STRING=1,BetaJS.Templates.TOKEN_CODE=2,BetaJS.Templates.TOKEN_EXPR=3,BetaJS.Templates.TOKEN_ESC=4,BetaJS.Class.extend("BetaJS.Templates.Template",{constructor:function(a){this._inherited(BetaJS.Templates.Template,"constructor"),this.__tokens=BetaJS.Templates.tokenize(a),this.__compiled=BetaJS.Templates.compile(this.__tokens)},evaluate:function(a){return this.__compiled.apply(this,[a])}}),BetaJS.JavaScript={STRING_SINGLE_QUOTATION_REGEX:/'[^']*'/g,STRING_DOUBLE_QUOTATION_REGEX:/"[^"]*"/g,IDENTIFIER_REGEX:/[a-zA-Z_][a-zA-Z_0-9]*/g,IDENTIFIER_SCOPE_REGEX:/[a-zA-Z_][a-zA-Z_0-9\.]*/g,RESERVED:BetaJS.Objs.objectify(["if","then","else","return","var"],!0),isReserved:function(a){return a in this.RESERVED},isIdentifier:function(a){return!this.isReserved(a)},removeStrings:function(a){return a.replace(this.STRING_SINGLE_QUOTATION_REGEX,"").replace(this.STRING_DOUBLE_QUOTATION_REGEX,"")},extractIdentifiers:function(a,b){var c=b?this.IDENTIFIER_SCOPE_REGEX:this.IDENTIFIER_REGEX;return a=this.removeStrings(a),BetaJS.Objs.filter(a.match(c),this.isIdentifier,this)}},BetaJS.Class.extend("BetaJS.States.Host",[BetaJS.Events.EventsMixin,{constructor:function(a){this._inherited(BetaJS.States.Host,"constructor"),a=a||{},this._stateRegistry=a.stateRegistry,this._baseState=a.baseState},initialize:function(a,b){if(!this._stateRegistry)if(BetaJS.Types.is_string(a)&&a.indexOf(".")>=0){var c=BetaJS.Strings.splitLast(a,".");this._stateRegistry=this._auto_destroy(new BetaJS.Classes.ClassRegistry(BetaJS.Scopes.resolve(c.head))),a=c.tail}else this._stateRegistry=this._auto_destroy(new BetaJS.Classes.ClassRegistry(BetaJS.Scopes.resolve(BetaJS.Strings.splitLast(this.cls.classname,".").head)));this._createState(a,b).start(),this._baseState=this._baseState||this._state.cls},_createState:function(a,b,c){return this._stateRegistry.create(a,this,b||{},c||{})},finalize:function(){this._state&&this._state.destroy(),this._state=null},destroy:function(){this.finalize(),this._inherited(BetaJS.States.Host,"destroy")},state:function(){return this._state},state_name:function(){return this.state().state_name()},next:function(){return this.state().next.apply(this.state(),arguments)},_start:function(a){this._stateEvent(a,"before_start"),this._state=a},_afterStart:function(a){this._stateEvent(a,"start")},_end:function(a){this._stateEvent(a,"end"),this._state=null},_afterEnd:function(a){this._stateEvent(a,"after_end")},_next:function(a){this._stateEvent(a,"next")},_afterNext:function(a){this._stateEvent(a,"after_next")},_can_transition_to:function(){return!0},_stateEvent:function(a,b){this.trigger("event",b,a.state_name(),a.description()),this.trigger(b,a.state_name(),a.description()),this.trigger(b+":"+a.state_name(),a.description())},register:function(a,b,c){BetaJS.Types.is_string(b)||(c=b,b=null),this._stateRegistry||(this._stateRegistry=this._auto_destroy(new BetaJS.Classes.ClassRegistry(BetaJS.Strings.splitLast(this.cls.classname).head)));var d=this._baseState?BetaJS.Strings.splitLast(this._baseState.classname,".").head+"."+a:a.indexOf(".")>=0?a:null,e=(this._stateRegistry.get(b)||this._baseState||BetaJS.States.State).extend(d,c);return d||(e.classname=a),this._stateRegistry.register(BetaJS.Strings.last_after(a,"."),e),this}}]),BetaJS.Class.extend("BetaJS.States.State",{_locals:[],_persistents:[],_white_list:null,constructor:function(a,b,c){this._inherited(BetaJS.States.State,"constructor"),this.host=a,this.transitionals=c,this._starting=!1,this._started=!1,this._stopped=!1,this._transitioning=!1,this.__next_state=null,this.__suspended=0,b=b||{},this._locals=BetaJS.Types.is_function(this._locals)?this._locals():this._locals;for(var d=0;d<this._locals.length;++d)this["_"+this._locals[d]]=b[this._locals[d]];for(this._persistents=BetaJS.Types.is_function(this._persistents)?this._persistents():this._persistents,d=0;d<this._persistents.length;++d)this["_"+this._persistents[d]]=b[this._persistents[d]]},state_name:function(){return BetaJS.Strings.last_after(this.cls.classname,".")},description:function(){return this.state_name()},start:function(){this._starting||(this._starting=!0,this.host._start(this),this._start(),this.host&&(this.host._afterStart(this),this._started=!0))},end:function(){this._stopped||(this._stopped=!0,this._end(),this.host._end(this),this.host._afterEnd(this),this.destroy())},eventualNext:function(a,b,c){this.suspend(),this.next(a,b,c),this.eventualResume()},next:function(a,b,c){if(this._starting&&!this._stopped&&!this.__next_state){b=b||{};for(var d=0;d<this._persistents.length;++d)this._persistents[d]in b||(b[this._persistents[d]]=this["_"+this._persistents[d]]);var e=this.host._createState(a,b,c);if(!this.can_transition_to(e))return e.destroy(),void 0;this._started||(this.host._afterStart(this),this._started=!0),this.__next_state=e,this._transitioning=!0,this._transition(),this.__suspended<=0&&this.__next()}},__next:function(){var a=this.host,b=this.__next_state;a._next(b),this.end(),b.start(),a._afterNext(b)},_transition:function(){},suspend:function(){this.__suspended++},eventualResume:function(){BetaJS.Async.eventually(this.resume,this)},resume:function(){this.__suspended--,0===this.__suspended&&!this._stopped&&this.__next_state&&this.__next()},can_transition_to:function(a){return this.host&&this.host._can_transition_to(a)&&this._can_transition_to(a)},_start:function(){},_end:function(){},_can_transition_to:function(a){return!BetaJS.Types.is_array(this._white_list)||BetaJS.Objs.contains_value(this._white_list,a.state_name())}}),BetaJS.Class.extend("BetaJS.States.CompetingComposite",{_register_host:function(a){this._hosts=this._hosts||[],this._hosts.push(this._auto_destroy(a))},other_hosts:function(a){return BetaJS.Objs.filter(this._hosts||[],function(b){return b!=a},this)},_next:function(a,b){for(var c=this.other_hosts(a),d=0;d<c.length;++d){var e=c[d],f=e.state();f.can_coexist_with(b)||f.retreat_against(b)}}}),BetaJS.States.Host.extend("BetaJS.States.CompetingHost",{constructor:function(a){this._inherited(BetaJS.States.CompetingHost,"constructor"),this._composite=a,a&&a._register_host(this)},composite:function(){return this._composite},_can_transition_to:function(a){if(!this._composite)return!0;for(var b=this._composite.other_hosts(this),c=0;c<b.length;++c){var d=b[c],e=d.state();if(!a.can_coexist_with(e)&&!a.can_prevail_against(e))return!1}return!0},_next:function(a){this._composite&&this._composite._next(this,a),this._inherited(BetaJS.States.CompetingHost,"_next",a)}}),BetaJS.States.State.extend("BetaJS.States.CompetingState",{can_coexist_with:function(){return!0},can_prevail_against:function(){return!1},retreat_against:function(){}}),BetaJS.Class.extend("BetaJS.States.StateRouter",{constructor:function(a){this._inherited(BetaJS.States.StateRouter,"constructor"),this._host=a,this._routes=[],this._states={}},registerRoute:function(a,b,c){var d={key:a,route:new RegExp("^"+a+"$"),state:b,mapping:c||[]};return this._routes.push(d),this._states[b]=d,this},readRoute:function(a){var b=this._states[a.state_name()];if(!b)return null;var c=/\(.*?\)/,d=b.key;return BetaJS.Objs.iter(b.mapping,function(b){d=d.replace(c,a["_"+b])},this),d},parseRoute:function(a){for(var b=0;b<this._routes.length;++b){var c=this._routes[b],d=c.route.exec(a);if(null!==d){var e={};return BetaJS.Objs.iter(c.mapping,function(a,b){e[a]=d[b+1]}),{state:c.state,args:e}}}return null},currentRoute:function(){return this.readRoute(this._host.state())},navigateRoute:function(a){var b=this.parseRoute(a);b&&this._host.next(b.state,b.args)}}),BetaJS.Class.extend("BetaJS.Parser.Lexer",{constructor:function(a){this._inherited(BetaJS.Parser.Lexer,"constructor"),this.__patterns=[],BetaJS.Objs.iter(a,function(a,b){this.__patterns.push({regex:new RegExp("^"+b,"m"),data:BetaJS.Types.is_string(a)?{token:a}:a})},this)},lex:function(a){for(var b=[],c="",d=a;d;){for(var e=null,f=null,g=0;g<this.__patterns.length;++g)if(e=this.__patterns[g].regex.exec(d)){f=BetaJS.Objs.clone(this.__patterns[g].data,1);break}if(!e)throw new BetaJS.Parser.LexerException(c,d);if(c+=e[0],d=d.substring(e[0].length),f){for(var h in f)if(BetaJS.Types.is_string(f[h]))for(var i=0;i<e.length;++i)f[h]=f[h].replace("$"+i,e[i]);b.push(f)}}return b}}),BetaJS.Exceptions.Exception.extend("BetaJS.Parser.LexerException",{constructor:function(a,b){this._inherited(BetaJS.Parser.LexerException,"constructor","Lexer error: Unrecognized identifier at "+a.length+"."),this.__head=a,this.__tail=b}}),BetaJS.Trees={},BetaJS.Trees.TreeNavigator={nodeRoot:function(){},nodeId:function(){},nodeParent:function(){},nodeChildren:function(){},nodeWatch:function(){},nodeUnwatch:function(){},nodeData:function(){}},BetaJS.Class.extend("BetaJS.Trees.TreeQueryEngine",{constructor:function(a){this._inherited(BetaJS.Trees.TreeQueryEngine,"constructor"),this.__navigator=a,this.__lexer=this._auto_destroy(new BetaJS.Parser.Lexer({"<\\+":{token:"Up"},"<":{token:"Up",single:!0},">\\+":{token:"Down"},">":{token:"Down",single:!0},"\\[s*([a-zA-Z]+)s*=s*'([^']*)'s*\\]":{token:"Selector",key:"$1",value:"$2"},s:null}))},query:function(a,b){return new BetaJS.Trees.TreeQueryObject(this.__navigator,a,this.__lexer.lex(b))}}),BetaJS.Class.extend("BetaJS.Trees.TreeQueryObject",[BetaJS.Events.EventsMixin,{constructor:function(a,b,c){this._inherited(BetaJS.Trees.TreeQueryObject,"constructor"),this.__navigator=a,this.__node=b,this.__query=c,this.__result={},this.__partials={},this.__register(b,0,{}),this.__ids=0},destroy:function(){BetaJS.Objs.iter(this.__partials,function(a){BetaJS.Objs.iter(a.partials,function(b){this.__navigator.nodeUnwatch(a.node,null,b)
},this)},this),this._inherited(BetaJS.Trees.TreeQueryObject,"destroy")},result:function(){var a=[];return BetaJS.Objs.iter(this.__result,function(b){a.push(b.node)}),a},__register:function(a,b){var c=this.__navigator.nodeId(a);this.__partials[c]||(this.__partials[c]={node:a,partials:{}});var d=this.__partials[c];this.__ids++;var e={owner:d,id:this.__ids,query_index_start:b,query_index_next:b,query_index_last:b,partial_match:!1,partial_final:b>=this.__query.length,partial_data:!1,partial_children:!1,partial_parent:!1,partial_star:!1,parent:null,deps:{}};d.partials[e.id]=e;for(var f=e.query_index_start;f<this.__query.length;++f){if("Selector"!=this.__query[f].token){"Up"==this.__query[f].token?e.partial_parent=!0:"Down"==this.__query[f].token&&(e.partial_children=!0),e.partial_star=!this.__query[f].single,e.partial_star||(e.query_index_next=f+1);break}e.partial_data=!0,e.query_index_next=f+1,e.partial_final=f+1==this.__query.length}e.query_index_last=e.partial_star?e.query_index_next+1:e.query_index_next;var g=this;return this.__navigator.nodeWatch(a,function(a,b){"data"==a&&e.partial_data&&g.__update(e),"remove"==a&&g.__unregisterPartial(e),"addChild"==a&&e.partial_children&&e.partial_match&&g.__addDependentPartial(e,b)},e),this.__update(e),e},__unregisterPartial:function(a){var b=a.owner,c=b.node,d=this.__navigator.nodeId(c);a.partial_final&&this.__result[d]&&(this.__result[d].count--,this.__result[d].count<=0&&(delete this.__result[d],this.trigger("remove",c),this.trigger("change"))),BetaJS.Objs.iter(a.deps,this.__unregisterPartial,this),a.parent&&delete a.parent.deps[a.id],this.__navigator.nodeUnwatch(c,null,a),delete b.partials[a.id],BetaJS.Types.is_empty(b.partials)&&delete this.__partials[d]},__addDependentPartial:function(a,b){var c=[];c.push(this.__register(b,a.query_index_next)),a.partial_star&&c.push(this.__register(b,a.query_index_next+1)),BetaJS.Objs.iter(c,function(b){a.deps[b.id]=b,b.parent=a},this)},__update:function(a){for(var b=!0,c=a.owner.node,d=this.__navigator.nodeId(c),e=this.__navigator.nodeData(c),f=a.query_index_start;f<a.query_index_last;++f){var g=this.__query[f];if("Selector"!=g.token)break;if(e[g.key]!=g.value){b=!1;break}}b!=a.partial_match&&(a.partial_match=b,b?a.partial_final?this.__result[d]?this.__result[d].count++:(this.__result[d]={node:c,count:1},this.trigger("add",c),this.trigger("change")):a.partial_parent?this.__addDependentPartial(a,this.__navigator.nodeParent(c)):a.partial_children&&BetaJS.Objs.iter(this.__navigator.nodeChildren(c),function(b){this.__addDependentPartial(a,b)},this):(a.partial_final&&(this.__result[d].count--,this.__result[d].count<=0&&(delete this.__result[d],this.trigger("remove",c),this.trigger("change"))),BetaJS.Objs.iter(a.deps,this.__unregisterPartial,this)))}}]),BetaJS.Class.extend("BetaJS.Channels.Sender",[BetaJS.Events.EventsMixin,{send:function(a,b){this.trigger("send",a,b),this._send(a,b)},_send:function(){}}]),BetaJS.Class.extend("BetaJS.Channels.Receiver",[BetaJS.Events.EventsMixin,{_receive:function(a,b){this.trigger("receive",a,b),this.trigger("receive:"+a,b)}}]),BetaJS.Channels.Sender.extend("BetaJS.Channels.ReceiverSender",{constructor:function(a){this._inherited(BetaJS.Channels.ReceiverSender,"constructor"),this.__receiver=a},_send:function(a,b){this.__receiver._receive(a,b)}}),BetaJS.Channels.Sender.extend("BetaJS.Channels.SenderMultiplexer",{constructor:function(a,b){this._inherited(BetaJS.Channels.SenderMultiplexer,"constructor"),this.__sender=a,this.__prefix=b},_send:function(a,b){this.__sender.send(this.__prefix+":"+a,b)}}),BetaJS.Channels.Receiver.extend("BetaJS.Channels.ReceiverMultiplexer",{constructor:function(a,b){this._inherited(BetaJS.Channels.ReceiverMultiplexer,"constructor"),this.__receiver=a,this.__prefix=b,this.__receiver.on("receive",function(a,b){BetaJS.Strings.starts_with(a,this.__prefix+":")&&this._receive(BetaJS.Strings.strip_start(a,this.__prefix+":"),b)},this)}}),BetaJS.Class.extend("BetaJS.Channels.TransportChannel",{constructor:function(a,b,c){this._inherited(BetaJS.Channels.TransportChannel,"constructor"),this.__sender=a,this.__receiver=b,this.__options=BetaJS.Objs.extend(c,{timeout:1e4,tries:1,timer:500}),this.__receiver.on("receive:send",function(a){this.__reply(a)},this),this.__receiver.on("receive:reply",function(a){this.__complete(a)},this),this.__sent_id=0,this.__sent={},this.__received={},this.__timer=this._auto_destroy(new BetaJS.Timers.Timer({delay:this.__options.timer,context:this,fire:this.__maintenance}))},_reply:function(){},send:function(a,b,c){var d=BetaJS.Promise.create();return c=c||{},c.stateless?(this.__sender.send("send",{message:a,data:b,stateless:!0}),d.asyncSuccess(!0)):(this.__sent_id++,this.__sent[this.__sent_id]={message:a,data:b,tries:1,time:BetaJS.Time.now(),id:this.__sent_id,promise:d},this.__sender.send("send",{message:a,data:b,id:this.__sent_id})),d},__reply:function(a){return a.stateless?(this._reply(a.message,a.data),void 0):(this.__received[a.id]?this.__received[a.id].returned&&this.__sender.send("reply",{id:a.id,reply:a.reply,success:a.success}):(this.__received[a.id]=a,this.__received[a.id].time=BetaJS.Time.now(),this.__received[a.id].returned=!1,this.__received[a.id].success=!1,this._reply(a.message,a.data).success(function(b){this.__received[a.id].reply=b,this.__received[a.id].success=!0},this).error(function(b){this.__received[a.id].reply=b},this).callback(function(){this.__received[a.id].returned=!0,this.__sender.send("reply",{id:a.id,reply:a.reply,success:a.success})},this)),void 0)},__complete:function(a){if(this.__sent[a.id]){var b=this.__sent[a.id].promise;b[a.success?"asyncSuccess":"asyncError"](a.reply),delete this.__sent[a.id]}},__maintenance:function(){var a=BetaJS.Time.now();for(var b in this.__received){var c=this.__received[b];c.time+this.__options.tries*this.__options.timeout<=a&&delete this.__received[b]}for(var d in this.__sent){var e=this.__sent[d];e.time+e.tries*this.__options.timeout<=a&&(e.tries<this.__options.tries?(e.tries++,this.__sender.send("send",{message:e.message,data:e.data,id:e.id})):(e.promise.asyncError({message:e.message,data:e.data}),delete this.__sent[d]))}}}),BetaJS.Class.extend("BetaJS.RMI.Stub",[BetaJS.Classes.InvokerMixin,{intf:[],constructor:function(){this._inherited(BetaJS.RMI.Stub,"constructor"),this.invoke_delegate("invoke",this.intf)},destroy:function(){this.invoke("_destroy"),this._inherited(BetaJS.RMI.Stub,"destroy")},invoke:function(a){return this.__send(a,BetaJS.Functions.getArguments(arguments,1))}}]),BetaJS.Class.extend("BetaJS.RMI.StubSyncer",[BetaJS.Classes.InvokerMixin,{constructor:function(a){this._inherited(BetaJS.RMI.StubSyncer,"constructor"),this.__stub=a,this.__current=null,this.__queue=[],this.invoke_delegate("invoke",this.__stub.intf)},invoke:function(){var a={args:BetaJS.Functions.getArguments(arguments),promise:BetaJS.Promise.create()};return this.__queue.push(a),this.__current||this.__next(),a.promise},__next:function(){0!==this.__queue.length&&(this.__current=this.__queue.shift(),this.__stub.invoke.apply(this.__stub,this.__current.args).forwardCallback(this.__current.promise).callback(this.__next,this))}}]),BetaJS.Class.extend("BetaJS.RMI.Skeleton",{_stub:null,intf:[],_intf:{},__superIntf:["_destroy"],constructor:function(a){this._options=BetaJS.Objs.extend({destroyable:!1},a),this._inherited(BetaJS.RMI.Skeleton,"constructor"),this.intf=this.intf.concat(this.__superIntf);for(var b=0;b<this.intf.length;++b)this._intf[this.intf[b]]=!0},_destroy:function(){this._options.destroyable&&this.destroy()},invoke:function(a,b){if(!this._intf[a])return BetaJS.Promise.error(a);try{var c=this[a].apply(this,b);return BetaJS.Promise.is(c)?c:BetaJS.Promise.value(c)}catch(d){return BetaJS.Promise.error(d)}},_success:function(a){return BetaJS.Promise.value(a)},_error:function(){return BetaJS.Promise.error(result)},stub:function(){if(this._stub)return this._stub;var a=this.cls.classname;return a.indexOf("Skeleton")>=0?a.replace("Skeleton","Stub"):a}}),BetaJS.Class.extend("BetaJS.RMI.Server",[BetaJS.Events.EventsMixin,{constructor:function(a,b){if(this._inherited(BetaJS.RMI.Server,"constructor"),this.__channels=new BetaJS.Lists.ObjectIdList,this.__instances={},a){var c=a;b&&(c=this._auto_destroy(new BetaJS.Channels.TransportChannel(a,b))),this.registerClient(c)}},destroy:function(){this.__channels.iterate(this.unregisterClient,this),BetaJS.Objs.iter(this.__instances,function(a){this.unregisterInstance(a.instance)},this),this.__channels.destroy(),this._inherited(BetaJS.RMI.Server,"destroy")},registerInstance:function(a,b){return b=b||{},this.__instances[BetaJS.Ids.objectId(a,b.name)]={instance:a,options:b},a},unregisterInstance:function(a){delete this.__instances[BetaJS.Ids.objectId(a)],a.destroy()},registerClient:function(a){var b=this;this.__channels.add(a),a._reply=function(c,d){var e=c.split(":");return 2==e.length?b._invoke(a,e[0],e[1],d):BetaJS.Promise.error(!0)}},unregisterClient:function(a){this.__channels.remove(a),a._reply=null},_serializeValue:function(a){if(BetaJS.RMI.Skeleton.is_class_instance(a)&&a.instance_of(BetaJS.RMI.Skeleton)){var b=this;return b.registerInstance(a),{__rmi_meta:!0,__rmi_stub:a.stub(),__rmi_stub_id:BetaJS.Ids.objectId(a)}}return a},_unserializeValue:function(a){if(a&&a.__rmi_meta){var b=this.client;return b.acquire(a.__rmi_stub,a.__rmi_stub_id)}return a},_invoke:function(a,b,c,d){var e=this.__instances[b];return e||(this.trigger("loadInstance",a,b),e=this.__instances[b]),e?(e=e.instance,d=BetaJS.Objs.map(d,this._unserializeValue,this),e.invoke(c,d,a).mapSuccess(function(a){return this._serializeValue(a)},this)):BetaJS.Promise.error(b)}}]),BetaJS.Class.extend("BetaJS.RMI.Client",{constructor:function(a,b){if(this._inherited(BetaJS.RMI.Client,"constructor"),this.__channel=null,this.__instances={},a){var c=a;b&&(c=this._auto_destroy(new BetaJS.Channels.TransportChannel(a,b))),this.__channel=c}},destroy:function(){this.__channel&&this.disconnect(),this._inherited(BetaJS.RMI.Client,"destroy")},connect:function(a){this.__channel||(this.__channel=a)},disconnect:function(){this.__channel&&(this.__channel=null,BetaJS.Objs.iter(this.__instances,function(a){this.release(a)},this))},_serializeValue:function(a){if(BetaJS.RMI.Skeleton.is_class_instance(a)&&a.instance_of(BetaJS.RMI.Skeleton)){var b=this.server;return b.registerInstance(a),{__rmi_meta:!0,__rmi_stub:a.stub(),__rmi_stub_id:BetaJS.Ids.objectId(a)}}return a},_unserializeValue:function(a){if(a&&a.__rmi_meta){var b=this;return b.acquire(a.__rmi_stub,a.__rmi_stub_id)}return a},acquire:function(a,b){if(this.__instances[b])return this.__instances[b];if(BetaJS.Types.is_string(a)&&(a=BetaJS.Scopes.resolve(a)),!a||!a.ancestor_of(BetaJS.RMI.Stub))return null;var c=new a;this.__instances[BetaJS.Ids.objectId(c,b)]=c;var d=this;return c.__send=function(a,c){return c=BetaJS.Objs.map(c,d._serializeValue,d),d.__channel.send(b+":"+a,c).mapSuccess(function(a){return this._unserializeValue(a)},d)},c},release:function(a){var b=BetaJS.Ids.objectId(a);this.__instances[b]&&(a.off(null,null,this),a.destroy(),delete this.__instances[b])}}),BetaJS.Class.extend("BetaJS.RMI.Peer",{constructor:function(a,b){this._inherited(BetaJS.RMI.Peer,"constructor"),this.__sender=a,this.__receiver=b,this.__client_sender=this._auto_destroy(new BetaJS.Channels.SenderMultiplexer(a,"client")),this.__server_sender=this._auto_destroy(new BetaJS.Channels.SenderMultiplexer(a,"server")),this.__client_receiver=this._auto_destroy(new BetaJS.Channels.ReceiverMultiplexer(b,"server")),this.__server_receiver=this._auto_destroy(new BetaJS.Channels.ReceiverMultiplexer(b,"client")),this.client=this._auto_destroy(new BetaJS.RMI.Client(this.__client_sender,this.__client_receiver)),this.server=this._auto_destroy(new BetaJS.RMI.Server(this.__server_sender,this.__server_receiver)),this.client.server=this.server,this.server.client=this.client},acquire:function(a,b){return this.client.acquire(a,b)},release:function(a){this.client.release(a)},registerInstance:function(a,b){return this.server.registerInstance(a,b)},unregisterInstance:function(a){this.server.unregisterInstance(a)}}),BetaJS.Promise={Promise:function(a,b,c){this.__value=b?null:a||null,this.__error=b?b:null,this.__isFinished=c,this.__hasError=!!b,this.__resultPromise=null,this.__callbacks=[]},create:function(a,b){return new this.Promise(a,b,arguments.length>0)},value:function(a){return this.is(a)?a:new this.Promise(a,null,!0)},eventualValue:function(a){var b=new this.Promise;return BetaJS.Async.eventually(function(){b.asyncSuccess(a)}),b},error:function(a){return this.is(a)?a:new this.Promise(null,a,!0)},box:function(a,b,c){try{var d=a.apply(b||this,c||[]);return this.is(d)?d:this.value(d)}catch(e){return this.error(e)}},tryCatch:function(a,b){try{return this.value(a.apply(b||this))}catch(c){return this.error(c)}},funcCallback:function(a,b){var c=BetaJS.Functions.getArguments(arguments,1);BetaJS.Types.is_function(a)?(c=BetaJS.Functions.getArguments(arguments,1),b=a,a=this):c=BetaJS.Functions.getArguments(arguments,2);var d=this.create();return c.push(d.asyncCallbackFunc()),b.apply(a,c),d},and:function(a){var b=this.create();return b.__promises=[],b.__successCount=0,b.__values=[],b.__errorPromise=null,b.and=function(a){if(a=a||[],this.__ended)return this;BetaJS.Types.is_array(a)||(a=[a]);for(var b=0;b<a.length;++b){var c=this.__promises.length;this.__promises.push(a[b]),this.__values.push(null),a[b].isFinished()?a[b].hasValue()?(this.__successCount++,this.__values[c]=a[b].value()):this.__errorPromise=a[b]:a[b].callback(function(b,c){b?this.__errorPromise=a[this.idx]:(this.promise.__successCount++,this.promise.__values[this.idx]=c),this.promise.results()},{promise:this,idx:c})}return this},b.end=function(){return this.__ended=!0,this.results(),this},b.results=function(){return this.__ended&&this.__errorPromise?this.asyncError(this.__errorPromise.err(),this.__errorPromise):this.__ended&&this.__successCount==this.__promises.length&&this.asyncSuccess(this.__values),this},b.successUnfold=function(a,b,c){return this.success(function(){return a.apply(b,arguments)},b,c)},b.and(a),b},func:function(a){for(var b=BetaJS.Functions.getArguments(arguments,1),c=[],d=0;d<b.length;++d)this.is(b[d])&&c.push(b[d]);var e=this.create();return this.and(c).end().success(function(){for(var c=[],d=0;d<b.length;++d)c[d]=this.is(b[d])?b[d].value():b[d];var f=a.apply(this,c);this.is(f)?f.forwardCallback(e):e.asyncSuccess(f)},this).forwardError(e),e},methodArgs:function(a,b,c){return c.unshift(function(){return b.apply(a,arguments)}),this.func.apply(this,c)},method:function(a,b){return this.methodArgs(a,b,BetaJS.Functions.getArguments(arguments,2))},newClass:function(a){var b=BetaJS.Functions.getArguments(arguments,1);return b.unshift(BetaJS.Functions.newClassFunc(a)),this.func.apply(this,b)},is:function(a){return a&&BetaJS.Types.is_object(a)&&a.classGuid==BetaJS.Promise.Promise.prototype.classGuid}},BetaJS.Promise.Promise.prototype.classGuid="7e3ed52f-22da-4e9c-95a4-e9bb877a3935",BetaJS.Promise.Promise.prototype.success=function(a,b,c){return this.callback(a,b,c,"success")},BetaJS.Promise.Promise.prototype.error=function(a,b,c){return this.callback(a,b,c,"error")},BetaJS.Promise.Promise.prototype.callback=function(a,b,c,d){var e={type:d||"callback",func:a,options:c||{},context:b};return this.__isFinished?this.triggerResult(e):this.__callbacks.push(e),this},BetaJS.Promise.Promise.prototype.triggerResult=function(a){if(!this.__isFinished)return this;if(a)"success"!=a.type||this.__hasError?"error"==a.type&&this.__hasError?a.func.call(a.context||this,this.__error,this.__resultPromise||this):"callback"==a.type&&a.func.call(a.context||this,this.__error,this.__value,this.__resultPromise||this):a.func.call(a.context||this,this.__value,this.__resultPromise||this);else{var b=this.__callbacks;this.__callbacks=[];for(var c=0;c<b.length;++c)this.triggerResult(b[c])}return this},BetaJS.Promise.Promise.prototype.value=function(){return this.__value},BetaJS.Promise.Promise.prototype.err=function(){return this.__error},BetaJS.Promise.Promise.prototype.isFinished=function(){return this.__isFinished},BetaJS.Promise.Promise.prototype.hasValue=function(){return this.__isFinished&&!this.__hasError},BetaJS.Promise.Promise.prototype.hasError=function(){return this.__isFinished&&this.__hasError},BetaJS.Promise.Promise.prototype.asyncSuccess=function(a,b){return this.__isFinished?this:(this.__resultPromise=b,this.__error=null,this.__isFinished=!0,this.__hasError=!1,this.__value=a,this.triggerResult())},BetaJS.Promise.Promise.prototype.forwardSuccess=function(a){return this.success(a.asyncSuccess,a),this},BetaJS.Promise.Promise.prototype.asyncError=function(a,b){return this.__isFinished?this:(this.__resultPromise=b,this.__isFinished=!0,this.__hasError=!0,this.__error=a,this.__value=null,this.triggerResult())},BetaJS.Promise.Promise.prototype.forwardError=function(a){return this.error(a.asyncError,a),this},BetaJS.Promise.Promise.prototype.asyncCallback=function(a,b,c){return a?this.asyncError(a,c):this.asyncSuccess(b,c)},BetaJS.Promise.Promise.prototype.asyncCallbackFunc=function(){return BetaJS.Functions.as_method(BetaJS.Promise.Promise.prototype.asyncCallback,this)},BetaJS.Promise.Promise.prototype.forwardCallback=function(a){return this.callback(a.asyncCallback,a),this},BetaJS.Promise.Promise.prototype.mapSuccess=function(a,b){var c=BetaJS.Promise.create();return this.forwardError(c).success(function(d,e){var f=a.call(b||c,d,e);BetaJS.Promise.is(f)?f.forwardCallback(c):c.asyncSuccess(f)}),c},BetaJS.Promise.Promise.prototype.mapError=function(a,b){var c=BetaJS.Promise.create();return this.forwardSuccess(c).error(function(d,e){var f=a.call(b||c,d,e);BetaJS.Promise.is(f)?f.forwardCallback(c):c.asyncError(f)}),c},BetaJS.Promise.Promise.prototype.mapCallback=function(a,b){var c=BetaJS.Promise.create();return this.callback(function(d,e,f){var g=a.call(b||c,d,e,f);BetaJS.Promise.is(g)?g.forwardCallback(c):c.asyncCallback(d?g:d,d?e:g,f)}),c},BetaJS.Promise.Promise.prototype.and=function(a){var b=BetaJS.Promise.and(this);return b.and(a)},BetaJS.Structures={},BetaJS.Structures.AvlTree={empty:function(){return null},singleton:function(a){return{data:a,left:null,right:null,height:1}},min:function(a){return a.left?this.min(a.left):a.data},max:function(a){return a.right?this.max(a.right):a.data},height:function(a){return a?a.height:0},height_join:function(a,b){return 1+Math.max(this.height(a),this.height(b))},create:function(a,b,c){return{data:a,left:b,right:c,height:this.height_join(b,c)}},balance:function(a,b,c){return this.height(b)>this.height(c)+2?this.height(b.left)>=this.height(b.right)?this.create(b.data,b.left,this.create(a,b.right,c)):this.create(b.right.data,this.create(b.data,b.left,b.right.left),this.create(a,b.right.right,c)):this.height(c)>this.height(b)+2?this.height(c.right)>=this.height(c.left)?this.create(c.data,this.create(a,b,c.left),c.right):this.create(c.left.data,this.create(a,b,c.left.left),this.create(c.data,c.left.right,c.right)):this.create(a,b,c)},__add_left:function(a,b){return b?this.balance(b.data,this.__add_left(a,b.left),b.right):this.singleton(a)},__add_right:function(a,b){return b?this.balance(b.data,b.data,this.__add_right(a,b.right)):this.singleton(a)},join:function(a,b,c){return b?c?this.height(b)>this.height(c)+2?this.balance(b.data,b.left,this.join(a,b.right,c)):this.height(c)>this.height(b)+2?this.balance(c.data,this.join(a,b,c.left),c.right):this.create(a,b,c):this.__add_right(a,b):this.__add_left(a,c)},take_min:function(a){if(!a.left)return[a.data,a.right];var b=this.take_min(a.left);return[b[0],this.join(a.data,b[1],a.right)]},take_max:function(a){if(!a.right)return[a.data,a.left];var b=this.take_max(a.right);return[b[0],this.join(a.data,a.left,b[1])]},rereoot:function(a,b){if(!a||!b)return a||b;if(this.height(a)>this.height(b)){var c=this.take_max(a);return this.join(c[0],c[1],b)}var d=this.take_min(b);return this.join(d[0],a,d[1])},take_min_iter:function(a){return a?a.left?this.take_min_iter(this.create(a.left.data,a.left.left,this.create(a.data,a.left.right,a.right))):[a.data,a.left]:null},take_max_iter:function(a){return a?a.right?this.take_max_iter(this.create(a.right.data,this.create(a.data,a.left,a.right.left),a.right.right)):[a.data,a.right]:null}},BetaJS.Structures.TreeMap={empty:function(a){return{root:null,length:0,compare:a||function(a,b){return a>b?1:b>a?-1:0}}},is_empty:function(a){return!a.root},length:function(a){return a.length},__add:function(a,b,c,d){var e={key:a,value:b};if(!d)return c.length++,BetaJS.Data.AvlTree.singleton(e);var f=c.compare(a,d.data.key);return 0===f?(d.data=e,d):0>f?BetaJS.Data.AvlTree.balance(d.data,this.__add(a,b,c,d.left),d.right):BetaJS.Data.AvlTree.balance(d.data,d.left,this.__add(a,b,c,d.right))},add:function(a,b,c){return c.root=this.__add(a,b,c,c.root),c},singleton:function(a,b,c){return this.add(a,b,this.empty(c))},__find:function(a,b,c){if(!c)return null;var d=b.compare(a,c.data.key);return 0===d?c.data.value:this.__find(a,b,0>d?c.left:c.right)},find:function(a,b){return this.__find(a,b,b.root)},__iterate:function(a,b,c,d){return b?this.__iterate(a,b.left,c,d)&&c.call(d,b.data.key,b.data.value)!==!1&&this.__iterate(a,b.right,c,d):!0},iterate:function(a,b,c){this.__iterate(a,a.root,b,c)},__iterate_from:function(a,b,c,d,e){if(!c)return!0;var f=b.compare(a,c.data.key);return 0>f&&!this.__iterate_from(a,b,c.left,d,e)?!1:0>=f&&d.call(e,c.data.key,c.data.value)===!1?!1:this.__iterate_from(a,b,c.right,d,e)},iterate_from:function(a,b,c,d){this.__iterate_from(a,b,b.root,c,d)},iterate_range:function(a,b,c,d,e){this.iterate_from(a,c,function(a,f){return c.compare(a,b)<=0&&d.call(e,a,f)!==!1},this)}},BetaJS.Class.extend("BetaJS.KeyValue.KeyValueStore",[BetaJS.Events.EventsMixin,{mem:function(a){return this._mem(a)},get:function(a){return this._get(a)},set:function(a,b){this._set(a,b),this.trigger("change:"+a,b)},remove:function(a){this._remove(a)}}]),BetaJS.KeyValue.KeyValueStore.extend("BetaJS.KeyValue.PrefixKeyValueStore",{constructor:function(a,b){this._inherited(BetaJS.KeyValue.PrefixKeyValueStore,"constructor"),this.__kv=a,this.__prefix=b},_mem:function(a){return this.__kv.mem(this.__prefix+a)},_get:function(a){return this.__kv.get(this.__prefix+a)},_set:function(a,b){this.__kv.set(this.__prefix+a,b)},_remove:function(a){this.__kv.remove(this.__prefix+a)}}),BetaJS.KeyValue.KeyValueStore.extend("BetaJS.KeyValue.MemoryKeyValueStore",{constructor:function(a,b){this._inherited(BetaJS.KeyValue.MemoryKeyValueStore,"constructor"),this.__data=BetaJS.Objs.clone(a,b?1:0)},_mem:function(a){return a in this.__data},_get:function(a){return this.__data[a]},_set:function(a,b){this.__data[a]=b},_remove:function(a){delete this.__data[a]}}),BetaJS.KeyValue.MemoryKeyValueStore.extend("BetaJS.KeyValue.LocalKeyValueStore",{constructor:function(){this._inherited(BetaJS.KeyValue.LocalKeyValueStore,"constructor",localStorage,!1)}}),BetaJS.KeyValue.KeyValueStore.extend("BetaJS.KeyValue.DefaultKeyValueStore",{constructor:function(a,b){this._inherited(BetaJS.KeyValue.DefaultKeyValueStore,"constructor"),this.__kv=a,this.__def=b},_mem:function(a){return this.__kv.mem(a)||this.__def.mem(a)},_get:function(a){return this.__kv.mem(a)?this.__kv.get(a):this.__def.get(a)},_set:function(a,b){this.__kv.set(a,b)},_remove:function(a){this.__kv.remove(a)}}),BetaJS.Class.extend("BetaJS.Net.AbstractAjax",{constructor:function(a){this._inherited(BetaJS.Net.AbstractAjax,"constructor"),this.__options=BetaJS.Objs.extend({method:"GET",data:{}},a)},syncCall:function(a){try{return this._syncCall(BetaJS.Objs.extend(BetaJS.Objs.clone(this.__options,1),a))}catch(b){throw b=BetaJS.Exceptions.ensure(b),b.assert(BetaJS.Net.AjaxException),b}},asyncCall:function(a){return this._asyncCall(BetaJS.Objs.extend(BetaJS.Objs.clone(this.__options,1),a))},_syncCall:function(){throw"Unsupported"},_asyncCall:function(){throw"Unsupported"}}),BetaJS.Exceptions.Exception.extend("BetaJS.Net.AjaxException",{constructor:function(a,b,c){this._inherited(BetaJS.Net.AjaxException,"constructor",a+": "+b),this.__status_code=a,this.__status_text=b,this.__data=c},status_code:function(){return this.__status_code},status_text:function(){return this.__status_text},data:function(){return this.__data},json:function(){var a=this._inherited(BetaJS.Net.AjaxException,"json");return a.data=this.data(),a}}),BetaJS.Channels.Sender.extend("BetaJS.Net.SocketSenderChannel",{constructor:function(a,b,c){this._inherited(BetaJS.Net.SocketSenderChannel,"constructor"),this.__socket=a,this.__message=b,this.__ready=BetaJS.Types.is_defined(c)?c:!0,this.__cache=[]},_send:function(a,b){this.__ready?this.__socket.emit(this.__message,{message:a,data:b}):this.__cache.push({message:a,data:b})},ready:function(){this.__ready=!0;for(var a=0;a<this.__cache.length;++a)this._send(this.__cache[a].message,this.__cache[a].data);this.__cache=[]},unready:function(){this.__ready=!1},socket:function(){return arguments.length>0&&(this.__socket=arguments[0]),this.__socket}}),BetaJS.Channels.Receiver.extend("BetaJS.Net.SocketReceiverChannel",{constructor:function(a,b){this._inherited(BetaJS.Net.SocketReceiverChannel,"constructor"),this.__message=b,this.socket(a)},socket:function(){if(arguments.length>0&&(this.__socket=arguments[0],this.__socket)){var a=this;this.__socket.on(this.__message,function(b){a._receive(b.message,b.data)})}return this.__socket}}),BetaJS.Net=BetaJS.Net||{},BetaJS.Net.HttpHeader={HTTP_STATUS_OK:200,HTTP_STATUS_CREATED:201,HTTP_STATUS_PAYMENT_REQUIRED:402,HTTP_STATUS_FORBIDDEN:403,HTTP_STATUS_NOT_FOUND:404,HTTP_STATUS_PRECONDITION_FAILED:412,HTTP_STATUS_INTERNAL_SERVER_ERROR:500,format:function(a,b){var c="";return c=a==this.HTTP_STATUS_OK?"OK":a==this.HTTP_STATUS_CREATED?"Created":a==this.HTTP_STATUS_PAYMENT_REQUIRED?"Payment Required":a==this.HTTP_STATUS_FORBIDDEN?"Forbidden":a==this.HTTP_STATUS_NOT_FOUND?"Not found":a==this.HTTP_STATUS_PRECONDITION_FAILED?"Precondition Failed":a==this.HTTP_STATUS_INTERNAL_SERVER_ERROR?"Internal Server Error":"Other Error",b?a+" "+c:c}},BetaJS.Net=BetaJS.Net||{},BetaJS.Net.Uri={build:function(a){var b="";return a.username&&(b+=a.username+":"),a.password&&(b+=a.password+"@"),b+=a.server,a.port&&(b+=":"+a.port),a.path&&(b+="/"+a.path),b},encodeUriParams:function(a,b){b=b||"";var c=[];return BetaJS.Objs.iter(a,function(a,d){BetaJS.Types.is_object(a)?c=c.concat(this.encodeUriParams(a,b+d+"_")):c.push(b+d+"="+encodeURI(a))},this),c.join("&")},appendUriParams:function(a,b,c){return BetaJS.Types.is_empty(b)?a:a+(-1!=a.indexOf("?")?"&":"?")+this.encodeUriParams(b,c)},parse:function(a,b){for(var c=b?this.__parse_strict_regex:this.__parse_loose_regex,d=c.exec(a),e={},f=0;f<this.__parse_key.length;++f)e[this.__parse_key[f]]=d[f]||"";return e.queryKey={},e[this.__parse_key[12]].replace(this.__parse_key_parser,function(a,b,c){b&&(e.queryKey[b]=c)}),e},__parse_strict_regex:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,__parse_loose_regex:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,__parse_key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],__parse_key_parser:/(?:^|&)([^&=]*)=?([^&]*)/g},BetaJS.Net.AbstractAjax.extend("BetaJS.Browser.JQueryAjax",{_syncCall:function(a){var b;return BetaJS.$.ajax({type:a.method,async:!1,url:a.uri,dataType:a.decodeType?a.decodeType:null,data:a.encodeType&&"json"==a.encodeType?JSON.stringify(a.data):a.data,success:function(a){b=a},error:function(a,b,c){var d="";try{d=JSON.parse(a.responseText)}catch(e){d=JSON.parse('"'+a.responseText+'"')}throw new BetaJS.Net.AjaxException(a.status,c,ee)}}),b},_asyncCall:function(a){var b=BetaJS.Promise.create();return BetaJS.Browser.Info.isInternetExplorer()&&BetaJS.Browser.Info.internetExplorerVersion()<=9&&(BetaJS.$.support.cors=!0),BetaJS.$.ajax({type:a.method,async:!0,url:a.uri,dataType:a.decodeType?a.decodeType:null,data:a.encodeType&&"json"==a.encodeType?JSON.stringify(a.data):a.data,success:function(a){b.asyncSuccess(a)},error:function(a,c,d){var e="";try{e=JSON.parse(a.responseText)}catch(f){e=JSON.parse('"'+a.responseText+'"')}b.asyncError(new BetaJS.Net.AjaxException(a.status,d,e))}}),b}}),BetaJS.Browser.Cookies={get:function(a){return BetaJS.Strings.read_cookie_string(document.cookie,a)},set:function(a,b){document.cookie=BetaJS.Strings.write_cookie_string(document.cookie,a,b)}},BetaJS.Browser.Dom={traverseNext:function(a,b){return"get"in a&&(a=a.get(0)),a.firstChild&&!b?BetaJS.$(a.firstChild):a.parentNode?a.nextSibling?BetaJS.$(a.nextSibling):this.traverseNext(a.parentNode,!0):null},selectNode:function(a,b){a=BetaJS.$(a).get(0);var c=null,d=null;window.getSelection?(c=window.getSelection(),c.removeAllRanges(),d=document.createRange()):document.selection&&(c=document.selection,d=c.createRange()),b?(d.setStart(a,b),d.setEnd(a,b),c.addRange(d)):(d.selectNode(a),c.addRange(d))},selectionStartNode:function(){return window.getSelection?BetaJS.$(window.getSelection().getRangeAt(0).startContainer):document.selection?BetaJS.$(document.selection.createRange().startContainer):null},selectedHtml:function(){return window.getSelection?window.getSelection().toString():document.selection?document.selection.createRange().htmlText:""},selectionAncestor:function(){return window.getSelection?BetaJS.$(window.getSelection().getRangeAt(0).commonAncestorContainer):document.selection?BetaJS.$(document.selection.createRange().parentElement()):null},selectionStartOffset:function(){return window.getSelection?window.getSelection().getRangeAt(0).startOffset:document.selection?document.selection.createRange().startOffset:null},selectionEndOffset:function(){return window.getSelection?window.getSelection().getRangeAt(0).endOffset:document.selection?document.selection.createRange().endOffset:null},selectionStart:function(){return window.getSelection?BetaJS.$(window.getSelection().getRangeAt(0).startContainer):document.selection?BetaJS.$(document.selection.createRange().startContainer):null},selectionEnd:function(){return window.getSelection?BetaJS.$(window.getSelection().getRangeAt(0).endContainer):document.selection?BetaJS.$(document.selection.createRange().endContainer):null},selectionNonEmpty:function(){var a=this.selectionStart(),b=this.selectionEnd();return a&&b&&a.get(0)&&b.get(0)&&(a.get(0)!=b.get(0)||this.selectionStartOffset()!=this.selectionEndOffset())},selectionContained:function(a){return a.has(this.selectionStart()).length>0&&a.has(this.selectionEnd()).length>0},selectionNodes:function(){var a=[],b=this.selectionStart(),c=this.selectionEnd();a.push(b);for(var d=b;d.get(0)!=c.get(0);)d=this.traverseNext(d),a.push(d);return a},selectionLeaves:function(){return BetaJS.Objs.filter(this.selectionNodes(),function(a){return 0===a.children().length})},contentSiblings:function(a){return a.parent().contents().filter(function(){return this!=a.get(0)})},remove_tag_from_parent_path:function(a,b,c){b=b.toLowerCase(),a=BetaJS.$(a);for(var d=a.parents(c?c+" "+b:b),e=0;e<d.length;++e){var f=d.get(e);for(f=BetaJS.$(f);a.get(0)!=f.get(0);)this.contentSiblings(a).wrap("<"+b+"></"+b+">"),a=a.parent();f.contents().unwrap()}},selectionSplitOffsets:function(){var a=this.selectionStartOffset(),b=this.selectionEndOffset(),c=this.selectionStart(),d=this.selectionEnd(),e=c.get(0)==d.get(0);if(b<d.get(0).wholeText.length){var f=d.get(0);f.splitText(b),d=BetaJS.$(f),e&&(c=d)}a>0&&(c=BetaJS.$(c.get(0).splitText(a)),e&&(d=c)),this.selectRange(c,d)},selectRange:function(a,b,c,d){a=BetaJS.$(a),b=BetaJS.$(b);var e=null,f=null;window.getSelection?(e=window.getSelection(),e.removeAllRanges(),f=document.createRange()):document.selection&&(e=document.selection,f=e.createRange()),f.setStart(a.get(0),c||0),f.setEnd(b.get(0),d||b.get(0).data.length),e.addRange(f)
},splitNode:function(a,b,c){if(a=BetaJS.$(a),b=b||0,c=c||a.get(0).data.length,c<a.get(0).data.length){var d=a.get(0);d.splitText(c),a=BetaJS.$(d)}return b>0&&(a=BetaJS.$(a.get(0).splitText(b))),a}},BetaJS.Browser=BetaJS.Browser||{},BetaJS.Browser.Hotkeys={SHIFT_NUMS:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},SPECIAL_KEYS:{esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},MODIFIERS:["ctrl","alt","shift","meta"],keyCodeToCharacter:function(a){return 188==a?",":190==a?".":String.fromCharCode(a).toLowerCase()},register:function(a,b,c,d){d=BetaJS.Objs.extend({type:"keyup",propagate:!1,disable_in_input:!1,target:document,keycode:!1},d),d.target=BetaJS.$(d.target);var e=a.toLowerCase().split("+"),f=function(a){if(d.disable_in_input){var f=a.target||a.srcElement||null;if(f&&3==f.nodeType&&(f=f.parentNode),f&&("INPUT"==f.tagName||"TEXTAREA"==f.tagName))return}var g=a.keyCode||a.which||0,h=BetaJS.Browser.Hotkeys.keyCodeToCharacter(g),i=0,j={};BetaJS.Objs.iter(BetaJS.Browser.Hotkeys.MODIFIERS,function(b){j[b]={pressed:a[b+"Key"],wanted:!1}},this),BetaJS.Objs.iter(e,function(b){b in j?(j[b].wanted=!0,i++):b.length>1?BetaJS.Browser.Hotkeys.SPECIAL_KEYS[b]==g&&i++:d.keycode?d.keycode==g&&i++:(h==b||a.shiftKey&&BetaJS.Browser.Hotkeys.SHIFT_NUMS[h]==b)&&i++},this),i==e.length&&BetaJS.Objs.all(j,function(a){return a.wanted==a.pressed})&&(b.apply(c||this),d.propagate||a.preventDefault())};return d.target.on(d.type,f),{target:d.target,type:d.type,func:f}},unregister:function(a){a.target.off(a.type,a.func)}},BetaJS.Browser=BetaJS.Browser||{},BetaJS.Browser.Info={getNavigator:function(){return{appCodeName:navigator.appCodeName,appName:navigator.appName,appVersion:navigator.appVersion,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,platform:navigator.platform,userAgent:navigator.userAgent}},__cache:{},__cached:function(a,b){return a in this.__cache||(this.__cache[a]=b.apply(this)),this.__cache[a]},flash:function(){return this.__cached("flash",function(){return new BetaJS.Browser.FlashDetect})},isiOS:function(){return this.__cached("isiOS",function(){var a=navigator.userAgent;return-1!=a.indexOf("iPhone")||-1!=a.indexOf("iPod")||-1!=a.indexOf("iPad")})},isChrome:function(){return this.__cached("isChrome",function(){return("chrome"in window||-1!=navigator.userAgent.indexOf("CriOS"))&&!window.opera&&-1===navigator.userAgent.indexOf(" OPR/")})},isOpera:function(){return this.__cached("isOpera",function(){return!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0})},isAndroid:function(){return this.__cached("isAndroid",function(){return-1!=navigator.userAgent.toLowerCase().indexOf("android")})},isWebOS:function(){return this.__cached("isWebOS",function(){return-1!=navigator.userAgent.toLowerCase().indexOf("webos")})},isWindowsPhone:function(){return this.__cached("isWindowsPhone",function(){return-1!=navigator.userAgent.toLowerCase().indexOf("windows phone")})},isBlackberry:function(){return this.__cached("isBlackberry",function(){return-1!=navigator.userAgent.toLowerCase().indexOf("blackberry")})},iOSversion:function(){return this.__cached("iOSversion",function(){if(!this.isiOS())return!1;var a=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return{major:parseInt(a[1],10),minor:parseInt(a[2],10),revision:parseInt(a[3]||0,10)}})},isMobile:function(){return this.__cached("isMobile",function(){return this.isiOS()||this.isAndroid()||this.isWebOS()||this.isWindowsPhone()||this.isBlackberry()})},isInternetExplorer:function(){return this.__cached("isInternetExplorer",function(){return null!==this.internetExplorerVersion()})},isFirefox:function(){return this.__cached("isFirefox",function(){return-1!=navigator.userAgent.toLowerCase().indexOf("firefox")})},isSafari:function(){return this.__cached("isSafari",function(){return!this.isChrome()&&-1!=navigator.userAgent.toLowerCase().indexOf("safari")})},isWindows:function(){return this.__cached("isWindows",function(){return-1!=navigator.appVersion.toLowerCase().indexOf("win")})},isMacOS:function(){return this.__cached("isMacOS",function(){return!this.isiOS()&&-1!=navigator.appVersion.toLowerCase().indexOf("mac")})},isUnix:function(){return this.__cached("isUnix",function(){return-1!=navigator.appVersion.toLowerCase().indexOf("x11")})},isLinux:function(){return this.__cached("isLinux",function(){return-1!=navigator.appVersion.toLowerCase().indexOf("linux")})},internetExplorerVersion:function(){if("Microsoft Internet Explorer"==navigator.appName){var a=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(a.exec(navigator.userAgent))return parseFloat(RegExp.$1)}else if("Netscape"==navigator.appName){var b=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");if(b.exec(navigator.userAgent))return parseFloat(RegExp.$1)}return null},inIframe:function(){try{return window.self!==window.top}catch(a){return!0}},formatDevice:function(){return this.isMobile()?"Mobile":"Desktop"},formatOS:function(){return this.__cached("formatOS",function(){return this.isMacOS()?"Mac OS-X":this.isWindows()?"Windows":this.isUnix()?"Unix":this.isLinux()?"Linux":this.isiOS()?"iOS "+this.iOSversion().major+"."+this.iOSversion().minor+"."+this.iOSversion().revision:this.isAndroid()?"Android":this.isWebOS()?"WebOS":this.isWindowsPhone()?"Windows Phone":this.isBlackberry()?"Blackberry":"Unknown Operating System"})},formatBrowser:function(){return this.__cached("formatBrowser",function(){return this.isChrome()?"Chrome":this.isOpera()?"Opera":this.isInternetExplorer()?"Internet Explorer "+this.internetExplorerVersion():this.isFirefox()?"Firefox":this.isSafari()?"Safari":this.isAndroid()?"Android":this.isWebOS()?"WebOS":this.isWindowsPhone()?"Windows Phone":this.isBlackberry()?"Blackberry":"Unknown Browser"})},formatFlash:function(){return this.flash().installed()?"Flash "+this.flash().version().raw:this.flash().supported()?"Flash not installed but supported":"Flash not supported"}},BetaJS.Class.extend("BetaJS.Browser.FlashDetect",{constructor:function(){if(this._inherited(BetaJS.Browser.FlashDetect,"constructor"),this.__version=null,navigator.plugins&&navigator.plugins.length>0){var a="application/x-shockwave-flash",b=navigator.mimeTypes;b&&b[a]&&b[a].enabledPlugin&&b[a].enabledPlugin.description&&(this.__version=this.parseVersion(b[a].enabledPlugin.description))}else if(-1==navigator.appVersion.indexOf("Mac")&&window.execScript)for(var c=0;c<this.__activeXDetectRules.length;c++)try{var d=new ActiveXObject(this.__activeXDetectRules[c].name),e=this.__activeXDetectRules[c].version(d);if(e){this.__version=this.parseActiveXVersion(e);break}}catch(f){}},parseVersion:function(a){var b=a.split(/ +/),c=b[2].split(/\./),d=b[3];return{raw:a,major:parseInt(c[0],10),minor:parseInt(c[1],10),revisionStr:d,revision:parseInt(d.replace(/[a-zA-Z]/g,""),10)}},parseActiveXVersion:function(a){var b=a.split(",");return{raw:a,major:parseInt(b[0].split(" ")[1],10),minor:parseInt(b[1],10),revision:parseInt(b[2],10),revisionStr:b[2]}},version:function(){return this.__version},installed:function(){return null!==this.__version},supported:function(){return this.installed()||!BetaJS.Browser.Info.isiOS()},majorAtLeast:function(a){return this.installed()&&this.version().major>=a},minorAtLeast:function(a){return this.installed()&&this.version().minor>=a},revisionAtLeast:function(a){return this.installed()&&this.version().revision>=a},versionAtLeast:function(){if(!this.installed())return!1;var a=[this.version().major,this.version().minor,this.version().revision],b=Math.min(a.length,arguments.length);for(i=0;b>i;i++)if(a[i]!=arguments[i])return a[i]>arguments[i];return!0},__activeXDetectRules:[{name:"ShockwaveFlash.ShockwaveFlash.7",version:function(a){try{return a.GetVariable("$version")}catch(b){return null}}},{name:"ShockwaveFlash.ShockwaveFlash.6",version:function(a){try{a.AllowScriptAccess="always";try{return a.GetVariable("$version")}catch(b){return null}}catch(b){return"6,0,21"}}},{name:"ShockwaveFlash.ShockwaveFlash",version:function(a){try{return a.GetVariable("$version")}catch(b){return null}}}]}),BetaJS.$="jQuery"in window?window.jQuery:null,BetaJS.Browser=BetaJS.Browser||{},BetaJS.Browser.Loader={loadScript:function(a,b,c){var d=!1,e=document.getElementsByTagName("head")[0],f=document.createElement("script");f.src=a,f.onload=f.onreadystatechange=function(){d||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(d=!0,f.onload=f.onreadystatechange=null,b&&b.call(c||this,a))},e.appendChild(f)},loadStyles:function(a,b,c){var d=!1,e=document.getElementsByTagName("head")[0],f=document.createElement("link");f.rel="stylesheet",f.href=a,f.onload=f.onreadystatechange=function(){d||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(d=!0,f.onload=f.onreadystatechange=null,b&&b.call(c||this,a))},e.appendChild(f)},inlineStyles:function(a){BetaJS.$("<style>"+a+"</style>").appendTo("head")},loadHtml:function(a,b,c){BetaJS.$.ajax({url:a,dataType:"html"}).done(function(d){b.call(c||this,d,a)})}},BetaJS.Browser=BetaJS.Browser||{},BetaJS.Browser.Router=BetaJS.Class.extend("BetaJS.Browser.Router",[BetaJS.Events.EventsMixin,{routes:[],constructor:function(a){this._inherited(BetaJS.Browser.Router,"constructor");var b=BetaJS.Types.is_function(this.routes)?this.routes():this.routes;BetaJS.Types.is_array(b)||(b=[b]),"routes"in a&&(BetaJS.Types.is_array(a.routes)?b=b.concat(a.routes):b.push(a.routes)),this.__routes=[],this.__paths={},this.__current=null,BetaJS.Objs.iter(b,function(a){BetaJS.Objs.iter(a,function(a,b){BetaJS.Types.is_string(a)&&(a={action:a}),a.key=b,a.route=new RegExp("^"+b+"$"),"applicable"in a?BetaJS.Types.is_array(a.applicable)||(a.applicable=[a.applicable]):a.applicable=[],"valid"in a?BetaJS.Types.is_array(a.valid)||(a.valid=[a.valid]):a.valid=[],"path"in a||(a.path=a.key),this.__routes.push(a),this.__paths[a.path]=a},this)},this),"actions"in a&&BetaJS.Objs.iter(a.actions,function(a,b){this[b]=a},this)},destroy:function(){this.__leave(),this._inherited(BetaJS.Browser.Router,"destroy")},parse:function(a){for(var b=0;b<this.__routes.length;++b){var c=this.__routes[b],d=c.route.exec(a);if(null!==d){d.shift(1);var e=!0;if(BetaJS.Objs.iter(c.applicable,function(a){var b=BetaJS.Types.is_string(a)?this[a]:a;e=e&&b.apply(this,d)},this),!e)continue;var f=!0;return BetaJS.Objs.iter(c.valid,function(a){var b=BetaJS.Types.is_string(a)?this[a]:a;f=f&&b.apply(this,d)},this),f?{object:c,params:d}:null}}return null},object:function(a){return this.__paths[a]},path:function(a){for(var b=this.object(a).key,c=Array.prototype.slice.apply(arguments,[1]),d=/\(.*?\)/;;){var e=c.shift();if(!e)break;b=b.replace(d,e)}return b},navigate:function(a){this.trigger("navigate",a);var b=this.parse(a);return null===b?(this.trigger("navigate-fail",a),!1):(this.trigger("navigate-success",b.object,b.params),this.invoke(b.object,b.params,a))},invoke:function(a,b,c){c=c||this.path(a.key,b),this.trigger("before_invoke",a,b,c),this.__enter(a,b,c),this.trigger("after_invoke",a,b,c);var d=this._invoke(a,b);return d},_invoke:function(a,b){var c=a.action;return BetaJS.Types.is_string(c)&&(c=this[c]),c?c.apply(this,b):!1},__leave:function(){null!==this.__current&&(this.trigger("leave",this.__current),this.__current.destroy(),this.__current=null)},__enter:function(a,b,c){this.__leave(),this.__current=new BetaJS.Events.Events,this.__current.route=c,this.__current.object=a,this.__current.params=b,this.trigger("enter",this.__current)},current:function(){return this.__current}}]),BetaJS.Class.extend("BetaJS.Browser.RouterHistory",[BetaJS.Events.EventsMixin,{constructor:function(a){this._inherited(BetaJS.Browser.RouterHistory,"constructor"),this.__router=a,this.__history=[],a.on("after_invoke",this.__after_invoke,this)},destroy:function(){this.__router.off(null,null,this),this._inherited(BetaJS.Browser.RouterHistory,"destroy")},__after_invoke:function(a,b){this.__history.push({object:a,params:b}),this.trigger("change")},last:function(a){return a=a||0,this.get(this.count()-1-a)},count:function(){return this.__history.length},get:function(a){return a=a||0,this.__history[a]},getRoute:function(a){var b=this.get(a);return this.__router.path(b.object.path,b.params)},back:function(a){if(this.count()<2)return null;for(a=a||0;a>=0&&this.count()>1;)this.__history.pop(),--a;var b=this.__history.pop();return this.trigger("change"),this.__router.invoke(b.object,b.params)}}]),BetaJS.Class.extend("BetaJS.Browser.RouteBinder",{constructor:function(a){this._inherited(BetaJS.Browser.RouteBinder,"constructor"),this.__router=a,this.__router.on("after_invoke",function(a,b,c){this._getExternalRoute()!=c&&this._setExternalRoute(c,b,a)},this)},destroy:function(){this.__router.off(null,null,this),this._inherited(BetaJS.Browser.RouteBinder,"destroy")},current:function(){return this._getExternalRoute()},_setRoute:function(a){var b=this.__router.current();b&&b.route==a||this.__router.navigate(a)},_getExternalRoute:function(){return null},_setExternalRoute:function(){}}),BetaJS.Browser.RouteBinder.extend("BetaJS.Browser.HashRouteBinder",{constructor:function(a){this._inherited(BetaJS.Browser.HashRouteBinder,"constructor",a);var b=this;BetaJS.$(window).on("hashchange.events"+this.cid(),function(){b._setRoute(b._getExternalRoute())})},destroy:function(){BetaJS.$(window).off("hashchange.events"+this.cid()),this._inherited(BetaJS.Browser.HashRouteBinder,"destroy")},_getExternalRoute:function(){var a=window.location.hash;return a.length&&"#"==a[0]?a.slice(1):a},_setExternalRoute:function(a){window.location.hash="#"+a}}),BetaJS.Browser.RouteBinder.extend("BetaJS.Browser.HistoryRouteBinder",{constructor:function(a){this._inherited(BetaJS.Browser.HistoryRouteBinder,"constructor",a);var b=this;this.__used=!1,BetaJS.$(window).on("popstate.events"+this.cid(),function(){b.__used&&b._setRoute(b._getExternalRoute())})},destroy:function(){BetaJS.$(window).off("popstate.events"+this.cid()),this._inherited(BetaJS.Browser.HistoryRouteBinder,"destroy")},_getExternalRoute:function(){return window.location.pathname},_setExternalRoute:function(a){window.history.pushState({},document.title,a),this.__used=!0}},{supported:function(){return window.history&&window.history.pushState}}),BetaJS.Browser.RouteBinder.extend("BetaJS.Browser.LocationRouteBinder",{_getExternalRoute:function(){return window.location.pathname},_setExternalRoute:function(a){window.location.pathname=a}}),BetaJS.Browser.RouteBinder.extend("BetaJS.Browser.StateRouteBinder",{constructor:function(a,b){this._inherited(BetaJS.Browser.StateRouteBinder,"constructor",a),this._host=b,this._states={},BetaJS.Objs.iter(a.routes,function(a){a.state&&(this._states[a.state]=a)},this),b.on("start",function(){this._setRoute(this._getExternalRoute)},this)},destroy:function(){this._host.off(null,null,this),this._inherited(BetaJS.Browser.StateRouteBinder,"destroy")},_getExternalRoute:function(){var a=this._host.state(),b=this._states[a.state_name()];if(!b)return null;var c=/\(.*?\)/,d=b.key;return BetaJS.Objs.iter(b.mapping,function(b){d=d.replace(c,a["_"+b])},this),d},_setExternalRoute:function(a,b,c){var d={};BetaJS.Objs.iter(c.mapping,function(a,c){d[a]=b[c]}),this._host.next(c.state,d)}}),BetaJS.$="jQuery"in window?window.jQuery:null,BetaJS.Exceptions.Exception.extend("BetaJS.Views.ViewException"),BetaJS.Views.View=BetaJS.Class.extend("BetaJS.Views.View",[BetaJS.Events.EventsMixin,BetaJS.Events.ListenMixin,BetaJS.Properties.PropertiesMixin,BetaJS.Classes.ModuleMixin,{$el:null,_templates:function(){return{}},_dynamics:function(){return{}},_events:function(){return[]},_global_events:function(){return[]},_css:function(){return{}},css:function(a){if(this.__css[a])return this.__css[a];var b=null;return this.__parent&&(b=this.__parent.css(a),b&&b!=a)?b:(b=this._css(),b[a]?b[a]:a)},_render:function(){this.__html?this.$el.html(this.__html):this.__templates["default"]?this.$el.html(this.evaluateTemplate("default",{})):this.__dynamics["default"]&&this.evaluateDynamics("default",this.$el,{},{name:"default"})},templates:function(a){return a in this.__templates?this.__templates[a]:null},dynamics:function(a){return a in this.__dynamics?this.__dynamics[a]:null},_supp:function(){return{__context:this,css:function(a){return this.__context.css(a)},attrs:function(a){var b="";for(var c in a)b+=(a[c]?c+"='"+a[c]+"'":c)+" ";return b},styles:function(a){var b="";for(var c in a)b+=c+":"+a[c]+";";return b},selector:function(a){return"data-selector='"+a+"' "},view_id:this.cid()}},templateArguments:function(){var a=this.getAll();return a.supp=this._supp(),a},evaluateTemplate:function(a,b){return b=b||{},this.__templates[a].evaluate(BetaJS.Objs.extend(b,this.templateArguments()))},evaluateDynamics:function(a,b,c,d){return this.__dynamics[a].renderInstance(b,BetaJS.Objs.extend(d||{},{args:c||{}}))},_setOption:function(a,b,c,d){d=d?d:"__",this[d+b]=a&&b in a&&BetaJS.Types.is_defined(a[b])?a[b]:c},_setOptionTyped:function(a,b,c,d,e){this._setOption(a,b,this.cls._parseType(c,d),e)},_setOptionProperty:function(a,b,c){this.set(b,a&&b in a&&BetaJS.Types.is_defined(a[b])?a[b]:c)},_setOptionPropertyTyped:function(a,b,c){this._setOptionProperty(a,b,this.cls._parseType(c,type))},constructor:function(a){a=a||{},this._inherited(BetaJS.Views.View,"constructor"),this._setOption(a,"el",null),this._setOption(a,"visible",!0),this._setOption(a,"html",null),this._setOption(a,"events",[]),this._setOption(a,"attributes",{}),this._setOption(a,"invalidate_on_show",!1),this._setOption(a,"append_to_el",!1),this.__old_attributes={},this._setOption(a,"el_classes",[]),BetaJS.Types.is_string(this.__el_classes)&&(this.__el_classes=this.__el_classes.split(" ")),this.__added_el_classes=[],this._setOption(a,"el_styles",{}),this._setOption(a,"children_styles",{}),this._setOption(a,"children_classes",[]),BetaJS.Types.is_string(this.__children_classes)&&(this.__children_classes=this.__children_classes.split(" ")),this._setOption(a,"invalidate_on_change",!1),this.__old_el_styles={},this._setOption(a,"css",{}),this.__parent=null,this.__children={},this.__active=!1,this.$el=null;var b=BetaJS.Types.is_function(this._events)?this._events():this._events;BetaJS.Types.is_array(b)||(b=[b]),this.__events=b.concat(this.__events);var c=BetaJS.Types.is_function(this._global_events)?this._global_events():this._global_events;BetaJS.Types.is_array(c)||(c=[c]),this.__global_events=c;var d=BetaJS.Objs.extend(BetaJS.Types.is_function(this._templates)?this._templates():this._templates,a.templates||{});"template"in a&&(d["default"]=a.template),this.__templates={};var e=null;for(e in d){if(!d[e])throw new BetaJS.Views.ViewException("Could not find template '"+e+"' in View '"+this.cls.classname+"'");this.__templates[e]=new BetaJS.Templates.Template(BetaJS.Types.is_string(d[e])?d[e]:d[e].html())}var f=BetaJS.Objs.extend(BetaJS.Types.is_function(this._dynamics)?this._dynamics():this._dynamics,a.dynamics||{});"dynamic"in a&&(f["default"]=a.dynamic),this.__dynamics={};for(e in f)this.__dynamics[e]=new BetaJS.Views.DynamicTemplate(this,BetaJS.Types.is_string(f[e])?f[e]:f[e].html());this.setAll(a.properties||{}),this.__invalidate_on_change&&this.on("change",function(){this.invalidate()},this),this.__modules={},BetaJS.Objs.iter(a.modules||[],this.add_module,this),this._notify("created",a),this.ns={};var g=this._domain(),h=this._domain_defaults(),i=null;if(!BetaJS.Types.is_empty(g)){var j=[];for(i in g)j.push({name:i,data:g[i]});j=BetaJS.Sort.dependency_sort(j,function(a){return a.name},function(a){return a.data.before||[]},function(a){var b=a.data.after||[];return a.data.parent&&b.push(a.data.parent),b});for(var k=0;k<j.length;++k){i=j[k].name;var l=j[k].data,m=l.options||{};BetaJS.Types.is_function(m)&&(m=m.apply(this,[this]));var n=h[l.type]||{};BetaJS.Types.is_function(n)&&(n=n.apply(this,[this])),m=BetaJS.Objs.tree_merge(n,m),l.type in BetaJS.Views&&(l.type=BetaJS.Views[l.type]),BetaJS.Types.is_string(l.type)&&(l.type=BetaJS.Scopes.resolve(l.type));var o=new l.type(m);this.ns[i]=o;var p=l.parent_options||{},q=this;l.parent&&(q=BetaJS.Scopes.resolve(l.parent,this.ns)),l.method?l.method(q,o):q.addChild(o,p),o.domain=this;var r=null;for(r in l.events||{})o.on(r,l.events[r],o);for(r in l.listeners||{})this.on(r,l.listeners[r],o)}}},_domain:function(){return{}},_domain_defaults:function(){return{}},isActive:function(){return this.__active},activate:function(){if(this.isActive())return this;if(this.__parent&&!this.__parent.isActive())return null;if(this.$el=this.__parent?this.__el?this.__parent.$(this.__el):this.__parent.$el:BetaJS.$(this.__el),0===this.$el.size()&&(this.$el=null),!this.$el)return null;this.__append_to_el&&(this.$el.append("<div data-view-id='"+this.cid()+"'></div>"),this.$el=this.$el.find("[data-view-id='"+this.cid()+"']")),this.__old_attributes={};var a=null,b=null;for(a in this.__attributes)b=this.$el.attr(a),this.__old_attributes[a]=BetaJS.Types.is_defined(b)?b:null,this.$el.attr(a,this.__attributes[a]);this.__added_el_classes=[];for(var c=this._el_classes().concat(this.__el_classes),d=0;d<c.length;++d)this.$el.hasClass(c[d])||(this.$el.addClass(c[d]),this.__added_el_classes.push(c[d]));this.__old_el_styles={};var e=BetaJS.Objs.extend(this._el_styles(),this.__el_styles);for(a in e)b=this.$el.css(a),this.__old_el_styles[a]=BetaJS.Types.is_defined(b)?b:null,this.$el.css(a,e[a]);return this.__bind(),this.__visible||this.$el.css("display",this.__visible?"":"none"),this.__active=!0,this.__render(),this._notify("preactivate"),BetaJS.Objs.iter(this.__children,function(a){a.view.activate()}),this._notify("activate"),this.trigger("activate"),this.__visible&&this.trigger("show"),this.trigger("visibility",this.__visible),this.trigger("resize"),this},deactivate:function(){if(!this.isActive())return!1;this.__visible&&this.trigger("hide"),this.trigger("visibility",!1),this._notify("deactivate"),this.trigger("deactivate"),BetaJS.Objs.iter(this.__children,function(a){a.view.deactivate()}),this.__active=!1,BetaJS.Objs.iter(this.__dynamics,function(a){a.reset()},this),this.__unbind(),this.$el.html("");var a=null;for(a in this.__old_attributes)this.$el.attr(a,this.__old_attributes[a]);for(var b=0;b<this.__added_el_classes.length;++b)this.$el.removeClass(this.__added_el_classes[b]);for(a in this.__old_el_styles)this.$el.css(a,this.__old_el_styles[a]);return this.__append_to_el&&this.$el.remove(),this.$el=null,!0},_el_styles:function(){return{}},_el_classes:function(){return[]},$:function(a){return this.$el.find(a)},$data:function(a,b){b||(b=this.$el);var c="";for(var d in a)c+="[data-"+d+"='"+a[d]+"']";return b.find(c)},destroy:function(){this.deactivate(),this.setParent(null);var a=this.__children;this.__children={},BetaJS.Objs.iter(a,function(a){a.view.destroy()}),this.__children={},BetaJS.Objs.iter(this.__dynamics,function(a){a.destroy()},this),BetaJS.Objs.iter(this.__templates,function(a){a.destroy()},this),this.trigger("destroy"),this._inherited(BetaJS.Views.View,"destroy")},show:function(){this.setVisibility(!0)},hide:function(){this.setVisibility(!1)},isVisible:function(){return this.__visible},setVisibility:function(a){a!=this.__visible&&(this.__visible=a,this.isActive()&&(this.$el.css("display",this.__visible?"":"none"),this.__visible&&(this.trigger("resize"),this.__invalidate_on_show&&this.invalidate()),this.trigger(a?"show":"hide"),this.trigger("visibility",a)),this.__parent&&this.__parent.updateChildVisibility(this))},updateChildVisibility:function(){},toggle:function(){this.setVisibility(!this.isVisible())},__bind:function(){var a=this;this.__unbind(),BetaJS.Objs.iter(this.__events,function(b){BetaJS.Objs.iter(b,function(b,c){var d=BetaJS.Types.is_function(b)?b:a[b],e=c.match(BetaJS.Views.BIND_EVENT_SPLITTER),f=e[1],g=e[2];f=f+".events"+a.cid();var h=BetaJS.Functions.as_method(d,a);""===g?a.$el.on(f,h):a.$el.on(f,g,h)})}),BetaJS.Objs.iter(this.__global_events,function(b){BetaJS.Objs.iter(b,function(b,c){var d=BetaJS.Types.is_function(b)?b:a[b],e=c.match(BetaJS.Views.BIND_EVENT_SPLITTER),f=e[1],g=e[2];f=f+".events"+a.cid();var h=BetaJS.Functions.as_method(d,a);""===g?BetaJS.$(document).on(f,h):BetaJS.$(document).on(f,g,h)})})},__unbind:function(){this.$el.off(".events"+this.cid()),BetaJS.$(document).off(".events"+this.cid())},__render:function(){if(this.isActive()){this._render();var a=this.$el.children();if(!BetaJS.Types.is_empty(this.__children_styles))for(var b in this.__children_styles)a.css(b,this.__children_styles[b]);BetaJS.Objs.iter(this.__children_classes,function(b){a.addClass(b)}),this.trigger("render")}},invalidate:function(){this.isActive()&&(BetaJS.Objs.iter(this.__children,function(a){a.view.deactivate()}),BetaJS.Objs.iter(this.__dynamics,function(a){a.reset()},this),this.__render(),BetaJS.Objs.iter(this.__children,function(a){a.view.activate()}))},setEl:function(a){this.isActive()?(this.deactivate(),this.__el=a,this.activate()):this.__el=a},getParent:function(){return this.__parent},hasChild:function(a){return a&&a.cid()in this.__children},setParent:function(a){if(a!=this.__parent){if(this.deactivate(),this.__parent){this._unbindParent(this.__parent);var b=this.__parent;this.__parent.off(null,null,this),this.__parent=null,b.removeChild(this)}a&&(this.__parent=a,a.addChild(this),this._bindParent(a),a.isActive()&&this.activate())}},_bindParent:function(){},_unbindParent:function(){},children:function(){var a={};return BetaJS.Objs.iter(this.__children,function(b,c){a[c]=b.view},this),a},childOptions:function(a){return this.__children[a.cid()].options},addChildren:function(a){BetaJS.Objs.iter(a,function(a){this.addChild(a)},this)},addChild:function(a,b){return this.hasChild(a)?null:(b=b||{},this.__children[a.cid()]={view:a,options:b},this._notify("addChild",a,b),a.setParent(this),this.isActive()&&this.isVisible()&&this.trigger("resize"),a)},removeChildren:function(a){BetaJS.Objs.iter(a,function(a){this.removeChild(a)},this)},removeChild:function(a){this.hasChild(a)&&(delete this.__children[a.cid()],a.setParent(null),a.off(null,null,this),this._notify("removeChild",a),this.isActive()&&this.isVisible()&&this.trigger("resize"))},width:function(){return this.$el.width()},innerWidth:function(){return this.$el.innerWidth()},outerWidth:function(){return this.$el.outerWidth()},height:function(){return this.$el.height()},innerHeight:function(){return this.$el.innerHeight()},outerHeight:function(){return this.$el.outerHeight()}}],{parseType:function(a,b){if(BetaJS.Types.is_defined(a)&&BetaJS.Types.is_string(a)){if(a=a.replace(/\s+/g,""),"int"==b)return parseInt(a,10);if("array"==b)return a.split(",");if("bool"==b)return""===a||BetaJS.Types.parseBool(a);if("object"==b||"function"==b)return BetaJS.Scopes.resolve(a)}return a}}),BetaJS.Views.BIND_EVENT_SPLITTER=/^(\S+)\s*(.*)$/,BetaJS.Class.extend("BetaJS.Views.DynamicTemplate",{constructor:function(a,b){this._inherited(BetaJS.Views.DynamicTemplate,"constructor"),this.__parent=a,this.__template=new BetaJS.Templates.Template(b),this.__instances={},this.__instances_by_name={}},reset:function(){BetaJS.Objs.iter(this.__instances,function(a){this.removeInstance(a)},this)},destroy:function(){this.reset(),this._inherited(BetaJS.Views.DynamicTemplate,"destroy")},renderInstance:function(a,b){b=b||{},b.name&&this.removeInstanceByName(b.name);var c=new BetaJS.Views.DynamicTemplateInstance(this,a,b);this.__instances[c.cid()]=c,b.name&&(this.__instances_by_name[name]=c)},removeInstanceByName:function(a){a in this.__instances_by_name&&this.removeInstance(this.__instances_by_name[a])},removeInstance:function(a){delete this.__instances[a.cid()],delete this.__instances_by_name[a.name()],a.destroy()},view:function(){return this.__parent},template:function(){return this.__template}}),BetaJS.Class.extend("BetaJS.Views.DynamicTemplateInstance",[BetaJS.Events.ListenMixin,{__bind:{attr:function(a,b){return this.__context.__bind_attribute(a,b)},attrs:function(a){var b="";for(attribute in a)b+=this.attr(attribute,a[attribute])+" ";return b},value:function(a){return this.__context.__bind_value(a)},inner:function(a){return this.__context.__bind_inner(a)},css_if:function(a,b){return this.__context.__bind_css_if(a,b,!0)},css_if_not:function(a,b){return this.__context.__bind_css_if(a,b,!1)}},__new_element:function(a){var b=BetaJS.Ids.uniqueId();return this.__elements[b]=BetaJS.Objs.extend({id:b,$el:null},a),this.__elements[b]},__decompose_variable:function(a){var b=a.split(".");return{object:1==b.length?this.__parent.view():this.__args[b[0]],key:1==b.length?a:b[1]}},__get_variable:function(a){var b=this.__decompose_variable(a);return b.object.get(b.key)},__set_variable:function(a,b){var c=this.__decompose_variable(a);return c.object.set(c.key,b)},__update_element:function(a){var b=this.__get_variable(a.variable);"inner"==a.type?a.$el.html(b):"value"==a.type?a.$el.val()!=b&&a.$el.val(b):"attribute"==a.type?a.$el.attr(a.attribute,b):"css"==a.type&&(a.positive||(b=!b),b?a.$el.addClass(this.__parent.view().css(a.css)):a.$el.removeClass(this.__parent.view().css(a.css)))},__prepare_element:function(a){var b=this;a.$el=this.$el.find(a.selector),"inner"==a.type||"css"==a.type?this.__update_element(a):"value"==a.type&&a.$el.on("change input keyup paste",function(){b.__set_variable(a.variable,a.$el.val())})},__bind_attribute:function(a,b){var c=this.__new_element({type:"attribute",attribute:a,variable:b}),d="data-bind-"+a+"='"+c.id+"'";c.selector="["+d+"]";var e=this.__decompose_variable(b);return this.listenOn(e.object,"change:"+e.key,function(){this.__update_element(c)},this),d+" "+a+"='"+e.object.get(e.key)+"'"},__bind_css_if:function(a,b,c){var d=this.__new_element({type:"css",css:a,variable:b,positive:c}),e="data-bind-css-"+a+"='"+d.id+"'";d.selector="["+e+"]";var f=this.__decompose_variable(b);return this.listenOn(f.object,"change:"+f.key,function(){this.__update_element(d)},this),e},__bind_value:function(a){var b=this.__new_element({type:"value",variable:a}),c="data-bind-value='"+b.id+"'";b.selector="["+c+"]";var d=this.__decompose_variable(a);return this.listenOn(d.object,"change:"+d.key,function(){this.__update_element(b)},this),c+" value='"+d.object.get(d.key)+"'"},__bind_inner:function(a){var b=this.__new_element({type:"inner",variable:a}),c="data-bind-inner='"+b.id+"'";b.selector="["+c+"]";var d=this.__decompose_variable(a);return this.listenOn(d.object,"change:"+d.key,function(){this.__update_element(b)},this),c},constructor:function(a,b,c){this._inherited(BetaJS.Views.DynamicTemplateInstance,"constructor"),this.__elements={},this.__inners={},c=c||{},c.name&&(this.__name=name),this.__parent=a,this.$el=b,this.__args=BetaJS.Objs.extend(c.args||{},this.__parent.view().templateArguments()),this.__args.bind=BetaJS.Objs.extend({__context:this},this.__bind),this.$el.html(a.template().evaluate(this.__args)),BetaJS.Objs.iter(this.__elements,function(a){this.__prepare_element(a)},this)},destroy:function(){BetaJS.Objs.iter(this.__elements,function(a){a.$el.off()},this),this._inherited(BetaJS.Views.DynamicTemplateInstance,"destroy")},name:function(){return this.__name}}]),BetaJS.Views.ActiveDom={__prefix_alias:["bjs","betajs"],__view_alias:{},__views:{},__active:!1,__on_add_element:function(a){var b=BetaJS.$(a.target);if(b){var c=!1;b.prop("tagName")&&(BetaJS.Objs.iter(BetaJS.Views.ActiveDom.__prefix_alias,function(a){b.prop("tagName").toLowerCase()==a+"view"&&(BetaJS.Views.ActiveDom.__attach(b),c=!0)}),BetaJS.Objs.iter(BetaJS.Views.ActiveDom.__view_alias,function(a,d){b.prop("tagName").toLowerCase()==d&&(BetaJS.Views.ActiveDom.__attach(b,a),c=!0)})),c||(BetaJS.Objs.iter(BetaJS.Views.ActiveDom.__prefix_alias,function(a){b.find(a+"view").each(function(){BetaJS.Views.ActiveDom.__attach(BetaJS.$(this))
})}),BetaJS.Objs.iter(BetaJS.Views.ActiveDom.__view_alias,function(a,c){b.find(c).each(function(){BetaJS.Views.ActiveDom.__attach(BetaJS.$(this),a)})}))}},__on_remove_element:function(a){var b=BetaJS.$(a.target);b.attr("data-active-dom-id")in BetaJS.Views.ActiveDom.__views?BetaJS.Views.ActiveDom.__views[b.attr("data-active-dom-id")].destroy():b.find("[data-active-dom-id]").each(function(){var a=BetaJS.$(this);a.attr("data-active-dom-id")in BetaJS.Views.ActiveDom.__views&&BetaJS.Views.ActiveDom.__views[a.attr("data-active-dom-id")].destroy()})},__attach:function(a,b){if(!a.attr("data-active-dom-element")){var c=function(a,c){for(var d=0;d<BetaJS.Views.ActiveDom.__prefix_alias.length;){var i=BetaJS.Views.ActiveDom.__prefix_alias[d];if(BetaJS.Strings.starts_with(a,i+"-"))return a=BetaJS.Strings.strip_start(a,i+"-"),BetaJS.Strings.starts_with(a,"child-")?(a=BetaJS.Strings.strip_start(a,"child-"),f[a]=c):a in h?b[a]=c:g[a]=c,void 0;++d}e[a]=c},d=function(a){var b=a.find("script[type='text/param']");return BetaJS.Strings.nltrim(b.length>0?b.html():a.html())},e={},f={},g={},h={type:"View","default":null,name:null,"keep-tag":!0};b=BetaJS.Objs.extend(BetaJS.Objs.clone(h,1),b||{});for(var i=a.get(0).attributes,j=0;j<i.length;++j)c(i.item(j).nodeName,i.item(j).nodeValue);BetaJS.Objs.iter(BetaJS.Views.ActiveDom.__prefix_alias,function(b){a.children(b+"param").each(function(){var a=BetaJS.$(this);c(b+"-"+a.attr(b+"-key"),d(a))})}),b["default"]&&(g[b["default"]]=d(a)),b.type in BetaJS.Views&&(b.type=BetaJS.Views[b.type]),BetaJS.Types.is_string(b.type)&&(b.type=BetaJS.Scopes.resolve(b.type));var k=new b.type(g);k.setEl("[data-active-dom-id='"+k.cid()+"']");var l="<div data-active-dom-id='"+k.cid()+"'></div>";b["keep-tag"]&&(l="<"+a.prop("tagName")+" data-active-dom-element='"+k.cid()+"'>"+l+"</"+a.prop("tagName")+">"),a.replaceWith(l),a=BetaJS.$("[data-active-dom-id='"+k.cid()+"']");var m=null;for(m in e)a.attr(m,e[m]);k.on("destroy",function(){delete BetaJS.Views.ActiveDom.__views[k.cid()]}),BetaJS.Views.ActiveDom.__views[k.cid()]=k,k.activate();for(m in f)a.children().attr(m,f[m]);b.name&&BetaJS.Scopes.set(k,b.name)}},activate:function(){BetaJS.$(document).ready(function(){BetaJS.Views.ActiveDom.__active||(document.addEventListener?(document.addEventListener("DOMNodeInserted",BetaJS.Views.ActiveDom.__on_add_element),document.addEventListener("DOMNodeRemoved",BetaJS.Views.ActiveDom.__on_remove_element)):(document.attachEvent("DOMNodeInserted",BetaJS.Views.ActiveDom.__on_add_element),document.attachEvent("DOMNodeRemoved",BetaJS.Views.ActiveDom.__on_remove_element)),BetaJS.Objs.iter(BetaJS.Views.ActiveDom.__prefix_alias,function(a){BetaJS.$(a+"view").each(function(){BetaJS.Views.ActiveDom.__attach(BetaJS.$(this))})}),BetaJS.Objs.iter(BetaJS.Views.ActiveDom.__view_alias,function(a,b){BetaJS.$(b).each(function(){BetaJS.Views.ActiveDom.__attach(BetaJS.$(this),a)})}),BetaJS.Views.ActiveDom.__active=!0)})},deactivate:function(){BetaJS.$(document).ready(function(){BetaJS.Views.ActiveDom.__active&&(document.removeEventListener("DOMNodeInserted",BetaJS.Views.ActiveDom.__on_add_element),document.removeEventListener("DOMNodeRemoved",BetaJS.Views.ActiveDom.__on_remove_element),BetaJS.Objs.iter(BetaJS.Views.ActiveDom.__views,function(a){a.destroy()}),BetaJS.Views.ActiveDom.__active=!1)})},registerPrefixAlias:function(a){this.__prefix_alias.push(a)},registerViewAlias:function(a,b,c){this.__view_alias[a]={type:b},this.__view_alias[a]["default"]=c}},BetaJS.Classes.Module.extend("BetaJS.Views.Modules.Centering",{constructor:function(a){this._inherited(BetaJS.Views.Modules.Centering,"constructor",a),this.__vertical="vertical"in a?a.vertical:!1,this.__horizontal="horizontal"in a?a.horizontal:!1},_register:function(a){a.on("resize",function(){a.isVisible()&&this.__update(a)},this),a.isActive()&&a.isVisible()&&this.__update(a)},__update:function(a){this.__vertical&&(a.$el.css("top","50%"),a.$el.css("margin-top",Math.round(-a.$el.height()/2)+"px")),this.__horizontal&&(a.$el.css("left","50%"),a.$el.css("margin-left",Math.round(-a.$el.width()/2)+"px"))}},{__vertical:null,vertical:function(){return this.__vertical||(this.__vertical=new this({auto_destroy:!1,vertical:!0,horizontal:!1})),this.__vertical},__horizontal:null,horizontal:function(){return this.__horizontal||(this.__horizontal=new this({auto_destroy:!1,horizontal:!0,vertical:!1})),this.__horizontal},__both:null,both:function(){return this.__both||(this.__both=new this({auto_destroy:!1,vertical:!0,horizontal:!0})),this.__both}}),BetaJS.Classes.Module.extend("BetaJS.Views.Modules.BindOnActivate",{_register:function(a,b){b.bound=!1,a.on("activate",function(){this.__bind(a)},this),a.on("deactivate",function(){this.__unbind(a)},this),a.isActive()&&this.__bind(a)},_unregister:function(a){this.__unbind(a)},__bind:function(a){var b=this._data(a);b.bound||(this._bind(a,b),b.bound=!0)},__unbind:function(a){var b=this._data(a);b.bound&&(this._unbind(a,b),b.bound=!1)},_bind:function(){},_unbind:function(){}}),BetaJS.Classes.Module.extend("BetaJS.Views.Modules.BindOnVisible",{_register:function(a,b){b.bound=!1,a.on("visibility",function(b){b?this.__bind(a):this.__unbind(a)},this),a.isActive()&&a.isVisible()&&this.__bind(a)},_unregister:function(a){this.__unbind(a)},__bind:function(a){var b=this._data(a);b.bound||(this._bind(a,b),b.bound=!0)},__unbind:function(a){var b=this._data(a);b.bound&&(this._unbind(a,b),b.bound=!1)},_bind:function(){},_unbind:function(){}}),BetaJS.Views.Modules.BindOnVisible.extend("BetaJS.Views.Modules.HideOnLeave",{_bind:function(a,b){var c=a.$el.get(0);b.hide_on_leave_func=function(d){return b.hide_on_leave_skip?(b.hide_on_leave_skip=!1,void 0):(document.contains(d.target)&&d.target!==c&&!BetaJS.$.contains(c,d.target)&&a.hide(),void 0)},b.hide_on_leave_skip=!0,BetaJS.$(document.body).on("click",b.hide_on_leave_func)},_unbind:function(a,b){BetaJS.$(document.body).unbind("click",b.hide_on_leave_func)}}),BetaJS.Views.Modules.BindOnActivate.extend("BetaJS.Views.Modules.Hotkeys",{constructor:function(a){this._inherited(BetaJS.Views.Modules.Hotkeys,"constructor",a),this.__hotkeys=a.hotkeys},_bind:function(a,b){b.hotkeys={},BetaJS.Objs.iter(this.__hotkeys,function(c,d){b.hotkeys[d]=BetaJS.Browser.Hotkeys.register(d,BetaJS.Types.is_function(c)?c:a[c],a)},this)},_unbind:function(a,b){BetaJS.Objs.iter(b.hotkeys,function(a){BetaJS.Browser.Hotkeys.unregister(a)},this),b.hotkeys={}}}),BetaJS.Templates.Cached=BetaJS.Templates.Cached||{},BetaJS.Templates.Cached["holygrail-view-template"]="  <div data-selector=\"right\" class='holygrail-view-right-container'></div>  <div data-selector=\"left\" class='holygrail-view-left-container'></div>  <div data-selector=\"center\" class='holygrail-view-center-container'></div> ",BetaJS.Templates.Cached["list-container-view-item-template"]='  <{%= container_element %} data-view-id="{%= cid %}"></{%= container_element %}> ',BetaJS.Templates.Cached["switch-container-view-item-template"]='  <div data-view-id="{%= cid %}" data-selector="switch-container-item"></div> ',BetaJS.Templates.Cached["button-view-template"]='   <{%= button_container_element %} type="button" data-selector="button-inner" class="{%= supp.css("default") %}"    {%= bind.css_if("disabled", "disabled") %}    {%= bind.css_if("selected", "selected") %}    {%= bind.inner("label") %}>   </{%= button_container_element %}>  ',BetaJS.Templates.Cached["check-box-view-template"]='  <input type="checkbox" {%= checked ? "checked" : "" %} id="check-{%= supp.view_id %}" />  <label for="check-{%= supp.view_id %}">{%= label %}</label> ',BetaJS.Templates.Cached["input-view-template"]='  <input class="input-view" type="{%= input_type %}" {%= bind.value("value") %} {%= bind.attr("placeholder", "placeholder") %} {%= bind.css_if("input-horizontal-fill", "horizontal_fill") %} /> ',BetaJS.Templates.Cached["label-view-template"]='  <{%= element %} class="{%= supp.css(\'label\') %}" {%= bind.inner("label") %}></{%= element %}> ',BetaJS.Templates.Cached["link-view-template"]='  <a href="javascript:{}" {%= bind.inner("label") %}></a> ',BetaJS.Templates.Cached["text-area-template"]='   <textarea {%= bind.value("value") %} {%= bind.attr("placeholder", "placeholder") %}             {%= bind.css_if_not("text-area-no-resize", "resizable") %}             {%= readonly ? \'readonly\' : \'\' %}             style="resize: {%= horizontal_resize ? (vertical_resize ? \'both\' : \'horizontal\') : (vertical_resize ? \'vertical\' : \'none\') %}"             {%= bind.css_if("text-area-horizontal-fill", "horizontal_fill") %}></textarea>  ',BetaJS.Templates.Cached["progress-template"]='  <div class="{%= supp.css(\'outer\') %}">   <div data-selector="inner" class="{%= supp.css(\'inner\') %}" style="{%= horizontal ? \'width\': \'height\' %}:{%= value*100 %}%">   </div>   <div class="progress-view-overlay" data-selector="label">    {%= label %}   </div>  </div> ',BetaJS.Templates.Cached["list-view-template"]='   <{%= list_container_element %}    {%= supp.attrs(list_container_attrs) %}    class="{%= list_container_classes %}"    data-selector="list">   </{%= list_container_element %}>  ',BetaJS.Templates.Cached["list-view-item-container-template"]='   <{%= item_container_element %}    {%= supp.attrs(item_container_attrs) %}    class="{%= item_container_classes %}"    {%= supp.list_item_attr(item) %}>   </{%= item_container_element %}>  ',BetaJS.Templates.Cached["overlay-view-template"]='  <div data-selector="container"></div> ',BetaJS.Templates.Cached["fullscreen-overlay-view-template"]='  <div class="fullscreen-overlay-background" data-selector="outer"></div>  <div class="fullscreen-overlay" data-selector="container">   <div class="fullscreen-overlay-inner" data-selector="inner"></div>  </div> ',BetaJS.Views.View.extend("BetaJS.Views.HolygrailView",{_templates:{"default":BetaJS.Templates.Cached["holygrail-view-template"]},constructor:function(a){this._inherited(BetaJS.Views.HolygrailView,"constructor",a),this.__left=null,this.__center=null,this.__right=null},getLeft:function(){return this.__left},setLeft:function(a){return this.__setView("left",a)},getCenter:function(){return this.__center},setCenter:function(a){return this.__setView("center",a)},getRight:function(){return this.__right},setRight:function(a){return this.__setView("right",a)},__setView:function(a,b){return this.removeChild(this["__"+a]),this["__"+a]=null,b&&(b.setEl('[data-selector="'+a+'"]'),this["__"+a]=this.addChild(b)),b}}),BetaJS.Views.View.extend("BetaJS.Views.ListContainerView",{_templates:{item:BetaJS.Templates.Cached["list-container-view-item-template"]},_notifications:{addChild:"__addChildContainer",removeChild:"__removeChildContainer"},constructor:function(a){a=a||{},this._inherited(BetaJS.Views.ListContainerView,"constructor",a),this._setOption(a,"alignment","horizontal"),this._setOption(a,"positioning","float"),this._setOption(a,"clear_float",!1),this._setOption(a,"container_element","div"),this.on("show",function(){"computed"==this.__positioning&&this.__updatePositioning()},this)},isHorizontal:function(){return"horizontal"==this.__alignment},_render:function(){this.__clear_float?this.$el.html("<div data-selector='clearboth' style='clear:both'></div>"):this.$el.html(""),BetaJS.Objs.iter(this.children(),function(a){this.__addChildContainer(a)},this)},__addChildContainer:function(a){var b=this.childOptions(a);if(this.isActive()){var c=this.evaluateTemplate("item",{cid:a.cid(),container_element:this.__container_element});this.__clear_float?this.$("[data-selector='clearboth']").before(c):this.$el.append(c)}if(a.setEl("[data-view-id='"+a.cid()+"']"),!this.isHorizontal()||"float"in b||"float"!=this.__positioning||(b["float"]="left"),this.isActive()&&"float"in b&&"float"==this.__positioning){var d=this.$("[data-view-id='"+a.cid()+"']");d.css("float",b["float"])}},__removeChildContainer:function(a){this.$data({"view-id":a.cid()}).remove()},__updatePositioningHelper:function(a,b,c){var d=0;BetaJS.Objs.iter(a,function(a){var e=this.childOptions(a);return e.type&&"ignore"==e.type||(a.$el.css(b,d+"px"),a.isVisible()&&(d+=parseInt(a.$el.css(c),10)),!e.type||"dynamic"!=e.type)?void 0:!1},this)},__updatePositioning:function(){var a=BetaJS.Objs.values(this.children()),b=BetaJS.Objs.clone(a,1).reverse(),c=this.isHorizontal()?"left":"top",d=this.isHorizontal()?"right":"bottom",e=this.isHorizontal()?"width":"height";this.__updatePositioningHelper(b,d,e),this.__updatePositioningHelper(a,c,e)},updateChildVisibility:function(a){this._inherited(BetaJS.Views.ListContainerView,"updateChildVisibility",a),"computed"==this.__positioning&&this.__updatePositioning()}}),BetaJS.Views.View.extend("BetaJS.Views.SingleContainerView",{constructor:function(a){this._inherited(BetaJS.Views.SingleContainerView,"constructor",a),this.__view=null},getView:function(){return this.__view},setView:function(a){return this.removeChild(this.__view),a&&(a.setEl(""),this.__view=this.addChild(a)),a}}),BetaJS.Views.View.extend("BetaJS.Views.SwitchContainerView",{_templates:{item:BetaJS.Templates.Cached["switch-container-view-item-template"]},_notifications:{addChild:"__addChildContainer",removeChild:"__removeChildContainer"},constructor:function(a){this._inherited(BetaJS.Views.SwitchContainerView,"constructor",a),this.__selected=null},_render:function(){this.$el.html(""),BetaJS.Objs.iter(this.children(),function(a){this.__addChildContainer(a)},this)},__addChildContainer:function(a){this.isActive()&&this.$el.append(this.evaluateTemplate("item",{cid:a.cid()})),a.setEl("[data-view-id='"+a.cid()+"']"),this.__selected=this.__selected||a,a.setVisibility(this.__selected==a)},__removeChildContainer:function(a){this.$data({"view-id":a.cid()}).remove(),this.__selected==a&&(this.__selected=null)},select:function(a){this.__selected=a,BetaJS.Objs.iter(this.children(),function(a){a.setVisibility(this.__selected==a)},this)},selected:function(){return this.__selected}}),BetaJS.Views.ListContainerView.extend("BetaJS.Views.TabbedView",{constructor:function(a){a=BetaJS.Objs.extend(a||{},{alignment:"vertical",positioning:"none"}),this._inherited(BetaJS.Views.TabbedView,"constructor",a),this.toolbar=this.addChild(new BetaJS.Views.ToolBarView),this.container=this.addChild(new BetaJS.Views.SwitchContainerView),this.toolbar.on("item:click",function(a){this.select(a)},this),a.tabs&&BetaJS.Objs.iter(a.tabs,function(a){this.addTab(a)},this)},addTab:function(a){a=BetaJS.Objs.extend(a,{selectable:!0,deselect_all:!0});var b=this.toolbar.addItem(a);return b.__tabView=this.container.addChild(a.view),a.view.__tabButton=b,a.selected&&this.select(b),b.__tabView},select:function(a){var b=null;return b=BetaJS.Types.is_string(a)?this.toolbar.itemByIdent(a).__tabView:a.__tabButton?a:a.__tabView,this.container.select(b),b.__tabButton.select(),this.trigger("select",b),b}}),BetaJS.Views.View.extend("BetaJS.Views.ButtonView",{_dynamics:{"default":BetaJS.Templates.Cached["button-view-template"]},_css:function(){return{disabled:"","default":"",selected:""}},constructor:function(a){if(a=a||{},this._inherited(BetaJS.Views.ButtonView,"constructor",a),this._setOptionProperty(a,"label",""),this._setOptionProperty(a,"button_container_element","button"),this._setOptionProperty(a,"disabled",!1),this._setOptionProperty(a,"selected",!1),this._setOption(a,"selectable",!1),this._setOption(a,"deselect_all",!1),a.hotkey){var b={};b[a.hotkey]=function(){this.click()},this.add_module(new BetaJS.Views.Modules.Hotkeys({hotkeys:b}))}},_events:function(){return this._inherited(BetaJS.Views.ButtonView,"_events").concat([{"click [data-selector='button-inner']":"click"}])},click:function(){this.get("disabled")||(this.__selectable&&this.select(),this.trigger("click"))},_bindParent:function(a){a.on("deselect",function(){this.unselect()},this)},_unbindParent:function(a){a.off("deselect",this)},select:function(){this.__selectable&&(this.__deselect_all&&this.getParent().trigger("deselect"),this.getParent().trigger("select",this),this.set("selected",!0))},unselect:function(){this.__selectable&&this.set("selected",!1)},isSelected:function(){return this.get("selected")}}),BetaJS.Views.View.extend("BetaJS.Views.CheckBoxView",{_templates:{"default":BetaJS.Templates.Cached["check-box-view-template"]},_events:function(){return this._inherited(BetaJS.Views.ButtonView,"_events").concat([{"click input":"__click"}])},constructor:function(a){a=a||{},a.invalidate_on_change=!0,this._inherited(BetaJS.Views.CheckBoxView,"constructor",a),this._setOptionProperty(a,"checked",!1),this._setOptionProperty(a,"label","")},__click:function(){this.set("checked",this.$("input").is(":checked")),this.trigger("check",this.get("checked"))}}),BetaJS.Views.SwitchContainerView.extend("BetaJS.Views.InputLabelView",{constructor:function(a){this._inherited(BetaJS.Views.InputLabelView,"constructor",a),this._setOptionProperty(a,"value",""),this._setOptionProperty(a,"placeholder",""),this._setOption(a,"edit_on_click",!0),this._setOption(a,"label_mode",!0),this._setOption(a,"read_only",!1),this.label=this.addChild(new BetaJS.Views.LabelView({label:this.binding("value"),el_classes:a.label_el_classes,children_classes:a.label_children_classes})),this.input=this.addChild(new BetaJS.Views.InputView({value:this.binding("value"),placeholder:this.binding("placeholder")})),this.__label_mode||this.select(this.input),this.input.on("leave enter_key",function(){this.label_mode()},this),this.__edit_on_click&&this.label.on("click",function(){this.edit_mode()},this)},is_label_mode:function(){return this.__label_mode},is_edit_mode:function(){return!this.__label_mode},label_mode:function(){this.is_label_mode()||(this.__label_mode=!0,this.select(this.label))},edit_mode:function(){this.is_edit_mode()||this.__read_only||(this.__label_mode=!1,this.select(this.input),this.input.focus(!0))}}),BetaJS.Views.View.extend("BetaJS.Views.InputView",{_dynamics:{"default":BetaJS.Templates.Cached["input-view-template"]},_events:function(){return[{"blur input":"__leaveEvent","keyup input":"__changeEvent","change input":"__changeEvent","input input":"__changeEvent","paste input":"__changeEvent"},{"keyup input":"__keyupEvent"}]},constructor:function(a){this._inherited(BetaJS.Views.InputView,"constructor",a),this._setOptionProperty(a,"value",""),this._setOptionProperty(a,"placeholder",""),this._setOptionProperty(a,"clear_after_enter",!1),this._setOptionProperty(a,"horizontal_fill",!1),this._setOptionProperty(a,"input_type","text")},__keyupEvent:function(a){var b=a.keyCode||a.which;13==b&&(this.trigger("enter_key",this.get("value")),this.get("clear_after_enter")&&this.set("value",""))},__leaveEvent:function(){this.trigger("leave")},__changeEvent:function(){this.trigger("change",this.get("value"))},focus:function(a){this.$("input").focus(),this.$("input").focus(),a&&this.$("input").select()}}),BetaJS.Views.View.extend("BetaJS.Views.LabelView",{_dynamics:{"default":BetaJS.Templates.Cached["label-view-template"]},_css:function(){return{label:"label-view-class"}},_events:function(){return[{click:"__clickEvent"}]},constructor:function(a){this._inherited(BetaJS.Views.LabelView,"constructor",a),this._setOptionProperty(a,"label",""),this._setOptionProperty(a,"element","span")},__clickEvent:function(){this.trigger("click")}}),BetaJS.Views.View.extend("BetaJS.Views.LinkView",{_dynamics:{"default":BetaJS.Templates.Cached["link-view-template"]},constructor:function(a){this._inherited(BetaJS.Views.LinkView,"constructor",a),this._setOptionProperty(a,"label","")},_events:function(){return this._inherited(BetaJS.Views.LinkView,"_events").concat([{"click a":"__click"}])},__click:function(){this.trigger("click")}}),BetaJS.Views.View.extend("BetaJS.Views.ProgressView",{_templates:{"default":BetaJS.Templates.Cached["progress-template"]},_css:function(){return{outer:"",inner:""}},constructor:function(a){this._inherited(BetaJS.Views.ProgressView,"constructor",a),this._setOptionProperty(a,"label",""),this._setOptionProperty(a,"horizontal",!0),this._setOptionProperty(a,"value",1),this.on("change:value",function(a){this.isActive()&&this.$("[data-selector='inner']").css(this.get("horizontal")?"width":"height",100*a+"%")},this),this.on("change:label",function(a){this.isActive()&&this.$("[data-selector='label']").html(a)},this)}}),BetaJS.Views.View.extend("BetaJS.Views.TextAreaView",{_dynamics:{"default":BetaJS.Templates.Cached["text-area-template"]},constructor:function(a){this._inherited(BetaJS.Views.TextAreaView,"constructor",a),this._setOptionProperty(a,"value",""),this._setOptionProperty(a,"placeholder",""),this._setOptionProperty(a,"horizontal_resize",!1),this._setOptionProperty(a,"vertical_resize",!0),this._setOptionProperty(a,"horizontal_fill",!1),this._setOptionProperty(a,"readonly",!1),this.on("change:readonly",function(){this.get("readonly")?this.$("textarea").attr("readonly","readonly"):this.$("textarea").removeAttr("readonly")},this)},addLine:function(a){this.get("value")?this.set("value",this.get("value")+"\n"+a):this.set("value",a),this.scrollToEnd()},scrollToEnd:function(){var a=this.$("textarea").get(0);a.scrollTop=a.scrollHeight}}),BetaJS.Views.View.extend("BetaJS.Views.CustomListView",{_templates:function(){return{"default":BetaJS.Templates.Cached["list-view-template"],"item-container":BetaJS.Templates.Cached["list-view-item-container-template"]}},_supp:function(){return BetaJS.Objs.extend(this._inherited(BetaJS.Views.CustomListView,"_supp"),{list_item_attr:function(a){return this.attrs({"data-view-id":this.__context.cid(),"data-cid":BetaJS.Ids.objectId(a),"data-index":this.__context.__collection.getIndex(a)})}})},_notifications:{activate:"__activateItems",deactivate:"__deactivateItems"},_events:function(){return[{click:"__click"}]},constructor:function(a){if(this._inherited(BetaJS.Views.CustomListView,"constructor",a),this._setOption(a,"list_container_element","ul"),this._setOption(a,"list_container_attrs",{}),this._setOption(a,"list_container_classes",""),this._setOption(a,"item_container_element","li"),this._setOption(a,"item_container_classes",""),this._setOption(a,"selectable",!0),this._setOption(a,"multi_select",!1),this._setOption(a,"click_select",!1),this.__itemData={},"table"in a){var b=this.cls.parseType(a.table,"object");this.active_query=new BetaJS.Queries.ActiveQuery(b.active_query_engine(),{}),a.collection=this.active_query.collection(),a.destroy_collection=!0}if("compare"in a&&(a.compare=this.cls.parseType(a.compare,"function")),"collection"in a)this.__collection=a.collection,this.__destroy_collection="destroy_collection"in a?a.destroy_collection:!1,"compare"in a&&this.__collection.set_compare(a.compare);else{var c={};"objects"in a&&(c.objects=a.objects),"compare"in a&&(c.compare=a.compare),this.__collection=new BetaJS.Collections.Collection(c),this.__destroy_collection=!0}this.__collection.on("add",function(a){this._addItem(a)},this),this.__collection.on("remove",function(a){this._removeItem(a)},this),this.__collection.on("change",function(a){this._changeItem(a)},this),this.__collection.on("index",function(a,b){this.__updateItemIndex(a,b)},this),this.__collection.on("reindexed",function(a){this.__reIndexItem(a)},this),this.__collection.on("sorted",function(){this.__sort()},this),this.__collection.iterate(function(a){this._registerItem(a)},this)},destroy:function(){this.__collection.iterate(function(a){this._unregisterItem(a)},this),this.__collection.off(null,null,this),this.__destroy_collection&&this.__collection.destroy(),this._inherited(BetaJS.Views.CustomListView,"destroy")},_itemBySubElement:function(a){var b=a.closest("[data-view-id='"+this.cid()+"']");return 0===b.length?null:this.__collection.getById(b.attr("data-cid"))},__click:function(a){if(this.__click_select&&this.__selectable){var b=this._itemBySubElement(BetaJS.$(a.target));b&&this.select(b)}},collection:function(){return this.__collection},add:function(a){this.__collection.add(a)},remove:function(a){this.__collection.remove(a)},_render:function(){this.$selector_list=this._renderListContainer()},_renderListContainer:function(){return this.$el.html(this.evaluateTemplate("default",{list_container_element:this.__list_container_element,list_container_attrs:this.__list_container_attrs,list_container_classes:this.__list_container_classes})),this.$data({selector:"list"})},invalidate:function(){this.isActive()&&this.__deactivateItems(),this._inherited(BetaJS.Views.CustomListView,"invalidate"),this.isActive()&&this.__activateItems()},__activateItems:function(){this.__collection.iterate(function(a){this._activateItem(a)},this)},__deactivateItems:function(){this.__collection.iterate(function(a){this._deactivateItem(a)},this)},itemElement:function(a){return this.$data({"view-id":this.cid(),cid:BetaJS.Ids.objectId(a)},this.$selector_list)},_findIndexElement:function(a){return this.$data({"view-id":this.cid(),index:a},this.$selector_list)},_changeItem:function(){},__updateItemIndex:function(a,b){var c=this.itemElement(a);c.attr("data-index",b),this._updateItemIndex(a,c)},__reIndexItem:function(a){var b=this.itemElement(a),c=this.collection().getIndex(a);if(0===c)this.$selector_list.prepend(b);else{var d=this._findIndexElement(c-1);d.after(b)}},_updateItemIndex:function(){},__sort:function(){for(var a=this.collection().count()-1;a>=0;a--)this.$selector_list.prepend(this._findIndexElement(a))},itemData:function(a){return this.__itemData[a.cid()]},_registerItem:function(a){this.__itemData[a.cid()]={properties:new BetaJS.Properties.Properties({selected:!1,new_element:!1})}},_unregisterItem:function(a){this.__itemData[a.cid()]&&(this.__itemData[a.cid()].properties.destroy(),delete this.__itemData[a.cid()])},_activateItem:function(a){var b=this.evaluateTemplate("item-container",{item:a,item_container_element:this.__item_container_element,item_container_attrs:this.__item_container_attrs,item_container_classes:this.__item_container_classes}),c=this.__collection.getIndex(a);if(0===c)this.$selector_list.prepend(b);else{var d=this._findIndexElement(c-1);if(d.length>0)d.after(b);else{var e=this._findIndexElement(c+1);e.length>0?e.before(b):this.$selector_list.append(b)}}this.trigger("activate_item",a)},_deactivateItem:function(a){this.itemData(a).new_element=!1;var b=this.itemElement(a);b.remove()},_addItem:function(a){this._registerItem(a),this.isActive()&&(this.itemData(a).new_element=!0,this._activateItem(a))},_removeItem:function(a){this.isActive()&&this._deactivateItem(a),this._unregisterItem(a)},isSelected:function(a){return this.itemData(a).properties.get("selected")},select:function(a){var b=this.itemData(a);return this.__selectable&&!this.isSelected(a)&&(this.__multi_select||this.collection().iterate(function(a){this.unselect(a)},this),b.properties.set("selected",!0),this.trigger("select",a)),b},unselect:function(a){var b=this.itemData(a);return this.__selectable&&this.isSelected(a)&&(b.properties.set("selected",!1),this.trigger("unselect",a)),b}}),BetaJS.Views.CustomListView.extend("BetaJS.Views.ListView",{constructor:function(a){a=a||{},"item_template"in a&&(a.templates={item:a.item_template}),"item_dynamic"in a&&(a.dynamics={item:a.item_dynamic}),this._inherited(BetaJS.Views.ListView,"constructor",a),this._setOption(a,"item_label","label"),this._setOption(a,"render_item_on_change",BetaJS.Types.is_defined(this.dynamics("item")))},_changeItem:function(a){this._inherited(BetaJS.Views.ListView,"_changeItem",a),this.__render_item_on_change&&this.isActive()&&this._renderItem(a)},_activateItem:function(a){this._inherited(BetaJS.Views.ListView,"_activateItem",a),this._renderItem(a)},_renderItem:function(a){var b=this.itemElement(a),c=this.itemData(a).properties;this.templates("item")?b.html(this.evaluateTemplate("item",{item:a,properties:c})):this.dynamics("item")?this.evaluateDynamics("item",b,{item:a,properties:c},{name:"item-"+BetaJS.Ids.objectId(a)}):b.html(a.get(this.__item_label))},_deactivateItem:function(a){this.dynamics("item")&&this.dynamics("item").removeInstanceByName("item-"+BetaJS.Ids.objectId(a)),this._inherited(BetaJS.Views.ListView,"_deactivateItem",a)}}),BetaJS.Views.CustomListView.extend("BetaJS.Views.SubViewListView",{_sub_view:BetaJS.Views.View,_sub_view_options:function(a){return{item:a,item_properties:this.itemData(a).properties}},_property_map:function(){},constructor:function(a){this._inherited(BetaJS.Views.SubViewListView,"constructor",a),"create_view"in a&&(this._create_view=a.create_view),"sub_view"in a&&(this._sub_view=this.cls.parseType(a.sub_view,"object")),"sub_view_options"in a&&(this._sub_view_options_param=a.sub_view_options),"property_map"in a&&(this._property_map_param=a.property_map)},_create_view:function(a){var b=BetaJS.Objs.extend(BetaJS.Types.is_function(this._property_map)?this._property_map.apply(this,[a]):this._property_map,BetaJS.Types.is_function(this._property_map_param)?this._property_map_param.apply(this,[a]):this._property_map_param),c=BetaJS.Objs.extend(BetaJS.Types.is_function(this._sub_view_options)?this._sub_view_options.apply(this,[a]):this._sub_view_options,BetaJS.Objs.extend(BetaJS.Types.is_function(this._sub_view_options_param)?this._sub_view_options_param.apply(this,[a]):this._sub_view_options_param||{},BetaJS.Objs.map(b,a.get,a)));return c.el=this.itemElement(a),new this._sub_view(c)},_activateItem:function(a){this._inherited(BetaJS.Views.SubViewListView,"_activateItem",a);var b=this._create_view(a);this.delegateEvents(null,b,"item",[b,a]),this.itemData(a).view=b,this.addChild(b)},_deactivateItem:function(a){var b=this.itemData(a).view;this.removeChild(b),b.destroy(),this._inherited(BetaJS.Views.SubViewListView,"_deactivateItem",a)}}),BetaJS.Classes.Module.extend("BetaJS.Views.Modules.ListViewAnimation",{_register:function(a){a.on("activate_item",function(b){if(a.itemData(b).new_element){var c=a.itemElement(b);c.css("display","none"),c.fadeIn()}},this)}},{__singleton:null,singleton:function(){return this.__singleton||(this.__singleton=new this({auto_destroy:!1})),this.__singleton}}),BetaJS.Views.View.extend("BetaJS.Views.OverlayView",{_templates:{"default":BetaJS.Templates.Cached["overlay-view-template"]},constructor:function(a){a=a||{},a.anchor=a.anchor||"absolute",a.visible="visible"in a?a.visible:!1,a.children_classes=a.children_classes||[],BetaJS.Types.is_string(a.children_classes)&&(a.children_classes=a.children_classes.split(" ")),a.children_classes.push("overlay-container-class"),this._inherited(BetaJS.Views.OverlayView,"constructor",a),this._setOption(a,"anchor","none"),this._setOption(a,"element",""),this._setOption(a,"overlay_left",0),this._setOption(a,"overlay_top",0),this._setOption(a,"overlay_align_vertical","top"),this._setOption(a,"overlay_align_horizontal","left"),this._setOption(a,"element_align_vertical","bottom"),this._setOption(a,"element_align_horizontal","left"),a.overlay_inner&&(a.overlay_inner.setEl('[data-selector="container"]'),this.overlay_inner=this.addChild(a.overlay_inner)),"hide_on_leave"in a&&!a.hide_on_leave||this.add_module(BetaJS.Views.Modules.HideOnLeave.singleton()),this.on("show",this._after_show,this)},_after_show:function(){if("none"!=this.__anchor){var a=this.$(".overlay-container-class"),b=a.outerWidth(),c=a.outerHeight(),d=this.__overlay_left,e=this.__overlay_top;"bottom"==this.__overlay_align_vertical?e-=c:"center"==this.__overlay_align_vertical&&(e-=Math.round(c/2)),"right"==this.__overlay_align_horizontal?d-=b:"center"==this.__overlay_align_horizontal&&(d-=Math.round(b/2));var f=this.$el;"element"==this.__anchor&&this.__element&&(f=this.__element,BetaJS.Types.is_string(f)?f=BetaJS.$(f):BetaJS.Class.is_class_instance(f)&&(f=f.$el)),("relative"==this.__anchor||"element"==this.__anchor)&&(element_width=f.outerWidth(),element_height=f.outerHeight(),d+=f.offset().left-BetaJS.$(window).scrollLeft(),e+=f.offset().top-BetaJS.$(window).scrollTop(),"bottom"==this.__element_align_vertical?e+=element_height:"center"==this.__element_align_vertical&&(e+=Math.round(element_height/2)),"right"==this.__element_align_horizontal?d+=element_width:"center"==this.__element_align_horizontal&&(d+=Math.round(element_width/2))),a.css("left",d+"px"),a.css("top",e+"px")
}}}),BetaJS.Views.View.extend("BetaJS.Views.FullscreenOverlayView",{_templates:{"default":BetaJS.Templates.Cached["fullscreen-overlay-view-template"]},_events:function(){return[{'click [data-selector="outer"]':"unfocus",'touchstart [data-selector="outer"]':"unfocus"}]},constructor:function(a){a=a||{},a.el=a.el||"body",a.append_to_el="append_to_el"in a?a.append_to_el:!0,a.visible="visible"in a?a.visible:!1,this._inherited(BetaJS.Views.FullscreenOverlayView,"constructor",a),a.overlay_inner.setEl('[data-selector="inner"]'),this.overlay_inner=this.addChild(a.overlay_inner),this._setOption(a,"hide_on_unfocus",!0),this._setOption(a,"destroy_on_unfocus",!1),this.on("show",this._after_show,this),this.on("hide",this._after_hide,this)},_after_show:function(){var a=this.$('[data-selector="outer"]'),b=this.$('[data-selector="inner"]'),c=this.$('[data-selector="container"]');c.removeClass("fullscreen-overlay-float"),c.removeClass("fullscreen-overlay-fit");var d=a.outerWidth(),e=a.outerHeight(),f=b.outerWidth(),g=b.outerHeight(),h=Math.floor((d-f)/2),i=Math.floor((e-g)/2);h>=0&&i>=0?(c.css("left",h+"px"),c.css("top",i+"px"),c.addClass("fullscreen-overlay-float")):(c.css("left","0px"),c.css("top","0px"),c.addClass("fullscreen-overlay-fit")),BetaJS.$("body").addClass("fullscreen-overlay-body")},_after_hide:function(){BetaJS.$("body").removeClass("fullscreen-overlay-body")},unfocus:function(){this.__destroy_on_unfocus?this.destroy():this.__hide_on_unfocus&&this.hide()}}),BetaJS.Views.ListContainerView.extend("BetaJS.Views.FormControlView",{constructor:function(a){this._inherited(BetaJS.Views.FormControlView,"constructor",a),this._model=a.model,this._property=a.property,this._setOption(a,"validate_on_change",!1),this._setOption(a,"validate_on_show",!1),this._setOption(a,"error_classes",""),this.control_view=this.addChild(this._createControl(this._model,this._property,a.control_options||{})),this.label_view=this.addChild(new BetaJS.Views.LabelView(BetaJS.Objs.extend(a.label_options||{},{visible:!1}))),this.__validate_on_change&&this._model.on("change:"+this._property,this.validate,this),this.__validate_on_show&&this.on("show",this.validate,this),this._model.on("validate:"+this._property,this.validate,this)},validate:function(){if(this.isActive()){var a=this._model.validateAttr(this._property);this.label_view.setVisibility(!a),a?this.$el.removeClass(this.__error_classes):(this.$el.addClass(this.__error_classes),this.label_view.set("label",this._model.getError(this._property)))}},_createControl:function(){}}),BetaJS.Views.FormControlView.extend("BetaJS.Views.FormInputView",{_createControl:function(a,b,c){return new BetaJS.Views.InputView(BetaJS.Objs.extend(c,{value:a.binding(b)}))}}),BetaJS.Views.FormControlView.extend("BetaJS.Views.FormCheckBoxView",{_createControl:function(a,b,c){return new BetaJS.Views.CheckBoxView(BetaJS.Objs.extend(c,{checked:a.binding(b)}))}}),BetaJS.Views.ListContainerView.extend("BetaJS.Views.ToolBarView",{_css:function(){return{divider:"divider",group:"group"}},constructor:function(a){a=BetaJS.Objs.extend({clear_float:!0},a||{}),this._inherited(BetaJS.Views.ToolBarView,"constructor",a),this.__group_by_ident={},this.__item_by_ident={},a.groups&&BetaJS.Objs.iter(a.groups,function(a){this.addGroup(a)},this),a.items&&BetaJS.Objs.iter(a.items,function(a){this.addItem(a)},this)},__group_parent_options:BetaJS.Objs.objectify(["group_ident","group_type","group_options"]),addGroup:function(a){var b={group_type:"container"},c={};BetaJS.Objs.iter(a||{},function(a,d){d in this.__group_parent_options?b[d]=a:c[d]=a},this);var d=null;if("container"==b.group_type){if(c.el_classes=this.css("group"),d=this.addChild(new BetaJS.Views.ListContainerView(c),b),b.group_ident){if(b.group_ident in this.__group_by_ident)throw"Group identifier already registered: "+b.group_ident;this.__group_by_ident[b.group_ident]=d}return d}if("divider"!=b.group_type)throw"Unknown group type: "+b.group_type;return c.el_classes=this.css("divider"),d=this.addChild(new BetaJS.Views.View(c),b)},__item_parent_options:BetaJS.Objs.objectify(["item_ident","item_type","item_group"]),addItem:function(a){var b={item_type:"ButtonView"},c={};BetaJS.Objs.iter(a||{},function(a,d){d in this.__item_parent_options?b[d]=a:c[d]=a},this),b.item_type in BetaJS.Views&&(b.item_type=BetaJS.Views[b.item_type]),BetaJS.Types.is_string(b.item_type)&&(b.item_type=BetaJS.Scopes.resolve(b.item_type));var d=this;if(b.item_group){if(!(b.item_group in this.__group_by_ident))throw"Unknown group identifier: "+b.item_group;d=this.__group_by_ident[b.item_group];var e=this.childOptions(d);c=BetaJS.Objs.extend(e.group_options||{},c)}var f=d.addChild(new b.item_type(c),b);if(this.delegateEvents(null,f,"item",[f,b]),b.item_ident&&this.delegateEvents(null,f,"item-"+b.item_ident,[f,b]),b.item_ident){if(b.item_ident in this.__item_by_ident)throw"Item identifier already registered: "+b.item_ident;this.__item_by_ident[b.item_ident]=f}return f},itemByIdent:function(a){return this.__item_by_ident[a]}}),BetaJS.Templates.Cached=BetaJS.Templates.Cached||{},BetaJS.Templates.Cached["video-player-image-template"]='  <div class="video-player-outer" style="width: {%= meta.width %}px; height: {%= meta.height %}px">   <div class="video-player-inner">    {% if (meta.image) { %}     <img class="video-player-content"      src="{%= meta.image %}"      width="{%= meta.fit_width %}"      height="{%= meta.fit_height %}"      style="max-width: {%= meta.fit_width %}px; width: {%= meta.fit_width %}px; max-height: {%= meta.fit_height %}px; height: {%= meta.fit_height %}px"/>    {% } %}   </div>   <div data-selector="play-button"></div>   <div data-selector="status"></div>  </div> ',BetaJS.Templates.Cached["video-player-play-template"]='  <div data-selector="player" class="video-player-outer" style="width: {%= meta.width %}px; height: {%= meta.height %}px">   <div class="video-player-inner" style="width: 100%; height: 100%">    <div class="video-player-content" data-selector="inner-player" style="width: 100%; height: 100%">     <div id="player-{%= id %}"></div>    </div>   </div>  </div> ',BetaJS.Views.View.extend("BetaJS.Views.VideoPlayerImageView",{_templates:{"default":BetaJS.Templates.Cached["video-player-image-template"]},_notifications:{activate:"__activatePlayer"},constructor:function(a){var b=BetaJS.Views.VideoPlayerView.VideoMeta.get(a.meta);this.meta=b;var c=BetaJS.Objs.extend(BetaJS.Objs.clone(BetaJS.Types.is_function(BetaJS.Views.VideoPlayerImageView.defaultPlayButton)?BetaJS.Views.VideoPlayerImageView.defaultPlayButton():BetaJS.Views.VideoPlayerImageView.defaultPlayButton,1),a.styling||{});if(this._inherited(BetaJS.Views.VideoPlayerImageView,"constructor",a),c.play_button){BetaJS.Types.is_function(c.play_button_options)&&(c.play_button_options=c.play_button_options(b)),c.play_button_options.el="[data-selector='play-button']";var d=c.play_button_options;d.el_styles=d.el_styles||{},d.modules=d.modules||[],"center"==c.play_button_vertical_align?d.modules.push(BetaJS.Views.Modules.Centering.vertical()):"top"==c.play_button_vertical_align?d.el_styles.top=Math.floor(this.meta.height/50)+"px":"bottom"==c.play_button_vertical_align&&(d.el_styles.bottom=Math.floor(this.meta.height/50)+"px"),"center"==c.play_button_horizontal_align?d.modules.push(BetaJS.Views.Modules.Centering.horizontal()):"left"==c.play_button_horizontal_align?d.el_styles.left=Math.floor(this.meta.width/50)+"px":"right"==c.play_button_horizontal_align&&(d.el_styles.right=Math.floor(this.meta.width/50)+"px"),this.play_button=this.addChild(new c.play_button(d)),this.play_button.on("click",function(){this.trigger("play")},this)}this.status_view=this.addChild(new BetaJS.Views.LabelView({el_classes:"video-player-status",button_container_element:"div",el_styles:{"font-size":Math.round(Math.min(b.width,b.height)/20)+"px","line-height":Math.round(Math.min(b.width,b.height)/20+4)+"px"},vertical_center:!0,el:"[data-selector='status']",visible:!1}))},templateArguments:function(){return{meta:this.meta}},__updateDimensions:function(a,b){if(a/b!=this.meta.fit_width/this.meta.fit_height){var c=this.meta.asObject();c.video_width=a,c.video_height=b,this.meta=BetaJS.Views.VideoPlayerView.VideoMeta.get(c),this.invalidate(),this.$("img").css("top",Math.floor((this.meta.height-this.meta.fit_height)/2)+"px"),this.$("img").css("display","")}},__activatePlayer:function(){if(this.meta.updateDimensionByParent(this.$el.parent()),this.$el.width(this.meta.width),this.$el.height(this.meta.height),this.meta.image){this.$("img").css("top",Math.floor((this.meta.height-this.meta.fit_height)/2)+"px");var a=(this.$("img").get(0),new Image),b=this;a.onload=function(){b&&b.meta&&this.width&&this.height&&b.__updateDimensions(this.width,this.height)},a.onerror=function(){b.__image_error||(b.__image_error=!0,b.showStatus("Could not display cover shot.",!0),b.$("img").css("display","none"),b.trigger("image-error"))},a.src=this.meta.image}},showStatus:function(a,b){BetaJS.Types.is_undefined(b)&&(b=!0),this.status_view.set("label",a),this.status_view.show(),b&&this.play_button.hide()},hideStatus:function(){this.status_view.hide(),this.play_button.show()}}),BetaJS.Views.VideoPlayerImageView.defaultPlayButton={play_button:BetaJS.Views.LabelView,play_button_options:function(a){return{label:"&#9658;",el_classes:"view-player-play-label",el_styles:{"font-size":Math.floor(Math.min(a.width,a.height)/6)+"px","line-height":Math.floor(Math.min(a.width,a.height)/6)+"px",height:Math.floor(Math.min(a.width,a.height)/6)+"px",width:Math.floor(Math.min(a.width,a.height)/6)+"px"}}},play_button_vertical_align:"center",play_button_horizontal_align:"center"},BetaJS.Views.View.extend("BetaJS.Views.VideoPlayerPlayView",{_templates:{"default":BetaJS.Templates.Cached["video-player-play-template"]},_notifications:{activate:"__activatePlayer",deactivate:"detach"},constructor:function(a){this.raw_sources=a.sources,this.sources=BetaJS.Objs.map(a.sources,function(a){return BetaJS.Views.VideoPlayerView.Source.get(a)}),this.rules=a.rules||BetaJS.Views.VideoPlayerView._options.rules||[],this.meta=BetaJS.Views.VideoPlayerView.VideoMeta.get(a.meta),this.config=BetaJS.Objs.extend({auto_play:!1},a.config||{}),this._inherited(BetaJS.Views.VideoPlayerPlayView,"constructor",a)},templateArguments:function(){return{meta:this.meta,id:this.cid()}},__activatePlayer:function(){this.meta.updateDimensionByParent(this.$el.parent()),this.$el.width(this.meta.width),this.$el.height(this.meta.height),this.$("[data-selector='inner-player']").css("top",Math.floor((this.meta.height-this.meta.fit_height)/2)+"px"),this.config.auto_play&&this.play()},play:function(){this.player&&this.player.destroy(),this.player=null;var a=null,b=null;BetaJS.Objs.iter(this.rules,function(c){return BetaJS.Objs.iter(this.sources,function(d){return c.applies(d)?(a=c,b=d,!1):void 0},this)},this),a?(this.__source=b,this.__rule=a,this.trigger("select",b,a),this.player=a.new_player(b,"player-"+this.cid(),{auto_play:!0,width:this.meta.fit_width,height:this.meta.fit_height,video_width:this.meta.video_width,video_height:this.meta.video_height,image:this.meta.image}),this.delegateEvents(BetaJS.Views.VideoPlayerView.events,this.player),this.player.attach()):this.trigger("error","Could not play video.")},detach:function(){this.player&&(this.player.destroy(),this.player=null)},source:function(){return this.__source},rule:function(){return this.__rule}}),BetaJS.Views.ListContainerView.extend("BetaJS.Views.VideoPlayerView",{_notifications:{preactivate:"__preactivatePlayer",activate:"__activatePlayer"},constructor:function(a){a.alignment="vertical",a.positioning="none",this._inherited(BetaJS.Views.VideoPlayerView,"constructor",a);var b=BetaJS.Views.VideoPlayerView.VideoMeta.get(a.meta);this.meta=b,this.image_view=this.addChild(new BetaJS.Views.VideoPlayerImageView({meta:this.meta,styling:a.styling})),this.config=a.config||{auto_play:!1},this.play_view=this.addChild(new BetaJS.Views.VideoPlayerPlayView({rules:a.rules,sources:a.sources,meta:this.meta,visible:!1})),this.delegateEvents(BetaJS.Views.VideoPlayerView.events,this.play_view),this.image_view.on("play",function(){this.play()},this),this.image_view.on("image-error",function(){this.trigger("image-error")},this),this.on("error",function(a){this.image_view.show(),this.play_view.hide(),this.image_view.showStatus(a,!0)})},__preactivatePlayer:function(){this.meta.updateDimensionByParent(this.$el.parent()),this.$el.width(this.meta.width),this.$el.height(this.meta.height)},__activatePlayer:function(){this.config.auto_play&&this.play()},play:function(){this.image_view.hide(),this.play_view.show(),this.play_view.play()},stop:function(){this.play_view.detach(),this.play_view.hide(),this.image_view.show()},player:function(){return this.play_view}},{_options:{},setup:function(a){this._options=a}}),BetaJS.Views.VideoPlayerView.events=["play","params","error","select","pause","stop"],BetaJS.Views.FullscreenOverlayView.extend("BetaJS.Views.OverlayVideoPlayerView",{constructor:function(a){if(a.meta=BetaJS.Views.VideoPlayerView.VideoMeta.get(a.meta),a.meta.width&&a.meta.height&&(BetaJS.$(window).width()<a.meta.width||BetaJS.$(window).height()<a.meta.height)){var b=.85*BetaJS.$(window).width(),c=b*a.meta.height/a.meta.width;a.meta.width=b,a.meta.height=c}a.meta=a.meta.asObject();var d=new BetaJS.Views.VideoPlayerView({rules:a.rules,sources:a.sources,meta:a.meta,config:a.config||{auto_play:!0},styling:a.styling});a.overlay_inner=d,this._inherited(BetaJS.Views.OverlayVideoPlayerView,"constructor",a),this.delegateEvents(BetaJS.Views.VideoPlayerView.events,d),this.on("hide",function(){this.overlay_inner.stop()},this)},play:function(){this.overlay_inner.play()},player:function(){return this.overlay_inner.player()}}),BetaJS.Views.ListContainerView.extend("BetaJS.Views.ImageOverlayVideoPlayerView",{constructor:function(a){if(a.meta=BetaJS.Views.VideoPlayerView.VideoMeta.get(a.meta),a.meta.width&&a.meta.height&&(BetaJS.$(window).width()<a.meta.width||BetaJS.$(window).height()<a.meta.height)){var b=.85*BetaJS.$(window).width(),c=b*a.meta.height/a.meta.width;a.meta.width=b,a.meta.height=c}a.meta=a.meta.asObject(),a.alignment="vertical",a.positioning="none",this._inherited(BetaJS.Views.ImageOverlayVideoPlayerView,"constructor",a),this.overlay=this.addChild(new BetaJS.Views.OverlayVideoPlayerView({rules:a.rules,sources:a.sources,meta:a.meta,config:{auto_play:!1},styling:a.styling})),this.delegateEvents(BetaJS.Views.VideoPlayerView.events,this.overlay);var d=BetaJS.Objs.clone(a.meta,1);this.image=this.addChild(new BetaJS.Views.VideoPlayerImageView({meta:BetaJS.Objs.extend(d,a.image_meta||{}),styling:a.styling})),this.image.on("play",function(){this.play()},this)},play:function(){this.overlay.show(),this.overlay.play()},player:function(){return this.overlay.player()}}),BetaJS.Class.extend("BetaJS.Views.VideoPlayerView.Source",{constructor:function(a){if(this._inherited(BetaJS.Views.VideoPlayerView.Source,"constructor"),this.priority=a.priority||0,this.video=a.video,this.streamer=a.streamer,this.protocol=a.protocol,this.secure=a.secure||!1,this.port=a.port,this.uri=a.uri,this.domain=a.domain,this.path=a.path,this.file=a.file,this.uri){var b=this.cls.decomposeUri(this.uri);this.protocol=b.protocol,this.domain=b.domain,b.port&&(this.port=b.port),this.path=b.path,this.file=b.file}this.video||(this.video=this.cls.videoByFile(this.file)),this.protocol&&!this.streamer&&(this.streamer=this.cls.streamerByProtocolAndVideo(this.protocol,this.video)),!this.protocol&&this.streamer&&(this.protocol=this.cls.protocolByStreamerAndSecure(this.streamer,this.secure)),this.secure=this.cls.secureByProtocol[this.protocol],this.port||(this.port=this.cls.portByProtocol[this.protocol]),this.uri||(this.uri=this.cls.composeUri(this.protocol,this.domain,this.port,this.path,this.file)),this.extension=this.cls.videoByFile(this.file)}},{decomposeUri:function(a){var b=BetaJS.Net.Uri.parse(a);return{protocol:b.protocol,port:b.port,domain:b.host,path:b.directory,file:b.file}},videoByFile:function(a){return BetaJS.Strings.last_after(a,".")},streamerByProtocolAndVideo:function(a,b){return"m3u8"==b?"hls":this.streamerByProtocol[a]},protocolByStreamerAndSecure:function(a,b){return"hls"==a&&(a="http"),b?a+"s":a},streamerByProtocol:{rtmp:"rtmp",rtmps:"rtmp",rtsp:"rtsp",rtsps:"rtsp",http:"http",https:"http"},secureByProtocol:{rtmp:!1,rtmps:!0,rtsp:!1,rtsps:!0,http:!1,https:!0},portByProtocol:{rtmp:1935,rtmps:443,rtsp:1935,rtsps:443,http:80,https:443},composeUri:function(a,b,c,d,e){return a+"://"+b+":"+c+"/"+d+e},get:function(a){return BetaJS.Class.is_class_instance(a)?a:new this(BetaJS.Types.is_string(a)?{uri:a}:a)}}),BetaJS.Class.extend("BetaJS.Views.VideoPlayerView.VideoMeta",{constructor:function(a){this._inherited(BetaJS.Views.VideoPlayerView.VideoMeta,"constructor"),a=BetaJS.Objs.extend({fit:"minimize",responsive:!1},a||{}),this.__update(a),this.width=a.width,this.height=a.height,this.video_width=a.video_width,this.video_height=a.video_height,this.fit_width=a.fit_width,this.fit_height=a.fit_height,this.fit=a.fit,this.image=a.image,this.responsive=a.responsive},__update:function(a){if(a.width&&a.height&&a.video_width&&a.video_height||(a.width&&a.height?a.video_width?a.video_height=Math.floor(a.height*a.video_width/a.width):a.video_height?a.video_width=Math.floor(a.width*a.video_height/a.width):(a.video_width=a.width,a.video_height=a.height):a.width?a.height=Math.floor(a.video_height*a.width/a.video_width):a.height?a.width=Math.floor(a.video_width*a.height/a.video_width):(a.width=a.video_width,a.height=a.video_height)),a.fit_width=a.video_width,a.fit_height=a.video_height,!(a.video_width==a.width&&a.video_height==a.height||"minimize"!=a.fit&&"maximize"!=a.fit)){var b=a.video_width/a.video_height,c=a.width/a.height;(c-b)*("maximize"==a.fit?1:-1)>=0?(a.fit_width=a.width,a.fit_height=Math.floor(a.width/b)):(a.fit_width=Math.floor(a.height*b),a.fit_height=a.height)}},asObject:function(){return{width:this.width,height:this.height,video_width:this.video_width,video_height:this.video_height,fit_width:this.fit_width,fit_height:this.fit_height,fit:this.fit,image:this.image,responsive:this.responsive}},updateDimensionByParent:function(a){if(this.responsive){var b=parseInt(a.css("width"),10);if(b){var c=parseInt(a.css("height"),10);c||(c=Math.floor(b*this.height/this.width)),this.width=b,this.height=c,this.__update(this)}}}},{get:function(a){return BetaJS.Class.is_class_instance(a)?a:new this(a)}}),BetaJS.Class.extend("BetaJS.Views.VideoPlayerView.PlayerRule",{constructor:function(a){this._inherited(BetaJS.Views.VideoPlayerView.PlayerRule,"constructor"),this.__player=a.player,this.__applies=a.applies,this.__options=a.options||{}},applies:function(a){return this.__applies?this.__applies.apply(this,[a]):!1},player:function(){return this.__player},new_player:function(a,b,c){return new this.__player(a,b,BetaJS.Objs.extend(c,this.__options))}}),BetaJS.Class.extend("BetaJS.Views.VideoPlayerView.Players.Player",[BetaJS.Events.EventsMixin,{constructor:function(a,b,c){this._inherited(BetaJS.Views.VideoPlayerView.Players.Player,"constructor"),this._source=a,this._id=b,this._options=c},destroy:function(){this.detach(),this._inherited(BetaJS.Views.VideoPlayerView.Players.Player,"destroy")},attach:function(){},detach:function(){}}],{playername:function(){return BetaJS.Strings.last_after(this.classname,".")},setup:function(a){this._options=a}}),BetaJS.Views.VideoPlayerView.Players.Player.extend("BetaJS.Views.VideoPlayerView.Players.ErrorPlayer",{attach:function(){var a=BetaJS.$("#"+this._id);a.html("<div class='error-player-inner'>"+(this._options.error?this._options.error:"Unknown Player Error")+"</div>");var b=a.parent(),c=a.children(),d=parseInt(b.css("width"),10),e=parseInt(b.css("height"),10);a.css("font-size",Math.floor((d+e)/50)+"px"),a.addClass("error-player-outer"),c.css("padding-left",Math.floor(d/20)+"px"),c.css("padding-right",Math.floor(d/20)+"px"),c.css("padding-top",Math.floor(e/20)+"px"),c.css("padding-bottom",Math.floor(e/20)+"px")}}),BetaJS.Views.VideoPlayerView.Players.Player.extend("BetaJS.Views.VideoPlayerView.Players.JWPlayer",{_params:function(){},attach:function(){this.cls.loadPlayer(function(){var a=this._params(),b=a.autostart;a.autostart=BetaJS.Browser.Info.isMobile()&&a.autostart,this.trigger("params",a),jwplayer(this._id).setup(a);var c=this;jwplayer(this._id).onPlay(function(){c.trigger("play")}),jwplayer(this._id).onPause(function(){c.trigger("pause")}),jwplayer(this._id).onComplete(function(){c.trigger("stop")}),jwplayer(this._id).onError(function(a){c.trigger("error",a.message)}),b&&!a.autostart&&jwplayer(this._id).play()},this)},detach:function(){try{BetaJS.Browser.Info.isInternetExplorer()||jwplayer(this._id).remove()}catch(a){}}},{loadPlayer:function(a,b){window.jwplayer?a.apply(b):BetaJS.Browser.Loader.loadScript(this._options.src,function(){this._options.key&&(jwplayer.key=this._options.key),a.apply(b)},this)}}),BetaJS.Views.VideoPlayerView.Players.JWPlayer.extend("BetaJS.Views.VideoPlayerView.Players.JWPlayer6",{_params:function(){var a={file:this._source.uri};"mp4"==this._source.video&&this._source.extension!=this._source.video&&(a.type="mp4");var b={sources:[a],width:this._options.width,height:this._options.height,image:this._options.image,autostart:this._options.auto_play,menubar:!1,stretching:"maximize"==this._options.fit?"uniform":""};return BetaJS.Browser.Info.flash().installed()&&(b.primary="flash"),this.cls._options.swfsrc&&(b.flashplayer=this.cls._options.swfsrc),b}}),BetaJS.Views.VideoPlayerView.Players.JWPlayer.extend("BetaJS.Views.VideoPlayerView.Players.JWPlayer5",{_params:function(){var a={mode:"html5",file:this._source.uri,image:this._options.image,width:this._options.width,height:this._options.height,menubar:!1,autostart:this._options.auto_play};return this.cls._options.swfsrc&&(a.flashplayer=this.cls._options.swfsrc),a}}),BetaJS.Views.VideoPlayerView.Players.JWPlayer5.Rules={oldiOSRules:[new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"hls"==a.streamer&&"flv"!=a.video&&BetaJS.Browser.Info.isiOS()&&BetaJS.Browser.Info.iOSversion().major<5},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer5}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"http"==a.streamer&&"flv"!=a.video&&BetaJS.Browser.Info.isiOS()&&BetaJS.Browser.Info.iOSversion().major<5},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer5})]},BetaJS.Views.VideoPlayerView.Players.JWPlayer6.Rules={defaultRules:[new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"hls"==a.streamer&&"flv"!=a.video&&BetaJS.Browser.Info.isiOS()},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"http"==a.streamer&&"flv"!=a.video&&BetaJS.Browser.Info.isiOS()},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"http"==a.streamer&&BetaJS.Browser.Info.isAndroid()},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"hls"==a.streamer&&BetaJS.Browser.Info.isAndroid()},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"http"==a.streamer&&(BetaJS.Browser.Info.flash().installed()||"flv"!=a.video)&&BetaJS.Browser.Info.isMobile()},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"hls"==a.streamer&&BetaJS.Browser.Info.isMobile()},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"http"==a.streamer&&BetaJS.Browser.Info.isInternetExplorer()},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"flv"==a.video&&BetaJS.Browser.Info.flash().installed()},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"http"==a.streamer&&(BetaJS.Browser.Info.flash().installed()||"flv"!=a.video)},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"rtmp"==a.streamer&&BetaJS.Browser.Info.flash().installed()},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"rtsp"==a.streamer},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(a){return"hls"==a.streamer},player:BetaJS.Views.VideoPlayerView.Players.JWPlayer6})]},BetaJS.Views.VideoPlayerView.Players.JWPlayer56={},BetaJS.Views.VideoPlayerView.Players.JWPlayer56.IncompatabilityRules=[new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(){var a=BetaJS.Browser.Info.flash();return a.installed()&&!a.versionAtLeast(10)},player:BetaJS.Views.VideoPlayerView.Players.ErrorPlayer,options:{error:'To play this video, you need to update your version of Flash. <a href="http://get.adobe.com/flashplayer">Click here to update</a>.'}}),new BetaJS.Views.VideoPlayerView.PlayerRule({applies:function(){var a=BetaJS.Browser.Info;if(a.isMobile())return!1;var b=a.flash();return b.installed()||!b.supported()?!1:a.isWindows()?!a.isInternetExplorer()||a.internetExplorerVersion()<=9:a.isFirefox()||a.isOpera()?!0:!1},player:BetaJS.Views.VideoPlayerView.Players.ErrorPlayer,options:{error:'To play this video, you need to install Flash. <a href="http://get.adobe.com/flashplayer">Click here to install</a>.'}})],BetaJS.Views.VideoPlayerView.Players.JWPlayer56.Rules=BetaJS.Views.VideoPlayerView.Players.JWPlayer56.IncompatabilityRules.concat(BetaJS.Views.VideoPlayerView.Players.JWPlayer5.Rules.oldiOSRules.concat(BetaJS.Views.VideoPlayerView.Players.JWPlayer6.Rules.defaultRules)),function(){var a={__recorders:{},get:function(b){return b in this.__recorders||(this.__recorders[b]=new a.Recorder(b)),this.__recorders[b]},remove:function(a){delete this.__recorders[a]},__events:function(a){return this.get(a).__events},events:["debug","init","error","microphone_state","camera_state","security_flash_access","player_state","recorder_state"],apicalls:["config_get","config_set","microphone_info","microphone_state","microphone_get","microphone_set","microphone_bind","camera_info","camera_state","camera_get","camera_set","camera_bind","device_info","device_state","security_info","security_flash_acquire","player_state","player_activate","player_deactivate","player_play","player_pause","player_resume","player_stop","recorder_state","recorder_activate","recorder_deactivate","recorder_start","recorder_stop","recorder_show_snapshots","recorder_hide_snapshots","recorder_select_snapshot","recorder_light_level"]};a.Recorder=function(a){this.__selector=a,this.__bound=!1,this.__events={},this.__ready_callback=[],this.__bind()},a.Recorder.prototype.jquery=function(){return window.BetaJS?window.BetaJS.$:$||jQuery},a.Recorder.prototype.__bind=function(){if(!this.__bound){var b=0,c=this.jquery();if(this.__$selector=c(this.__selector),this.__$embed=this.__$selector.find("embed"),this.__embed=this.__$embed.get(0),BetaJS.Browser.Info.isInternetExplorer()&&BetaJS.Browser.Info.internetExplorerVersion()<=10&&(this.__embed=null),this.__embed||(this.__$embed=this.__$selector.find("object"),this.__embed=this.__$embed.get(0)),!this.__embed){var d=c("object");for(b=0;b<d.length;++b)c(d[b]).closest(this.__selector).length>0&&(this.__$embed=c("object"),this.__embed=this.__$embed.get(0))}if(this.__embed)for(this.__bound=!0,this.__ready=!1,b=0;b<a.events.length;++b)this.__add_event(a.events[b])}},a.Recorder.prototype.api=function(){return this.__bind(),this.__embed&&this.__ready?this.__embed:null},a.Recorder.prototype.__add_event=function(a){var b=this;this.__events[a]=function(){if("init"==a){b.__ready=!0;for(var c=0;c<b.__ready_callback.length;++c){var d=b.__ready_callback[c];d.callback.apply(d.context||b)}}b.__$selector.trigger("recorder_"+a,arguments)}},a.Recorder.prototype.ready=function(a,b){this.__ready?a.apply(b||this):this.__ready_callback.push({callback:a,context:b})},a.Recorder.prototype.on=function(a,b,c){this.__$selector.on("recorder_"+a,b,c)},a.Recorder.prototype.off=function(a,b,c){this.__$selector.off("recorder_"+a,b,c)},BetaJS?(BetaJS.Apis=BetaJS.Apis||{},BetaJS.Apis.VideoRecorder=a):window.BetaJSVideoRecorder=a}.call(),BetaJS.Templates.Cached=BetaJS.Templates.Cached||{},BetaJS.Templates.Cached["simple-video-recorder-template"]='  <object id="{%= id %}"   classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"   width="{%= recorder_width %}"   height="{%= recorder_height %}"   codebase="http://fpdownload.macromedia.com/get/flashplayer/current/swflash.cab">      <param name=FlashVars value="{%= params %}" />   <param name="movie" value="{%= recorder_swf %}{%= disable_swf_cache ? (\'?\' + BetaJS.Time.now()) : \'\' %}" />   <param name="quality" value="high" />   <param name="allowScriptAccess" value="always" />   <param name="bgcolor" value="{%= recorder_bg_color %}" />   <param name="wmode" value="opaque">    <embed    src="{%= recorder_swf %}{%= disable_swf_cache ? (\'?\' + BetaJS.Time.now()) : \'\' %}"    quality="high"    bgcolor="{%= recorder_bg_color %}"    wmode="opaque"    width="{%= recorder_width %}"    height="{%= recorder_height %}"    FlashVars="{%= params %}"    align="middle"    play="true"    loop="false"    allowScriptAccess="always"    type="application/x-shockwave-flash"    pluginspage="http://www.adobe.com/go/getflashplayer"   >   </embed>  </object> ',BetaJS.Templates.Cached["tutorial-template"]='  <div class="main-tutorial">   <p class="heading">How to Record a Video</p>   <ul style="font-size:{%= fontsize %}%">    <li>     Enable your camera from the <a href="javascript: {}" data-selector="tutorial-flash">Adobe Flash Player Settings</a>. Check <strong>Allow</strong> and click <strong>Close</strong>.    </li>    <li>     Next, check the sound. Say something until the <strong>Mic</strong> light turns green.    </li>    <li>     Click on <strong>Record</strong> to start recording. <strong>Stop</strong> when you\'re done.    </li>    <li>     <strong>Select a thumbnail</strong> to use as the display image for your video. Not happy? <strong>Re-record</strong> to start over.    </li>   </ul>   <p>    <a href="javascript: {}" data-selector="tutorial-close">Ok, got it.</a>   </p>  </div>  <div class="flash-tutorial" style="display: none">   <div class="flash-tutorial-image"></div>   <p class="flash-back-link">    <a href="javascript: {}" data-selector="tutorial-main">Ok, will do.</a>   </p>  </div> ',BetaJS.Templates.Cached["initial-template"]='  <div class="inner-container">   <p class="center"><a href="javascript: {}" data-selector="record-video"><i class="bjs-icon-videocam hero-img"></i></a></p>   <a href="javascript: {}" class="btn-primary" data-selector="record-video">{%= BetaJS.Locales.get(\'video_recorder.record_video\') %}</a>   <p><a href="javascript: {}" data-selector="upload-video" style="display: {%= external_upload ? "inline" : "none"%}"><i class="bjs-icon-upload"></i> {%= BetaJS.Locales.get(\'video_recorder.external_upload\') %} &nbsp; </a><a href="javascript: {}" data-selector="start-tutorial" style="display:none"> <i class="fa fa-star"></i> {%= BetaJS.Locales.get(\'video_recorder.tutorial\') %} </a></p>  </div> ',BetaJS.Templates.Cached["video-recorder-error-template"]='  <p class="error-label">{%= error %}</p>  <a href="javascript: {}" class="call-to-action" style="display: {%= call_to_action ? \'inline\' : \'none\' %}">{%= call_to_action %}</a> ',BetaJS.Templates.Cached["video-recorder-progress-template"]='  <p class="progress-label" {%= bind.inner(\'progress_label\') %}></p>  <i class="bjs-icon-spinner animate-spin progress-spinner"></i> ',BetaJS.Templates.Cached["video-recorder-device-popup-template"]='  {% for (var i = 0; i < items.length; ++i) { %}   <div class="radio">     <label>       <input type="radio" name="options-{%= supp.view_id %}" value="{%= i %}" {%= i == current ? \'checked\' : \'\' %}>       {%= items[i] %}     </label>   </div>  {% } %} ',BetaJS.Templates.Cached["video-uploader-upload-button-view-template"]='    {% if (form_fallback) { %}     <iframe id="iframe-{%= supp.view_id %}" name="iframe-{%= supp.view_id %}" style="display:none"></iframe>     <form method="POST" target="iframe-{%= supp.view_id %}" id="form-{%= supp.view_id %}">    {% } %}   <{%= button_container_element %} data-selector="button-inner" class="{%= supp.css("default") %}" style="color:white"    {%= bind.css_if("disabled", "disabled") %}>    <input type="file" name="file" class="video-uploader-upload-input" style="height:100%" {%= accept_string %} />    {%= label %}   </{%= button_container_element %}>    {% if (form_fallback) { %}   </form>    {% } %}  ',BetaJS.Templates.Cached["video-uploader-progress-template"]='   <p class="progress-label" {%= bind.inner(\'progress_label\') %}></p>   <i class="bjs-icon-spinner animate-spin progress-spinner"></i>  ',BetaJS.Templates.Cached["video-uploader-error-template"]='   <p class="error-label">{%= error %}</p>   <a href="javascript: {}" class="call-to-action" style="display: {%= call_to_action ? \'inline\' : \'none\' %}">{%= call_to_action %}</a>  ',BetaJS.Templates.Cached["video-uploader-upload-template"]='   <div class="inner-container">    <p class="center"><i class="fa {%= BetaJS.Browser.Info.isMobile() ? \'bjs-icon-videocam\' : \'bjs-icon-upload\' %} hero-img"></i></p>    <div data-selector="upload-video" style="position:relative"></div>    <p><a href="javascript: {}" data-selector="record-video" style="display: {%= external_record ? "inline" : "none"%}"><i class="fa bjs-icon-videocam"></i> {%= external_record_label %} &nbsp; </a></p>   </div>   <p class="progress-label" {%= bind.inner(\'progress_label\') %} style="display:none"></p>   <i class="bjs-icon-spinner animate-spin progress-spinner" style="display:none"></i>  ',BetaJS.Views.View.extend("BetaJS.Views.SimpleVideoRecorder",{_notifications:{activate:"__attach",deactivate:"__detach"},_templates:{"default":BetaJS.Templates.Cached["simple-video-recorder-template"]},constructor:function(a){this._inherited(BetaJS.Views.SimpleVideoRecorder,"constructor",a),this._setOption(a,"object",null),this._setOptionProperty(a,"recorder_width",640),this._setOptionProperty(a,"recorder_height",480),this._setOptionProperty(a,"responsive",!1),this._setOptionProperty(a,"camera_width",this.get("recorder_width")),this._setOptionProperty(a,"camera_height",this.get("recorder_height")),this._setOptionProperty(a,"camera_fps",30),this._setOptionProperty(a,"recorder_bg_color","#333333"),this._setOptionProperty(a,"initial_image",""),this._setOptionProperty(a,"recorder_swf","betajs-video-recorder.swf"),this._setOptionProperty(a,"disable_swf_cache",!1),this._setOptionProperty(a,"flip_video",!1),this._setOptionProperty(a,"snapshots",0),this._setOptionProperty(a,"snapshots_post",""),this._setOptionProperty(a,"snapshots_quality",90),this._setOptionProperty(a,"snapshots_type","jpg"),this.set("snapshot_config",BetaJS.Objs.extend({margin_percentage:.2,frame_percentage:.9},a.snapshot_config||{})),this.set("play_stream",BetaJS.Objs.extend({file_type:"mp4",server:"",file:"",vcodec:"h264",cookie:""},a.play_stream||{})),this.set("record_stream",BetaJS.Objs.extend({file_type:"mp4",server:"",file:"",vcodec:"h264",acodec:"nellymoser",cookie:""},a.record_stream||{}))
},__attach:function(){var a=this;this.__recorder=BetaJS.Apis.VideoRecorder.get(this.__object),this.__recorder.ready(function(){BetaJS.Objs.iter(BetaJS.Apis.VideoRecorder.events,function(b){this.__recorder.on(b,function(){var c=Array.prototype.slice.call(arguments,1);a.trigger.apply(a,[b].concat(c))})},this)},this)},__detach:function(){BetaJS.Apis.VideoRecorder.remove(this.__object),this.__object=null},recorder:function(){return this.__recorder},api:function(){return this.recorder().api()},_render:function(){if(this.get("responsive")){var a=parseInt(this.$el.parent().css("width"),10);if(a){var b=parseInt(this.$el.parent().css("height"),10);b||(b=Math.floor(a*this.get("recorder_height")/this.get("recorder_width"))),this.set("recorder_width",a),this.set("recorder_height",b)}}if(this.__object)this.$el.html(""),BetaJS.$(this.__object).detach().appendTo(this.$el),this.set("recorder_width",this.$("object").outerWidth()),this.set("recorder_height",this.$("object").outerheight());else{var c="video-recorder-view-"+this.cid(),d=BetaJS.Net.Uri.encodeUriParams({camera_width:this.get("camera_width"),camera_height:this.get("camera_height"),camera_fps:this.get("camera_fps"),initial_image:this.get("initial_image"),flip_video:this.get("flip_video"),snapshots:this.get("snapshots"),snapshots_post:this.get("snapshots_post"),snapshots_type:this.get("snapshots_type"),snapshots_quality:this.get("snapshots_quality"),play_stream:this.get("play_stream"),record_stream:this.get("record_stream"),js_namespace:"BetaJS.Apis.VideoRecorder.__events('#"+c+"')."});this.__object="#"+c,this.$el.html(this.evaluateTemplate("default",{id:c,params:d}))}}}),BetaJS.Views.ListContainerView.extend("BetaJS.Views.VideoRecorder",{_notifications:{activate:"__attach",deactivate:"__detach"},constructor:function(a){a=a||{},a.el_classes="video-recorder-outer",a.positioning="none",this._inherited(BetaJS.Views.VideoRecorder,"constructor",a),a=BetaJS.Objs.extend(BetaJS.Objs.clone(this.cls._options,1),a),this._setOptionProperty(a,"recording_countdown",0),this._setOptionProperty(a,"type","recorder"),this._setOptionProperty(a,"player_remaining_time",!1),this._setOptionProperty(a,"allow_rerecord",!0),this._setOptionProperty(a,"rerecord_limit",!1),this.set("can_record",this.computed(function(){return this.get("allow_rerecord")&&(this.get("rerecord_limit")===!1||this.get("rerecord_limit")>=0)},["allow_rerecord","rerecord_limit"])),this.set("can_rerecord",this.computed(function(){return this.get("allow_rerecord")&&(this.get("rerecord_limit")===!1||this.get("rerecord_limit")>0)},["allow_rerecord","rerecord_limit"])),this._setOptionProperty(a,"time_limit",null),this._setOptionProperty(a,"device_test",!0),this._setOptionProperty(a,"first_screen",!0),this._setOptionProperty(a,"face_outline",!1),this._setOptionProperty(a,"disable_timer",!1),this._setOptionProperty(a,"disable_snapshots",!1),this._setOptionProperty(a,"immediate_playback",!1),this._setOptionProperty(a,"snapshots",0),this._setOptionProperty(a,"snapshots_post",""),this.get("disable_snapshots")&&this.set("snapshots_post",""),this._setOptionProperty(a,"snapshots_type","jpg"),this._setOptionProperty(a,"snapshots_quality",90),this._setOptionProperty(a,"responsive",!1),this._setOptionProperty(a,"external_upload",!1),this._setOptionProperty(a,"play_stream",{}),this._setOptionProperty(a,"record_stream",{}),this._setOptionProperty(a,"margin_percentage",.3),this._setOptionProperty(a,"frame_percentage",.9),this.__simple_video_recorder=this.addChild(new BetaJS.Views.SimpleVideoRecorder({responsive:this.get("responsive"),recorder_width:a.recorder_width,recorder_height:a.recorder_height,camera_width:a.camera_width,camera_height:a.camera_height,camera_fps:a.camera_fps,recorder_swf:a.recorder_swf,disable_swf_cache:a.disable_swf_cache,recorder_bg_color:"#b4e0e3",initial_image:a.initial_image,snapshots:a.snapshots,snapshots_post:a.snapshots_post,snapshots_type:a.snapshots_type,snapshots_quality:a.snapshots_quality,snapshot_config:{margin_percentage:this.get("margin_percentage"),frame_percentage:this.get("frame_percentage")},flip_video:a.flip_video,play_stream:a.play_stream||{},record_stream:a.record_stream||{}})),this.__device_info=null,this.__device_state=null,this.events().on("init",function(a){this.__device_info=a.info,this.__device_state=a.state,this.__security_info=a.security},this),this.on("client_error",function(a){this.trigger("error","client",a)},this),this.on("server_error",function(a){this.trigger("error","server",a)},this),this.__waiting_for_flash_view=this.addChild(new BetaJS.Views.VideoRecorder.Views.WaitingForFlashView({parent:this,visible:!1,label:BetaJS.Locales.get("video_recorder.waiting_for_flash")})),this.__tutorial_view=this.addChild(new BetaJS.Views.VideoRecorder.Views.TutorialView({visible:!1,fontsize:Math.floor(100*a.recorder_width/640)})),this.__face_outline_view=this.addChild(new BetaJS.Views.View({parent:this,visible:!1,el_classes:"video-recorder-face-position"})),this.__state_host=this._auto_destroy(new BetaJS.States.Host),this.__state_host.view=this,this.__state_host.on("start",function(a){this.trigger("state",a),this.trigger("state:"+a)},this)},state:function(){return this.__state_host.state()},user_error:function(a){this.state().next("UserError",{error_msg:a})},events:function(){return this.__simple_video_recorder},recorderWidth:function(){return this.__simple_video_recorder.get("recorder_width")},recorderHeight:function(){return this.__simple_video_recorder.get("recorder_height")},_render:function(){if(this.get("responsive")){var a=parseInt(this.$el.parent().css("width"),10);if(a){var b=parseInt(this.$el.parent().css("height"),10);b||(b=Math.floor(a*this.get("recorder_height")/this.get("recorder_width"))),this.set("recorder_width",a),this.set("recorder_height",b)}}this._inherited(BetaJS.Views.VideoRecorder,"_render")},__attach:function(){this.__time_started=BetaJS.Time.now(),this.$el.css("width",this.recorderWidth()+"px"),this.$el.css("height",this.recorderHeight()+"px"),this.__state_host.initialize("BetaJS.Views.VideoRecorder.States.Init"),this.__timer=new BetaJS.Timers.Timer({delay:25,fire:this.__timer,context:this})},__detach:function(){this.__timer.destroy(),this.__state_host.finalize()},__timer:function(){this.api()&&this.trigger("timer")},recorder:function(){return this.__simple_video_recorder.recorder()},api:function(){var a=this.recorder().api();if(a){var b=Math.floor(1e5*Math.random());try{a.echo(b)!=b&&(a=null)}catch(c){a=null}}return this.__api_is_active&&!a&&(this.__api_is_active=!1,this.state()&&this.state().next("WaitingForFlash")),this.__api_is_active=!!a,this.__api_was_active=this.__api_was_active||this.__api_is_active,a},device_info:function(a){return a&&(this.__device_info=this.api().device_info()),this.__device_info},device_state:function(a){return a&&(this.__device_state=this.api().device_state()),this.__device_state},security_info:function(a){return a&&(this.__security_info=this.api().security_info()),this.__security_info},stop:function(){this.api().player_stop()},play:function(){this.api().player_play()},stopRecord:function(){this.state().stop_recording&&this.state().stop_recording()}},{_options:{},setup:function(a){this._options=BetaJS.Objs.extend(this._options,a)}}),BetaJS.Views.LabelView.extend("BetaJS.Views.VideoRecorder.Views.WaitingForFlashView",{constructor:function(a){var b=Math.min(a.parent.recorderWidth(),a.parent.recorderHeight());a.el_classes="video-recorder-waiting-for-flash-view",a.el_styles={"font-size":Math.round(b/15)+"px","line-height":Math.round(b/14)+"px"},this._inherited(BetaJS.Views.VideoRecorder.Views.WaitingForFlashView,"constructor",a)}}),BetaJS.Views.View.extend("BetaJS.Views.VideoRecorder.Views.SecurityView",{constructor:function(a){var b=243,c=136,d=80,e=94,f=116;a.el_classes=["video-recorder-security-"+a.side+"-view"],a.html="left"==a.side?"&#9312;&#8594;":"&#8592;&#9313;";var g=a.parent.recorderWidth(),h=(a.parent.recorderHeight(),Math.floor((g-b)/2/2/2)),i="left"==a.side?(d+e)/2:f;a.el_styles={"font-size":h+"px","line-height":h+"px","margin-top":Math.floor(i-c/2-h/2)+"px","margin-left":"4px","margin-right":"4px"},this._inherited(BetaJS.Views.VideoRecorder.Views.SecurityView,"constructor",a)}}),BetaJS.Views.View.extend("BetaJS.Views.VideoRecorder.Views.ChromeArrowView",{constructor:function(a){a.el_classes=[BetaJS.Browser.Info.isWindows()?"video-recorder-chrome-arrow-view-windows":"video-recorder-chrome-arrow-view-default"],a.el_styles={top:"0px"},a.html="&#8593;",this._inherited(BetaJS.Views.VideoRecorder.Views.ChromeArrowView,"constructor",a)}}),BetaJS.Views.LabelView.extend("BetaJS.Views.VideoRecorder.Views.CountdownView",{constructor:function(a){var b=Math.min(a.parent.recorderWidth(),a.parent.recorderHeight());this._inherited(BetaJS.Views.VideoRecorder.Views.CountdownView,"constructor",BetaJS.Objs.extend({el_classes:"video-recorder-countdown-view video-recorder-font",button_container_element:"div",el_styles:{width:Math.round(b/4)+"px",height:Math.round(b/4)+"px","line-height":Math.round(b/4)+"px","font-size":Math.round(b/8)+"px"},modules:[BetaJS.Views.Modules.Centering.both()]},a||{}))}}),BetaJS.Views.LabelView.extend("BetaJS.Views.VideoRecorder.Views.TimerView",{constructor:function(a){var b=Math.min(a.parent.recorderWidth(),a.parent.recorderHeight());this._inherited(BetaJS.Views.VideoRecorder.Views.TimerView,"constructor",BetaJS.Objs.extend({el_classes:"video-recorder-timer-view video-recorder-font",button_container_element:"div",el_styles:{"line-height":Math.round(b/16)+"px","font-size":Math.round(b/16)+"px"}},a||{})),this._setOptionProperty(a,"format","mmm:ss"),this._setOptionProperty(a,"time",0),this._setOptionProperty(a,"max_time",null),this.set("label",this.computed(function(){var a=this.get("time");return this.get("max_time")&&(a=this.get("max_time")-a),BetaJS.Time.formatTime(a,this.get("format"))},["format","time","max_time"]))}}),BetaJS.Views.View.extend("BetaJS.Views.VideoRecorder.Views.BlinkingRecordView",{constructor:function(a){Math.min(a.parent.recorderWidth(),a.parent.recorderHeight());this._inherited(BetaJS.Views.VideoRecorder.Views.BlinkingRecordView,"constructor",BetaJS.Objs.extend({html:"<div></div>",children_classes:"video-recorder-blinking-record",children_styles:{width:"10px",height:"10px"}},a||{})),this.__timer=new BetaJS.Timers.Timer({delay:500,context:this,fire:this.__fire})},destroy:function(){this.__timer.destroy(),this._inherited(BetaJS.Views.VideoRecorder.Views.BlinkingRecordView,"destroy")},__fire:function(){this.isActive()&&this.$el.css("visibility","hidden"==this.$el.css("visibility")?"visible":"hidden")}}),BetaJS.Views.ButtonView.extend("BetaJS.Views.VideoRecorder.Views.BarButtonView",{constructor:function(a){var b=a.parent.recorderWidth(),c=a.parent.recorderHeight(),d=Math.round(Math.min(b,c)/15);this._inherited(BetaJS.Views.VideoRecorder.Views.BarButtonView,"constructor",BetaJS.Objs.extend({css:{"default":"video-recorder-bar-button-view",disabled:"video-recorder-bar-button-view-disabled"},button_container_element:"div",children_styles:{"line-height":d+"px","min-width":d+"px","font-size":Math.round(d/2)+"px"}},a||{}))}}),BetaJS.Views.ListContainerView.extend("BetaJS.Views.VideoRecorder.Views.ButtonBarView",{constructor:function(a){a.parent.recorderWidth(),a.parent.recorderHeight();this._inherited(BetaJS.Views.VideoRecorder.Views.ButtonBarView,"constructor",BetaJS.Objs.extend({el_classes:"video-recorder-button-bar-view",positioning:"float",modules:[BetaJS.Views.Modules.Centering.horizontal()]},a||{}))}}),BetaJS.Views.ProgressView.extend("BetaJS.Views.VideoRecorder.Views.ProgressBarView",{constructor:function(a){var b=a.parent.recorderHeight(),c=Math.round(b/12);this._inherited(BetaJS.Views.VideoRecorder.Views.ProgressBarView,"constructor",BetaJS.Objs.extend({el_classes:"video-recorder-progress-bar",children_styles:{"font-size":c+"px","line-height":c+"px"},css:{outer:"video-recorder-progress-bar-outer",inner:"video-recorder-progress-bar-inner"}},a||{}))}}),BetaJS.Views.ListContainerView.extend("BetaJS.Views.VideoRecorder.Views.SnapshotFramesView",{constructor:function(a){this._inherited(BetaJS.Views.VideoRecorder.Views.SnapshotFramesView,"constructor");for(var b=a.parent.get("margin_percentage"),c=1-b,d=a.parent.get("frame_percentage"),e=1-d,f=this,g=a.parent.recorderWidth(),h=a.parent.recorderHeight(),i=a.number,j=Math.ceil(Math.sqrt(i)),k=j,l=b/2*g,m=b/2*h,n=c*d*g/j,o=c*d*h/k,p=c*e*g/(j+1),q=c*e*h/(k+1),r=0;k>r;++r)for(var s=0;j>s;++s){var t=s+r*j;i>t&&this.addChild(new BetaJS.Views.ButtonView({properties:{index:t},el_styles:{left:Math.floor(l+p*(s+1)+n*s-4)+"px",top:Math.floor(m+q*(r+1)+o*r-4)+"px",width:Math.floor(n)+"px",height:Math.floor(o)+"px"},el_classes:"video-recorder-snapshot-frame-view"+(BetaJS.Browser.Info.isInternetExplorer()?"-ie":""),button_container_element:"div",children_styles:{height:"100%"}})).on("click",function(){f.trigger("click",this.get("index"))})}}}),BetaJS.Views.View.extend("BetaJS.Views.VideoRecorder.Views.TutorialView",{_templates:{"default":BetaJS.Templates.Cached["tutorial-template"]},_events:{"click [data-selector='tutorial-close']":"__close_tutorial","click [data-selector='tutorial-flash']":"__flash_tutorial","click [data-selector='tutorial-main']":"__main_tutorial"},constructor:function(a){a=a||{},a.el_classes=["video-recorder-tutorial"],this._inherited(BetaJS.Views.VideoRecorder.Views.TutorialView,"constructor",a),this._setOptionProperty(a,"fontsize",!1)},__close_tutorial:function(){this.hide()},__flash_tutorial:function(){this.$(".main-tutorial").hide(),this.$(".flash-tutorial").show()},__main_tutorial:function(){this.$(".flash-tutorial").hide(),this.$(".main-tutorial").show()}}),BetaJS.Views.View.extend("BetaJS.Views.VideoRecorder.Views.InitialView",{_templates:{"default":BetaJS.Templates.Cached["initial-template"]},_events:{"click [data-selector='record-video']":"__record_video","click [data-selector='upload-video']":"__upload_video","click [data-selector='start-tutorial']":"__start_tutorial"},constructor:function(a){a=a||{},a.el_classes=["video-recorder-initial"],this._inherited(BetaJS.Views.VideoRecorder.Views.InitialView,"constructor",a),this.set("external_upload",a.parent.get("external_upload"))},__record_video:function(){this.trigger("record")},__upload_video:function(){this.trigger("upload")},__start_tutorial:function(){this.trigger("tutorial")}}),BetaJS.Views.View.extend("BetaJS.Views.VideoRecorder.Views.ProgressView",{_dynamics:{"default":BetaJS.Templates.Cached["video-recorder-progress-template"]},constructor:function(a){a=a||{},a.el_classes=["video-recorder-progress"],this._inherited(BetaJS.Views.VideoRecorder.Views.ProgressView,"constructor",a),this._setOptionProperty(a,"progress",0),this._setOptionProperty(a,"label","Label"),this.set("progress_label",this.computed(function(){return this.get("label")+(Math.floor(100*this.get("progress"))>0?": "+Math.floor(100*this.get("progress"))+"%":"...")},["progress","label"]))}}),BetaJS.Views.View.extend("BetaJS.Views.VideoRecorder.Views.ErrorView",{_templates:{"default":BetaJS.Templates.Cached["video-recorder-error-template"]},_events:{"click .call-to-action":"__call_to_action"},constructor:function(a){a=a||{},a.el_classes=["video-recorder-error"],this._inherited(BetaJS.Views.VideoRecorder.Views.ErrorView,"constructor",a),this._setOptionProperty(a,"error",""),this._setOptionProperty(a,"call_to_action","")},__call_to_action:function(){this.trigger("call_to_action")}}),BetaJS.Views.LabelView.extend("BetaJS.Views.VideoRecorder.Views.SimpleMessageView",{constructor:function(a){var b=Math.min(a.parent.recorderWidth(),a.parent.recorderHeight());a.el_classes="video-recorder-simple-message-view",a.el_styles=BetaJS.Objs.extend({"font-size":Math.round(b/15)+"px","line-height":Math.round(b/14)+"px"},a.el_styles),this._inherited(BetaJS.Views.VideoRecorder.Views.MessageView,"constructor",a)}}),BetaJS.Views.View.extend("BetaJS.Views.VideoRecorder.Views.DevicePopupView",{_templates:{"default":BetaJS.Templates.Cached["video-recorder-device-popup-template"]},_events:{"change input":"__submit"},__submit:function(){this.trigger("submit",this.$el.find(":checked").val())}}),BetaJS.States.State.extend("BetaJS.Views.VideoRecorder.States.State",{constructor:function(a,b,c){this._inherited(BetaJS.Views.VideoRecorder.States.State,"constructor",a,b,c),this.__view=a.view,this.__views=[]},_:function(a){return BetaJS.Locales.get("video_recorder."+a)},view:function(){return this.__view},events:function(){return this.__view.events()},_start_time:function(){return this.__start_time},_elapsed_time:function(){return BetaJS.Time.ago(this.__start_time)},api:function(){return this.__view.api()},device_info:function(a){return this.__view.device_info(a)},device_state:function(a){return this.__view.device_state(a)},security_info:function(a){return this.__view.security_info(a)},_timer_state:function(){},_start_state:function(){},_end_state:function(){},_timer:function(){this._timer_state()},_start:function(){this.__start_time=BetaJS.Time.now(),this.__view.on("timer",function(){if(this._started&&!this._stopped)try{this._timer()}catch(a){}},this),this._start_state()},_end:function(){this._end_state(),BetaJS.Objs.iter(this.__views,function(a){a.destroy()},this),this.__view.events().off(null,null,this),this.__view.off(null,null,this)},addView:function(a,b){b=b||{},b.parent=this.__view;var c=this.__view.addChild(new a(b));return this.__views.push(c),c}}),BetaJS.Locales.register({flash_not_supported:"Sorry, you can't use this device to record your video (Flash is required).",flash_not_installed:'To record yourself on video, you need to install Flash. <a href="http://get.adobe.com/flashplayer">Click here to install</a>.',flash_old_version:'To record yourself on video, you need to update your version of Flash. <a href="http://get.adobe.com/flashplayer">Click here to update</a>.',no_camera:"Sorry, we could not detect a camera on your device. Please use a device with a working camera.",no_microphone:"Sorry, we could not detect a microphone on your device. Please use a device with a working microphone.",no_visual:"Sorry, we cannot see you.",no_sound:"Sorry, we cannot hear you.",browser_permission:"We need access to your camera and microphone.",microphone_test:"Testing Microphone...",camera_test:"Testing Camera...",say_something:"Say something so we can test your microphone.",also_try_different_camera:"You can also try to select a different camera.",try_different_camera:"Try to select a different camera.",try_different_microphone:"Try to select a different microphone.",record_label:"Record",recording_get_ready:"Get Ready...",uploading_label:"Uploading",microphone_settings:"Microphone settings",camera_settings:"Camera settings",camera_light_level:"Your lighting is fairly poor",external_upload:"Upload Video",tutorial:"New? Read the tutorial.",unsupported_video_type:"Please upload: %s",recording_start:"Go!",recording_starts_in:"Starts in",record_video:"Record your Video",stop_recording:"Stop",select_snapshot:"Pick a Thumbnail",uploading_video:"Your video is being uploaded",rerecord_label:"Re-record?",rerecord_confirm:"Are you sure you want to re-record your video?",abort_record:"Wait",rerecord_affirmation:"Don't worry, you can always re-record.",rerecord_multiple_affirmation:"Don't worry, you can re-record %d more times.",rerecord_double_affirmation:"Don't worry, you can re-record twice.",rerecord_single_affirmation:"Don't worry, you can re-record one more time.",rerecord_immediately:"Re-record",waiting_for_flash:"Waiting for Flash. Try clicking at the top of this box to activate.",select_file_action:"Upload your Video",select_file_action_mobile:"Record your Video",reselect_file_action:"Re-upload your Video",reselect_file_action_mobile:"Re-record your Video",external_record_label:"Record your Video",try_again:"Try again?",processing_label:"Processing",uploading_file_failed:"Uploading failed, please try again.",could_not_process_file:"We could not process your video, please try again.",device_unsupported:"Your device is currently not supported. We are very sorry."},"video_recorder"),BetaJS.Locales.register({flash_not_supported:"Dieses Ger&auml;t kann leider nicht verwendet werden (Flash wird ben&ouml;tigt).",flash_not_installed:'Um ein Video aufnehmen zu k&ouml;nnen, muss Flash installiert werden. <a href="http://get.adobe.com/flashplayer">Jetzt installieren</a>.',flash_old_version:'Um ein Video aufnehmen zu k&ouml;nnen, muss Flash aktualisiert werden. <a href="http://get.adobe.com/flashplayer">Jetzt aktualisieren</a>.',no_camera:"Wir konnten keine Kamera finden. Bitte verwenden Sie einen Computer mit installierter Kamera.",no_microphone:"Wir konnten kein Mikrofon finden. Bitte verwenden Sie einen Computer mit installierten Mikrofon.",no_visual:"Wir k&ouml;nnen leider kein Bild empfangen.",no_sound:"Wir k&ouml;nnen leider kein Audio h&ouml;ren.",browser_permission:"Wir ben&ouml;tigen Zugriff auf Ihre Kamera und Ihr Mikrofon.",microphone_test:"Teste Mikrofon...",camera_test:"Teste Kamera...",say_something:"Bitte sagen Sie etwas, damit wir Ihr Mikrofon testen k&ouml;nnen.",also_try_different_camera:"Sie k&ouml;nnen auch versuchen, eine andere Kamera auszuw&auml;hlen.",try_different_camera:"Versuchen Sie bitte eine andere Kamera auszuw&auml;hlen.",try_different_microphone:"Versuchen Sie bitte ein anderes Mikrofon auszuw&auml;hlen.",record_label:"Aufnehmen",recording_get_ready:"Und...",microphone_settings:"Mikrofoneinstellungen",camera_settings:"Kamera-Einstellungen",camera_light_level:"Lichtqualtit&auml; eingeschr&auml;nkt",uploading_label:"Hochladen",external_upload:"Video hochladen",tutorial:"Neu hier? Tutorial lesen (auf Englisch).",recording_start:"Los!",recording_starts_in:"Los geht's in",record_video:"Video aufnehmen",stop_recording:"Stopp",select_snapshot:"Bild ausw&auml;hlen",uploading_video:"Ihr video wird hochgeladen",rerecord_label:"Nochmal aufnehmen?",rerecord_confirm:"Sind Sie sicher, dass Sie Ihr Video noch einmal aufnehmen wollen?",abort_record:"Warte!",rerecord_affirmation:"Keine Sorge, Sie k&ouml;nnen immer wieder aufnehmen.",rerecord_multiple_affirmation:"Keine Sorge, Sie k&ouml;nnen %d weitere Aufnahmen anlegen.",rerecord_double_affirmation:"Keine Sorge, Sie k&ouml;nnen noch zwei weitere Versuche aufnehmen.",rerecord_single_affirmation:"Keine Sorge, Sie k&ouml;nnen noch einen weiteren Versuch aufnehmen.",rerecord_immediately:"Nochmal aufnehmen?",waiting_for_flash:"Flash reagiert nicht. Sie m&uuml;ssen m&ouml;glicherweise oberhalb dieser Nachricht clicken, um die Energiesparfeatures Ihres Browsers zu deaktivieren.",select_file_action:"Video hochladen",select_file_action_mobile:"Video aufnehmen",reselect_file_action:"Video erneut hochladen",reselect_file_action_mobile:"Video erneut aufnehmen",external_record_label:"Video aufnehmen",try_again:"Nochmal versuchen?",processing_label:"Verarbeiten",uploading_file_failed:"Hochladen fehlgeschlagen, bitte versuchen Sie es erneut.",could_not_process_file:"Wir konnten Ihr Video nicht verarbeiten, bitte versuchen Sie es erneut.",device_unsupported:"Ihr Ger&auml;t wird derzeit nicht unterst&uuml;tzt."},"de.video_recorder"),BetaJS.Locales.register({flash_not_supported:"Lo sentimos, no puede usar este dispositivo para grabar el video (se requiere Flash).",flash_not_installed:'Para grabarse en video, debe instalar Flash. <a href="http://get.adobe.com/flashplayer">Haga clic aqu&iacute; para instalar</a>.',flash_old_version:'Para grabarse en video, debe actualizar la versi&oacute;n de Flash. <a href="http://get.adobe.com/flashplayer">Haga clic aqu&iacute; para actualizar</a>.',no_camera:"Lo sentimos, no se detect&oacute; una c&aacute;mara en el dispositivo. Use un dispositivo con una c&aacute;mara que funcione.",no_microphone:"Lo sentimos, no se detect&oacute; un micr&oacute;fono en el dispositivo. Use un dispositivo con un micr&oacute;fono que funcione.",no_visual:"Lo sentimos, no podemos verlo.",no_sound:"Lo sentimos, no podemos escucharlo.",browser_permission:"Necesitamos acceso a su c&aacute;mara y micr&oacute;fono.",microphone_test:"Probando micr&oacute;fono...",camera_test:"Probando c&aacute;mara...",say_something:"Diga algo para que podamos probar su micr&oacute;fono.",also_try_different_camera:"Tambi&eacute;n puede tratar de seleccionar una c&aacute;mara diferente.",try_different_camera:"Trate de seleccionar una c&aacute;mara diferente.",try_different_microphone:"Trate de seleccionar un micr&oacute;fono diferente.",record_label:"Grabar",recording_get_ready:"Prep&aacute;rese...",uploading_label:"Cargando",microphone_settings:"Configuraci&oacute;n del micr&oacoute;fono",camera_settings:"Ajustes de la c&aacute;mara",camera_light_level:"La falta de iluminaci&oacoute;n",external_upload:"Quiero cargar un video.",tutorial:"New? Read the tutorial (english).",recording_start:"&iexcl;Ya!",recording_starts_in:"Comienza dentro de",record_video:"Grabar",stop_recording:"Parar.",select_snapshot:"Seleccione una instant&aacute;nea",uploading_video:"Su video se est&aacute; cargando",rerecord_label:"&iquest;Volver a grabar?",rerecord_confirm:"&iquest;Est&aacute; seguro de que desea volver a grabar su video?",abort_record:"&iexcl;Espere!",rerecord_affirmation:"No se preocupe, siempre puede volver a grabar.",rerecord_multiple_affirmation:"No se preocupe, puede volver a grabar %d m&aacute;s veces.",rerecord_double_affirmation:"No se preocupe, puede volver a grabar dos veces.",rerecord_single_affirmation:"No se preocupe, puede volver a grabar una vez m&aacute;s.",rerecord_immediately:"D&eacute;jeme volver a grabarlo.",waiting_for_flash:"Esperando que Flash se reactive. Es posible que deba hacer clic sobre este mensaje para desactivar las caracter&iacute;sticas de ahorro de energ&iacute;a del explorador.",select_file_action:"Seleccionar",select_file_action_mobile:"Grabar",reselect_file_action:"Reseleccionar",reselect_file_action_mobile:"Regrabar",external_record_label:"Grabar",try_again:"&iquest;Intentarlo de nuevo?",processing_label:"Procesamiento",uploading_file_failed:"Error al cargar, vuelva a intentarlo.",could_not_process_file:"No pudimos procesar su video, vuelva a intentarlo.",device_unsupported:"Actualmente su dispositivo no es compatible. Lo sentimos mucho."},"es.video_recorder"),BetaJS.Locales.register({flash_not_supported:"Ci dispiace, non &egrave; possibile utilizzare questo dispositivo per registrare il video (&egrave; necessario Flash).",flash_not_installed:'Per registrare un video &egrave; necessario installare Flash. <a href="http://get.adobe.com/flashplayer">Clicca qui per installarlo</a>.',flash_old_version:'Per registrare un video &egrave; necessario aggiornare la versione di Flash. <a href="http://get.adobe.com/flashplayer">Clicca qui per aggiornare</a>.',no_camera:"Ci dispiace, non abbiamo potuto rilevare una fotocamera sul dispositivo. Si prega di utilizzare un dispositivo con una fotocamera funzionante.",no_microphone:"Ci dispiace, non abbiamo potuto rilevare un microfono sul dispositivo. Si prega di utilizzare un dispositivo con un microfono funzionante.",no_visual:"Ci dispiace, non riusciamo a vederti.",no_sound:"Ci dispiace, non riusciamo a sentirti.",browser_permission:"Abbiamo bisogno di accedere alla tua fotocamera e al tuo microfono.",microphone_test:"Testando il microfono...",camera_test:"Testando la fotocamera...",say_something:"Di' qualcosa cosi da poter testare il microfono.",also_try_different_camera:"Puoi anche provare a selezionare un'altra fotocamera.",try_different_camera:"Prova a selezionare un'altra fotocamera.",try_different_microphone:"Prova a selezionare un altro microfono.",record_label:"Registra",recording_get_ready:"Preparati...",uploading_label:"Caricamento",microphone_settings:"Impostazioni del microfono",camera_settings:"Impostazioni della fotocamera",camera_light_level:"La scarsa illuminazione",external_upload:"Carica Video",tutorial:"Nuovo utente? Leggi il tutorial.",recording_start:"Vai!",recording_starts_in:"Inizia in",record_video:"Registra un Video",stop_recording:"Stop",select_snapshot:"Seleziona un'immagine",uploading_video:"Il tuo video &egrave; in fase di caricamento",rerecord_label:"Registrare di nuovo?",rerecord_confirm:"Sei sicuro di voler registrare nuovamente il video?",abort_record:"Attendere",rerecord_affirmation:"Non ti preoccupare, &egrave; possibile registrare nuovamente il video",rerecord_multiple_affirmation:"Non ti preoccupare, &egrave; possibile registrare il video altre %d volte.",rerecord_double_affirmation:"Non ti preoccupare, &egrave; possibile registrare il video altre due volte.",rerecord_single_affirmation:"Non ti preoccupare, &egrave; possibile reigistrare il video ancora una volta.",rerecord_immediately:"Registra di nuovo",waiting_for_flash:"In attesa di Flash. Potrebbe essere necessario cliccare sulla parte superiore del registratore per disattivare le funzioni di risparmio energetico del tuo browser.",select_file_action:"Carica il tuo Video",select_file_action_mobile:"Registra un Video",reselect_file_action:"Carica nuovamente il tuo Video",reselect_file_action_mobile:"Registra nuovamente un Video",external_record_label:"Registra un Video",try_again:"Riprova",processing_label:"Elaborazione in corso",uploading_file_failed:"Caricamento non riuscito, si prega di riprovare.",could_not_process_file:"Non abbiamo potuto elaborare il tuo video, si prega di riprovare.",device_unsupported:"Il tuo dispositivo non e' al momento supportato, ci scusiamo per l'inconveniente."},"it.video_recorder"),BetaJS.Locales.register({flash_not_supported:"Du kan inte anv&auml;nda denna enheten f&ouml;r att spela in din video (Flash kr&auml;vs).",flash_not_installed:'F&ouml;r att spela in dig sj&auml;lv kr&auml;vs det att du installerar Flash. <a href="http://get.adobe.com/flashplayer">Klicka h&auml;r f&ouml;r att installera</a>.',flash_old_version:'F&ouml;r att spela in dig sj&auml;lv kr&auml;vs det att du uppdaterar din version av Flash. <a href="http://get.adobe.com/flashplayer">Klicka h&auml;r f&ouml;r att uppdatera</a>.',no_camera:"Ingen kamera hittades. V&auml;nligen anv&auml;nd en enhet med fungerande kamera f&ouml;r att spela in din video.",no_microphone:"Ingen mikrofon hittades. V&auml;nligen anv&auml;nd en enhet med fungerande mikrofon f&ouml;r att spela in din video.",no_visual:"Ledsen, vi kan inte se dig.",no_sound:"Ledsen, vi kan inte h&ouml;ra dig.",browser_permission:"Vi beh&ouml;ver tillg&aring;ng till din kamera och mikrofon.",microphone_test:"Testar Mikrofon...",camera_test:"Testar Kamera...",say_something:"S&auml;g n&aring;nting s&aring; att vi kan testa mikrofonen.",also_try_different_camera:"Du kan &auml;ven testa att anv&auml;nda en annan kamera.",try_different_camera:"Testa att anv&auml;nda en annna kamera.",try_different_microphone:"Testa att anv&auml;nda en annan mikrofon.",record_label:"Spela in",recording_get_ready:"G&ouml;r dig redo...",uploading_label:"Laddar upp",microphone_settings:"Mikrofoninst&auml;llningar",camera_settings:"Kamerainst&auml;llningar",camera_light_level:"Din ljuss&auml;ttning &auml;r ganska d&aring;lig",external_upload:"Ladda upp video",tutorial:"Ny? L&auml;s guiden.",unsupported_video_type:"V&auml;nligen ladda upp: %s",recording_start:"K&ouml;r!",recording_starts_in:"Startar om",record_video:"Spela in din video",stop_recording:"Stopp",select_snapshot:"V&auml;lj en miniatyrbild",uploading_video:"Din video laddas upp",rerecord_label:"Omtagning?",rerecord_confirm:"Ã„r du s&auml;ker p&aring; att du vill g&ouml;ra omtagning p&aring; din video?",abort_record:"V&auml;nta",rerecord_affirmation:"Oroa dig inte, du kan alltid g&ouml;ra en omtagning",rerecord_multiple_affirmation:"Oroa dig inte, du kan g&ouml;ra omtagning %d g&aring;nger till.",rerecord_double_affirmation:"Oroa dig inte, du kan g&ouml;ra tv&aring; omtagningar till.",rerecord_single_affirmation:"Oroa dig inte, du kan g&ouml;ra en omtagning till.",rerecord_immediately:"Omtagning",waiting_for_flash:"V&auml;ntar p&aring; Flash. Testa att klicka p&aring; toppen av denna box f&ouml;r att aktivera.",select_file_action:"Ladda upp din video.",select_file_action_mobile:"Spela in din video.",reselect_file_action:"Ladda upp din video igen.",reselect_file_action_mobile:"Spela in din video igen",external_record_label:"Spela in din video",try_again:"F&ouml;rs&ouml;k igen?",processing_label:"Bearbetar",uploading_file_failed:"Uppladdning misslyckades, v&auml;nligen f&ouml;rs&ouml;k igen.",could_not_process_file:"Vi kunde inte bearbeta din video, v&auml;nligen f&ouml;rsk igen.",device_unsupported:"Tyv&auml;rr s&aring; st&ouml;ds inte din enhet f&ouml;r tillf&auml;llet. Vi ber om urs&auml;kt f&ouml;r detta."},"se.video_recorder"),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.WaitingForFlash",{_start_state:function(){this.view().__waiting_for_flash_view.show()
},_timer_state:function(){this.api()&&this.next("Init")},_end_state:function(){this.view().__waiting_for_flash_view.hide()}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.Init",{_start_state:function(){if(this.view().__screen_height=window.innerHeight,!this.view().get("first_screen")||"player"==this.view().get("type")){var a=BetaJS.Browser.Info.flash();return a.installed()&&a.versionAtLeast(11)?this.next("FlashOkay"):this.next("FlashFailed"),void 0}var b=this.addView(BetaJS.Views.VideoRecorder.Views.InitialView,{parent:this.view()});b.on("record",function(){var a=BetaJS.Browser.Info.flash();a.installed()&&a.versionAtLeast(11)?this.next("FlashOkay"):this.next("FlashFailed")},this),b.on("upload",function(){this.view().trigger("external_upload")},this),b.on("tutorial",function(){this.view().__tutorial_view.show()},this)}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.ErrorState",{_locals:["error_message","call_to_action"],_start_state:function(){this.addView(BetaJS.Views.VideoRecorder.Views.ErrorView,{error:this._error_message,call_to_action:this._call_to_action})}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.FlashFailed",{_start_state:function(){var a=BetaJS.Browser.Info.flash();a.supported()?a.installed()?(this.view().trigger("client_error",this._("flash_old_version")),this.next("ErrorState",{error_message:this._("flash_old_version")})):(this.view().trigger("client_error",this._("flash_not_installed")),this.next("ErrorState",{error_message:this._("flash_not_installed")})):(this.view().trigger("client_error",this._("flash_not_supported")),this.next("ErrorState",{error_message:this._("flash_not_supported")}))}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.FlashOkay",{_timer_state:function(){this.api()&&this.device_info()&&this.device_state()&&this.next("Attached")}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.Attached",{_start_state:function(){"recorder"==this.view().get("type")?this.next("RecorderDeviceCheck"):this.next("PlayerReady")}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.RecorderDeviceCheck",{_start_state:function(){this.device_info(!0).camera.has&&this.device_info().microphone.has?this.next("RecorderSecurityCheck"):this.next("RecorderDeviceFailed")}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.RecorderDeviceFailed",{_start_state:function(){this.device_info().camera.has?(this.next("ErrorState",{error_message:this._("no_microphone")}),this.view().trigger("client_error",this._("no_microphone"))):(this.next("ErrorState",{error_message:this._("no_camera")}),this.view().trigger("client_error",this._("no_camera")))}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.UserError",{_locals:["error_msg"],_start_state:function(){this.next("ErrorState",{error_message:this._error_msg})}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.RecorderSecurityCheck",{_start_state:function(){return this.view().__screen_height=window.innerHeight,"granted"==this.security_info(!0).flash_access?(this.next("RecorderSecurityOkay"),void 0):(this.addView(BetaJS.Views.VideoRecorder.Views.SecurityView,{side:"left"}),this.addView(BetaJS.Views.VideoRecorder.Views.SecurityView,{side:"right"}),this.events().on("security_flash_access",function(a){"granted"==a&&this.next("RecorderSecurityOkay")},this),this.api().security_flash_acquire(),void 0)}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.RecorderSecurityOkay",{_start_state:function(){this.next("RecorderDeviceReady")}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.RecorderDeviceReady",{_start_state:function(){var a=this;this.__added_arrow=!1,this.api().microphone_bind("test"),this.api().camera_bind("test"),this.view().get("face_outline")&&this.view().__face_outline_view.show(),this.__dashboard_under=this.addView(BetaJS.Views.View,{el_classes:"video-recorder-dashboard-under"}),this.__dashboard=this.addView(BetaJS.Views.ListContainerView,{el_classes:"video-recorder-dashboard"}),this.record_button_view=this.__dashboard.addChild(new BetaJS.Views.ButtonView({label:this._("record_label"),el_classes:["video-recorder"],css:{"default":"btn"},children_styles:{position:"inherit"},el_styles:{"float":"right"},disabled:this.view().get("device_test")})),this.__message_under=this.addView(BetaJS.Views.View,{el_classes:"video-recorder-message-under",visible:!1}),this.__message=this.addView(BetaJS.Views.LabelView,{el_classes:"video-recorder-message",visible:!1}),this.__set_message=function(a){this.__message.set("label",a),this.__message_under.setVisibility(!!a),this.__message.setVisibility(!!a)},this.cam_button_view=this.__dashboard.addChild(new BetaJS.Views.ButtonView({label:'<i class="bjs-icon-cog"></i>',el_classes:["video-recorder"],css:{"default":"btn-link",selected:"active"},children_styles:{position:"inherit"},el_styles:{"float":"left"}})),this.mic_button_view=this.__dashboard.addChild(new BetaJS.Views.ButtonView({label:'Mic <i class="bjs-icon-circle off"></i>',el_classes:["video-recorder"],css:{"default":"btn-link",selected:"active"},children_styles:{position:"inherit"},el_styles:{"float":"left"}}));var b=this.device_info(!0);this.mic_select_view=this.__dashboard.addChild(new BetaJS.Views.VideoRecorder.Views.DevicePopupView({el_classes:"video-recorder input-options mic off",visible:!1,properties:{items:b.microphone.names,current:b.microphone.current}})),this.cam_select_view=this.__dashboard.addChild(new BetaJS.Views.VideoRecorder.Views.DevicePopupView({el_classes:"video-recorder input-options settings",visible:!1,properties:{items:b.camera.names,current:b.camera.current}})),this.mic_button_view.on("click",function(){this.mic_button_view.set("selected",!this.mic_button_view.get("selected"))},this),this.cam_button_view.$el.on("click",function(){a.cam_button_view.set("selected",!a.cam_button_view.get("selected"))}),this.mic_button_view.on("change:selected",function(a){this.mic_select_view.setVisibility(a),a&&this.cam_button_view.set("selected",!1)},this),this.cam_button_view.on("change:selected",function(a){this.cam_select_view.setVisibility(a),a&&this.mic_button_view.set("selected",!1)},this),this.cam_select_view.on("submit",function(a){this.api().camera_set(a),this.api().camera_bind("test"),this.cam_button_view.set("selected",!1)},this),this.mic_select_view.on("submit",function(a){this.api().microphone_set(a),this.api().microphone_bind("test"),this.mic_button_view.set("selected",!1)},this),this.record_button_view.$el.on("mouseenter",function(){if(a._elapsed_time()>=2e3){{var b=a.device_state(!0);a.device_info().camera.count>1}if("active"!=b.camera.status)return a.__set_message(a._("try_different_camera")),void 0;if("active"!=b.microphone.status)return a.__set_message(a._("say_something")),void 0}if(!a.record_button_view.get("disabled")){var c=a.view().get("rerecord_limit");c===!1?a.__set_message(a._("rerecord_affirmation")):1==c?a.__set_message(a._("rerecord_single_affirmation")):2==c?a.__set_message(a._("rerecord_double_affirmation")):a.__set_message(a._("rerecord_multiple_affirmation").replace("%d",c))}}),this.record_button_view.$el.on("mouseleave",function(){a.__set_message("")}),this.record_button_view.on("click",function(){this.record()},this),this.cam_button_view.$el.on("mouseenter",function(){var b=a.device_state(!0),c=a.device_info().camera.count>1,d="active"==b.camera.status;if(d){var e=a.api().recorder_light_level();e>=100&&200>=e||1>=e||e>=254?a.__set_message(a._("camera_settings")):a.__set_message(a._("camera_light_level"))}else a._elapsed_time()<2e3&&a.chrome_view?a.__set_message(a._("browser_permission")):c?a.__set_message(a._("try_different_camera")):a.__set_message(a._("browser_permission"))}),this.cam_button_view.$el.on("mouseleave",function(){a.__set_message("")}),this.mic_button_view.$el.on("mouseenter",function(){var b=a.device_state(!0),c="active"==b.microphone.status;c?a.__set_message(a._("microphone_settings")):a._elapsed_time()<2e3?a.__set_message(a._("microphone_test")):a._elapsed_time()<8e3?a.__set_message(a._("say_something")):a.__set_message(a._("no_sound")+(a.device_info().microphone.count>1?" "+a._("try_different_microphone"):""))}),this.mic_button_view.$el.on("mouseleave",function(){a.__set_message("")}),this.__light_level=!0},record:function(){this.next("RecorderBeforeRecording")},_timer_state:function(){!this.chrome_view&&BetaJS.Browser.Info.isChrome()&&window.innerHeight!=this.view().__screen_height&&(this.view().get("face_outline")&&this.view().__face_outline_view.hide(),this.chrome_view=this.addView(BetaJS.Views.VideoRecorder.Views.ChromeArrowView));var a=this.device_state(!0),b="active"==a.camera.status,c="active"==a.microphone.status;c&&this.mic_button_view.$el.find("i").removeClass("off"),(b&&c||window.innerHeight==this.view().__screen_height)&&this.chrome_view&&(this.chrome_view.setVisibility(!1),this.view().get("face_outline")&&this.view().__face_outline_view.show()),b&&c&&this.record_button_view.set("disabled",!1);var d=this.api().recorder_light_level(),e=d>=100&&200>=d||1>=d||d>=254;e!=this.__light_level&&(this.__light_level=e,this.__light_level?this.cam_button_view.$el.find("button").html('<i class="bjs-icon-cog"></i>'):this.cam_button_view.$el.find("button").html('Light <i class="bjs-icon-circle off"></i>'))}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.RecorderBeforeRecording",{_start_state:function(){return this.api().microphone_bind("test"),this.api().camera_bind("test"),this.__dashboard_under=this.addView(BetaJS.Views.View,{el_classes:"video-recorder-dashboard-under"}),this.__dashboard=this.addView(BetaJS.Views.ListContainerView,{el_classes:"video-recorder-dashboard"}),this.stop_button_view=this.__dashboard.addChild(new BetaJS.Views.ButtonView({label:this._("abort_record"),el_classes:["video-recorder"],css:{"default":"btn on"},children_styles:{position:"inherit"},el_styles:{"float":"right"}})),this.countdown_view=this.__dashboard.addChild(new BetaJS.Views.LabelView({label:this._("recording_starts_in")+" "+this.view().get("recording_countdown"),el_classes:"video-recorder-font",el_styles:{"float":"right",padding:"15px 15px 15px 15px","font-size":"16px"}})),this.stop_button_view.on("click",function(){this.next("RecorderDeviceReady")},this),this.view().get("recording_countdown")?void 0:(this.next("RecorderRecording"),void 0)},_timer_state:function(){var a=1e3*this.view().get("recording_countdown")-this._elapsed_time();a>0&&this.view().trigger("countdown",a),this.countdown_view.set("label",a>=0?this._("recording_starts_in")+" "+Math.ceil(a/1e3):this._("recording_get_ready")),0>=a&&this.next("RecorderRecording")}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.RecorderRecording",{_start_state:function(){this.__dashboard_under=this.addView(BetaJS.Views.View,{el_classes:"video-recorder-dashboard-under"}),this.__dashboard=this.addView(BetaJS.Views.ListContainerView,{el_classes:"video-recorder-dashboard"}),this.stop_button_view=this.__dashboard.addChild(new BetaJS.Views.ButtonView({label:this._("recording_get_ready"),el_classes:["video-recorder"],css:{"default":"btn on"},children_styles:{position:"inherit"},el_styles:{"float":"right"}})),this.__time=null,this.countdown_view=this.__dashboard.addChild(new BetaJS.Views.LabelView({label:"",el_classes:"video-recorder-font",el_styles:{"float":"right",padding:"15px 15px 15px 15px","font-size":"16px"}})),this.timer_view=this.__dashboard.addChild(new BetaJS.Views.VideoRecorder.Views.TimerView({parent:this.view(),max_time:this.view().get("time_limit")?1e3*this.view().get("time_limit"):null,time:0,visible:!1,el_styles:{"float":"right",padding:"15px 15px 15px 15px","font-size":"16px"},el_classes:"video-recorder-font"})),this.blinking_record_view=this.__dashboard.addChild(new BetaJS.Views.VideoRecorder.Views.BlinkingRecordView({parent:this.view(),visible:!1,el_styles:{"float":"left",padding:"20px"}})),this.stop_button_view.on("click",function(){this.stop_recording()},this),this.events().on("error",function(a){this.view().trigger("server_error",a),this.timer_view.hide(),this.blinking_record_view.hide(),this.countdown_view.hide(),this.api().recorder_stop(),this.next("ErrorState",{error_message:a})},this),this.events().on("recorder_state",function(a){"none"==a&&this.stop_button_view.set("disabled",!0),"connecting"==a&&this.stop_button_view.set("disabled",!0),"active"==a&&(this.stop_button_view.set("disabled",!0),this.api().recorder_start()),"recording"==a&&(this.stop_button_view.set("label",this._("recording_start")),this.stop_button_view.$el.children().css("background-color","green"),this.countdown_view.hide(),this.blinking_record_view.show(),this.view().get("disable_timer")||this.timer_view.show(),this.__time=BetaJS.Time.now())},this),this.api().recorder_activate()},_timer_state:function(){if(this.__time){var a=BetaJS.Time.now()-this.__time;this.timer_view.set("time",a),this.view().trigger("elapsed",a),this.view().get("time_limit")&&a>=1e3*this.view().get("time_limit")&&this.stop_recording(),a>1500&&(this.stop_button_view.$el.children().css("background-color",""),this.stop_button_view.set("disabled",!1),this.stop_button_view.set("label",this._("stop_recording")))}},stop_recording:function(){this.api().recorder_stop();var a=BetaJS.Time.now()-this.__time;if(this.view()._duration=a,this.view().__face_outline_view.hide(),this.view().trigger("recording_finished"),this.view().get("disable_snapshots")){var b=this.api().recorder_state();b.snapshots_count>0&&this.api().recorder_select_snapshot(Math.floor(b.snapshots_count/2)),this.next("RecorderUploading")}else this.next("RecorderSnapshotSelection")}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.RecorderSnapshotSelection",{_start_state:function(){var a=this.api().recorder_state();return 0===a.snapshots_count?(this.next("RecorderUploading"),void 0):(this.api().recorder_show_snapshots(),this.view().get("can_record")&&(this.rerecord_button_view=this.addView(BetaJS.Views.ButtonView,{label:"&#8592; "+this._("rerecord_immediately"),el_classes:["video-recorder"],css:{"default":"btn-outline"},children_styles:{bottom:"-6px",left:"-6px"}}),this.rerecord_button_view.on("click",function(){confirm(this._("rerecord_confirm"))&&(this.view().set("type","recorder"),this.view().trigger("recording_discarded"),this.api().recorder_hide_snapshots(),this.api().recorder_deactivate(),this.next("RecorderDeviceReady"))},this)),this.__message_under=this.addView(BetaJS.Views.View,{el_classes:"video-recorder-message-under"}),this.__message=this.addView(BetaJS.Views.LabelView,{el_classes:"video-recorder-message",label:this._("select_snapshot")}),this.addView(BetaJS.Views.VideoRecorder.Views.SnapshotFramesView,{number:a.snapshots_count}).on("click",function(a){this.api().recorder_select_snapshot(a),this.next("RecorderUploading")},this),void 0)},_end_state:function(){this.api().recorder_hide_snapshots()}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.RecorderUploading",{_start_state:function(){var a=this.api().recorder_state();return"finished"==a.status&&(a.snapshot_uploaded||this.view().get("disable_snapshots"))?(this.__finished(),void 0):(this.__processing_view=this.addView(BetaJS.Views.VideoRecorder.Views.ProgressView,{label:this._("uploading_label"),progress:0}),this.__start_time=BetaJS.Time.now(),void 0)},_timer_state:function(){var a=this.api().recorder_state();if("finished"==a.status&&(a.snapshot_uploaded||this.view().get("disable_snapshots")))return this.__finished(),void 0;if("error"==a.status)return this.progress_bar_view.hide(),this.next("ErrorState",{error_message:a.error}),void 0;if(a.uploading_total>0&&a.elapsed_uploading_time>0&&a.uploading_transferred>0){var b=BetaJS.Time.now();if(this.__time){if(this.__uploading_transferred_last!=a.uploading_transferred){if(this.__uploading_transferred_last=a.uploading_transferred,this.__uploading_transferred_rate=a.uploading_transferred/a.elapsed_uploading_time,this.__last_delta_time=b-this.__delta_start,this.__last_delta_time>0){var c=a.uploading_transferred-this.__uploading_transferred_current;this.__uploading_transferred_rate=Math.max(this.__uploading_transferred_rate/2,this.__uploading_transferred_rate+c/this.__last_delta_time)}this.__delta_start=b}}else this.__time=b,this.__delta_start=b,this.__uploading_transferred_last=a.uploading_transferred,this.__uploading_transferred_current=a.uploading_transferred,this.__uploading_transferred_rate=a.uploading_transferred/a.elapsed_uploading_time;var d=b-this.__time;this.__uploading_transferred_rate>0&&d<=this.__last_delta_time&&(this.__uploading_transferred_current=Math.min(a.uploading_total,this.__uploading_transferred_current+this.__uploading_transferred_rate*d)),this.__time=b;{a.elapsed_uploading_time*(a.uploading_total-this.__uploading_transferred_current)/this.__uploading_transferred_current}this.__processing_view.set("progress",this.__uploading_transferred_current/a.uploading_total)}else if(!a.snapshot_uploaded){var e=BetaJS.Time.now();if(this.__snapshot_time){var f=e-this.__snapshot_time;if(f>0){var g=1-1/(1+Math.sqrt(Math.sqrt(f/1e3)));this.__processing_view.set("progress",g)}}else this.__snapshot_time=e}},__finished:function(){if(!this.__finished_called){this.__finished_called=!0,this.view().set("type","player"),this.view().get("rerecord_limit")!==!1&&this.view().set("rerecord_limit",this.view().get("rerecord_limit")-1);var a=Math.max(2e3-(BetaJS.Time.now()-this.__start_time),0),b=this;a>0?setTimeout(function(){b.__finished_finished()},a):b.__finished_finished()}},__finished_finished:function(){this.api().recorder_deactivate(),this.view().trigger("recording_submitted",{duration:this.view()._duration}),"next"in this&&this.next("Attached")}}),BetaJS.Views.VideoRecorder.States.State.extend("BetaJS.Views.VideoRecorder.States.PlayerReady",{_start_state:function(){var a=this.view().get("can_record");if(this.rerecord_button_view=this.addView(BetaJS.Views.ButtonView,{label:this._("rerecord_label"),el_classes:["video-recorder"],css:{"default":"btn"},children_styles:{top:"10px",left:"10px"},visible:a}),this.rerecord_button_view.on("click",function(){confirm(this._("rerecord_confirm"))&&(this.view().set("type","recorder"),this.view().trigger("recording_discarded"),this.next("RecorderSecurityCheck"))},this),this.timer_view=this.addView(BetaJS.Views.VideoRecorder.Views.TimerView,{}),this.button_bar_view=this.addView(BetaJS.Views.VideoRecorder.Views.ButtonBarView,{}),this.play_button_view=this.button_bar_view.addChild(new BetaJS.Views.VideoRecorder.Views.BarButtonView({parent:this.view(),label:"<i class='bjs-icon-play'></i>"})),this.play_button_view.on("click",function(){"paused"==this.api().player_state().status?this.api().player_resume():this.api().player_play()},this),this.pause_button_view=this.button_bar_view.addChild(new BetaJS.Views.VideoRecorder.Views.BarButtonView({parent:this.view(),label:"<i class='bjs-icon-pause'></i>",disabled:!0})),this.pause_button_view.on("click",function(){this.api().player_pause()},this),this.stop_button_view=this.button_bar_view.addChild(new BetaJS.Views.VideoRecorder.Views.BarButtonView({parent:this.view(),label:"<i class='bjs-icon-stop'></i>",disabled:!0})),this.stop_button_view.on("click",function(){this.stop_player()},this),this.events().on("error",function(a){this.view().trigger("server_error",a),this.button_bar_view.hide(),this.timer_view.hide(),this.next("ErrorState",{error_message:a})},this),this.events().on("player_state",function(b){"none"==b&&(this.play_button_view.set("disabled",!1),this.pause_button_view.set("disabled",!0),this.stop_button_view.set("disabled",!0),this.rerecord_button_view.setVisibility(a)),"connecting"==b&&(this.play_button_view.set("disabled",!0),this.pause_button_view.set("disabled",!0),this.stop_button_view.set("disabled",!0),this.rerecord_button_view.setVisibility(a)),"active"==b&&(this.play_button_view.set("disabled",!1),this.pause_button_view.set("disabled",!0),this.stop_button_view.set("disabled",!0),this.rerecord_button_view.setVisibility(a)),"playing"==b&&(this.play_button_view.set("disabled",!0),this.pause_button_view.set("disabled",!1),this.stop_button_view.set("disabled",!1),this.rerecord_button_view.setVisibility(!1)),"paused"==b&&(this.play_button_view.set("disabled",!1),this.pause_button_view.set("disabled",!0),this.stop_button_view.set("disabled",!1),this.rerecord_button_view.setVisibility(a)),"finished"==b&&(this.play_button_view.set("disabled",!0),this.pause_button_view.set("disabled",!0),this.stop_button_view.set("disabled",!1),this.rerecord_button_view.setVisibility(a),this.api().player_stop(),this.view().trigger("stop")),"error"==b&&(this.play_button_view.set("disabled",!0),this.pause_button_view.set("disabled",!0),this.stop_button_view.set("disabled",!0),this.rerecord_button_view.setVisibility(a))},this),this.api().player_activate(),this.view().get("immediate_playback")){var b=this;setTimeout(function(){b.api().player_play()},500)}},stop_player:function(){this.api().player_stop()},_timer_state:function(){var a=this.api().player_state(),b=this.view().get("player_remaining_time")?a.video_remaining:a.video_position;this.timer_view.set("time",Math.floor(1e3*b))},_end_state:function(){this.api().player_deactivate()}}),BetaJS.Views.ListContainerView.extend("BetaJS.Views.VideoUploader",{_notifications:{activate:"__attach",deactivate:"__detach"},__supports_form_data:function(){try{new FormData}catch(a){return!1}return!0},__require_form_fallback:function(){return BetaJS.Browser.Info.isInternetExplorer()&&BetaJS.Browser.Info.internetExplorerVersion()<=9?!0:BetaJS.Browser.Info.isAndroid()?!this.__supports_form_data():!1},constructor:function(a){a=a||{},a.el_classes="video-recorder-outer",a.positioning="none",this._inherited(BetaJS.Views.VideoUploader,"constructor",a),a=BetaJS.Objs.extend(BetaJS.Objs.clone(this.cls._options,1),a),this._setOptionProperty(a,"type","recorder"),this._setOptionProperty(a,"allow_rerecord",!0),this._setOptionProperty(a,"rerecord_limit",!1),this.set("can_record",this.computed(function(){return this.get("allow_rerecord")&&(this.get("rerecord_limit")===!1||this.get("rerecord_limit")>=0)},["allow_rerecord","rerecord_limit"])),this.set("can_rerecord",this.computed(function(){return this.get("allow_rerecord")&&(this.get("rerecord_limit")===!1||this.get("rerecord_limit")>0)},["allow_rerecord","rerecord_limit"])),this._setOptionProperty(a,"allow_custom_file",!BetaJS.Browser.Info.isMobile()),this._setOptionProperty(a,"player_config",{}),this._setOptionProperty(a,"initial_image",""),this._setOptionProperty(a,"recorder_config",{}),this._setOptionProperty(a,"recorder_width",640),this._setOptionProperty(a,"recorder_height",480),this._setOptionProperty(a,"immediate_playback",!1),this._setOptionProperty(a,"responsive",!1),this._setOptionProperty(a,"external_record",!1),this._setOptionProperty(a,"allowed_extensions",null),this.set("form_fallback",this.__require_form_fallback()),this.on("client_error",function(a){this.trigger("error","client",a)},this),this.on("server_error",function(a){this.trigger("error","server",a)},this),this.__state_host=this._auto_destroy(new BetaJS.States.Host),this.__state_host.view=this,this.__state_host.on("start",function(a){this.trigger("state",a),this.trigger("state:"+a)},this)},state:function(){return this.__state_host.state()},recorderWidth:function(){return this.get("recorder_width")},recorderHeight:function(){return this.get("recorder_height")},__attach:function(){if(this.get("responsive")){var a=parseInt(this.$el.parent().css("width"),10);if(a){var b=parseInt(this.$el.parent().css("height"),10);b||(b=Math.floor(a*this.recorderHeight()/this.recorderWidth())),this.set("recorder_width",a),this.set("recorder_height",b)}}this.$el.css("width",this.recorderWidth()+"px"),this.$el.css("height",this.recorderHeight()+"px"),this.__state_host.initialize("BetaJS.Views.VideoUploader.States.Init"),this.__timer=new BetaJS.Timers.Timer({delay:100,fire:this.__timer,context:this})},__detach:function(){this.__timer.destroy(),this.__state_host.finalize()},__timer:function(){this.trigger("timer")},play:function(){this.player_view&&this.player_view.play&&this.player_view.play()},stop:function(){this.player_view&&this.player_view.stop&&this.player_view.stop()}},{_options:{},setup:function(a){this._options=BetaJS.Objs.extend(this._options,a)}}),BetaJS.Views.ButtonView.extend("BetaJS.Views.VideoUploader.Views.UploadButtonView",{_dynamics:{"default":BetaJS.Templates.Cached["video-uploader-upload-button-view-template"]},constructor:function(a){a.el_classes="btn-primary",a.button_container_element="a",this._inherited(BetaJS.Views.VideoUploader.Views.UploadButtonView,"constructor",a),this._setOptionProperty(a,"allow_custom_file",!0),this._setOptionProperty(a,"form_fallback",!1),this.set("accept_string",this.computed(function(){var a=BetaJS.Browser.Info.isMobile(),b=this.get("allow_custom_file");return a===b?"accept='video/*,video/mp4'":a?"accept='video/*,video/mp4;capture=camcorder' capture":""},["allow_custom_file"]))},_events:function(){return this._inherited(BetaJS.Views.VideoUploader.Views.UploadButtonView,"_events").concat([{"change input":"__select_file"}])},__select_file:function(){this.trigger("select",this.$("input"))}}),BetaJS.Views.View.extend("BetaJS.Views.VideoUploader.Views.ProgressView",{_dynamics:{"default":BetaJS.Templates.Cached["video-uploader-progress-template"]},constructor:function(a){a=a||{},a.el_classes=["video-uploader-progress"],this._inherited(BetaJS.Views.VideoUploader.Views.ProgressView,"constructor",a),this._setOptionProperty(a,"progress",0),this._setOptionProperty(a,"label","Label"),this.set("progress_label",this.computed(function(){return this.get("label")+": "+Math.floor(100*this.get("progress"))+"%"},["progress","label"]))}}),BetaJS.Views.View.extend("BetaJS.Views.VideoUploader.Views.ErrorView",{_templates:{"default":BetaJS.Templates.Cached["video-uploader-error-template"]},_events:{"click .call-to-action":"__call_to_action"},constructor:function(a){a=a||{},a.el_classes=["video-uploader-error"],this._inherited(BetaJS.Views.VideoUploader.Views.ErrorView,"constructor",a),this._setOptionProperty(a,"error",""),this._setOptionProperty(a,"call_to_action","")},__call_to_action:function(){this.trigger("call_to_action")}}),BetaJS.Views.View.extend("BetaJS.Views.VideoUploader.Views.UploadView",{_dynamics:{"default":BetaJS.Templates.Cached["video-uploader-upload-template"]},_events:{"click [data-selector='record-video']":"__record_video"},constructor:function(a){a=a||{},a.el_classes=["video-uploader-upload"],this._inherited(BetaJS.Views.VideoUploader.Views.ProgressView,"constructor",a),this._setOptionProperty(a,"progress",0),this._setOptionProperty(a,"external_record",!1),this._setOptionProperty(a,"label","Label"),this.set("external_record_label",BetaJS.Locales.get("video_recorder.external_record_label")),this.set("progress_label",this.computed(function(){return this.get("label")+(this.get("progress")?": "+Math.floor(100*this.get("progress"))+"%":"...")},["progress","label"]))},__record_video:function(){this.trigger("record_video")},show_progress:function(){this.$(".inner-container").hide(),this.$(".progress-label").show(),this.$(".progress-spinner").show()}}),BetaJS.States.State.extend("BetaJS.Views.VideoUploader.States.State",{constructor:function(a,b,c){this._inherited(BetaJS.Views.VideoUploader.States.State,"constructor",a,b,c),this.__view=a.view,this.__views=[]},_:function(a){return BetaJS.Locales.get("video_recorder."+a)},view:function(){return this.__view},_start_time:function(){return this.__start_time},_elapsed_time:function(){return BetaJS.Time.ago(this.__start_time)},_timer_state:function(){},_start_state:function(){},_end_state:function(){},_timer:function(){this._timer_state()},_start:function(){this.__start_time=BetaJS.Time.now(),this.__view.on("timer",function(){if(this._started&&!this._stopped)try{this._timer()}catch(a){}},this),this._start_state()},_end:function(){this._end_state(),BetaJS.Objs.iter(this.__views,function(a){a.destroy()},this),this.__view.off(null,null,this)},addView:function(a,b){b=b||{},b.parent=this.__view;var c=this.__view.addChild(new a(b));return this.__views.push(c),c}}),BetaJS.Views.VideoUploader.States.State.extend("BetaJS.Views.VideoUploader.States.Init",{_start_state:function(){"recorder"==this.view().get("type")?this.next("CheckState"):this.next("PlayerState")}}),BetaJS.Views.VideoUploader.States.State.extend("BetaJS.Views.VideoUploader.States.CheckState",{__device_supported:function(){return BetaJS.Browser.Info.isiOS()&&BetaJS.Browser.Info.iOSversion().major<6?!1:!0},_start_state:function(){return BetaJS.Browser.Info.isiOS()&&8==BetaJS.Browser.Info.iOSversion().major&&!BetaJS.Browser.Info.iOSversion().minor&&!BetaJS.Browser.Info.iOSversion().revision&&BetaJS.Browser.Info.isSafari()?(this.next("ErrorState",{error_message:"<a href='http://blog.fineuploader.com/2014/09/10/ios8-presents-serious-issues-that-prevent-file-uploading/' target='_blank'>Mobile Upload of any media is broken on iOS 8 Safari</a>. Apple is working on this issue. Please upgrade your iOS version if possible or use a different browser like Chrome."}),void 0):(this.__device_supported()?this.next("UploaderState"):this.next("ErrorState",{error_message:this._("device_unsupported")}),void 0)}}),BetaJS.Views.VideoUploader.States.State.extend("BetaJS.Views.VideoUploader.States.UploaderState",{_start_state:function(){this.__uploader_view=this.addView(BetaJS.Views.VideoUploader.Views.UploadView,{label:this._("uploading_label"),progress:0,external_record:this.view().get("external_record")}),this.__uploader_view.on("record_video",function(){this.view().trigger("external_record")},this),this.upload_button=this.__uploader_view.addChild(new BetaJS.Views.VideoUploader.Views.UploadButtonView({label:BetaJS.Browser.Info.isMobile()?this._(this.view().get("rerecording")?"reselect_file_action_mobile":"select_file_action_mobile"):this._(this.view().get("rerecording")?"reselect_file_action":"select_file_action"),allow_custom_file:this.view().get("allow_custom_file"),form_fallback:this.view().get("form_fallback"),el:"[data-selector='upload-video']"}));var a=this;this.upload_button.on("select",function(b){if(this.view().get("allowed_extensions")){var c=b.val().toLowerCase(),d=!1;BetaJS.Objs.iter(this.view().get("allowed_extensions"),function(a){BetaJS.Strings.ends_with(c,"."+a.toLowerCase())&&(d=!0)}),d||this.next("ErrorState",{error_message:a._("unsupported_video_type").replace("%s",this.view().get("allowed_extensions").join(" / ")),call_to_action:a._("try_again")})}if(this.__uploader_view.show_progress(),this.view().set("file_size",null),this.view().trigger("recording_finished"),this.view().get("form_fallback")){var e=this.view().$("form").get(0),f=this.view().$("iframe").get(0),g=!("postMessage"in window);f.onerror=function(){g&&(window.postMessage=null),BetaJS.$(window).off("message."+this.view().cid()),a.view().trigger("server_error",a._("uploading_file_failed")),a.next("ErrorState",{error_message:a._("uploading_file_failed"),call_to_action:a._("try_again")})},e.action=BetaJS.Net.Uri.appendUriParams(this.view().get("recorder_config").submit,{_postmessage:!0}),e.encoding=e.enctype="multipart/form-data";var h=function(b){g&&(window.postMessage=null);var c=JSON.parse(b);a.view().trigger("recording_uploaded",c),a.next("ProcessingState")};BetaJS.$(window).on("message."+this.view().cid(),function(b){BetaJS.$(window).off("message."+a.view().cid());var c=b.originalEvent.data;h(c)}),g&&(window.postMessage=h),e.submit()}else{var i=new FormData;i.append("file",b.get(0).files[0]),BetaJS.$.ajax({type:"POST",async:!0,url:this.view().get("recorder_config").submit,data:i,cache:!1,contentType:!1,processData:!1,xhr:function(){var b=BetaJS.$.ajaxSettings.xhr();
  return b.upload&&b.upload.addEventListener("progress",function(b){b.lengthComputable&&(a.view().set("file_size",b.total),a.__uploader_view.set("progress",b.loaded/b.total))},!1),b}}).success(function(b){a.view().trigger("recording_uploaded",b),a.next("ProcessingState")}).error(function(){a.view().trigger("server_error",a._("uploading_file_failed")),a.next("ErrorState",{error_message:a._("uploading_file_failed"),call_to_action:a._("try_again")})})}},this)}}),BetaJS.Views.VideoUploader.States.State.extend("BetaJS.Views.VideoUploader.States.ProcessingState",{_start_state:function(){this.__processing_view=this.addView(BetaJS.Views.VideoUploader.Views.ProgressView,{label:this._("processing_label"),progress:0}),this.__time=BetaJS.Time.now(),this.__last_check=this.__time},_timer_state:function(){var a=BetaJS.Time.now(),b=1e3;this.view().get("file_size")&&1e3*this.view().get("file_size")>1e3&&(b=this.view().get("file_size")/1e3);var c=(a-this.__time)/b,d=1-1/(1+Math.sqrt(Math.sqrt(c)));this.__processing_view.set("progress",d);var e=this;a-this.__last_check>=1e3&&(this.__last_check=a,BetaJS.Browser.Info.isInternetExplorer()&&BetaJS.Browser.Info.internetExplorerVersion()<=9&&(BetaJS.$.support.cors=!0),BetaJS.$.ajax({type:"GET",async:!0,url:this.view().get("recorder_config").state}).success(function(a){e.view().get("rerecord_limit")!==!1&&e.view().set("rerecord_limit",e.view().get("rerecord_limit")-1),e.view().trigger("recording_submitted",BetaJS.Types.is_object(a)?a:JSON.parse(a)),e.view().set("player_config",BetaJS.Types.is_object(a)?a:JSON.parse(a)),e.view().set("type","player"),e.next("Init")}).error(function(a){a.status!=BetaJS.Net.HttpHeader.HTTP_STATUS_PRECONDITION_FAILED&&(e.view().trigger("server_error",e._("could_not_process_file")),e.next("ErrorState",{error_message:e._("could_not_process_file"),call_to_action:e._("try_again")}))}))}}),BetaJS.Views.VideoUploader.States.State.extend("BetaJS.Views.VideoUploader.States.ErrorState",{_locals:["error_message","call_to_action"],_start_state:function(){var a=this.addView(BetaJS.Views.VideoUploader.Views.ErrorView,{error:this._error_message,call_to_action:this._call_to_action});a.on("call_to_action",function(){this.next("UploaderState")},this)}}),BetaJS.Views.VideoUploader.States.State.extend("BetaJS.Views.VideoUploader.States.PlayerState",{_start_state:function(){var a=this.view().get("player_config");if(this.player_view=this.addView(BetaJS.Views.VideoPlayerView,{sources:a.sources||[],meta:{responsive:this.view().get("responsive"),image:a.image||null,width:this.view().recorderWidth(),height:this.view().recorderHeight(),video_width:a.width||this.view().recorderWidth(),video_height:a.height||this.view().recorderHeight(),fit:"minimize"},el_styles:{left:"0px",top:"0px",position:"absolute"}}),this.view.player_view=this.player_view,this.player_view.on("stop",function(){this.view().trigger("stop")},this),this.player_view.on("error",function(a){this.view().trigger("server_error",a)},this),this.view().get("can_record")){var b=this.addView(BetaJS.Views.ButtonView,{el_classes:["video-recorder"],css:{"default":"btn"},children_styles:{top:"10px",right:"10px"},label:this._("rerecord_label")});b.on("click",function(){confirm(this._("rerecord_confirm"))&&(this.view().trigger("recording_discarded"),this.view().set("type","recorder"),this.view().set("rerecording",!0),this.view().trigger("recording_discarded"),this.next("UploaderState"))},this)}this.view().get("immediate_playback")&&this.player_view.play()}}),BetaJS.Views.SingleContainerView.extend("BetaJS.Views.VideoSubmitter",{constructor:function(a){this._inherited(BetaJS.Views.SingleContainerView,"constructor",a),a=BetaJS.Objs.extend(BetaJS.Objs.clone(this.cls._options,1),a||{}),this._setOption(a,"recorder_options",{}),this._setOption(a,"uploader_options",{}),this._setOption(a,"type","recorder"),this._setOption(a,"mode","recorder"),this._setOption(a,"width",640),this._setOption(a,"height",480),this._setOption(a,"responsive",!1),this._setOption(a,"allow_rerecord",!0),this._setOptionProperty(a,"rerecord_limit",!1),this._setOption(a,"allow_to_switch",!1),this.__attach()},__attach:function(){"recorder"==this.__mode&&BetaJS.Browser.Info.isMobile()&&(this.__mode="uploader");var a=null;"recorder"==this.__mode?(a=this.setView(new BetaJS.Views.VideoRecorder(BetaJS.Objs.merge(this.__recorder_options,{type:this.__type,allow_rerecord:this.__allow_rerecord,external_upload:this.__allow_to_switch,recorder_width:this.__width,recorder_height:this.__height,responsive:this.__responsive,rerecord_limit:this.binding("rerecord_limit")},{}))),a.on("error",function(a,b){this.trigger("error",a,b)},this),a.on("recording_submitted",function(a){this.trigger("recording_submitted",a)},this),a.on("recording_discarded",function(){this.trigger("recording_discarded")},this),a.on("external_upload",function(){this.__mode="uploader",this.__attach()},this)):(a=this.setView(new BetaJS.Views.VideoUploader(BetaJS.Objs.merge(this.__uploader_options,{type:this.__type,allow_rerecord:this.__allow_rerecord,external_record:this.__allow_to_switch&&!BetaJS.Browser.Info.isMobile(),recorder_width:this.__width,recorder_height:this.__height,responsive:this.__responsive,rerecord_limit:this.binding("rerecord_limit")},{}))),a.on("error",function(a,b){this.trigger("error",a,b)},this),a.on("recording_submitted",function(a){this.trigger("recording_submitted",a)},this),a.on("recording_discarded",function(){this.trigger("recording_discarded")},this),a.on("external_record",function(){this.__mode="recorder",this.__attach()},this))}},{_options:{},setup:function(a){this._options=BetaJS.Objs.extend(this._options,a)}}),BetaJS.Views.WebRTC={userMedia:function(){return navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia},supported:function(){return!!this.userMedia()&&"MediaRecorder"in window},url:function(){return window.URL||window.webkitURL},bind:function(a){var b=new BetaJS.Promise.Promise;if(this.supported()){var c=this.url(),d=this.userMedia();d.call(navigator,{audio:!0,video:!0},function(d){a.src=c.createObjectURL(d),b.asyncSuccess(d)},function(a){b.asyncError(a)})}else b.asyncError("Not supported");return b},startRecording:function(a,b,c){var d=new MediaRecorder(a);return d.start(),d.ondataavailable=function(a){b.call(c||this,new Blob([a.data],{type:a.data.type}))},d},stopRecording:function(a){a.stop()}},BetaJS.Views.ListContainerView.extend("BetaJS.Views.VideoRTCRecorder",{_notifications:{activate:"__attach",deactivate:"__detach"},constructor:function(a){a=a||{},a.el_classes="video-recorder-outer",a.positioning="none",this._inherited(BetaJS.Views.VideoRTCRecorder,"constructor",a),a=BetaJS.Objs.extend(BetaJS.Objs.clone(this.cls._options,1),a),this._setOptionProperty(a,"recording_countdown",0),this._setOptionProperty(a,"type","recorder"),this._setOptionProperty(a,"player_remaining_time",!1),this._setOptionProperty(a,"allow_rerecord",!0),this._setOptionProperty(a,"rerecord_limit",!1),this.set("can_record",this.computed(function(){return this.get("allow_rerecord")&&(this.get("rerecord_limit")===!1||this.get("rerecord_limit")>=0)},["allow_rerecord","rerecord_limit"])),this.set("can_rerecord",this.computed(function(){return this.get("allow_rerecord")&&(this.get("rerecord_limit")===!1||this.get("rerecord_limit")>0)},["allow_rerecord","rerecord_limit"])),this._setOptionProperty(a,"time_limit",null),this._setOptionProperty(a,"device_test",!0),this._setOptionProperty(a,"first_screen",!0),this._setOptionProperty(a,"face_outline",!1),this._setOptionProperty(a,"recorder_config",{}),this._setOptionProperty(a,"player_config",{}),this._setOptionProperty(a,"recorder_width",640),this._setOptionProperty(a,"recorder_height",480),this._setOptionProperty(a,"immediate_playback",!1),this._setOptionProperty(a,"disable_timer",!1),this._setOptionProperty(a,"responsive",!1),this._setOptionProperty(a,"external_upload",!1),this._setOptionProperty(a,"margin_percentage",.3),this._setOptionProperty(a,"frame_percentage",.9),this.on("client_error",function(a){this.trigger("error","client",a)},this),this.on("server_error",function(a){this.trigger("error","server",a)},this),this.__face_outline_view=this.addChild(new BetaJS.Views.View({parent:this,visible:!1,el_classes:"video-recorder-face-position"})),this.__video_view=this.addChild(new BetaJS.Views.View({parent:this,visible:!1,template:"<video autoplay style='width:100%; height:100%'></video>"})),this.__state_host=this._auto_destroy(new BetaJS.States.Host),this.__state_host.view=this,this.__state_host.on("start",function(a){this.trigger("state",a),this.trigger("state:"+a)},this)},state:function(){return this.__state_host.state()},user_error:function(a){this.state().next("UserError",{error_msg:a})},_render:function(){if(this.get("responsive")){var a=parseInt(this.$el.parent().css("width"),10);if(a){var b=parseInt(this.$el.parent().css("height"),10);b||(b=Math.floor(a*this.get("recorder_height")/this.get("recorder_width"))),this.set("recorder_width",a),this.set("recorder_height",b)}}this._inherited(BetaJS.Views.VideoRTCRecorder,"_render")},__attach:function(){this.__time_started=BetaJS.Time.now(),this.$el.css("width",this.get("recorder_width")+"px"),this.$el.css("height",this.get("recorder_height")+"px"),this.__state_host.initialize("BetaJS.Views.VideoRTCRecorder.States.Init"),this.__timer=new BetaJS.Timers.Timer({delay:25,fire:this.__timer,context:this})},__detach:function(){this.__timer.destroy(),this.__state_host.finalize()},__timer:function(){this.trigger("timer")},recorderWidth:function(){return this.get("recorder_width")},recorderHeight:function(){return this.get("recorder_height")},stop:function(){this.player_view&&this.player_view.stop&&this.player_view.stop()},play:function(){this.player_view&&this.player_view.play&&this.player_view.play()},stopRecord:function(){this.state().stop_recording&&this.state().stop_recording()}},{_options:{},setup:function(a){this._options=BetaJS.Objs.extend(this._options,a)}}),BetaJS.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.State",{constructor:function(a,b,c){this._inherited(BetaJS.Views.VideoRTCRecorder.States.State,"constructor",a,b,c),this.__view=a.view,this.__views=[]},_:function(a){return BetaJS.Locales.get("video_recorder."+a)},view:function(){return this.__view},events:function(){return this.__view.events()},_start_time:function(){return this.__start_time},_elapsed_time:function(){return BetaJS.Time.ago(this.__start_time)},api:function(){return this.__view.api()},device_info:function(a){return this.__view.device_info(a)},device_state:function(a){return this.__view.device_state(a)},security_info:function(a){return this.__view.security_info(a)},_timer_state:function(){},_start_state:function(){},_end_state:function(){},_timer:function(){this._timer_state()},_start:function(){this.__start_time=BetaJS.Time.now(),this.__view.on("timer",function(){if(this._started&&!this._stopped)try{this._timer()}catch(a){}},this),this._start_state()},_end:function(){this._end_state(),BetaJS.Objs.iter(this.__views,function(a){a.destroy()},this),this.__view.off(null,null,this)},addView:function(a,b){b=b||{},b.parent=this.__view;var c=this.__view.addChild(new a(b));return this.__views.push(c),c}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.Init",{_start_state:function(){if(this.view().__screen_height=window.innerHeight,!this.view().get("first_screen")||"player"==this.view().get("type"))return this.next("Attached"),void 0;var a=this.addView(BetaJS.Views.VideoRecorder.Views.InitialView,{parent:this.view()});a.on("record",function(){this.next("Attached")},this),a.on("upload",function(){this.view().trigger("external_upload")},this),a.on("tutorial",function(){this.view().__tutorial_view.show()},this)}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.ErrorState",{_locals:["error_message","call_to_action"],_start_state:function(){this.addView(BetaJS.Views.VideoRecorder.Views.ErrorView,{error:this._error_message,call_to_action:this._call_to_action})}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.Attached",{_start_state:function(){"recorder"==this.view().get("type")?this.next("RecorderDeviceCheck"):this.next("PlayerReady")}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.RecorderDeviceCheck",{_start_state:function(){BetaJS.Views.WebRTC.supported()?this.next("RecorderDeviceReady"):this.next("RecorderDeviceFailed")}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.RecorderDeviceFailed",{_start_state:function(){this.next("ErrorState",{error_message:this._("no_camera")}),this.view().trigger("client_error",this._("no_camera"))}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.UserError",{_locals:["error_msg"],_start_state:function(){this.next("ErrorState",{error_message:this._error_msg})}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.RecorderDeviceReady",{_start_state:function(){var a=this;this.view().__video_view.show(),BetaJS.Views.WebRTC.bind(this.view().__video_view.$("video").get(0)).success(function(a){this.view().stream=a},this).error(function(a){this.next("ErrorState",{error_message:a})},this),this.view().get("face_outline")&&this.view().__face_outline_view.show(),this.__dashboard_under=this.addView(BetaJS.Views.View,{el_classes:"video-recorder-dashboard-under"}),this.__dashboard=this.addView(BetaJS.Views.ListContainerView,{el_classes:"video-recorder-dashboard"}),this.record_button_view=this.__dashboard.addChild(new BetaJS.Views.ButtonView({label:this._("record_label"),el_classes:["video-recorder"],css:{"default":"btn"},children_styles:{position:"inherit"},el_styles:{"float":"right"}})),this.__message_under=this.addView(BetaJS.Views.View,{el_classes:"video-recorder-message-under",visible:!1}),this.__message=this.addView(BetaJS.Views.LabelView,{el_classes:"video-recorder-message",visible:!1}),this.__set_message=function(a){this.__message.set("label",a),this.__message_under.setVisibility(!!a),this.__message.setVisibility(!!a)},this.record_button_view.$el.on("mouseenter",function(){var b=a.view().get("rerecord_limit");b===!1?a.__set_message(a._("rerecord_affirmation")):1==b?a.__set_message(a._("rerecord_single_affirmation")):2==b?a.__set_message(a._("rerecord_double_affirmation")):a.__set_message(a._("rerecord_multiple_affirmation").replace("%d",b))}),this.record_button_view.$el.on("mouseleave",function(){a.__set_message("")}),this.record_button_view.on("click",function(){this.record()},this)},record:function(){this.next("RecorderBeforeRecording")}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.RecorderBeforeRecording",{_start_state:function(){return this.view().get("recording_countdown")?(this.__dashboard_under=this.addView(BetaJS.Views.View,{el_classes:"video-recorder-dashboard-under"}),this.__dashboard=this.addView(BetaJS.Views.ListContainerView,{el_classes:"video-recorder-dashboard"}),this.stop_button_view=this.__dashboard.addChild(new BetaJS.Views.ButtonView({label:this._("abort_record"),el_classes:["video-recorder"],css:{"default":"btn on"},children_styles:{position:"inherit"},el_styles:{"float":"right"}})),this.countdown_view=this.__dashboard.addChild(new BetaJS.Views.LabelView({label:this._("recording_starts_in")+" "+this.view().get("recording_countdown"),el_classes:"video-recorder-font",el_styles:{"float":"right",padding:"15px 15px 15px 15px","font-size":"16px"}})),this.stop_button_view.on("click",function(){this.next("RecorderDeviceReady")},this),void 0):(this.next("RecorderRecording"),void 0)},_timer_state:function(){var a=1e3*this.view().get("recording_countdown")-this._elapsed_time();a>0&&this.view().trigger("countdown",a),this.countdown_view.set("label",a>=0?this._("recording_starts_in")+" "+Math.ceil(a/1e3):this._("recording_get_ready")),0>=a&&this.next("RecorderRecording")}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.RecorderRecording",{_start_state:function(){this.__dashboard_under=this.addView(BetaJS.Views.View,{el_classes:"video-recorder-dashboard-under"}),this.__dashboard=this.addView(BetaJS.Views.ListContainerView,{el_classes:"video-recorder-dashboard"}),this.stop_button_view=this.__dashboard.addChild(new BetaJS.Views.ButtonView({label:this._("recording_get_ready"),el_classes:["video-recorder"],css:{"default":"btn on"},children_styles:{position:"inherit"},el_styles:{"float":"right"}})),this.__time=null,this.countdown_view=this.__dashboard.addChild(new BetaJS.Views.LabelView({label:"",el_classes:"video-recorder-font",el_styles:{"float":"right",padding:"15px 15px 15px 15px","font-size":"16px"}})),this.timer_view=this.__dashboard.addChild(new BetaJS.Views.VideoRecorder.Views.TimerView({parent:this.view(),max_time:this.view().get("time_limit")?1e3*this.view().get("time_limit"):null,time:0,visible:!1,el_styles:{"float":"right",padding:"15px 15px 15px 15px","font-size":"16px"},el_classes:"video-recorder-font"})),this.blinking_record_view=this.__dashboard.addChild(new BetaJS.Views.VideoRecorder.Views.BlinkingRecordView({parent:this.view(),visible:!1,el_styles:{"float":"left",padding:"20px"}})),this.stop_button_view.on("click",function(){this.stop_recording()},this),this.stop_button_view.set("disabled",!0),this.view().streamRecorder=BetaJS.Views.WebRTC.startRecording(this.view().stream,function(a){this.view().blob=a,this.next("RecorderUploading")},this),this.stop_button_view.set("label",this._("recording_start")),this.stop_button_view.$el.children().css("background-color","green"),this.countdown_view.hide(),this.blinking_record_view.show(),this.view().get("disable_timer")||this.timer_view.show(),this.__time=BetaJS.Time.now()},_timer_state:function(){if(this.__time){var a=BetaJS.Time.now()-this.__time;this.timer_view.set("time",a),this.view().trigger("elapsed",a),this.view().get("time_limit")&&a>=1e3*this.view().get("time_limit")&&this.stop_recording(),a>1500&&(this.stop_button_view.$el.children().css("background-color",""),this.stop_button_view.set("disabled",!1),this.stop_button_view.set("label",this._("stop_recording")))}},stop_recording:function(){BetaJS.Views.WebRTC.stopRecording(this.view().streamRecorder);var a=BetaJS.Time.now()-this.__time;this.view()._duration=a,this.view().__face_outline_view.hide(),this.view().trigger("recording_finished")}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.RecorderUploading",{_start_state:function(){this.view().__video_view.hide(),this.__processing_view=this.addView(BetaJS.Views.VideoRecorder.Views.ProgressView,{label:this._("uploading_label"),progress:0});var a=new FormData;a.append("file",this.view().blob,"video.webm");var b=this;BetaJS.$.ajax({type:"POST",async:!0,url:this.view().get("recorder_config").submit,data:a,cache:!1,contentType:!1,processData:!1,xhr:function(){var a=BetaJS.$.ajaxSettings.xhr();return a.upload&&a.upload.addEventListener("progress",function(a){a.lengthComputable&&(b.view().set("file_size",a.total),b.__processing_view.set("progress",a.loaded/a.total))},!1),a}}).success(function(a){b.view().trigger("recording_uploaded",a),b.next("ProcessingState")}).error(function(){b.view().trigger("server_error","Error"),b.next("ErrorState",{error_message:"Error"})})}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.ProcessingState",{_start_state:function(){this.__processing_view=this.addView(BetaJS.Views.VideoUploader.Views.ProgressView,{label:this._("processing_label"),progress:0}),this.__time=BetaJS.Time.now(),this.__last_check=this.__time},_timer_state:function(){var a=BetaJS.Time.now(),b=1e3;this.view().get("file_size")&&1e3*this.view().get("file_size")>1e3&&(b=this.view().get("file_size")/1e3);var c=(a-this.__time)/b,d=1-1/(1+Math.sqrt(Math.sqrt(c)));this.__processing_view.set("progress",d);var e=this;a-this.__last_check>=1e3&&(this.__last_check=a,BetaJS.$.ajax({type:"GET",async:!0,url:this.view().get("recorder_config").state}).success(function(a){e.view().get("rerecord_limit")!==!1&&e.view().set("rerecord_limit",e.view().get("rerecord_limit")-1),e.view().trigger("recording_submitted",BetaJS.Types.is_object(a)?a:JSON.parse(a)),e.view().set("player_config",BetaJS.Types.is_object(a)?a:JSON.parse(a)),e.view().set("type","player"),e.next("Init")}).error(function(a){a.status!=BetaJS.Net.HttpHeader.HTTP_STATUS_PRECONDITION_FAILED&&(e.view().trigger("server_error",e._("could_not_process_file")),e.next("ErrorState",{error_message:e._("could_not_process_file"),call_to_action:e._("try_again")}))}))}}),BetaJS.Views.VideoRTCRecorder.States.State.extend("BetaJS.Views.VideoRTCRecorder.States.PlayerReady",{_start_state:function(){var a=this.view().get("player_config");if(this.player_view=this.addView(BetaJS.Views.VideoPlayerView,{sources:a.sources||[],meta:{responsive:this.view().get("responsive"),image:a.image||null,width:this.view().recorderWidth(),height:this.view().recorderHeight(),video_width:a.width||this.view().recorderWidth(),video_height:a.height||this.view().recorderHeight(),fit:"minimize"},el_styles:{left:"0px",top:"0px",position:"absolute"}}),this.view.player_view=this.player_view,this.player_view.on("stop",function(){this.view().trigger("stop")},this),this.player_view.on("error",function(a){this.view().trigger("server_error",a)},this),this.view().get("can_record")){var b=this.addView(BetaJS.Views.ButtonView,{el_classes:["video-recorder"],css:{"default":"btn"},children_styles:{top:"10px",right:"10px"},label:this._("rerecord_label")});b.on("click",function(){confirm(this._("rerecord_confirm"))&&(this.view().trigger("recording_discarded"),this.view().set("type","recorder"),this.view().set("rerecording",!0),this.view().trigger("recording_discarded"),this.next("UploaderState"))},this)}this.view().get("immediate_playback")&&this.player_view.play()}});var ZiggeoApi=ZiggeoApi||{token:"",Styles:{play_button_class:"ziggeo-play-button",play_button_vertical_align:"center",play_button_horizontal_align:"center"},Options:{maintenance:!1,enable_webserver_playback:!0,enable_wowza_playback:!0,enable_wowza_recording:!0,recording_type:"mp4",image_type:"jpg",vcodec:"h264",session_cookie_prefix:"i07af2jp98rvoctt26y5egy3",runtime:{}},Config:{jwplayer6_key:"zB2MBHKdnnQ5gr7Y/W+isBwTNs1NmamS6WsU3cnVdoI=",revision:"1428325363",webrtc:!1,rtmp80:!1},Uris:{get:function(a){var b=this[a],c=!1;try{c=-1!=location.protocol.indexOf("https")}catch(d){}var e=-1!=a.indexOf("rtmp"),f=(e?"rtmp":"http")+(c?"s":"");if(e&&(f="rtmp"),e&&ZiggeoApi.Config.rtmp80){var g=b.indexOf("/");b=b.substring(0,g)+":80/"+b.substring(g+1)}return f+"://"+b},jwplayer6_src:"assets.ziggeo.com/vendors/jwplayer/jwplayer.js",jwplayer6_swfsrc:"assets.ziggeo.com/vendors/jwplayer/jwplayer.flash.swf",jwplayer5_src:"assets.ziggeo.com/vendors/jwplayer/jwplayer-old.js",jwplayer5_swfsrc:"assets.ziggeo.com/vendors/jwplayer/player.swf",recorder_swfsrc:"assets.ziggeo.com/js/betajs-video-recorder.swf",assets_url:"assets.ziggeo.com",embed_api_url:"embed.ziggeo.com",wowza_http_play_url:"wowza.ziggeo.com/vod/_definst_",wowza_rtmp_play_url:"wowza.ziggeo.com/vod/_definst_",wowza_rtmp_record_url:"wowza.ziggeo.com/record/_definst_"},Params:{width:{type:"int",def:640},height:{type:"int",def:480},recording_width:{type:"int",def:640},recording_height:{type:"int",def:480},responsive:{type:"bool",def:!1},popup_width:{type:"int",def:640},popup_height:{type:"int",def:480},popup:{type:"bool",def:!1},video:{type:"string",def:null},face_outline:{type:"bool",def:!1},stream:{type:"string",def:null},modes:{type:"array",def:null},tags:{type:"array",def:null},effect_profile:{type:"array",def:null},data:{type:"json",def:null},perms:{type:"array",def:null},disable_first_screen:{type:"bool",def:!1},disable_device_test:{type:"bool",def:!1},disable_timer:{type:"bool",def:!1},disable_snapshots:{type:"bool",def:!1},auto_crop:{type:"bool",def:!1},key:{type:"string",def:null},limit:{type:"int",def:null},countdown:{type:"int",def:3},input_bind:{type:"string",def:null},form_accept:{type:"string",def:null},id:{type:"string",def:null},immediate_playback:{type:"bool",def:!1},server_auth:{type:"string",def:null},client_auth:{type:"string",def:null},rerecordings:{type:"int",def:null},expiration_days:{type:"int",def:null},video_profile:{type:"string",def:null},meta_profile:{type:"string",def:null},stream_width:{type:"int",def:null},stream_height:{type:"int",def:null},title:{type:"string",def:null},description:{type:"string",def:null},allowed_extensions:{type:"array",def:null},default_image_selector:{type:"float",def:null},apitoken:{type:"string",def:null}}};"undefined"!=typeof module&&"exports"in module&&("undefined"!=typeof BetaJS&&module.exports==BetaJS?BetaJS.ZiggeoApi=ZiggeoApi:module.exports=ZiggeoApi);try{BetaJS.$(document).ready(function(){ZiggeoApi.language&&(BetaJS.Locales.language=ZiggeoApi.language),BetaJS.Browser.Loader.loadScript(ZiggeoApi.Uris.get("embed_api_url")+"/v1/applications/"+ZiggeoApi.token+"/support/session");try{BetaJS.$.ajax({url:ZiggeoApi.Uris.get("embed_api_url")+"/v1/applications/"+ZiggeoApi.token+"/support/runtime"}).fail(function(a){a&&a.status&&503==a.status&&(ZiggeoApi.Options.maintenance=!0,ZiggeoApi.Embed._update_runtime())}).done(function(a){try{"string"==typeof a&&(a=JSON.parse(a)),ZiggeoApi.Options.runtime=a,ZiggeoApi.Embed._update_runtime()}catch(b){}})}catch(a){}})}catch(e){}ZiggeoApi.Connect={_ajax:BetaJS.Server?new BetaJS.Server.Net.HttpAjax:new BetaJS.Browser.JQueryAjax,_get:function(a,b,c,d,e,f){return this._request("GET",a,b,c,d,e,!1,f)},_getJSON:function(a,b,c,d,e,f){return this._requestJSON("GET",a,b,c,d,e,f)},_post:function(a,b,c,d,e,f){return this._request("POST",a,b,c,d,e,!1,f)},_postJSON:function(a,b,c,d,e,f){return this._requestJSON("POST",a,b,c,d,e,f)},_destroy:function(a,b,c,d,e,f){return this._request("DELETE",a,b,c,d,e,!1,f)},_destroyJSON:function(a,b,c,d,e,f){return this._requestJSON("DELETE",a,b,c,d,e,f)},_uri:function(a,b){return ZiggeoApi.Uris.get("embed_api_url")+this._path(a,b)},_path:function(a,b){return b=b||ZiggeoApi.token,"/v1/applications/"+b+a},_requestJSON:function(a,b,c,d,e,f,g){return this._request(a,b,c,d,e,f,!0,g)},__cookieName:function(){return ZiggeoApi.Options.session_cookie_prefix+document.location.hostname.replace(/\./g,"_")+ZiggeoApi.token},_request:function(a,b,c,d,e,f,g,h){var i={};d&&BetaJS.Objs.extend(i,d);try{var j=ZiggeoApi.Connect.__cookieName();i[j]=BetaJS.Browser.Cookies.get(j)}catch(k){}return b=BetaJS.Net.Uri.appendUriParams(b,i),c?this._ajax.asyncCall({method:a,data:f,uri:this._uri(b,h)}).success(function(a){if(c&&c.success){if(g)try{var b=JSON.parse(a);a=b}catch(d){}e.push(a),c.success.apply(this,e)}},c.context||this).error(function(a){c&&c.failure&&(e.push(a),c.failure.apply(this,e))},c.context||this):this._ajax.syncCall({method:a,data:f,uri:this._uri(b,h)})}},ZiggeoApi.Streams=BetaJS.Objs.extend(ZiggeoApi.Streams||{},{destroy:function(a,b,c,d,e){return ZiggeoApi.Connect._destroy("/videos/"+a+"/streams/"+b,c,d,[a,b],null,e)},create:function(a,b,c,d,e){return ZiggeoApi.Connect._postJSON("/videos/"+a+"/streams",c,d,[a,b],b,e)},accept:function(a,b,c,d,e){return ZiggeoApi.Connect._postJSON("/videos/"+a+"/streams/"+b+"/accept",c,d,[a,b],null,e)},_image_attach:function(a,b,c,d,e,f){return ZiggeoApi.Connect._postJSON("/videos/"+a+"/streams/"+b+"/imageattach",d,e,[a,b,c],c,f)},_recorder_submit:function(a,b,c,d,e,f){return ZiggeoApi.Connect._postJSON("/videos/"+a+"/streams/"+b+"/recordersubmit",d,e,[a,b,c],c,f)},_uploader_state:function(a,b,c,d,e){return ZiggeoApi.Connect._getJSON("/videos/"+a+"/streams/"+b+"/uploaderstate",c,d,[a,b],null,e)}}),ZiggeoApi.Streams=BetaJS.Objs.extend(ZiggeoApi.Streams||{},{sources:function(a,b,c){c=c||ZiggeoApi.token;var d="/applications/"+c+"/videos/"+a+"/streams/"+b+"/video.mp4";return[ZiggeoApi.Uris.get("embed_api_url")+"/v1"+d,ZiggeoApi.Uris.get("wowza_http_play_url")+d+"/playlist.m3u8"]},image:function(a,b,c){return c=c||ZiggeoApi.token,ZiggeoApi.Uris.get("embed_api_url")+"/v1/applications/"+c+"/videos/"+a+"/streams/"+b+"/image"},source:function(a,b,c){var d=this.sources(a,b,c);return d[1]}}),ZiggeoApi.Videos=BetaJS.Objs.extend(ZiggeoApi.Videos||{},{index:function(a,b,c,d){return ZiggeoApi.Connect._getJSON("/videos/",b,c,[a],a,d)},destroy:function(a,b,c,d){return ZiggeoApi.Connect._destroy("/videos/"+a,b,c,[a],null,d)},create:function(a,b,c,d){return ZiggeoApi.Connect._postJSON("/videos",b,c,[a],a,d)},update:function(a,b,c,d,e){return ZiggeoApi.Connect._postJSON("/videos/"+a,c,d,[a,b],b,e)},get:function(a,b,c,d){return ZiggeoApi.Connect._getJSON("/videos/"+a,b,c,[a],null,d)}}),ZiggeoApi.Videos=BetaJS.Objs.extend(ZiggeoApi.Videos||{},{sources:function(a,b){b=b||ZiggeoApi.token;var c="/applications/"+b+"/videos/"+a+"/video.mp4",d=[];return ZiggeoApi.Options.enable_webserver_playback&&d.push(ZiggeoApi.Uris.get("embed_api_url")+"/v1"+c),ZiggeoApi.Options.enable_wowza_playback&&d.push(ZiggeoApi.Uris.get("wowza_http_play_url")+c+"/playlist.m3u8"),d},image:function(a,b){return b=b||ZiggeoApi.token,ZiggeoApi.Uris.get("embed_api_url")+"/v1/applications/"+b+"/videos/"+a+"/image"},source:function(a,b){var c=this.sources(a,b);return c[1]}}),ZiggeoApi.Events=new BetaJS.Events.Events,ZiggeoApi.Support={message:function(a,b){return jQuery.ajax({type:"POST",async:!1,crossDomain:!0,dataType:"json",url:"//"+ZiggeoApi.Uris.embed_api_url+"/v1/applications/"+ZiggeoApi.token+"/support/message?subject="+encodeURIComponent(a),data:b})}},BetaJS.Properties.Properties.extend("ZiggeoApi.Views.ViewData",{constructor:function(a,b){this._inherited(ZiggeoApi.Views.ViewData,"constructor"),options={};for(var c in ZiggeoApi.Params)options[c]=c in a?BetaJS.Views.View.parseType(a[c],ZiggeoApi.Params[c].type):ZiggeoApi.Params[c].def?ZiggeoApi.Params[c].def:null;b=b||{},this.set("apitoken",options.apitoken?options.apitoken:ZiggeoApi.token),this.set("popup",b.popup?!0:!1),this.set("intermediate_token",a.intermediate_token),this.set("embed_popup",options.popup?!0:!1),this.set("disable_first_screen",options.disable_first_screen?!0:!1),this.set("disable_device_test",options.disable_device_test?!0:!1),this.set("disable_timer",options.disable_timer?!0:!1),this.set("disable_snapshots",options.disable_snapshots?!0:!1),this.set("face_outline",options.face_outline?!0:!1),this.set("video_profile",options.video_profile),this.set("meta_profile",options.meta_profile),this.set("auto_crop",options.auto_crop?!0:!1),this.set("title",options.title),this.set("description",options.description),this.set("error",b.error?b.error:null),this.set("width",options.width),this.set("height",options.height),this.set("recording_width",options.recording_width),this.set("recording_height",options.recording_height),this.set("stream_width",options.stream_width),this.set("stream_height",options.stream_height),this.set("immediate_playback",options.immediate_playback?!0:!1),this.set("responsive",options.responsive?!0:!1),this.set("expiration_days",options.expiration_days?options.expiration_days:null),this.set("countdown","countdown"in options?Math.max(0,options.countdown):3),this.set("popup_width",options.popup_width),this.set("popup_height",options.popup_height),this.set("input_bind",options.input_bind),this.set("form_accept",options.form_accept),this.set("server_auth",options.server_auth),this.set("client_auth",options.client_auth),this.set("rerecordings",options.rerecordings?options.rerecordings:!1),this.set("auth_params",this.computed(function(){var a="domain="+location.hostname;return this.get("client_auth")?a+="&client_auth="+this.get("client_auth"):this.get("server_auth")?a+="&server_auth="+this.get("server_auth"):this.get("intermediate_token")&&(a+="&intermediate_token="+this.get("intermediate_token")),a},["server_auth","client_auth","intermediate_token"])),this.set("auth",this.computed(function(){return this.get("client_auth")?{client_auth:this.get("client_auth"),domain:location.hostname}:this.get("server_auth")?{server_auth:this.get("server_auth"),domain:location.hostname}:this.get("intermediate_token")?{intermediate_token:this.get("intermediate_token"),domain:location.hostname}:{}
},["server_auth","client_auth","intermediate_token"])),this.set("id",options.id),this.set("key",options.key?options.key:null),this.set("tags",options.tags?options.tags:[]),this.set("effect_profile",options.effect_profile?options.effect_profile:[]),this.set("allowed_extensions",options.allowed_extensions?options.allowed_extensions:null),this.set("default_image_selector",options.default_image_selector?options.default_image_selector:null),this.set("data",options.data?BetaJS.Types.is_string(options.data)?JSON.parse(options.data):options.data:{}),options.perms=options.perms||{},this.set("allow_upload",BetaJS.Objs.contains_value(options.perms,"allowupload")),this.set("allow_record",!BetaJS.Objs.contains_value(options.perms,"forbidrecord")&&!BetaJS.Browser.Info.isMobile()&&ZiggeoApi.Options.enable_wowza_recording),this.set("allow_switch",!BetaJS.Objs.contains_value(options.perms,"forbidswitch")&&this.get("allow_upload")&&this.get("allow_record")),this.set("allow_rerecord",!BetaJS.Objs.contains_value(options.perms,"forbidrerecord")),this.set("submit_mode",this.get("allow_record")?"recorder":"uploader"),this.set("video",{token:options.video}),this.set("stream",{token:options.stream}),this.set("time_limit",options.limit);var d=.85*BetaJS.$(window).width()/this.get("popup_width"),e=.85*BetaJS.$(window).height()/this.get("popup_height"),f=Math.min(d,e);if(1>f&&(this.set("popup_width",Math.floor(this.get("popup_width")*f)),this.set("popup_height",Math.floor(this.get("popup_height")*f))),this.set("player_params",this.computed(function(){return(this.get("stream_width")?"stream_width="+this.get("stream_width"):"")+"&"+(this.get("stream_height")?"stream_height="+this.get("stream_height"):"")+"&"+(this.get("effect_profile")?"effect_profile="+this.get("effect_profile").toString():"")},["stream_width","stream_height"])),this.set("actual_width",this.computed(function(){return this.get("popup")?this.get("popup_width"):this.get("width")},["width","popup_width","popup"])),this.set("actual_height",this.computed(function(){return this.get("popup")?this.get("popup_height"):this.get("height")},["height","popup_height","popup"])),this.set("image",this.computed(function(){var a=null;return this.get("video").token&&(a=this.get("stream").token?ZiggeoApi.Streams.image(this.get("video").token,this.get("stream").token,this.get("apitoken"))+"?"+this.get("auth_params")+"&"+this.get("player_params"):ZiggeoApi.Videos.image(this.get("video").token,this.get("apitoken"))+"?"+this.get("auth_params")+"&"+this.get("player_params")),a},["video","stream","auth_params","player_params"])),this.set("sources",this.computed(function(){var a=null;if(this.get("video").token){a=this.get("stream").token?ZiggeoApi.Streams.sources(this.get("video").token,this.get("stream").token,this.get("apitoken")):ZiggeoApi.Videos.sources(this.get("video").token,this.get("apitoken"));for(var b=0;b<a.length;++b)a[b]=a[b]+"?"+this.get("auth_params")+"&"+this.get("player_params")}return a},["video","stream","auth_params","player_params"])),this.set("mode","error"),options.modes=options.modes||[],!this.get("error"))if(0===options.modes.length)this.set("mode",this.get("video").token?"player":"recorder");else if(1==options.modes.length)this.set("mode",options.modes[0]);else if(BetaJS.Objs.contains_value(options.modes,"rerecorder")&&BetaJS.Objs.contains_value(options.modes,"player"))this.set("error","You cannot combine player and rerecorder");else{var g=BetaJS.Objs.contains_value(options.modes,"rerecorder")?"rerecorder":"player";try{var h=ZiggeoApi.Videos.get(this.get("video").token,null,this.get("auth"),this.get("apitoken"));this.set("video",h),this.set("mode",g)}catch(i){this.set("key",BetaJS.Strings.strip_start(this.get("video").token,"_")),this.set("video",{token:null}),this.set("mode","recorder")}}this.get("video").token&&!this.get("key")&&BetaJS.Strings.starts_with(this.get("video").token,"_")&&this.set("key",BetaJS.Strings.strip_start(this.get("video").token,"_")),this.set("uriparams",this.computed(function(){return BetaJS.Net.Uri.encodeUriParams({tags:this.get("tags").join(","),effect_profile:this.get("effect_profile").join(","),data:JSON.stringify(this.get("data")),key:this.get("key"),expiration_days:this.get("expiration_days"),auto_crop:this.get("auto_crop"),default_image_selector:this.get("default_image_selector"),video_profile:this.get("video_profile"),meta_profile:this.get("meta_profile"),title:this.get("title"),description:this.get("description")})},["tags","key"]))}}),BetaJS.Templates.Cached=BetaJS.Templates.Cached||{},BetaJS.Templates.Cached["ziggeo-view-error-template"]="  <div class='view-player-not-ready-outer' style='width: {%= width %}px; height: {%= height %}px'>   <div class='view-player-not-ready-inner' style='font-size:{%= Math.floor((width + height) / 20) %}px; padding-left:{%= Math.floor(width / 10) %}px; padding-right:{%= Math.floor(width / 10) %}px'>    {%= error %}   </div>  </div> ",BetaJS.Views.View.extend("ZiggeoApi.Views.ZiggeoErrorView",{_templates:{"default":BetaJS.Templates.Cached["ziggeo-view-error-template"]},constructor:function(a){this._inherited(ZiggeoApi.Views.ZiggeoErrorView,"constructor",a),this.view_data=a.view_data,this._setOptionProperty(a,"width",this.view_data.get("actual_width")),this._setOptionProperty(a,"height",this.view_data.get("actual_height")),this.set("error",this.view_data.get("error")?this.view_data.get("error"):"An unknown error has occurred")}}),BetaJS.Views.View.extend("ZiggeoApi.Views.ZiggeoPlayerView",{constructor:function(a){this._inherited(ZiggeoApi.Views.ZiggeoPlayerView,"constructor",a),this.view_data=a.view_data,this.view=this.view_data.get("embed_popup")?this.addChild(new BetaJS.Views.ImageOverlayVideoPlayerView({el:"",sources:this.view_data.get("sources"),meta:{video_width:this.view_data.get("popup_width"),video_height:this.view_data.get("popup_height"),image:this.view_data.get("image"),fit:"minimize"},image_meta:{width:this.view_data.get("width"),height:this.view_data.get("height"),image:this.view_data.get("image"),fit:"maximize",responsive:this.view_data.get("responsive")}})):this.addChild(new BetaJS.Views.VideoPlayerView({el:"",sources:this.view_data.get("sources"),meta:{video_width:this.view_data.get("actual_width"),video_height:this.view_data.get("actual_height"),image:this.view_data.get("image"),fit:"maximize",responsive:this.view_data.get("responsive")}})),this.view.on("image-error",function(){var a=this;ZiggeoApi.Videos.get(this.view_data.get("video").token,{success:function(){a.view.image_view.showStatus("The video is not ready. It is processing or under moderation.")},failure:function(b,c){a.view.image_view.showStatus(c.status_text())}},this.view_data.get("auth"),this.view_data.get("apitoken"))},this),this.view.on("play",function(){ZiggeoApi.Events.triggerAsync("play",this.view_data.getAll())},this).on("pause",function(){ZiggeoApi.Events.triggerAsync("pause",this.view_data.getAll())},this).on("stop",function(){ZiggeoApi.Events.triggerAsync("stop",this.view_data.getAll())},this).on("error",function(a){this.view_data.set("error",a),ZiggeoApi.Events.triggerAsync("error_player",this.view_data.getAll()),BetaJS.Views.VideoPlayerView.on_error(this.view,this.view_data.getAll())},this)},play:function(){this.view.play()},stop:function(){this.view.stop()},stopRecord:function(){}}),BetaJS.Views.View.extend("ZiggeoApi.Views.ZiggeoRecorderView",{constructor:function(a){this._inherited(ZiggeoApi.Views.ZiggeoRecorderView,"constructor",a),this.view_data=a.view_data,this.set("submittable","rerecorder"==this.view_data.get("mode"));var b=null;"rerecorder"==this.view_data.get("mode")&&(b="applications/"+this.view_data.get("apitoken")+"/videos/"+this.view_data.get("video").token,this.view_data.get("stream").token&&(b+="/streams/"+this.view_data.get("stream").token),b+="/video.mp4?"+this.view_data.get("auth_params")),this.view=this.addChild(new BetaJS.Views.VideoRecorder({recorder_swf:ZiggeoApi.Uris.get("recorder_swfsrc")+"?v="+ZiggeoApi.Config.revision,el:"",play_stream:{file_type:ZiggeoApi.Options.recording_type,server:ZiggeoApi.Uris.get("wowza_rtmp_play_url"),vcodec:ZiggeoApi.Options.vcodec,cookie:ZiggeoApi.Connect.__cookieName(),file:b},record_stream:{file_type:ZiggeoApi.Options.recording_type,server:ZiggeoApi.Uris.get("wowza_rtmp_record_url"),vcodec:ZiggeoApi.Options.vcodec,acodec:"speex",cookie:ZiggeoApi.Connect.__cookieName()},type:"rerecorder"==this.view_data.get("mode")?"player":"recorder",first_screen:!this.view_data.get("disable_first_screen"),disable_timer:this.view_data.get("disable_timer"),disable_snapshots:this.view_data.get("disable_snapshots"),face_outline:this.view_data.get("face_outline"),device_test:!this.view_data.get("disable_device_test"),allow_rerecord:this.view_data.get("allow_rerecord"),immediate_playback:this.view_data.get("immediate_playback"),rerecord_limit:this.view_data.binding("rerecordings"),recorder_width:this.view_data.get("actual_width"),recorder_height:this.view_data.get("actual_height"),camera_width:this.view_data.get("recording_width"),camera_height:this.view_data.get("recording_height"),responsive:this.view_data.get("responsive"),snapshots_type:ZiggeoApi.Options.image_type,snapshots_quality:70,external_upload:this.view_data.get("allow_switch"),time_limit:this.view_data.get("time_limit"),recording_countdown:this.view_data.get("countdown"),initial_image:"rerecorder"==this.view_data.get("mode")?this.view_data.get("image"):null})),this.view.on("state:RecorderBeforeRecording",function(){var a=this;this.view.state().suspend();var b=function(){var b="applications/"+a.view_data.get("apitoken"),c="/videos/"+a.view_data.get("video").token+"/streams/"+a.view_data.get("stream").token;a.view.set("snapshots_post",ZiggeoApi.Connect._uri(c+"/imageattach")+"?"+a.view_data.get("auth_params")),a.view.get("play_stream").file=b+c+"/video.mp4?"+a.view_data.get("auth_params"),a.view.get("record_stream").file=b+c+"/video.mp4?"+a.view_data.get("auth_params"),a.view.api().config_set("snapshots_post",a.view.get("snapshots_post")),a.view.api().config_set("play_stream_file",a.view.get("play_stream").file),a.view.api().config_set("record_stream_file",a.view.get("record_stream").file),a.__update_form_input(),a.view.state().resume()},c=function(b){a.view.user_error(BetaJS.Types.is_string(b.data())&&b.data()?b.data():"Could not create video."),a.view.trigger("error","user_error",b.json()),a.view.state().resume()};this.view_data.get("video").token?ZiggeoApi.Streams.create(this.view_data.get("video").token,{flash_recording:!0},{success:function(c,d,e){a.view_data.set("stream",e),b(e)},failure:function(a,b,d){c(d)}},this.view_data.get("auth"),this.view_data.get("apitoken")):ZiggeoApi.Videos.create({flash_recording:!0,tags:this.view_data.get("tags").join(","),effect_profile:this.view_data.get("effect_profile").join(","),data:JSON.stringify(this.view_data.get("data")),key:this.view_data.get("key"),expiration_days:this.view_data.get("expiration_days"),auto_crop:this.view_data.get("auto_crop"),default_image_selector:this.view_data.get("default_image_selector"),video_profile:this.view_data.get("video_profile"),meta_profile:this.view_data.get("meta_profile"),title:this.view_data.get("title"),description:this.view_data.get("description")},{success:function(c,d){a.view_data.set("video",d.video),a.view_data.set("stream",d.stream),b(d)},failure:function(a,b){c(b)}},this.view_data.get("auth"),this.view_data.get("apitoken"))},this),this.view.on("stop",function(){ZiggeoApi.Events.triggerAsync("stop",this.view_data.getAll())},this),this.view.on("state:RecorderDeviceReady",function(){ZiggeoApi.Events.triggerAsync("ready_to_record",this.view_data.getAll())},this),this.view.on("state:RecorderRecording",function(){ZiggeoApi.Events.triggerAsync("recording",this.view_data.getAll())},this),this.view.on("recording_submitted",function(a){this.view_data.get("video").duration=a.duration/1e3,this.view_data.get("stream").duration=this.view_data.get("video").duration,this.view.state().suspend();var b=10,c=function(){ZiggeoApi.Streams._recorder_submit(this.view_data.get("video").token,this.view_data.get("stream").token,this.view_data.get("uriparams"),{success:function(){this.set("submittable",!0),ZiggeoApi.Events.triggerAsync("submitted",this.view_data.getAll()),this.view.state().resume()},failure:function(a,d){0>=b?(this.view.user_error(BetaJS.Types.is_string(d.data())?d.data():"Could not submit video"),this.view.trigger("error","user_error",d.json())):(b--,c.apply(this))},context:this},this.view_data.get("auth"))};c.apply(this)},this),this.view.on("recording_discarded",function(){this.set("submittable",!1),ZiggeoApi.Events.triggerAsync("discarded",this.view_data.getAll())},this),this.view.on("recording_finished",function(){ZiggeoApi.Events.triggerAsync("finished",this.view_data.getAll())},this),this.view.on("external_upload",function(){this.set("submittable",!1),this.trigger("external_upload")},this),this.view.on("error",function(a,b){this.view_data.set("error",b),ZiggeoApi.Events.triggerAsync("error_recorder",this.view_data.getAll()),BetaJS.Views.VideoSubmitter.on_error(this.view,this.view_data.getAll())},this),this.view.on("countdown",function(a){ZiggeoApi.Events.triggerAsync("countdown",a,this.view_data.getAll())},this),this.view.on("elapsed",function(a){ZiggeoApi.Events.triggerAsync("elapsed",a,this.view_data.getAll())},this)},record:function(){this.view.state().record()},_notifications:{activate:"__activate_view",deactivate:"__deactivate_view"},__activate_view:function(){if(this.__update_form_input(),this.view_data.get("form_accept")){var a=this;BetaJS.$(this.view_data.get("form_accept")).on("submit."+this.cid(),function(){return a.get("submittable")})}},__deactivate_view:function(){if(this.view_data.get("form_accept")){BetaJS.$(this.view_data.get("form_accept")).off("submit."+this.cid())}},__update_form_input:function(){if(this.view_data.get("input_bind")&&this.view_data.get("video")&&this.view_data.get("video").token){var a=BetaJS.$("[name='"+this.view_data.get("input_bind")+"']");a.length>0?a.val(this.view_data.get("video").token):this.$el.parent().append("<input type='hidden' id='"+this.view_data.get("input_bind")+"' name='"+this.view_data.get("input_bind")+"' value='"+this.view_data.get("video").token+"' />")}},stop:function(){this.view.stop()},play:function(){this.view.play()},stopRecord:function(){this.view.stopRecord()}}),BetaJS.Views.View.extend("ZiggeoApi.Views.ZiggeoRTCRecorderView",{constructor:function(a){this._inherited(ZiggeoApi.Views.ZiggeoRTCRecorderView,"constructor",a),this.view_data=a.view_data;var b=this.view_data.get("auth_params");this.set("submittable","rerecorder"==this.view_data.get("mode")),this.view=this.addChild(new BetaJS.Views.VideoRTCRecorder({el:"",type:"rerecorder"==this.view_data.get("mode")?"player":"recorder",el_styles:{"background-color":"#333333"},allow_custom_file:this.view_data.get("allow_upload"),allow_rerecord:this.view_data.get("allow_rerecord"),rerecord_limit:this.view_data.binding("rerecordings"),external_record:this.view_data.get("allow_switch"),recorder_width:this.view_data.get("actual_width"),recorder_height:this.view_data.get("actual_height"),immediate_playback:this.view_data.get("immediate_playback"),responsive:this.view_data.get("responsive"),time_limit:this.view_data.get("time_limit"),recording_countdown:this.view_data.get("countdown"),recorder_config:{submit:this.view_data.get("video").token?ZiggeoApi.Connect._uri("/videos/"+this.view_data.get("video").token+"/streams?"+this.view_data.get("uriparams")+b):ZiggeoApi.Connect._uri("/videos?"+this.view_data.get("uriparams")+b)},player_config:{image:this.view_data.get("image"),sources:this.view_data.get("sources")}})),this.view.on("stop",function(){ZiggeoApi.Events.triggerAsync("stop",this.view_data.getAll())},this),this.view.on("state:RecorderDeviceReady",function(){ZiggeoApi.Events.triggerAsync("ready_to_record",this.view_data.getAll())},this),this.view.on("recording_uploaded",function(a){this.view_data.get("video").token?this.view_data.set("stream",a):(this.view_data.set("video",a.video),this.view_data.set("stream",a.stream)),this.view_data.get("video").duration=this.view_data.get("stream").duration,this.view.get("recorder_config").state=ZiggeoApi.Connect._uri("/videos/"+this.view_data.get("video").token+"/streams/"+this.view_data.get("stream").token+"/uploaderstate")+"?"+this.view_data.get("auth_params"),this.view.get("recorder_config").submit=ZiggeoApi.Connect._uri("/videos/"+this.view_data.get("video").token+"/streams")+"?"+this.view_data.get("uriparams")+"&"+this.view_data.get("auth_params"),this.__update_form_input()},this),this.view.on("recording_submitted",function(){this.set("submittable",!0),ZiggeoApi.Events.triggerAsync("submitted",this.view_data.getAll())},this),this.view.on("recording_discarded",function(){this.set("submittable",!1),ZiggeoApi.Events.triggerAsync("discarded",this.view_data.getAll())},this),this.view.on("recording_finished",function(){ZiggeoApi.Events.triggerAsync("finished",this.view_data.getAll())},this),this.view.on("external_record",function(){this.set("submittable",!1),this.trigger("external_record")},this),this.view.on("error",function(a,b){this.view_data.set("error",b),ZiggeoApi.Events.triggerAsync("error_recorder",this.view_data.getAll()),BetaJS.Views.VideoSubmitter.on_error(this.view,this.view_data.getAll())},this)},_notifications:{activate:"__activate_view",deactivate:"__deactivate_view"},__activate_view:function(){if(this.__update_form_input(),this.view_data.get("form_accept")){var a=this;BetaJS.$(this.view_data.get("form_accept")).on("submit."+this.cid(),function(){return a.get("submittable")})}},__deactivate_view:function(){if(this.view_data.get("form_accept")){BetaJS.$(this.view_data.get("form_accept")).off("submit."+this.cid())}},__update_form_input:function(){if(this.view_data.get("input_bind")&&this.view_data.get("video")&&this.view_data.get("video").token){var a=BetaJS.$("[name='"+this.view_data.get("input_bind")+"']");a.length>0?a.val(this.view_data.get("video").token):this.$el.parent().append("<input type='hidden' id='"+this.view_data.get("input_bind")+"' name='"+this.view_data.get("input_bind")+"' value='"+this.view_data.get("video").token+"' />")}},play:function(){this.view.play()},stop:function(){this.view.stop()},stopRecord:function(){this.view.stopRecord()}}),BetaJS.Views.View.extend("ZiggeoApi.Views.ZiggeoUploaderView",{constructor:function(a){this._inherited(ZiggeoApi.Views.ZiggeoUploaderView,"constructor",a),this.view_data=a.view_data;var b=this.view_data.get("auth_params");this.set("submittable","rerecorder"==this.view_data.get("mode")),this.view=this.addChild(new BetaJS.Views.VideoUploader({el:"",type:"rerecorder"==this.view_data.get("mode")?"player":"recorder",el_styles:{"background-color":"#333333"},allow_custom_file:this.view_data.get("allow_upload"),allow_rerecord:this.view_data.get("allow_rerecord"),rerecord_limit:this.view_data.binding("rerecordings"),external_record:this.view_data.get("allow_switch"),recorder_width:this.view_data.get("actual_width"),recorder_height:this.view_data.get("actual_height"),immediate_playback:this.view_data.get("immediate_playback"),allowed_extensions:BetaJS.Browser.Info.isMobile()?null:this.view_data.get("allowed_extensions"),responsive:this.view_data.get("responsive"),recorder_config:{submit:this.view_data.get("video").token?ZiggeoApi.Connect._uri("/videos/"+this.view_data.get("video").token+"/streams?"+this.view_data.get("uriparams")+b):ZiggeoApi.Connect._uri("/videos?"+this.view_data.get("uriparams")+b)},player_config:{image:this.view_data.get("image"),sources:this.view_data.get("sources")}})),this.view.on("stop",function(){ZiggeoApi.Events.triggerAsync("stop",this.view_data.getAll())},this),this.view.on("state:UploadingState",function(){ZiggeoApi.Events.triggerAsync("ready_to_record",this.view_data.getAll())},this),this.view.on("recording_uploaded",function(a){this.view_data.get("video").token?this.view_data.set("stream",a):(this.view_data.set("video",a.video),this.view_data.set("stream",a.stream)),this.view_data.get("video").duration=this.view_data.get("stream").duration,this.view.get("recorder_config").state=ZiggeoApi.Connect._uri("/videos/"+this.view_data.get("video").token+"/streams/"+this.view_data.get("stream").token+"/uploaderstate")+"?"+this.view_data.get("auth_params"),this.view.get("recorder_config").submit=ZiggeoApi.Connect._uri("/videos/"+this.view_data.get("video").token+"/streams")+"?"+this.view_data.get("uriparams")+"&"+this.view_data.get("auth_params"),this.__update_form_input()},this),this.view.on("recording_submitted",function(){this.set("submittable",!0),ZiggeoApi.Events.triggerAsync("submitted",this.view_data.getAll())},this),this.view.on("recording_discarded",function(){this.set("submittable",!1),ZiggeoApi.Events.triggerAsync("discarded",this.view_data.getAll())},this),this.view.on("external_record",function(){this.set("submittable",!1),this.trigger("external_record")},this),this.view.on("recording_finished",function(){ZiggeoApi.Events.triggerAsync("finished",this.view_data.getAll())},this),this.view.on("error",function(a,b){this.view_data.set("error",b),ZiggeoApi.Events.triggerAsync("error_recorder",this.view_data.getAll()),BetaJS.Views.VideoSubmitter.on_error(this.view,this.view_data.getAll())},this)},_notifications:{activate:"__activate_view",deactivate:"__deactivate_view"},__activate_view:function(){if(this.__update_form_input(),this.view_data.get("form_accept")){var a=this;BetaJS.$(this.view_data.get("form_accept")).on("submit."+this.cid(),function(){return a.get("submittable")})}},__deactivate_view:function(){if(this.view_data.get("form_accept")){BetaJS.$(this.view_data.get("form_accept")).off("submit."+this.cid())}},__update_form_input:function(){if(this.view_data.get("input_bind")&&this.view_data.get("video")&&this.view_data.get("video").token){var a=BetaJS.$("[name='"+this.view_data.get("input_bind")+"']");a.length>0?a.val(this.view_data.get("video").token):this.$el.parent().append("<input type='hidden' id='"+this.view_data.get("input_bind")+"' name='"+this.view_data.get("input_bind")+"' value='"+this.view_data.get("video").token+"' />")}},play:function(){this.view.play()},stop:function(){this.view.stop()},stopRecord:function(){}}),BetaJS.Views.View.extend("ZiggeoApi.Views.ZiggeoView",{_notifications:{preactivate:"__preactivate_view"},constructor:function(a){a=a||{},this.original_options=a,this.view_data=new ZiggeoApi.Views.ViewData(a,a.params),this.view_data.get("responsive")||(a.el_styles={width:this.view_data.get("width"),height:this.view_data.get("height")}),this._inherited(ZiggeoApi.Views.ZiggeoView,"constructor",a),this.view_data.get("id")&&(ZiggeoApi.Embed.__ids[this.view_data.get("id")]=this),ZiggeoApi.Embed.__views[this.cid()]=this,this.__attach()},destroy:function(){delete ZiggeoApi.Embed.__views[this.cid()],this.view_data.get("id")&&ZiggeoApi.Embed.__ids[this.view_data.get("id")]==this&&delete ZiggeoApi.Embed.__ids[this.view_data.get("id")],this._inherited(ZiggeoApi.Views.ZiggeoView,"destroy")},__preactivate_view:function(){if(this.view_data.get("responsive")){var a=parseInt(this.$el.parent().parent().css("width"),10);if(a){var b=parseInt(this.$el.parent().parent().css("height"),10);b||(b=Math.floor(a*this.view_data.get("height")/this.view_data.get("width"))),this.$el.parent().css("width",a+"px"),this.$el.parent().css("height",b+"px"),this.$el.parent().css("display","inline-block")}}},__attach:function(){this.view&&this.view.destroy();var a=ZiggeoApi.Views.ZiggeoErrorView;return ZiggeoApi.Options.maintenance?(this.view_data.set("error","We are maintaining our service. Videos will be back soon."),this.view=this.addChild(new a({el:"",view_data:this.view_data})),void 0):("player"==this.view_data.get("mode")?a=ZiggeoApi.Views.ZiggeoPlayerView:("recorder"==this.view_data.get("mode")||"rerecorder"==this.view_data.get("mode"))&&(a="recorder"==this.view_data.get("submit_mode")?ZiggeoApi.Views.ZiggeoRecorderView:ZiggeoApi.Views.ZiggeoUploaderView),a==ZiggeoApi.Views.ZiggeoRecorderView&&ZiggeoApi.Config.webrtc&&BetaJS.Views.WebRTC.supported()&&(a=ZiggeoApi.Views.ZiggeoRTCRecorderView),this.view=this.addChild(new a({el:"",view_data:this.view_data})),this.view.on("external_upload external_record",function(){this.view_data.set("submit_mode","recorder"==this.view_data.get("submit_mode")?"uploader":"recorder"),this.__attach()},this),void 0)},play:function(){this.view.play()},record:function(){this.view.record()},stop:function(){this.view.stop()},stopRecord:function(){this.view.stopRecord()},hidePopup:function(){var a=this.getParent();a&&"unfocus"in a&&a.unfocus()},reset:function(){this.view_data=new ZiggeoApi.Views.ViewData(this.original_options,this.original_options.params),this.__attach()},hide_popup:function(){this.hidePopup()}}),ZiggeoApi.Embed={__ids:{},__views:{},popup:function(a,b){var c=new ZiggeoApi.Views.ZiggeoView(BetaJS.Objs.extend(a||{},{params:BetaJS.Objs.extend(b||{},{popup:!0})}));return new BetaJS.Views.FullscreenOverlayView({overlay_inner:c,destroy_on_unfocus:!0}).activate().show(),c},embed:function(a,b,c){return new ZiggeoApi.Views.ZiggeoView(BetaJS.Objs.extend(b||{},{el:a,params:BetaJS.Objs.extend(c||{},{popup:!1})})).activate()},get:function(a){return this.__ids[a]},_update_runtime:function(){for(var a in this.__views)this.__views[a].__attach()}},BetaJS.Views.ActiveDom.registerViewAlias("ziggeo",ZiggeoApi.Views.ZiggeoView),BetaJS.Views.ActiveDom.registerPrefixAlias("ziggeo"),BetaJS.Views.ActiveDom.activate(),BetaJS.Views.VideoPlayerView.Players.JWPlayer6.setup({src:ZiggeoApi.Uris.get("jwplayer6_src"),swfsrc:ZiggeoApi.Uris.get("jwplayer6_swfsrc"),key:ZiggeoApi.Config.jwplayer6_key}),BetaJS.Views.VideoPlayerView.Players.JWPlayer5.setup({src:ZiggeoApi.Uris.get("jwplayer5_src"),swfsrc:ZiggeoApi.Uris.get("jwplayer5_swfsrc")}),BetaJS.Views.VideoPlayerView.setup({rules:BetaJS.Views.VideoPlayerView.Players.JWPlayer5.Rules.oldiOSRules.concat(BetaJS.Views.VideoPlayerView.Players.JWPlayer6.Rules.defaultRules)}),BetaJS.Views.VideoPlayerImageView.defaultPlayButton=function(){return{play_button:BetaJS.Views.LabelView,play_button_options:function(){return{label:"<i class='bjs-icon-play'></i>",el_classes:"view-player-play-label "+ZiggeoApi.Styles.play_button_class}},play_button_vertical_align:ZiggeoApi.Styles.play_button_vertical_align,play_button_horizontal_align:ZiggeoApi.Styles.play_button_horizontal_align}},BetaJS.Views.VideoPlayerView.on_error=function(a,b){var c={message:b.error,location:document.location+"",browser:JSON.stringify(BetaJS.Browser.Info.getNavigator()),flash:BetaJS.Browser.Info.flash().installed()?BetaJS.Browser.Info.flash().version():!1,uri:player.player().source()?player.player().source().uri:!1,player:player.player().rule()?player.player().rule().player().playername():!1,sources:player.player().raw_sources,data:b};console.log(c)},BetaJS.Browser.Info.isInternetExplorer()&&BetaJS.Browser.Info.internetExplorerVersion()<=9&&BetaJS.Browser.Loader.inlineStyles(".ziggeo-play-button { background-image: none; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+ZiggeoApi.Uris.get("assets_url")+"/img/button_play_hover.png',sizingMethod='scale'); }"),BetaJS.Views.VideoUploader.setup({allow_custom_file:!0}),BetaJS.Views.VideoSubmitter.setup({allow_rerecord:!0,allow_to_switch:!1,mode:"recorder"}),BetaJS.Views.VideoRecorder.setup({disable_swf_cache:!1,recording_countdown:5,allow_rerecord:!0,snapshots:4,flip_video:!0,player_remaining_time:!0,camera_width:640,camera_height:480}),BetaJS.Views.VideoSubmitter.on_error=function(a,b){var c={message:b.error,location:document.location+"",browser:JSON.stringify(BetaJS.Browser.Info.getNavigator()),flash:BetaJS.Browser.Info.flash().installed()?BetaJS.Browser.Info.flash().version():!1,view_data:b};console.log(c)},function(){var a=BetaJS.$.noConflict(!0);window.$||(window.$=a)}.call(this);